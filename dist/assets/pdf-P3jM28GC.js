var Sv=Object.defineProperty;var Bp=d=>{throw TypeError(d)};var xv=(d,e,t)=>e in d?Sv(d,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):d[e]=t;var F=(d,e,t)=>xv(d,typeof e!="symbol"?e+"":e,t),Bu=(d,e,t)=>e.has(d)||Bp("Cannot "+t);var n=(d,e,t)=>(Bu(d,e,"read from private field"),t?t.call(d):e.get(d)),y=(d,e,t)=>e.has(d)?Bp("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(d):e.set(d,t),g=(d,e,t,s)=>(Bu(d,e,"write to private field"),s?s.call(d,t):e.set(d,t),t),w=(d,e,t)=>(Bu(d,e,"access private method"),t);var ie=(d,e,t,s)=>({set _(i){g(d,e,i,t)},get _(){return n(d,e,s)}});var Tv={34:(d,e,t)=>{var s=t(4901);d.exports=function(i){return typeof i=="object"?i!==null:s(i)}},81:(d,e,t)=>{var s=t(9565),i=t(9306),r=t(8551),a=t(6823),o=t(851),l=TypeError;d.exports=function(h,c){var u=arguments.length<2?o(h):c;if(i(u))return r(s(u,h));throw new l(a(h)+" is not iterable")}},116:(d,e,t)=>{var s=t(6518),i=t(9565),r=t(2652),a=t(9306),o=t(8551),l=t(1767),h=t(9539),c=t(4549),u=c("find",TypeError);s({target:"Iterator",proto:!0,real:!0,forced:u},{find:function(p){o(this);try{a(p)}catch(A){h(this,"throw",A)}if(u)return i(u,this,p);var v=l(this),m=0;return r(v,function(A,b){if(p(A,m++))return b(A)},{IS_RECORD:!0,INTERRUPTED:!0}).result}})},283:(d,e,t)=>{var s=t(9504),i=t(9039),r=t(4901),a=t(9297),o=t(3724),l=t(350).CONFIGURABLE,h=t(3706),c=t(1181),u=c.enforce,f=c.get,p=String,v=Object.defineProperty,m=s("".slice),A=s("".replace),b=s([].join),S=o&&!i(function(){return v(function(){},"length",{value:8}).length!==8}),E=String(String).split("String"),T=d.exports=function(x,C,R){m(p(C),0,7)==="Symbol("&&(C="["+A(p(C),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),R&&R.getter&&(C="get "+C),R&&R.setter&&(C="set "+C),(!a(x,"name")||l&&x.name!==C)&&(o?v(x,"name",{value:C,configurable:!0}):x.name=C),S&&R&&a(R,"arity")&&x.length!==R.arity&&v(x,"length",{value:R.arity});try{R&&a(R,"constructor")&&R.constructor?o&&v(x,"prototype",{writable:!1}):x.prototype&&(x.prototype=void 0)}catch{}var I=u(x);return a(I,"source")||(I.source=b(E,typeof C=="string"?C:"")),x};Function.prototype.toString=T(function(){return r(this)&&f(this).source||h(this)},"toString")},350:(d,e,t)=>{var s=t(3724),i=t(9297),r=Function.prototype,a=s&&Object.getOwnPropertyDescriptor,o=i(r,"name"),l=o&&(function(){}).name==="something",h=o&&(!s||s&&a(r,"name").configurable);d.exports={EXISTS:o,PROPER:l,CONFIGURABLE:h}},397:(d,e,t)=>{var s=t(7751);d.exports=s("document","documentElement")},421:d=>{d.exports={}},456:(d,e,t)=>{var s=t(6518),i=t(4576),r=t(9504),a=t(4154),o=t(5169),l=r(1.1.toString),h=i.Uint8Array,c=!h||!h.prototype.toHex||!function(){try{var u=new h([255,255,255,255,255,255,255,255]);return u.toHex()==="ffffffffffffffff"}catch{return!1}}();h&&s({target:"Uint8Array",proto:!0,forced:c},{toHex:function(){a(this),o(this.buffer);for(var f="",p=0,v=this.length;p<v;p++){var m=l(this[p],16);f+=m.length===1?"0"+m:m}return f}})},507:(d,e,t)=>{var s=t(9565);d.exports=function(i,r,a){for(var o=a?i:i.iterator,l=i.next,h,c;!(h=s(l,o)).done;)if(c=r(h.value),c!==void 0)return c}},531:(d,e,t)=>{var s=t(6518),i=t(9565),r=t(9306),a=t(8551),o=t(1767),l=t(8646),h=t(9462),c=t(9539),u=t(6395),f=t(684),p=t(4549),v=!u&&!f("flatMap",function(){}),m=!u&&!v&&p("flatMap",TypeError),A=u||v||m,b=h(function(){for(var S=this.iterator,E=this.mapper,T,x;;){if(x=this.inner)try{if(T=a(i(x.next,x.iterator)),!T.done)return T.value;this.inner=null}catch(C){c(S,"throw",C)}if(T=a(i(this.next,S)),this.done=!!T.done)return;try{this.inner=l(E(T.value,this.counter++),!1)}catch(C){c(S,"throw",C)}}});s({target:"Iterator",proto:!0,real:!0,forced:A},{flatMap:function(E){a(this);try{r(E)}catch(T){c(this,"throw",T)}return m?i(m,this,E):new b(o(this),{mapper:E,inner:null})}})},616:(d,e,t)=>{var s=t(9039);d.exports=!s(function(){var i=(function(){}).bind();return typeof i!="function"||i.hasOwnProperty("prototype")})},655:(d,e,t)=>{var s=t(6955),i=String;d.exports=function(r){if(s(r)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return i(r)}},679:(d,e,t)=>{var s=t(1625),i=TypeError;d.exports=function(r,a){if(s(a,r))return r;throw new i("Incorrect invocation")}},684:d=>{d.exports=function(e,t){var s=typeof Iterator=="function"&&Iterator.prototype[e];if(s)try{s.call({next:null},t).next()}catch{return!0}}},741:d=>{var e=Math.ceil,t=Math.floor;d.exports=Math.trunc||function(i){var r=+i;return(r>0?t:e)(r)}},757:(d,e,t)=>{var s=t(7751),i=t(4901),r=t(1625),a=t(7040),o=Object;d.exports=a?function(l){return typeof l=="symbol"}:function(l){var h=s("Symbol");return i(h)&&r(h.prototype,o(l))}},851:(d,e,t)=>{var s=t(6955),i=t(5966),r=t(4117),a=t(6269),o=t(8227),l=o("iterator");d.exports=function(h){if(!r(h))return i(h,l)||i(h,"@@iterator")||a[s(h)]}},944:d=>{var e=TypeError;d.exports=function(t){var s=t&&t.alphabet;if(s===void 0||s==="base64"||s==="base64url")return s||"base64";throw new e("Incorrect `alphabet` option")}},1072:(d,e,t)=>{var s=t(1828),i=t(8727);d.exports=Object.keys||function(a){return s(a,i)}},1103:d=>{d.exports=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}}},1108:(d,e,t)=>{var s=t(6955);d.exports=function(i){var r=s(i);return r==="BigInt64Array"||r==="BigUint64Array"}},1148:(d,e,t)=>{var s=t(6518),i=t(9565),r=t(2652),a=t(9306),o=t(8551),l=t(1767),h=t(9539),c=t(4549),u=c("every",TypeError);s({target:"Iterator",proto:!0,real:!0,forced:u},{every:function(p){o(this);try{a(p)}catch(A){h(this,"throw",A)}if(u)return i(u,this,p);var v=l(this),m=0;return!r(v,function(A,b){if(!p(A,m++))return b()},{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},1181:(d,e,t)=>{var s=t(8622),i=t(4576),r=t(34),a=t(6699),o=t(9297),l=t(7629),h=t(6119),c=t(421),u="Object already initialized",f=i.TypeError,p=i.WeakMap,v,m,A,b=function(x){return A(x)?m(x):v(x,{})},S=function(x){return function(C){var R;if(!r(C)||(R=m(C)).type!==x)throw new f("Incompatible receiver, "+x+" required");return R}};if(s||l.state){var E=l.state||(l.state=new p);E.get=E.get,E.has=E.has,E.set=E.set,v=function(x,C){if(E.has(x))throw new f(u);return C.facade=x,E.set(x,C),C},m=function(x){return E.get(x)||{}},A=function(x){return E.has(x)}}else{var T=h("state");c[T]=!0,v=function(x,C){if(o(x,T))throw new f(u);return C.facade=x,a(x,T,C),C},m=function(x){return o(x,T)?x[T]:{}},A=function(x){return o(x,T)}}d.exports={set:v,get:m,has:A,enforce:b,getterFor:S}},1291:(d,e,t)=>{var s=t(741);d.exports=function(i){var r=+i;return r!==r||r===0?0:s(r)}},1385:(d,e,t)=>{var s=t(9539);d.exports=function(i,r,a){for(var o=i.length-1;o>=0;o--)if(i[o]!==void 0)try{a=s(i[o].iterator,r,a)}catch(l){r="throw",a=l}if(r==="throw")throw a;return a}},1548:(d,e,t)=>{var s=t(4576),i=t(9039),r=t(9519),a=t(4215),o=s.structuredClone;d.exports=!!o&&!i(function(){if(a==="DENO"&&r>92||a==="NODE"&&r>94||a==="BROWSER"&&r>97)return!1;var l=new ArrayBuffer(8),h=o(l,{transfer:[l]});return l.byteLength!==0||h.byteLength!==8})},1549:(d,e,t)=>{t(6632)},1625:(d,e,t)=>{var s=t(9504);d.exports=s({}.isPrototypeOf)},1689:(d,e,t)=>{var s=t(6518),i=t(4576),r=t(8745),a=t(7680),o=t(6043),l=t(9306),h=t(1103),c=i.Promise,u=!1,f=!c||!c.try||h(function(){c.try(function(p){u=p===8},8)}).error||!u;s({target:"Promise",stat:!0,forced:f},{try:function(p){var v=arguments.length>1?a(arguments,1):[],m=o.f(this),A=h(function(){return r(l(p),void 0,v)});return(A.error?m.reject:m.resolve)(A.value),m.promise}})},1698:(d,e,t)=>{var s=t(6518),i=t(4204),r=t(9835),a=t(4916),o=!a("union")||!r("union");s({target:"Set",proto:!0,real:!0,forced:o},{union:i})},1701:(d,e,t)=>{var s=t(6518),i=t(9565),r=t(9306),a=t(8551),o=t(1767),l=t(9462),h=t(6319),c=t(9539),u=t(684),f=t(4549),p=t(6395),v=!p&&!u("map",function(){}),m=!p&&!v&&f("map",TypeError),A=p||v||m,b=l(function(){var S=this.iterator,E=a(i(this.next,S)),T=this.done=!!E.done;if(!T)return h(S,this.mapper,[E.value,this.counter++],!0)});s({target:"Iterator",proto:!0,real:!0,forced:A},{map:function(E){a(this);try{r(E)}catch(T){c(this,"throw",T)}return m?i(m,this,E):new b(o(this),{mapper:E})}})},1767:d=>{d.exports=function(e){return{iterator:e,next:e.next,done:!1}}},1828:(d,e,t)=>{var s=t(9504),i=t(9297),r=t(5397),a=t(9617).indexOf,o=t(421),l=s([].push);d.exports=function(h,c){var u=r(h),f=0,p=[],v;for(v in u)!i(o,v)&&i(u,v)&&l(p,v);for(;c.length>f;)i(u,v=c[f++])&&(~a(p,v)||l(p,v));return p}},2106:(d,e,t)=>{var s=t(283),i=t(4913);d.exports=function(r,a,o){return o.get&&s(o.get,a,{getter:!0}),o.set&&s(o.set,a,{setter:!0}),i.f(r,a,o)}},2140:(d,e,t)=>{var s=t(8227),i=s("toStringTag"),r={};r[i]="z",d.exports=String(r)==="[object z]"},2195:(d,e,t)=>{var s=t(9504),i=s({}.toString),r=s("".slice);d.exports=function(a){return r(i(a),8,-1)}},2211:(d,e,t)=>{var s=t(9039);d.exports=!s(function(){function i(){}return i.prototype.constructor=null,Object.getPrototypeOf(new i)!==i.prototype})},2303:(d,e,t)=>{var s=t(4576),i=t(9504),r=s.Uint8Array,a=s.SyntaxError,o=s.parseInt,l=Math.min,h=/[^\da-f]/i,c=i(h.exec),u=i("".slice);d.exports=function(f,p){var v=f.length;if(v%2!==0)throw new a("String should be an even number of characters");for(var m=p?l(p.length,v/2):v/2,A=p||new r(m),b=0,S=0;S<m;){var E=u(f,b,b+=2);if(c(h,E))throw new a("String should only contain hex characters");A[S++]=o(E,16)}return{bytes:A,read:b}}},2360:(d,e,t)=>{var s=t(8551),i=t(6801),r=t(8727),a=t(421),o=t(397),l=t(4055),h=t(6119),c=">",u="<",f="prototype",p="script",v=h("IE_PROTO"),m=function(){},A=function(x){return u+p+c+x+u+"/"+p+c},b=function(x){x.write(A("")),x.close();var C=x.parentWindow.Object;return x=null,C},S=function(){var x=l("iframe"),C="java"+p+":",R;return x.style.display="none",o.appendChild(x),x.src=String(C),R=x.contentWindow.document,R.open(),R.write(A("document.F=Object")),R.close(),R.F},E,T=function(){try{E=new ActiveXObject("htmlfile")}catch{}T=typeof document<"u"?document.domain&&E?b(E):S():b(E);for(var x=r.length;x--;)delete T[f][r[x]];return T()};a[v]=!0,d.exports=Object.create||function(C,R){var I;return C!==null?(m[f]=s(C),I=new m,m[f]=null,I[v]=C):I=T(),R===void 0?I:i.f(I,R)}},2475:(d,e,t)=>{var s=t(6518),i=t(8527),r=t(4916),a=!r("isSupersetOf",function(o){return!o});s({target:"Set",proto:!0,real:!0,forced:a},{isSupersetOf:i})},2489:(d,e,t)=>{var s=t(6518),i=t(9565),r=t(9306),a=t(8551),o=t(1767),l=t(9462),h=t(6319),c=t(6395),u=t(9539),f=t(684),p=t(4549),v=!c&&!f("filter",function(){}),m=!c&&!v&&p("filter",TypeError),A=c||v||m,b=l(function(){for(var S=this.iterator,E=this.predicate,T=this.next,x,C,R;;){if(x=a(i(T,S)),C=this.done=!!x.done,C)return;if(R=x.value,h(S,E,[R,this.counter++],!0))return R}});s({target:"Iterator",proto:!0,real:!0,forced:A},{filter:function(E){a(this);try{r(E)}catch(T){u(this,"throw",T)}return m?i(m,this,E):new b(o(this),{predicate:E})}})},2529:d=>{d.exports=function(e,t){return{value:e,done:t}}},2603:(d,e,t)=>{var s=t(655);d.exports=function(i,r){return i===void 0?arguments.length<2?"":r:s(i)}},2652:(d,e,t)=>{var s=t(6080),i=t(9565),r=t(8551),a=t(6823),o=t(4209),l=t(6198),h=t(1625),c=t(81),u=t(851),f=t(9539),p=TypeError,v=function(A,b){this.stopped=A,this.result=b},m=v.prototype;d.exports=function(A,b,S){var E=S&&S.that,T=!!(S&&S.AS_ENTRIES),x=!!(S&&S.IS_RECORD),C=!!(S&&S.IS_ITERATOR),R=!!(S&&S.INTERRUPTED),I=s(b,E),P,M,D,_,k,N,G,B=function(z){return P&&f(P,"normal"),new v(!0,z)},L=function(z){return T?(r(z),R?I(z[0],z[1],B):I(z[0],z[1])):R?I(z,B):I(z)};if(x)P=A.iterator;else if(C)P=A;else{if(M=u(A),!M)throw new p(a(A)+" is not iterable");if(o(M)){for(D=0,_=l(A);_>D;D++)if(k=L(A[D]),k&&h(m,k))return k;return new v(!1)}P=c(A,M)}for(N=x?A.next:P.next;!(G=i(N,P)).done;){try{k=L(G.value)}catch(z){f(P,"throw",z)}if(typeof k=="object"&&k&&h(m,k))return k}return new v(!1)}},2777:(d,e,t)=>{var s=t(9565),i=t(34),r=t(757),a=t(5966),o=t(4270),l=t(8227),h=TypeError,c=l("toPrimitive");d.exports=function(u,f){if(!i(u)||r(u))return u;var p=a(u,c),v;if(p){if(f===void 0&&(f="default"),v=s(p,u,f),!i(v)||r(v))return v;throw new h("Can't convert object to primitive value")}return f===void 0&&(f="number"),o(u,f)}},2787:(d,e,t)=>{var s=t(9297),i=t(4901),r=t(8981),a=t(6119),o=t(2211),l=a("IE_PROTO"),h=Object,c=h.prototype;d.exports=o?h.getPrototypeOf:function(u){var f=r(u);if(s(f,l))return f[l];var p=f.constructor;return i(p)&&f instanceof p?p.prototype:f instanceof h?c:null}},2796:(d,e,t)=>{var s=t(9039),i=t(4901),r=/#|\.prototype\./,a=function(u,f){var p=l[o(u)];return p===c?!0:p===h?!1:i(f)?s(f):!!f},o=a.normalize=function(u){return String(u).replace(r,".").toLowerCase()},l=a.data={},h=a.NATIVE="N",c=a.POLYFILL="P";d.exports=a},2804:d=>{var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=e+"+/",s=e+"-_",i=function(r){for(var a={},o=0;o<64;o++)a[r.charAt(o)]=o;return a};d.exports={i2c:t,c2i:i(t),i2cUrl:s,c2iUrl:i(s)}},2812:d=>{var e=TypeError;d.exports=function(t,s){if(t<s)throw new e("Not enough arguments");return t}},2839:(d,e,t)=>{var s=t(4576),i=s.navigator,r=i&&i.userAgent;d.exports=r?String(r):""},2967:(d,e,t)=>{var s=t(6706),i=t(34),r=t(7750),a=t(3506);d.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var o=!1,l={},h;try{h=s(Object.prototype,"__proto__","set"),h(l,[]),o=l instanceof Array}catch{}return function(u,f){return r(u),a(f),i(u)&&(o?h(u,f):u.__proto__=f),u}}():void 0)},3068:(d,e,t)=>{var s=t(6518),i=t(9504),r=t(2652),a=RangeError,o=TypeError,l=1/0,h=NaN,c=Math.abs,u=Math.pow,f=i([].push),p=u(2,1023),v=u(2,53)-1,m=Number.MAX_VALUE,A=u(2,971),b={},S={},E={},T={},x={},C=function(R,I){var P=R+I,M=I-(P-R);return{hi:P,lo:M}};s({target:"Math",stat:!0},{sumPrecise:function(I){var P=[],M=0,D=T;switch(r(I,function(U){if(++M>=v)throw new a("Maximum allowed index exceeded");if(typeof U!="number")throw new o("Value is not a number");D!==b&&(U!==U?D=b:U===l?D=D===S?b:E:U===-l?D=D===E?b:S:(U!==0||1/U===l)&&(D===T||D===x)&&(D=x,f(P,U)))}),D){case b:return h;case S:return-l;case E:return l;case T:return-0}for(var _=[],k=0,N,G,B,L,z,nt,ht=0;ht<P.length;ht++){N=P[ht];for(var Pt=0,Z=0;Z<_.length;Z++){if(G=_[Z],c(N)<c(G)&&(nt=N,N=G,G=nt),B=C(N,G),L=B.hi,z=B.lo,c(L)===l){var ot=L===l?1:-1;k+=ot,N=N-ot*p-ot*p,c(N)<c(G)&&(nt=N,N=G,G=nt),B=C(N,G),L=B.hi,z=B.lo}z!==0&&(_[Pt++]=z),N=L}_.length=Pt,N!==0&&f(_,N)}var bt=_.length-1;if(L=0,z=0,k!==0){var gt=bt>=0?_[bt]:0;if(bt--,c(k)>1||k>0&&gt>0||k<0&&gt<0)return k>0?l:-l;if(B=C(k*p,gt/2),L=B.hi,z=B.lo,z*=2,c(2*L)===l)return L>0?L===p&&z===-(A/2)&&bt>=0&&_[bt]<0?m:l:L===-p&&z===A/2&&bt>=0&&_[bt]>0?-m:-l;z!==0&&(_[++bt]=z,z=0),L*=2}for(;bt>=0&&(B=C(L,_[bt--]),L=B.hi,z=B.lo,z===0););return bt>=0&&(z<0&&_[bt]<0||z>0&&_[bt]>0)&&(G=z*2,N=L+G,G===N-L&&(L=N)),L}})},3167:(d,e,t)=>{var s=t(4901),i=t(34),r=t(2967);d.exports=function(a,o,l){var h,c;return r&&s(h=o.constructor)&&h!==l&&i(c=h.prototype)&&c!==l.prototype&&r(a,c),a}},3238:(d,e,t)=>{var s=t(4576),i=t(7811),r=t(7394),a=s.DataView;d.exports=function(o){if(!i||r(o)!==0)return!1;try{return new a(o),!1}catch{return!0}}},3392:(d,e,t)=>{var s=t(9504),i=0,r=Math.random(),a=s(1.1.toString);d.exports=function(o){return"Symbol("+(o===void 0?"":o)+")_"+a(++i+r,36)}},3440:(d,e,t)=>{var s=t(7080),i=t(4402),r=t(9286),a=t(5170),o=t(3789),l=t(8469),h=t(507),c=i.has,u=i.remove;d.exports=function(p){var v=s(this),m=o(p),A=r(v);return a(v)<=m.size?l(v,function(b){m.includes(b)&&u(A,b)}):h(m.getIterator(),function(b){c(A,b)&&u(A,b)}),A}},3463:d=>{var e=TypeError;d.exports=function(t){if(typeof t=="string")return t;throw new e("Argument is not a string")}},3506:(d,e,t)=>{var s=t(3925),i=String,r=TypeError;d.exports=function(a){if(s(a))return a;throw new r("Can't set "+i(a)+" as a prototype")}},3579:(d,e,t)=>{var s=t(6518),i=t(9565),r=t(2652),a=t(9306),o=t(8551),l=t(1767),h=t(9539),c=t(4549),u=c("some",TypeError);s({target:"Iterator",proto:!0,real:!0,forced:u},{some:function(p){o(this);try{a(p)}catch(A){h(this,"throw",A)}if(u)return i(u,this,p);var v=l(this),m=0;return r(v,function(A,b){if(p(A,m++))return b()},{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},3650:(d,e,t)=>{var s=t(7080),i=t(4402),r=t(9286),a=t(3789),o=t(507),l=i.add,h=i.has,c=i.remove;d.exports=function(f){var p=s(this),v=a(f).getIterator(),m=r(p);return o(v,function(A){h(p,A)?c(m,A):l(m,A)}),m}},3706:(d,e,t)=>{var s=t(9504),i=t(4901),r=t(7629),a=s(Function.toString);i(r.inspectSource)||(r.inspectSource=function(o){return a(o)}),d.exports=r.inspectSource},3717:(d,e)=>{e.f=Object.getOwnPropertySymbols},3724:(d,e,t)=>{var s=t(9039);d.exports=!s(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7})},3789:(d,e,t)=>{var s=t(9306),i=t(8551),r=t(9565),a=t(1291),o=t(1767),l="Invalid size",h=RangeError,c=TypeError,u=Math.max,f=function(p,v){this.set=p,this.size=u(v,0),this.has=s(p.has),this.keys=s(p.keys)};f.prototype={getIterator:function(){return o(i(r(this.keys,this.set)))},includes:function(p){return r(this.has,this.set,p)}},d.exports=function(p){i(p);var v=+p.size;if(v!==v)throw new c(l);var m=a(v);if(m<0)throw new h(l);return new f(p,m)}},3838:(d,e,t)=>{var s=t(7080),i=t(5170),r=t(8469),a=t(3789);d.exports=function(l){var h=s(this),c=a(l);return i(h)>c.size?!1:r(h,function(u){if(!c.includes(u))return!1},!0)!==!1}},3853:(d,e,t)=>{var s=t(6518),i=t(4449),r=t(4916),a=!r("isDisjointFrom",function(o){return!o});s({target:"Set",proto:!0,real:!0,forced:a},{isDisjointFrom:i})},3925:(d,e,t)=>{var s=t(34);d.exports=function(i){return s(i)||i===null}},3972:(d,e,t)=>{var s=t(34),i=String,r=TypeError;d.exports=function(a){if(a===void 0||s(a))return a;throw new r(i(a)+" is not an object or undefined")}},4055:(d,e,t)=>{var s=t(4576),i=t(34),r=s.document,a=i(r)&&i(r.createElement);d.exports=function(o){return a?r.createElement(o):{}}},4114:(d,e,t)=>{var s=t(6518),i=t(8981),r=t(6198),a=t(4527),o=t(6837),l=t(9039),h=l(function(){return[].push.call({length:4294967296},1)!==4294967297}),c=function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(f){return f instanceof TypeError}},u=h||!c();s({target:"Array",proto:!0,arity:1,forced:u},{push:function(p){var v=i(this),m=r(v),A=arguments.length;o(m+A);for(var b=0;b<A;b++)v[m]=arguments[b],m++;return a(v,m),m}})},4117:d=>{d.exports=function(e){return e==null}},4149:d=>{var e=RangeError;d.exports=function(t){if(t===t)return t;throw new e("NaN is not allowed")}},4154:(d,e,t)=>{var s=t(6955),i=TypeError;d.exports=function(r){if(s(r)==="Uint8Array")return r;throw new i("Argument is not an Uint8Array")}},4204:(d,e,t)=>{var s=t(7080),i=t(4402).add,r=t(9286),a=t(3789),o=t(507);d.exports=function(h){var c=s(this),u=a(h).getIterator(),f=r(c);return o(u,function(p){i(f,p)}),f}},4209:(d,e,t)=>{var s=t(8227),i=t(6269),r=s("iterator"),a=Array.prototype;d.exports=function(o){return o!==void 0&&(i.Array===o||a[r]===o)}},4215:(d,e,t)=>{var s=t(4576),i=t(2839),r=t(2195),a=function(o){return i.slice(0,o.length)===o};d.exports=function(){return a("Bun/")?"BUN":a("Cloudflare-Workers")?"CLOUDFLARE":a("Deno/")?"DENO":a("Node.js/")?"NODE":s.Bun&&typeof Bun.version=="string"?"BUN":s.Deno&&typeof Deno.version=="object"?"DENO":r(s.process)==="process"?"NODE":s.window&&s.document?"BROWSER":"REST"}()},4226:(d,e,t)=>{var s=t(6518),i=t(4576),r=t(3463),a=t(4154),o=t(5169),l=t(2303);i.Uint8Array&&s({target:"Uint8Array",proto:!0},{setFromHex:function(c){a(this),r(c),o(this.buffer);var u=l(c,this).read;return{read:u,written:u/2}}})},4235:(d,e,t)=>{t(3068)},4270:(d,e,t)=>{var s=t(9565),i=t(4901),r=t(34),a=TypeError;d.exports=function(o,l){var h,c;if(l==="string"&&i(h=o.toString)&&!r(c=s(h,o))||i(h=o.valueOf)&&!r(c=s(h,o))||l!=="string"&&i(h=o.toString)&&!r(c=s(h,o)))return c;throw new a("Can't convert object to primitive value")}},4376:(d,e,t)=>{var s=t(2195);d.exports=Array.isArray||function(r){return s(r)==="Array"}},4402:(d,e,t)=>{var s=t(9504),i=Set.prototype;d.exports={Set,add:s(i.add),has:s(i.has),remove:s(i.delete),proto:i}},4449:(d,e,t)=>{var s=t(7080),i=t(4402).has,r=t(5170),a=t(3789),o=t(8469),l=t(507),h=t(9539);d.exports=function(u){var f=s(this),p=a(u);if(r(f)<=p.size)return o(f,function(m){if(p.includes(m))return!1},!0)!==!1;var v=p.getIterator();return l(v,function(m){if(i(f,m))return h(v,"normal",!1)})!==!1}},4483:(d,e,t)=>{var s=t(4576),i=t(9429),r=t(1548),a=s.structuredClone,o=s.ArrayBuffer,l=s.MessageChannel,h=!1,c,u,f,p;if(r)h=function(v){a(v,{transfer:[v]})};else if(o)try{l||(c=i("worker_threads"),c&&(l=c.MessageChannel)),l&&(u=new l,f=new o(2),p=function(v){u.port1.postMessage(null,[v])},f.byteLength===2&&(p(f),f.byteLength===0&&(h=p)))}catch{}d.exports=h},4495:(d,e,t)=>{var s=t(9519),i=t(9039),r=t(4576),a=r.String;d.exports=!!Object.getOwnPropertySymbols&&!i(function(){var o=Symbol("symbol detection");return!a(o)||!(Object(o)instanceof Symbol)||!Symbol.sham&&s&&s<41})},4527:(d,e,t)=>{var s=t(3724),i=t(4376),r=TypeError,a=Object.getOwnPropertyDescriptor,o=s&&!function(){if(this!==void 0)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(l){return l instanceof TypeError}}();d.exports=o?function(l,h){if(i(l)&&!a(l,"length").writable)throw new r("Cannot set read only .length");return l.length=h}:function(l,h){return l.length=h}},4549:(d,e,t)=>{var s=t(4576);d.exports=function(i,r){var a=s.Iterator,o=a&&a.prototype,l=o&&o[i],h=!1;if(l)try{l.call({next:function(){return{done:!0}},return:function(){h=!0}},-1)}catch(c){c instanceof r||(h=!1)}if(!h)return l}},4576:function(d){var e=function(t){return t&&t.Math===Math&&t};d.exports=e(typeof globalThis=="object"&&globalThis)||e(typeof window=="object"&&window)||e(typeof self=="object"&&self)||e(typeof global=="object"&&global)||e(typeof this=="object"&&this)||function(){return this}()||Function("return this")()},4603:(d,e,t)=>{var s=t(6840),i=t(9504),r=t(655),a=t(2812),o=URLSearchParams,l=o.prototype,h=i(l.append),c=i(l.delete),u=i(l.forEach),f=i([].push),p=new o("a=1&a=2&b=3");p.delete("a",1),p.delete("b",void 0),p+""!="a=2"&&s(l,"delete",function(v){var m=arguments.length,A=m<2?void 0:arguments[1];if(m&&A===void 0)return c(this,v);var b=[];u(this,function(P,M){f(b,{key:M,value:P})}),a(m,1);for(var S=r(v),E=r(A),T=0,x=0,C=!1,R=b.length,I;T<R;)I=b[T++],C||I.key===S?(C=!0,c(this,I.key)):x++;for(;x<R;)I=b[x++],I.key===S&&I.value===E||h(this,I.key,I.value)},{enumerable:!0,unsafe:!0})},4628:(d,e,t)=>{var s=t(6518),i=t(6043);s({target:"Promise",stat:!0},{withResolvers:function(){var a=i.f(this);return{promise:a.promise,resolve:a.resolve,reject:a.reject}}})},4644:(d,e,t)=>{var s=t(7811),i=t(3724),r=t(4576),a=t(4901),o=t(34),l=t(9297),h=t(6955),c=t(6823),u=t(6699),f=t(6840),p=t(2106),v=t(1625),m=t(2787),A=t(2967),b=t(8227),S=t(3392),E=t(1181),T=E.enforce,x=E.get,C=r.Int8Array,R=C&&C.prototype,I=r.Uint8ClampedArray,P=I&&I.prototype,M=C&&m(C),D=R&&m(R),_=Object.prototype,k=r.TypeError,N=b("toStringTag"),G=S("TYPED_ARRAY_TAG"),B="TypedArrayConstructor",L=s&&!!A&&h(r.opera)!=="Opera",z=!1,nt,ht,Pt,Z={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},ot={BigInt64Array:8,BigUint64Array:8},bt=function(Lt){if(!o(Lt))return!1;var Bt=h(Lt);return Bt==="DataView"||l(Z,Bt)||l(ot,Bt)},gt=function(Y){var Lt=m(Y);if(o(Lt)){var Bt=x(Lt);return Bt&&l(Bt,B)?Bt[B]:gt(Lt)}},U=function(Y){if(!o(Y))return!1;var Lt=h(Y);return l(Z,Lt)||l(ot,Lt)},O=function(Y){if(U(Y))return Y;throw new k("Target is not a typed array")},$=function(Y){if(a(Y)&&(!A||v(M,Y)))return Y;throw new k(c(Y)+" is not a typed array constructor")},q=function(Y,Lt,Bt,Ss){if(i){if(Bt)for(var Fe in Z){var ce=r[Fe];if(ce&&l(ce.prototype,Y))try{delete ce.prototype[Y]}catch{try{ce.prototype[Y]=Lt}catch{}}}(!D[Y]||Bt)&&f(D,Y,Bt?Lt:L&&R[Y]||Lt,Ss)}},mt=function(Y,Lt,Bt){var Ss,Fe;if(i){if(A){if(Bt){for(Ss in Z)if(Fe=r[Ss],Fe&&l(Fe,Y))try{delete Fe[Y]}catch{}}if(!M[Y]||Bt)try{return f(M,Y,Bt?Lt:L&&M[Y]||Lt)}catch{}else return}for(Ss in Z)Fe=r[Ss],Fe&&(!Fe[Y]||Bt)&&f(Fe,Y,Lt)}};for(nt in Z)ht=r[nt],Pt=ht&&ht.prototype,Pt?T(Pt)[B]=ht:L=!1;for(nt in ot)ht=r[nt],Pt=ht&&ht.prototype,Pt&&(T(Pt)[B]=ht);if((!L||!a(M)||M===Function.prototype)&&(M=function(){throw new k("Incorrect invocation")},L))for(nt in Z)r[nt]&&A(r[nt],M);if((!L||!D||D===_)&&(D=M.prototype,L))for(nt in Z)r[nt]&&A(r[nt].prototype,D);if(L&&m(P)!==D&&A(P,D),i&&!l(D,N)){z=!0,p(D,N,{configurable:!0,get:function(){return o(this)?this[G]:void 0}});for(nt in Z)r[nt]&&u(r[nt],G,nt)}d.exports={NATIVE_ARRAY_BUFFER_VIEWS:L,TYPED_ARRAY_TAG:z&&G,aTypedArray:O,aTypedArrayConstructor:$,exportTypedArrayMethod:q,exportTypedArrayStaticMethod:mt,getTypedArrayConstructor:gt,isView:bt,isTypedArray:U,TypedArray:M,TypedArrayPrototype:D}},4659:(d,e,t)=>{var s=t(3724),i=t(4913),r=t(6980);d.exports=function(a,o,l){s?i.f(a,o,r(0,l)):a[o]=l}},4901:d=>{var e=typeof document=="object"&&document.all;d.exports=typeof e>"u"&&e!==void 0?function(t){return typeof t=="function"||t===e}:function(t){return typeof t=="function"}},4913:(d,e,t)=>{var s=t(3724),i=t(5917),r=t(8686),a=t(8551),o=t(6969),l=TypeError,h=Object.defineProperty,c=Object.getOwnPropertyDescriptor,u="enumerable",f="configurable",p="writable";e.f=s?r?function(m,A,b){if(a(m),A=o(A),a(b),typeof m=="function"&&A==="prototype"&&"value"in b&&p in b&&!b[p]){var S=c(m,A);S&&S[p]&&(m[A]=b.value,b={configurable:f in b?b[f]:S[f],enumerable:u in b?b[u]:S[u],writable:!1})}return h(m,A,b)}:h:function(m,A,b){if(a(m),A=o(A),a(b),i)try{return h(m,A,b)}catch{}if("get"in b||"set"in b)throw new l("Accessors not supported");return"value"in b&&(m[A]=b.value),m}},4916:(d,e,t)=>{var s=t(7751),i=function(a){return{size:a,has:function(){return!1},keys:function(){return{next:function(){return{done:!0}}}}}},r=function(a){return{size:a,has:function(){return!0},keys:function(){throw new Error("e")}}};d.exports=function(a,o){var l=s("Set");try{new l()[a](i(0));try{return new l()[a](i(-1)),!1}catch{if(!o)return!0;try{return new l()[a](r(-1/0)),!1}catch{var h=new l([1,2]);return o(h[a](r(1/0)))}}}catch{return!1}}},4972:(d,e,t)=>{var s=t(6518),i=t(9565),r=t(8551),a=t(1767),o=t(4149),l=t(9590),h=t(9462),c=t(9539),u=t(4549),f=t(6395),p=!f&&u("take",RangeError),v=h(function(){var m=this.iterator;if(!this.remaining--)return this.done=!0,c(m,"normal",void 0);var A=r(i(this.next,m)),b=this.done=!!A.done;if(!b)return A.value});s({target:"Iterator",proto:!0,real:!0,forced:f||p},{take:function(A){r(this);var b;try{b=l(o(+A))}catch(S){c(this,"throw",S)}return p?i(p,this,b):new v(a(this),{remaining:b})}})},4979:(d,e,t)=>{var s=t(6518),i=t(4576),r=t(7751),a=t(6980),o=t(4913).f,l=t(9297),h=t(679),c=t(3167),u=t(2603),f=t(5002),p=t(8574),v=t(3724),m=t(6395),A="DOMException",b=r("Error"),S=r(A),E=function(){h(this,T);var B=arguments.length,L=u(B<1?void 0:arguments[0]),z=u(B<2?void 0:arguments[1],"Error"),nt=new S(L,z),ht=new b(L);return ht.name=A,o(nt,"stack",a(1,p(ht.stack,1))),c(nt,this,E),nt},T=E.prototype=S.prototype,x="stack"in new b(A),C="stack"in new S(1,2),R=S&&v&&Object.getOwnPropertyDescriptor(i,A),I=!!R&&!(R.writable&&R.configurable),P=x&&!I&&!C;s({global:!0,constructor:!0,forced:m||P},{DOMException:P?E:S});var M=r(A),D=M.prototype;if(D.constructor!==M){m||o(D,"constructor",a(1,M));for(var _ in f)if(l(f,_)){var k=f[_],N=k.s;l(M,N)||o(M,N,a(6,k.c))}}},5002:d=>{d.exports={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}}},5024:(d,e,t)=>{var s=t(6518),i=t(3650),r=t(9835),a=t(4916),o=!a("symmetricDifference")||!r("symmetricDifference");s({target:"Set",proto:!0,real:!0,forced:o},{symmetricDifference:i})},5031:(d,e,t)=>{var s=t(7751),i=t(9504),r=t(8480),a=t(3717),o=t(8551),l=i([].concat);d.exports=s("Reflect","ownKeys")||function(c){var u=r.f(o(c)),f=a.f;return f?l(u,f(c)):u}},5169:(d,e,t)=>{var s=t(3238),i=TypeError;d.exports=function(r){if(s(r))throw new i("ArrayBuffer is detached");return r}},5170:(d,e,t)=>{var s=t(6706),i=t(4402);d.exports=s(i.proto,"size","get")||function(r){return r.size}},5213:(d,e,t)=>{var s=t(6518),i=t(4576),r=t(5370),a=t(9143),o=i.Uint8Array,l=!o||!o.fromBase64||!function(){try{o.fromBase64("a");return}catch{}try{o.fromBase64("",null)}catch{return!0}}();o&&s({target:"Uint8Array",stat:!0,forced:l},{fromBase64:function(c){var u=a(c,arguments.length>1?arguments[1]:void 0,null,9007199254740991);return r(o,u.bytes)}})},5370:(d,e,t)=>{var s=t(6198);d.exports=function(i,r,a){for(var o=0,l=arguments.length>2?a:s(r),h=new i(l);l>o;)h[o]=r[o++];return h}},5397:(d,e,t)=>{var s=t(7055),i=t(7750);d.exports=function(r){return s(i(r))}},5610:(d,e,t)=>{var s=t(1291),i=Math.max,r=Math.min;d.exports=function(a,o){var l=s(a);return l<0?i(l+o,0):r(l,o)}},5623:(d,e,t)=>{t(456)},5636:(d,e,t)=>{var s=t(4576),i=t(9504),r=t(6706),a=t(7696),o=t(5169),l=t(7394),h=t(4483),c=t(1548),u=s.structuredClone,f=s.ArrayBuffer,p=s.DataView,v=Math.min,m=f.prototype,A=p.prototype,b=i(m.slice),S=r(m,"resizable","get"),E=r(m,"maxByteLength","get"),T=i(A.getInt8),x=i(A.setInt8);d.exports=(c||h)&&function(C,R,I){var P=l(C),M=R===void 0?P:a(R),D=!S||!S(C),_;if(o(C),c&&(C=u(C,{transfer:[C]}),P===M&&(I||D)))return C;if(P>=M&&(!I||D))_=b(C,0,M);else{var k=I&&!D&&E?{maxByteLength:E(C)}:void 0;_=new f(M,k);for(var N=new p(C),G=new p(_),B=v(M,P),L=0;L<B;L++)x(G,L,T(N,L))}return c||h(C),_}},5745:(d,e,t)=>{var s=t(7629);d.exports=function(i,r){return s[i]||(s[i]=r||{})}},5781:(d,e,t)=>{var s=t(6518),i=t(7751),r=t(2812),a=t(655),o=t(7416),l=i("URL");s({target:"URL",stat:!0,forced:!o},{parse:function(c){var u=r(arguments.length,1),f=a(c),p=u<2||arguments[1]===void 0?void 0:a(arguments[1]);try{return new l(f,p)}catch{return null}}})},5854:(d,e,t)=>{var s=t(2777),i=TypeError;d.exports=function(r){var a=s(r,"number");if(typeof a=="number")throw new i("Can't convert number to bigint");return BigInt(a)}},5876:(d,e,t)=>{var s=t(6518),i=t(3838),r=t(4916),a=!r("isSubsetOf",function(o){return o});s({target:"Set",proto:!0,real:!0,forced:a},{isSubsetOf:i})},5917:(d,e,t)=>{var s=t(3724),i=t(9039),r=t(4055);d.exports=!s&&!i(function(){return Object.defineProperty(r("div"),"a",{get:function(){return 7}}).a!==7})},5966:(d,e,t)=>{var s=t(9306),i=t(4117);d.exports=function(r,a){var o=r[a];return i(o)?void 0:s(o)}},6043:(d,e,t)=>{var s=t(9306),i=TypeError,r=function(a){var o,l;this.promise=new a(function(h,c){if(o!==void 0||l!==void 0)throw new i("Bad Promise constructor");o=h,l=c}),this.resolve=s(o),this.reject=s(l)};d.exports.f=function(a){return new r(a)}},6080:(d,e,t)=>{var s=t(7476),i=t(9306),r=t(616),a=s(s.bind);d.exports=function(o,l){return i(o),l===void 0?o:r?a(o,l):function(){return o.apply(l,arguments)}}},6119:(d,e,t)=>{var s=t(5745),i=t(3392),r=s("keys");d.exports=function(a){return r[a]||(r[a]=i(a))}},6193:(d,e,t)=>{var s=t(4215);d.exports=s==="NODE"},6198:(d,e,t)=>{var s=t(8014);d.exports=function(i){return s(i.length)}},6269:d=>{d.exports={}},6279:(d,e,t)=>{var s=t(6840);d.exports=function(i,r,a){for(var o in r)s(i,o,r[o],a);return i}},6319:(d,e,t)=>{var s=t(8551),i=t(9539);d.exports=function(r,a,o,l){try{return l?a(s(o)[0],o[1]):a(o)}catch(h){i(r,"throw",h)}}},6395:d=>{d.exports=!1},6518:(d,e,t)=>{var s=t(4576),i=t(7347).f,r=t(6699),a=t(6840),o=t(9433),l=t(7740),h=t(2796);d.exports=function(c,u){var f=c.target,p=c.global,v=c.stat,m,A,b,S,E,T;if(p?A=s:v?A=s[f]||o(f,{}):A=s[f]&&s[f].prototype,A)for(b in u){if(E=u[b],c.dontCallGetSet?(T=i(A,b),S=T&&T.value):S=A[b],m=h(p?b:f+(v?".":"#")+b,c.forced),!m&&S!==void 0){if(typeof E==typeof S)continue;l(E,S)}(c.sham||S&&S.sham)&&r(E,"sham",!0),a(A,b,E,c)}}},6573:(d,e,t)=>{var s=t(3724),i=t(2106),r=t(3238),a=ArrayBuffer.prototype;s&&!("detached"in a)&&i(a,"detached",{configurable:!0,get:function(){return r(this)}})},6632:(d,e,t)=>{var s=t(6518),i=t(4576),r=t(9143),a=t(4154),o=i.Uint8Array,l=!o||!o.prototype.setFromBase64||!function(){var h=new o([255,255,255,255,255]);try{h.setFromBase64("",null);return}catch{}try{h.setFromBase64("a");return}catch{}try{h.setFromBase64("MjYyZg===")}catch{return h[0]===50&&h[1]===54&&h[2]===50&&h[3]===255&&h[4]===255}}();o&&s({target:"Uint8Array",proto:!0,forced:l},{setFromBase64:function(c){a(this);var u=r(c,arguments.length>1?arguments[1]:void 0,this,this.length);return{read:u.read,written:u.written}}})},6699:(d,e,t)=>{var s=t(3724),i=t(4913),r=t(6980);d.exports=s?function(a,o,l){return i.f(a,o,r(1,l))}:function(a,o,l){return a[o]=l,a}},6706:(d,e,t)=>{var s=t(9504),i=t(9306);d.exports=function(r,a,o){try{return s(i(Object.getOwnPropertyDescriptor(r,a)[o]))}catch{}}},6801:(d,e,t)=>{var s=t(3724),i=t(8686),r=t(4913),a=t(8551),o=t(5397),l=t(1072);e.f=s&&!i?Object.defineProperties:function(c,u){a(c);for(var f=o(u),p=l(u),v=p.length,m=0,A;v>m;)r.f(c,A=p[m++],f[A]);return c}},6823:d=>{var e=String;d.exports=function(t){try{return e(t)}catch{return"Object"}}},6837:d=>{var e=TypeError,t=9007199254740991;d.exports=function(s){if(s>t)throw e("Maximum allowed index exceeded");return s}},6840:(d,e,t)=>{var s=t(4901),i=t(4913),r=t(283),a=t(9433);d.exports=function(o,l,h,c){c||(c={});var u=c.enumerable,f=c.name!==void 0?c.name:l;if(s(h)&&r(h,f,c),c.global)u?o[l]=h:a(l,h);else{try{c.unsafe?o[l]&&(u=!0):delete o[l]}catch{}u?o[l]=h:i.f(o,l,{value:h,enumerable:!1,configurable:!c.nonConfigurable,writable:!c.nonWritable})}return o}},6955:(d,e,t)=>{var s=t(2140),i=t(4901),r=t(2195),a=t(8227),o=a("toStringTag"),l=Object,h=r(function(){return arguments}())==="Arguments",c=function(u,f){try{return u[f]}catch{}};d.exports=s?r:function(u){var f,p,v;return u===void 0?"Undefined":u===null?"Null":typeof(p=c(f=l(u),o))=="string"?p:h?r(f):(v=r(f))==="Object"&&i(f.callee)?"Arguments":v}},6969:(d,e,t)=>{var s=t(2777),i=t(757);d.exports=function(r){var a=s(r,"string");return i(a)?a:a+""}},6980:d=>{d.exports=function(e,t){return{enumerable:!(e&1),configurable:!(e&2),writable:!(e&4),value:t}}},7040:(d,e,t)=>{var s=t(4495);d.exports=s&&!Symbol.sham&&typeof Symbol.iterator=="symbol"},7055:(d,e,t)=>{var s=t(9504),i=t(9039),r=t(2195),a=Object,o=s("".split);d.exports=i(function(){return!a("z").propertyIsEnumerable(0)})?function(l){return r(l)==="String"?o(l,""):a(l)}:a},7080:(d,e,t)=>{var s=t(4402).has;d.exports=function(i){return s(i),i}},7347:(d,e,t)=>{var s=t(3724),i=t(9565),r=t(8773),a=t(6980),o=t(5397),l=t(6969),h=t(9297),c=t(5917),u=Object.getOwnPropertyDescriptor;e.f=s?u:function(p,v){if(p=o(p),v=l(v),c)try{return u(p,v)}catch{}if(h(p,v))return a(!i(r.f,p,v),p[v])}},7394:(d,e,t)=>{var s=t(4576),i=t(6706),r=t(2195),a=s.ArrayBuffer,o=s.TypeError;d.exports=a&&i(a.prototype,"byteLength","get")||function(l){if(r(l)!=="ArrayBuffer")throw new o("ArrayBuffer expected");return l.byteLength}},7416:(d,e,t)=>{var s=t(9039),i=t(8227),r=t(3724),a=t(6395),o=i("iterator");d.exports=!s(function(){var l=new URL("b?a=1&b=2&c=3","https://a"),h=l.searchParams,c=new URLSearchParams("a=1&a=2&b=3"),u="";return l.pathname="c%20d",h.forEach(function(f,p){h.delete("b"),u+=p+f}),c.delete("a",2),c.delete("b",void 0),a&&(!l.toJSON||!c.has("a",1)||c.has("a",2)||!c.has("a",void 0)||c.has("b"))||!h.size&&(a||!r)||!h.sort||l.href!=="https://a/c%20d?a=1&c=3"||h.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!h[o]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://тест").host!=="xn--e1aybc"||new URL("https://a#б").hash!=="#%D0%B1"||u!=="a1c3"||new URL("https://x",void 0).host!=="x"})},7476:(d,e,t)=>{var s=t(2195),i=t(9504);d.exports=function(r){if(s(r)==="Function")return i(r)}},7566:(d,e,t)=>{var s=t(6840),i=t(9504),r=t(655),a=t(2812),o=URLSearchParams,l=o.prototype,h=i(l.getAll),c=i(l.has),u=new o("a=1");(u.has("a",2)||!u.has("a",void 0))&&s(l,"has",function(p){var v=arguments.length,m=v<2?void 0:arguments[1];if(v&&m===void 0)return c(this,p);var A=h(this,p);a(v,1);for(var b=r(m),S=0;S<A.length;)if(A[S++]===b)return!0;return!1},{enumerable:!0,unsafe:!0})},7588:(d,e,t)=>{var s=t(6518),i=t(9565),r=t(2652),a=t(9306),o=t(8551),l=t(1767),h=t(9539),c=t(4549),u=c("forEach",TypeError);s({target:"Iterator",proto:!0,real:!0,forced:u},{forEach:function(p){o(this);try{a(p)}catch(A){h(this,"throw",A)}if(u)return i(u,this,p);var v=l(this),m=0;r(v,function(A){p(A,m++)},{IS_RECORD:!0})}})},7629:(d,e,t)=>{var s=t(6395),i=t(4576),r=t(9433),a="__core-js_shared__",o=d.exports=i[a]||r(a,{});(o.versions||(o.versions=[])).push({version:"3.47.0",mode:s?"pure":"global",copyright:"© 2014-2025 Denis Pushkarev (zloirock.ru), 2025 CoreJS Company (core-js.io)",license:"https://github.com/zloirock/core-js/blob/v3.47.0/LICENSE",source:"https://github.com/zloirock/core-js"})},7642:(d,e,t)=>{var s=t(6518),i=t(3440),r=t(9039),a=t(4916),o=!a("difference",function(h){return h.size===0}),l=o||r(function(){var h={size:1,has:function(){return!0},keys:function(){var u=0;return{next:function(){var f=u++>1;return c.has(1)&&c.clear(),{done:f,value:2}}}}},c=new Set([1,2,3,4]);return c.difference(h).size!==3});s({target:"Set",proto:!0,real:!0,forced:l},{difference:i})},7657:(d,e,t)=>{var s=t(9039),i=t(4901),r=t(34),a=t(2360),o=t(2787),l=t(6840),h=t(8227),c=t(6395),u=h("iterator"),f=!1,p,v,m;[].keys&&(m=[].keys(),"next"in m?(v=o(o(m)),v!==Object.prototype&&(p=v)):f=!0);var A=!r(p)||s(function(){var b={};return p[u].call(b)!==b});A?p={}:c&&(p=a(p)),i(p[u])||l(p,u,function(){return this}),d.exports={IteratorPrototype:p,BUGGY_SAFARI_ITERATORS:f}},7680:(d,e,t)=>{var s=t(9504);d.exports=s([].slice)},7696:(d,e,t)=>{var s=t(1291),i=t(8014),r=RangeError;d.exports=function(a){if(a===void 0)return 0;var o=s(a),l=i(o);if(o!==l)throw new r("Wrong length or index");return l}},7740:(d,e,t)=>{var s=t(9297),i=t(5031),r=t(7347),a=t(4913);d.exports=function(o,l,h){for(var c=i(l),u=a.f,f=r.f,p=0;p<c.length;p++){var v=c[p];!s(o,v)&&!(h&&s(h,v))&&u(o,v,f(l,v))}}},7750:(d,e,t)=>{var s=t(4117),i=TypeError;d.exports=function(r){if(s(r))throw new i("Can't call method on "+r);return r}},7751:(d,e,t)=>{var s=t(4576),i=t(4901),r=function(a){return i(a)?a:void 0};d.exports=function(a,o){return arguments.length<2?r(s[a]):s[a]&&s[a][o]}},7811:d=>{d.exports=typeof ArrayBuffer<"u"&&typeof DataView<"u"},7936:(d,e,t)=>{var s=t(6518),i=t(5636);i&&s({target:"ArrayBuffer",proto:!0},{transferToFixedLength:function(){return i(this,arguments.length?arguments[0]:void 0,!1)}})},8004:(d,e,t)=>{var s=t(6518),i=t(9039),r=t(8750),a=t(4916),o=!a("intersection",function(l){return l.size===2&&l.has(1)&&l.has(2)})||i(function(){return String(Array.from(new Set([1,2,3]).intersection(new Set([3,2]))))!=="3,2"});s({target:"Set",proto:!0,real:!0,forced:o},{intersection:r})},8014:(d,e,t)=>{var s=t(1291),i=Math.min;d.exports=function(r){var a=s(r);return a>0?i(a,9007199254740991):0}},8100:(d,e,t)=>{var s=t(6518),i=t(5636);i&&s({target:"ArrayBuffer",proto:!0},{transfer:function(){return i(this,arguments.length?arguments[0]:void 0,!0)}})},8111:(d,e,t)=>{var s=t(6518),i=t(4576),r=t(679),a=t(8551),o=t(4901),l=t(2787),h=t(2106),c=t(4659),u=t(9039),f=t(9297),p=t(8227),v=t(7657).IteratorPrototype,m=t(3724),A=t(6395),b="constructor",S="Iterator",E=p("toStringTag"),T=TypeError,x=i[S],C=A||!o(x)||x.prototype!==v||!u(function(){x({})}),R=function(){if(r(this,v),l(this)===v)throw new T("Abstract class Iterator not directly constructable")},I=function(P,M){m?h(v,P,{configurable:!0,get:function(){return M},set:function(D){if(a(this),this===v)throw new T("You can't redefine this property");f(this,P)?this[P]=D:c(this,P,D)}}):v[P]=M};f(v,E)||I(E,S),(C||!f(v,b)||v[b]===Object)&&I(b,R),R.prototype=v,s({global:!0,constructor:!0,forced:C},{Iterator:R})},8227:(d,e,t)=>{var s=t(4576),i=t(5745),r=t(9297),a=t(3392),o=t(4495),l=t(7040),h=s.Symbol,c=i("wks"),u=l?h.for||h:h&&h.withoutSetter||a;d.exports=function(f){return r(c,f)||(c[f]=o&&r(h,f)?h[f]:u("Symbol."+f)),c[f]}},8235:(d,e,t)=>{var s=t(9504),i=t(9297),r=SyntaxError,a=parseInt,o=String.fromCharCode,l=s("".charAt),h=s("".slice),c=s(/./.exec),u={'\\"':'"',"\\\\":"\\","\\/":"/","\\b":"\b","\\f":"\f","\\n":`
`,"\\r":"\r","\\t":"	"},f=/^[\da-f]{4}$/i,p=/^[\u0000-\u001F]$/;d.exports=function(v,m){for(var A=!0,b="";m<v.length;){var S=l(v,m);if(S==="\\"){var E=h(v,m,m+2);if(i(u,E))b+=u[E],m+=2;else if(E==="\\u"){m+=2;var T=h(v,m,m+4);if(!c(f,T))throw new r("Bad Unicode escape at: "+m);b+=o(a(T,16)),m+=4}else throw new r('Unknown escape sequence: "'+E+'"')}else if(S==='"'){A=!1,m++;break}else{if(c(p,S))throw new r("Bad control character in string literal at: "+m);b+=S,m++}}if(A)throw new r("Unterminated string at: "+m);return{value:b,end:m}}},8237:(d,e,t)=>{var s=t(6518),i=t(2652),r=t(9306),a=t(8551),o=t(1767),l=t(9539),h=t(4549),c=t(8745),u=t(9039),f=TypeError,p=u(function(){[].keys().reduce(function(){},void 0)}),v=!p&&h("reduce",f);s({target:"Iterator",proto:!0,real:!0,forced:p||v},{reduce:function(A){a(this);try{r(A)}catch(x){l(this,"throw",x)}var b=arguments.length<2,S=b?void 0:arguments[1];if(v)return c(v,this,b?[A]:[A,S]);var E=o(this),T=0;if(i(E,function(x){b?(b=!1,S=x):S=A(S,x,T),T++},{IS_RECORD:!0}),b)throw new f("Reduce of empty iterator with no initial value");return S}})},8335:(d,e,t)=>{t(9112)},8469:(d,e,t)=>{var s=t(9504),i=t(507),r=t(4402),a=r.Set,o=r.proto,l=s(o.forEach),h=s(o.keys),c=h(new a).next;d.exports=function(u,f,p){return p?i({iterator:h(u),next:c},f):l(u,f)}},8480:(d,e,t)=>{var s=t(1828),i=t(8727),r=i.concat("length","prototype");e.f=Object.getOwnPropertyNames||function(o){return s(o,r)}},8527:(d,e,t)=>{var s=t(7080),i=t(4402).has,r=t(5170),a=t(3789),o=t(507),l=t(9539);d.exports=function(c){var u=s(this),f=a(c);if(r(u)<f.size)return!1;var p=f.getIterator();return o(p,function(v){if(!i(u,v))return l(p,"normal",!1)})!==!1}},8551:(d,e,t)=>{var s=t(34),i=String,r=TypeError;d.exports=function(a){if(s(a))return a;throw new r(i(a)+" is not an object")}},8574:(d,e,t)=>{var s=t(9504),i=Error,r=s("".replace),a=function(h){return String(new i(h).stack)}("zxcasd"),o=/\n\s*at [^:]*:[^\n]*/,l=o.test(a);d.exports=function(h,c){if(l&&typeof h=="string"&&!i.prepareStackTrace)for(;c--;)h=r(h,o,"");return h}},8622:(d,e,t)=>{var s=t(4576),i=t(4901),r=s.WeakMap;d.exports=i(r)&&/native code/.test(String(r))},8646:(d,e,t)=>{var s=t(9565),i=t(8551),r=t(1767),a=t(851);d.exports=function(o,l){(!l||typeof o!="string")&&i(o);var h=a(o);return r(i(h!==void 0?s(h,o):o))}},8686:(d,e,t)=>{var s=t(3724),i=t(9039);d.exports=s&&i(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42})},8721:(d,e,t)=>{var s=t(3724),i=t(9504),r=t(2106),a=URLSearchParams.prototype,o=i(a.forEach);s&&!("size"in a)&&r(a,"size",{get:function(){var h=0;return o(this,function(){h++}),h},configurable:!0,enumerable:!0})},8727:d=>{d.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},8745:(d,e,t)=>{var s=t(616),i=Function.prototype,r=i.apply,a=i.call;d.exports=typeof Reflect=="object"&&Reflect.apply||(s?a.bind(r):function(){return a.apply(r,arguments)})},8750:(d,e,t)=>{var s=t(7080),i=t(4402),r=t(5170),a=t(3789),o=t(8469),l=t(507),h=i.Set,c=i.add,u=i.has;d.exports=function(p){var v=s(this),m=a(p),A=new h;return r(v)>m.size?l(m.getIterator(),function(b){u(v,b)&&c(A,b)}):o(v,function(b){m.includes(b)&&c(A,b)}),A}},8773:(d,e)=>{var t={}.propertyIsEnumerable,s=Object.getOwnPropertyDescriptor,i=s&&!t.call({1:2},1);e.f=i?function(a){var o=s(this,a);return!!o&&o.enumerable}:t},8981:(d,e,t)=>{var s=t(7750),i=Object;d.exports=function(r){return i(s(r))}},9039:d=>{d.exports=function(e){try{return!!e()}catch{return!0}}},9112:(d,e,t)=>{var s=t(6518),i=t(3724),r=t(4576),a=t(7751),o=t(9504),l=t(9565),h=t(4901),c=t(34),u=t(4376),f=t(9297),p=t(655),v=t(6198),m=t(4659),A=t(9039),b=t(8235),S=t(4495),E=r.JSON,T=r.Number,x=r.SyntaxError,C=E&&E.parse,R=a("Object","keys"),I=Object.getOwnPropertyDescriptor,P=o("".charAt),M=o("".slice),D=o(/./.exec),_=o([].push),k=/^\d$/,N=/^[1-9]$/,G=/^[\d-]$/,B=/^[\t\n\r ]$/,L=0,z=1,nt=function(U,O){U=p(U);var $=new ot(U,0),q=$.parse(),mt=q.value,Y=$.skip(B,q.end);if(Y<U.length)throw new x('Unexpected extra character: "'+P(U,Y)+'" after the parsed data at: '+Y);return h(O)?ht({"":mt},"",O,q):mt},ht=function(U,O,$,q){var mt=U[O],Y=q&&mt===q.value,Lt=Y&&typeof q.source=="string"?{source:q.source}:{},Bt,Ss,Fe,ce,Ga;if(c(mt)){var Nu=u(mt),ld=Y?q.nodes:Nu?[]:{};if(Nu)for(Bt=ld.length,Fe=v(mt),ce=0;ce<Fe;ce++)Pt(mt,ce,ht(mt,""+ce,$,ce<Bt?ld[ce]:void 0));else for(Ss=R(mt),Fe=v(Ss),ce=0;ce<Fe;ce++)Ga=Ss[ce],Pt(mt,Ga,ht(mt,Ga,$,f(ld,Ga)?ld[Ga]:void 0))}return l($,U,O,mt,Lt)},Pt=function(U,O,$){if(i){var q=I(U,O);if(q&&!q.configurable)return}$===void 0?delete U[O]:m(U,O,$)},Z=function(U,O,$,q){this.value=U,this.end=O,this.source=$,this.nodes=q},ot=function(U,O){this.source=U,this.index=O};ot.prototype={fork:function(U){return new ot(this.source,U)},parse:function(){var U=this.source,O=this.skip(B,this.index),$=this.fork(O),q=P(U,O);if(D(G,q))return $.number();switch(q){case"{":return $.object();case"[":return $.array();case'"':return $.string();case"t":return $.keyword(!0);case"f":return $.keyword(!1);case"n":return $.keyword(null)}throw new x('Unexpected character: "'+q+'" at: '+O)},node:function(U,O,$,q,mt){return new Z(O,q,U?null:M(this.source,$,q),mt)},object:function(){for(var U=this.source,O=this.index+1,$=!1,q={},mt={};O<U.length;){if(O=this.until(['"',"}"],O),P(U,O)==="}"&&!$){O++;break}var Y=this.fork(O).string(),Lt=Y.value;O=Y.end,O=this.until([":"],O)+1,O=this.skip(B,O),Y=this.fork(O).parse(),m(mt,Lt,Y),m(q,Lt,Y.value),O=this.until([",","}"],Y.end);var Bt=P(U,O);if(Bt===",")$=!0,O++;else if(Bt==="}"){O++;break}}return this.node(z,q,this.index,O,mt)},array:function(){for(var U=this.source,O=this.index+1,$=!1,q=[],mt=[];O<U.length;){if(O=this.skip(B,O),P(U,O)==="]"&&!$){O++;break}var Y=this.fork(O).parse();if(_(mt,Y),_(q,Y.value),O=this.until([",","]"],Y.end),P(U,O)===",")$=!0,O++;else if(P(U,O)==="]"){O++;break}}return this.node(z,q,this.index,O,mt)},string:function(){var U=this.index,O=b(this.source,this.index+1);return this.node(L,O.value,U,O.end)},number:function(){var U=this.source,O=this.index,$=O;if(P(U,$)==="-"&&$++,P(U,$)==="0")$++;else if(D(N,P(U,$)))$=this.skip(k,$+1);else throw new x("Failed to parse number at: "+$);if(P(U,$)==="."&&($=this.skip(k,$+1)),P(U,$)==="e"||P(U,$)==="E"){$++,(P(U,$)==="+"||P(U,$)==="-")&&$++;var q=$;if($=this.skip(k,$),q===$)throw new x("Failed to parse number's exponent value at: "+$)}return this.node(L,T(M(U,O,$)),O,$)},keyword:function(U){var O=""+U,$=this.index,q=$+O.length;if(M(this.source,$,q)!==O)throw new x("Failed to parse value at: "+$);return this.node(L,U,$,q)},skip:function(U,O){for(var $=this.source;O<$.length&&D(U,P($,O));O++);return O},until:function(U,O){O=this.skip(B,O);for(var $=P(this.source,O),q=0;q<U.length;q++)if(U[q]===$)return O;throw new x('Unexpected character: "'+$+'" at: '+O)}};var bt=A(function(){var U="9007199254740993",O;return C(U,function($,q,mt){O=mt.source}),O!==U}),gt=S&&!A(function(){return 1/C("-0 	")!==-1/0});s({target:"JSON",stat:!0,forced:bt},{parse:function(O,$){return gt&&!h($)?C(O):nt(O,$)}})},9143:(d,e,t)=>{var s=t(4576),i=t(9504),r=t(3972),a=t(3463),o=t(9297),l=t(2804),h=t(944),c=t(5169),u=l.c2i,f=l.c2iUrl,p=s.SyntaxError,v=s.TypeError,m=i("".charAt),A=function(E,T){for(var x=E.length;T<x;T++){var C=m(E,T);if(C!==" "&&C!=="	"&&C!==`
`&&C!=="\f"&&C!=="\r")break}return T},b=function(E,T,x){var C=E.length;C<4&&(E+=C===2?"AA":"A");var R=(T[m(E,0)]<<18)+(T[m(E,1)]<<12)+(T[m(E,2)]<<6)+T[m(E,3)],I=[R>>16&255,R>>8&255,R&255];if(C===2){if(x&&I[1]!==0)throw new p("Extra bits");return[I[0]]}if(C===3){if(x&&I[2]!==0)throw new p("Extra bits");return[I[0],I[1]]}return I},S=function(E,T,x){for(var C=T.length,R=0;R<C;R++)E[x+R]=T[R];return x+C};d.exports=function(E,T,x,C){a(E),r(T);var R=h(T)==="base64"?u:f,I=T?T.lastChunkHandling:void 0;if(I===void 0&&(I="loose"),I!=="loose"&&I!=="strict"&&I!=="stop-before-partial")throw new v("Incorrect `lastChunkHandling` option");x&&c(x.buffer);var P=E.length,M=x||[],D=0,_=0,k="",N=0;if(C)for(;;){if(N=A(E,N),N===P){if(k.length>0){if(I==="stop-before-partial")break;if(I==="loose"){if(k.length===1)throw new p("Malformed padding: exactly one additional character");D=S(M,b(k,R,!1),D)}else throw new p("Missing padding")}_=P;break}var G=m(E,N);if(++N,G==="="){if(k.length<2)throw new p("Padding is too early");if(N=A(E,N),k.length===2){if(N===P){if(I==="stop-before-partial")break;throw new p("Malformed padding: only one =")}m(E,N)==="="&&(++N,N=A(E,N))}if(N<P)throw new p("Unexpected character after padding");D=S(M,b(k,R,I==="strict"),D),_=P;break}if(!o(R,G))throw new p("Unexpected character");var B=C-D;if(B===1&&k.length===2||B===2&&k.length===3||(k+=G,k.length===4&&(D=S(M,b(k,R,!1),D),k="",_=N,D===C)))break}return{bytes:M,read:_,written:D}}},9286:(d,e,t)=>{var s=t(4402),i=t(8469),r=s.Set,a=s.add;d.exports=function(o){var l=new r;return i(o,function(h){a(l,h)}),l}},9297:(d,e,t)=>{var s=t(9504),i=t(8981),r=s({}.hasOwnProperty);d.exports=Object.hasOwn||function(o,l){return r(i(o),l)}},9306:(d,e,t)=>{var s=t(4901),i=t(6823),r=TypeError;d.exports=function(a){if(s(a))return a;throw new r(i(a)+" is not a function")}},9314:(d,e,t)=>{var s=t(6518),i=t(9565),r=t(8551),a=t(1767),o=t(4149),l=t(9590),h=t(9539),c=t(9462),u=t(684),f=t(4549),p=t(6395),v=!p&&!u("drop",0),m=!p&&!v&&f("drop",RangeError),A=p||v||m,b=c(function(){for(var S=this.iterator,E=this.next,T,x;this.remaining;)if(this.remaining--,T=r(i(E,S)),x=this.done=!!T.done,x)return;if(T=r(i(E,S)),x=this.done=!!T.done,!x)return T.value});s({target:"Iterator",proto:!0,real:!0,forced:A},{drop:function(E){r(this);var T;try{T=l(o(+E))}catch(x){h(this,"throw",x)}return m?i(m,this,T):new b(a(this),{remaining:T})}})},9429:(d,e,t)=>{var s=t(4576),i=t(6193);d.exports=function(r){if(i){try{return s.process.getBuiltinModule(r)}catch{}try{return Function('return require("'+r+'")')()}catch{}}}},9432:(d,e,t)=>{t(5213)},9433:(d,e,t)=>{var s=t(4576),i=Object.defineProperty;d.exports=function(r,a){try{i(s,r,{value:a,configurable:!0,writable:!0})}catch{s[r]=a}return a}},9462:(d,e,t)=>{var s=t(9565),i=t(2360),r=t(6699),a=t(6279),o=t(8227),l=t(1181),h=t(5966),c=t(7657).IteratorPrototype,u=t(2529),f=t(9539),p=t(1385),v=o("toStringTag"),m="IteratorHelper",A="WrapForValidIterator",b="normal",S="throw",E=l.set,T=function(R){var I=l.getterFor(R?A:m);return a(i(c),{next:function(){var M=I(this);if(R)return M.nextHandler();if(M.done)return u(void 0,!0);try{var D=M.nextHandler();return M.returnHandlerResult?D:u(D,M.done)}catch(_){throw M.done=!0,_}},return:function(){var P=I(this),M=P.iterator;if(P.done=!0,R){var D=h(M,"return");return D?s(D,M):u(void 0,!0)}if(P.inner)try{f(P.inner.iterator,b)}catch(_){return f(M,S,_)}if(P.openIters)try{p(P.openIters,b)}catch(_){return f(M,S,_)}return M&&f(M,b),u(void 0,!0)}})},x=T(!0),C=T(!1);r(C,v,"Iterator Helper"),d.exports=function(R,I,P){var M=function(_,k){k?(k.iterator=_.iterator,k.next=_.next):k=_,k.type=I?A:m,k.returnHandlerResult=!!P,k.nextHandler=R,k.counter=0,k.done=!1,E(this,k)};return M.prototype=I?x:C,M}},9486:(d,e,t)=>{var s=t(6518),i=t(4576),r=t(9504),a=t(3972),o=t(4154),l=t(5169),h=t(2804),c=t(944),u=h.i2c,f=h.i2cUrl,p=r("".charAt),v=i.Uint8Array,m=!v||!v.prototype.toBase64||!function(){try{var A=new v;A.toBase64(null)}catch{return!0}}();v&&s({target:"Uint8Array",proto:!0,forced:m},{toBase64:function(){var b=o(this),S=arguments.length?a(arguments[0]):void 0,E=c(S)==="base64"?u:f,T=!!S&&!!S.omitPadding;l(this.buffer);for(var x="",C=0,R=b.length,I,P=function(M){return p(E,I>>6*M&63)};C+2<R;C+=3)I=(b[C]<<16)+(b[C+1]<<8)+b[C+2],x+=P(3)+P(2)+P(1)+P(0);return C+2===R?(I=(b[C]<<16)+(b[C+1]<<8),x+=P(3)+P(2)+P(1)+(T?"":"=")):C+1===R&&(I=b[C]<<16,x+=P(3)+P(2)+(T?"":"==")),x}})},9504:(d,e,t)=>{var s=t(616),i=Function.prototype,r=i.call,a=s&&i.bind.bind(r,r);d.exports=s?a:function(o){return function(){return r.apply(o,arguments)}}},9519:(d,e,t)=>{var s=t(4576),i=t(2839),r=s.process,a=s.Deno,o=r&&r.versions||a&&a.version,l=o&&o.v8,h,c;l&&(h=l.split("."),c=h[0]>0&&h[0]<4?1:+(h[0]+h[1])),!c&&i&&(h=i.match(/Edge\/(\d+)/),(!h||h[1]>=74)&&(h=i.match(/Chrome\/(\d+)/),h&&(c=+h[1]))),d.exports=c},9539:(d,e,t)=>{var s=t(9565),i=t(8551),r=t(5966);d.exports=function(a,o,l){var h,c;i(a);try{if(h=r(a,"return"),!h){if(o==="throw")throw l;return l}h=s(h,a)}catch(u){c=!0,h=u}if(o==="throw")throw l;if(c)throw h;return i(h),l}},9565:(d,e,t)=>{var s=t(616),i=Function.prototype.call;d.exports=s?i.bind(i):function(){return i.apply(i,arguments)}},9577:(d,e,t)=>{var s=t(9928),i=t(4644),r=t(1108),a=t(1291),o=t(5854),l=i.aTypedArray,h=i.getTypedArrayConstructor,c=i.exportTypedArrayMethod,u=function(){try{new Int8Array(1).with(2,{valueOf:function(){throw 8}})}catch(p){return p===8}}(),f=u&&function(){try{new Int8Array(1).with(-.5,1)}catch{return!0}}();c("with",function(p,v){var m=l(this),A=a(p),b=r(m)?o(v):+v;return s(m,h(m),A,b)},!u||f)},9590:(d,e,t)=>{var s=t(1291),i=RangeError;d.exports=function(r){var a=s(r);if(a<0)throw new i("The argument can't be less than 0");return a}},9617:(d,e,t)=>{var s=t(5397),i=t(5610),r=t(6198),a=function(o){return function(l,h,c){var u=s(l),f=r(u);if(f===0)return!o&&-1;var p=i(c,f),v;if(o&&h!==h){for(;f>p;)if(v=u[p++],v!==v)return!0}else for(;f>p;p++)if((o||p in u)&&u[p]===h)return o||p||0;return!o&&-1}};d.exports={includes:a(!0),indexOf:a(!1)}},9631:(d,e,t)=>{t(9486)},9797:(d,e,t)=>{t(4226)},9835:d=>{d.exports=function(e){try{var t=new Set,s={size:0,has:function(){return!0},keys:function(){return Object.defineProperty({},"next",{get:function(){return t.clear(),t.add(4),function(){return{done:!0}}}})}},i=t[e](s);return i.size===1&&i.values().next().value===4}catch{return!1}}},9928:(d,e,t)=>{var s=t(6198),i=t(1291),r=RangeError;d.exports=function(a,o,l,h){var c=s(a),u=i(l),f=u<0?c+u:u;if(f>=c||f<0)throw new r("Incorrect index");for(var p=new o(c),v=0;v<c;v++)p[v]=v===f?h:a[v];return p}}},_p={};function it(d){var e=_p[d];if(e!==void 0)return e.exports;var t=_p[d]={exports:{}};return Tv[d].call(t.exports,t,t.exports,it),t.exports}it.d=(d,e)=>{for(var t in e)it.o(e,t)&&!it.o(d,t)&&Object.defineProperty(d,t,{enumerable:!0,get:e[t]})};it.o=(d,e)=>Object.prototype.hasOwnProperty.call(d,e);it(4114);it(6573);it(8100);it(7936);it(8111);it(8237);it(1689);it(9577);it(4235);it(9432);it(1549);it(9797);it(9631);it(5623);it(4979);it(5781);const He=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),Xu=[.001,0,0,.001,0,0],_u=1.35,bs={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},xn={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},ah="pdfjs_internal_editor_",et={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,POPUP:16,SIGNATURE:101,COMMENT:102},dt={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_THICKNESS:32,HIGHLIGHT_FREE:33,HIGHLIGHT_SHOW_ALL:34,DRAW_STEP:41},Cv={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},Yu={TRIANGLES:1,LATTICE:2},ne={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},yd={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},te={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},Wa={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},Du={ERRORS:0,WARNINGS:1,INFOS:5},oh={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94},Fl={moveTo:0,lineTo:1,curveTo:2,quadraticCurveTo:3,closePath:4},Rv={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let Mu=Du.WARNINGS;function Pv(d){Number.isInteger(d)&&(Mu=d)}function Iv(){return Mu}function Ou(d){Mu>=Du.INFOS&&console.info(`Info: ${d}`)}function J(d){Mu>=Du.WARNINGS&&console.warn(`Warning: ${d}`)}function Ot(d){throw new Error(d)}function ut(d,e){d||Ot(e)}function Dv(d){switch(d==null?void 0:d.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function fg(d,e=null,t=null){if(!d)return null;if(t&&typeof d=="string"){if(t.addDefaultProtocol&&d.startsWith("www.")){const i=d.match(/\./g);(i==null?void 0:i.length)>=2&&(d=`http://${d}`)}if(t.tryConvertEncoding)try{d=kv(d)}catch{}}const s=e?URL.parse(d,e):URL.parse(d);return Dv(s)?s:null}function pg(d,e,t=!1){const s=URL.parse(d);return s?(s.hash=e,s.href):t&&fg(d,"http://example.com")?d.split("#",1)[0]+`${e?`#${e}`:""}`:""}function Q(d,e,t,s=!1){return Object.defineProperty(d,e,{value:t,enumerable:!s,configurable:!0,writable:!1}),t}const ja=function(){function e(t,s){this.message=t,this.name=s}return e.prototype=new Error,e.constructor=e,e}();class Up extends ja{constructor(e,t){super(e,"PasswordException"),this.code=t}}class Uu extends ja{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}}class Ku extends ja{constructor(e){super(e,"InvalidPDFException")}}class Zd extends ja{constructor(e,t,s){super(e,"ResponseException"),this.status=t,this.missing=s}}class Mv extends ja{constructor(e){super(e,"FormatError")}}class gr extends ja{constructor(e){super(e,"AbortException")}}function gg(d){(typeof d!="object"||(d==null?void 0:d.length)===void 0)&&Ot("Invalid argument for bytesToString");const e=d.length,t=8192;if(e<t)return String.fromCharCode.apply(null,d);const s=[];for(let i=0;i<e;i+=t){const r=Math.min(i+t,e),a=d.subarray(i,r);s.push(String.fromCharCode.apply(null,a))}return s.join("")}function ed(d){typeof d!="string"&&Ot("Invalid argument for stringToBytes");const e=d.length,t=new Uint8Array(e);for(let s=0;s<e;++s)t[s]=d.charCodeAt(s)&255;return t}function Ov(d){return String.fromCharCode(d>>24&255,d>>16&255,d>>8&255,d&255)}function Lv(){const d=new Uint8Array(4);return d[0]=1,new Uint32Array(d.buffer,0,1)[0]===1}function Fv(){try{return new Function(""),!0}catch{return!1}}class he{static get isLittleEndian(){return Q(this,"isLittleEndian",Lv())}static get isEvalSupported(){return Q(this,"isEvalSupported",Fv())}static get isOffscreenCanvasSupported(){return Q(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return Q(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get isFloat16ArraySupported(){return Q(this,"isFloat16ArraySupported",typeof Float16Array<"u")}static get isSanitizerSupported(){return Q(this,"isSanitizerSupported",typeof Sanitizer<"u")}static get platform(){const{platform:e,userAgent:t}=navigator;return Q(this,"platform",{isAndroid:t.includes("Android"),isLinux:e.includes("Linux"),isMac:e.includes("Mac"),isWindows:e.includes("Win"),isFirefox:t.includes("Firefox")})}static get isCSSRoundSupported(){var e,t;return Q(this,"isCSSRoundSupported",(t=(e=globalThis.CSS)==null?void 0:e.supports)==null?void 0:t.call(e,"width: round(1.5px, 1px)"))}}const Hu=Array.from(Array(256).keys(),d=>d.toString(16).padStart(2,"0"));var yn,bd,Ju;class j{static makeHexColor(e,t,s){return`#${Hu[e]}${Hu[t]}${Hu[s]}`}static domMatrixToTransform(e){return[e.a,e.b,e.c,e.d,e.e,e.f]}static scaleMinMax(e,t){let s;e[0]?(e[0]<0&&(s=t[0],t[0]=t[2],t[2]=s),t[0]*=e[0],t[2]*=e[0],e[3]<0&&(s=t[1],t[1]=t[3],t[3]=s),t[1]*=e[3],t[3]*=e[3]):(s=t[0],t[0]=t[1],t[1]=s,s=t[2],t[2]=t[3],t[3]=s,e[1]<0&&(s=t[1],t[1]=t[3],t[3]=s),t[1]*=e[1],t[3]*=e[1],e[2]<0&&(s=t[0],t[0]=t[2],t[2]=s),t[0]*=e[2],t[2]*=e[2]),t[0]+=e[4],t[1]+=e[5],t[2]+=e[4],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static multiplyByDOMMatrix(e,t){return[e[0]*t.a+e[2]*t.b,e[1]*t.a+e[3]*t.b,e[0]*t.c+e[2]*t.d,e[1]*t.c+e[3]*t.d,e[0]*t.e+e[2]*t.f+e[4],e[1]*t.e+e[3]*t.f+e[5]]}static applyTransform(e,t,s=0){const i=e[s],r=e[s+1];e[s]=i*t[0]+r*t[2]+t[4],e[s+1]=i*t[1]+r*t[3]+t[5]}static applyTransformToBezier(e,t,s=0){const i=t[0],r=t[1],a=t[2],o=t[3],l=t[4],h=t[5];for(let c=0;c<6;c+=2){const u=e[s+c],f=e[s+c+1];e[s+c]=u*i+f*a+l,e[s+c+1]=u*r+f*o+h}}static applyInverseTransform(e,t){const s=e[0],i=e[1],r=t[0]*t[3]-t[1]*t[2];e[0]=(s*t[3]-i*t[2]+t[2]*t[5]-t[4]*t[3])/r,e[1]=(-s*t[1]+i*t[0]+t[4]*t[1]-t[5]*t[0])/r}static axialAlignedBoundingBox(e,t,s){const i=t[0],r=t[1],a=t[2],o=t[3],l=t[4],h=t[5],c=e[0],u=e[1],f=e[2],p=e[3];let v=i*c+l,m=v,A=i*f+l,b=A,S=o*u+h,E=S,T=o*p+h,x=T;if(r!==0||a!==0){const C=r*c,R=r*f,I=a*u,P=a*p;v+=I,b+=I,A+=P,m+=P,S+=C,x+=C,T+=R,E+=R}s[0]=Math.min(s[0],v,A,m,b),s[1]=Math.min(s[1],S,T,E,x),s[2]=Math.max(s[2],v,A,m,b),s[3]=Math.max(s[3],S,T,E,x)}static inverseTransform(e){const t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e,t){const s=e[0],i=e[1],r=e[2],a=e[3],o=s**2+i**2,l=s*r+i*a,h=r**2+a**2,c=(o+h)/2,u=Math.sqrt(c**2-(o*h-l**2));t[0]=Math.sqrt(c+u||1),t[1]=Math.sqrt(c-u||1)}static normalizeRect(e){const t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){const s=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),i=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(s>i)return null;const r=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),a=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return r>a?null:[s,r,i,a]}static pointBoundingBox(e,t,s){s[0]=Math.min(s[0],e),s[1]=Math.min(s[1],t),s[2]=Math.max(s[2],e),s[3]=Math.max(s[3],t)}static rectBoundingBox(e,t,s,i,r){r[0]=Math.min(r[0],e,s),r[1]=Math.min(r[1],t,i),r[2]=Math.max(r[2],e,s),r[3]=Math.max(r[3],t,i)}static bezierBoundingBox(e,t,s,i,r,a,o,l,h){h[0]=Math.min(h[0],e,o),h[1]=Math.min(h[1],t,l),h[2]=Math.max(h[2],e,o),h[3]=Math.max(h[3],t,l),w(this,yn,Ju).call(this,e,s,r,o,t,i,a,l,3*(-e+3*(s-r)+o),6*(e-2*s+r),3*(s-e),h),w(this,yn,Ju).call(this,e,s,r,o,t,i,a,l,3*(-t+3*(i-a)+l),6*(t-2*i+a),3*(i-t),h)}}yn=new WeakSet,bd=function(e,t,s,i,r,a,o,l,h,c){if(h<=0||h>=1)return;const u=1-h,f=h*h,p=f*h,v=u*(u*(u*e+3*h*t)+3*f*s)+p*i,m=u*(u*(u*r+3*h*a)+3*f*o)+p*l;c[0]=Math.min(c[0],v),c[1]=Math.min(c[1],m),c[2]=Math.max(c[2],v),c[3]=Math.max(c[3],m)},Ju=function(e,t,s,i,r,a,o,l,h,c,u,f){if(Math.abs(h)<1e-12){Math.abs(c)>=1e-12&&w(this,yn,bd).call(this,e,t,s,i,r,a,o,l,-u/c,f);return}const p=c**2-4*u*h;if(p<0)return;const v=Math.sqrt(p),m=2*h;w(this,yn,bd).call(this,e,t,s,i,r,a,o,l,(-c+v)/m,f),w(this,yn,bd).call(this,e,t,s,i,r,a,o,l,(-c-v)/m,f)},y(j,yn);function kv(d){return decodeURIComponent(escape(d))}let $u=null,Hp=null;function Nv(d){return $u||($u=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,Hp=new Map([["ﬅ","ſt"]])),d.replaceAll($u,(e,t,s)=>t?t.normalize("NFKC"):Hp.get(s))}function mg(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const d=new Uint8Array(32);return crypto.getRandomValues(d),gg(d)}const to="pdfjs_internal_id_";function Bv(d,e,t){if(!Array.isArray(t)||t.length<2)return!1;const[s,i,...r]=t;if(!d(s)&&!Number.isInteger(s)||!e(i))return!1;const a=r.length;let o=!0;switch(i.name){case"XYZ":if(a<2||a>3)return!1;break;case"Fit":case"FitB":return a===0;case"FitH":case"FitBH":case"FitV":case"FitBV":if(a>1)return!1;break;case"FitR":if(a!==4)return!1;o=!1;break;default:return!1}for(const l of r)if(!(typeof l=="number"||o&&l===null))return!1;return!0}function $e(d,e,t){return Math.min(Math.max(d,e),t)}function vg(d){return Uint8Array.prototype.toBase64?d.toBase64():btoa(gg(d))}function _v(d){return Uint8Array.fromBase64?Uint8Array.fromBase64(d):ed(atob(d))}typeof Math.sumPrecise!="function"&&(Math.sumPrecise=function(d){return d.reduce((e,t)=>e+t,0)});typeof AbortSignal.any!="function"&&(AbortSignal.any=function(d){const e=new AbortController,{signal:t}=e;for(const s of d)if(s.aborted)return e.abort(s.reason),t;for(const s of d)s.addEventListener("abort",()=>{e.abort(s.reason)},{signal:t});return t});it(1701);it(4603);it(7566);it(8721);class lh{static textContent(e){const t=[],s={items:t,styles:Object.create(null)};function i(r){var l;if(!r)return;let a=null;const o=r.name;if(o==="#text")a=r.value;else if(lh.shouldBuildText(o))(l=r==null?void 0:r.attributes)!=null&&l.textContent?a=r.attributes.textContent:r.value&&(a=r.value);else return;if(a!==null&&t.push({str:a}),!!r.children)for(const h of r.children)i(h)}return i(e),s}static shouldBuildText(e){return!(e==="textarea"||e==="input"||e==="option"||e==="select")}}class yg{static setupStorage(e,t,s,i,r){const a=i.getValue(t,{value:null});switch(s.name){case"textarea":if(a.value!==null&&(e.textContent=a.value),r==="print")break;e.addEventListener("input",o=>{i.setValue(t,{value:o.target.value})});break;case"input":if(s.attributes.type==="radio"||s.attributes.type==="checkbox"){if(a.value===s.attributes.xfaOn?e.setAttribute("checked",!0):a.value===s.attributes.xfaOff&&e.removeAttribute("checked"),r==="print")break;e.addEventListener("change",o=>{i.setValue(t,{value:o.target.checked?o.target.getAttribute("xfaOn"):o.target.getAttribute("xfaOff")})})}else{if(a.value!==null&&e.setAttribute("value",a.value),r==="print")break;e.addEventListener("input",o=>{i.setValue(t,{value:o.target.value})})}break;case"select":if(a.value!==null){e.setAttribute("value",a.value);for(const o of s.children)o.attributes.value===a.value?o.attributes.selected=!0:o.attributes.hasOwnProperty("selected")&&delete o.attributes.selected}e.addEventListener("input",o=>{const l=o.target.options,h=l.selectedIndex===-1?"":l[l.selectedIndex].value;i.setValue(t,{value:h})});break}}static setAttributes({html:e,element:t,storage:s=null,intent:i,linkService:r}){const{attributes:a}=t,o=e instanceof HTMLAnchorElement;a.type==="radio"&&(a.name=`${a.name}-${i}`);for(const[l,h]of Object.entries(a))if(h!=null)switch(l){case"class":h.length&&e.setAttribute(l,h.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",h);break;case"style":Object.assign(e.style,h);break;case"textContent":e.textContent=h;break;default:(!o||l!=="href"&&l!=="newWindow")&&e.setAttribute(l,h)}o&&r.addLinkAttributes(e,a.href,a.newWindow),s&&a.dataId&&this.setupStorage(e,a.dataId,t,s)}static render(e){var u,f;const t=e.annotationStorage,s=e.linkService,i=e.xfaHtml,r=e.intent||"display",a=document.createElement(i.name);i.attributes&&this.setAttributes({html:a,element:i,intent:r,linkService:s});const o=r!=="richText",l=e.div;if(l.append(a),e.viewport){const p=`matrix(${e.viewport.transform.join(",")})`;l.style.transform=p}o&&l.setAttribute("class","xfaLayer xfaFont");const h=[];if(i.children.length===0){if(i.value){const p=document.createTextNode(i.value);a.append(p),o&&lh.shouldBuildText(i.name)&&h.push(p)}return{textDivs:h}}const c=[[i,-1,a]];for(;c.length>0;){const[p,v,m]=c.at(-1);if(v+1===p.children.length){c.pop();continue}const A=p.children[++c.at(-1)[1]];if(A===null)continue;const{name:b}=A;if(b==="#text"){const E=document.createTextNode(A.value);h.push(E),m.append(E);continue}const S=(u=A==null?void 0:A.attributes)!=null&&u.xmlns?document.createElementNS(A.attributes.xmlns,b):document.createElement(b);if(m.append(S),A.attributes&&this.setAttributes({html:S,element:A,storage:t,intent:r,linkService:s}),((f=A.children)==null?void 0:f.length)>0)c.push([A,-1,S]);else if(A.value){const E=document.createTextNode(A.value);o&&lh.shouldBuildText(b)&&h.push(E),S.append(E)}}for(const p of l.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))p.setAttribute("readOnly",!0);return{textDivs:h}}static update(e){const t=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=t,e.div.hidden=!1}}const Di="http://www.w3.org/2000/svg",wr=class wr{};F(wr,"CSS",96),F(wr,"PDF",72),F(wr,"PDF_TO_CSS_UNITS",wr.CSS/wr.PDF);let mr=wr;async function sd(d,e="text"){if(Ul(d,document.baseURI)){const t=await fetch(d);if(!t.ok)throw new Error(t.statusText);switch(e){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"json":return t.json()}return t.text()}return new Promise((t,s)=>{const i=new XMLHttpRequest;i.open("GET",d,!0),i.responseType=e,i.onreadystatechange=()=>{if(i.readyState===XMLHttpRequest.DONE){if(i.status===200||i.status===0){switch(e){case"arraybuffer":case"blob":case"json":t(i.response);return}t(i.responseText);return}s(new Error(i.statusText))}},i.send(null)})}class id{constructor({viewBox:e,userUnit:t,scale:s,rotation:i,offsetX:r=0,offsetY:a=0,dontFlip:o=!1}){this.viewBox=e,this.userUnit=t,this.scale=s,this.rotation=i,this.offsetX=r,this.offsetY=a,s*=t;const l=(e[2]+e[0])/2,h=(e[3]+e[1])/2;let c,u,f,p;switch(i%=360,i<0&&(i+=360),i){case 180:c=-1,u=0,f=0,p=1;break;case 90:c=0,u=1,f=1,p=0;break;case 270:c=0,u=-1,f=-1,p=0;break;case 0:c=1,u=0,f=0,p=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}o&&(f=-f,p=-p);let v,m,A,b;c===0?(v=Math.abs(h-e[1])*s+r,m=Math.abs(l-e[0])*s+a,A=(e[3]-e[1])*s,b=(e[2]-e[0])*s):(v=Math.abs(l-e[0])*s+r,m=Math.abs(h-e[1])*s+a,A=(e[2]-e[0])*s,b=(e[3]-e[1])*s),this.transform=[c*s,u*s,f*s,p*s,v-c*s*l-f*s*h,m-u*s*l-p*s*h],this.width=A,this.height=b}get rawDims(){const e=this.viewBox;return Q(this,"rawDims",{pageWidth:e[2]-e[0],pageHeight:e[3]-e[1],pageX:e[0],pageY:e[1]})}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:s=this.offsetX,offsetY:i=this.offsetY,dontFlip:r=!1}={}){return new id({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:e,rotation:t,offsetX:s,offsetY:i,dontFlip:r})}convertToViewportPoint(e,t){const s=[e,t];return j.applyTransform(s,this.transform),s}convertToViewportRectangle(e){const t=[e[0],e[1]];j.applyTransform(t,this.transform);const s=[e[2],e[3]];return j.applyTransform(s,this.transform),[t[0],t[1],s[0],s[1]]}convertToPdfPoint(e,t){const s=[e,t];return j.applyInverseTransform(s,this.transform),s}}class Ep extends ja{constructor(e,t=0){super(e,"RenderingCancelledException"),this.extraDelay=t}}function Lu(d){const e=d.length;let t=0;for(;t<e&&d[t].trim()==="";)t++;return d.substring(t,t+5).toLowerCase()==="data:"}function Sp(d){return typeof d=="string"&&/\.pdf$/i.test(d)}function Uv(d){return[d]=d.split(/[#?]/,1),d.substring(d.lastIndexOf("/")+1)}function Hv(d,e="document.pdf"){if(typeof d!="string")return e;if(Lu(d))return J('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),e;const s=(o=>{try{return new URL(o)}catch{try{return new URL(decodeURIComponent(o))}catch{try{return new URL(o,"https://foo.bar")}catch{try{return new URL(decodeURIComponent(o),"https://foo.bar")}catch{return null}}}}})(d);if(!s)return e;const i=o=>{try{let l=decodeURIComponent(o);return l.includes("/")?(l=l.split("/").at(-1),l.test(/^\.pdf$/i)?l:o):l}catch{return o}},r=/\.pdf$/i,a=s.pathname.split("/").at(-1);if(r.test(a))return i(a);if(s.searchParams.size>0){const o=Array.from(s.searchParams.values()).reverse();for(const h of o)if(r.test(h))return i(h);const l=Array.from(s.searchParams.keys()).reverse();for(const h of l)if(r.test(h))return i(h)}if(s.hash){const l=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i.exec(s.hash);if(l)return i(l[0])}return e}class $p{constructor(){F(this,"started",Object.create(null));F(this,"times",[])}time(e){e in this.started&&J(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||J(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){const e=[];let t=0;for(const{name:s}of this.times)t=Math.max(s.length,t);for(const{name:s,start:i,end:r}of this.times)e.push(`${s.padEnd(t)} ${r-i}ms
`);return e.join("")}}function Ul(d,e){const t=e?URL.parse(d,e):URL.parse(d);return(t==null?void 0:t.protocol)==="http:"||(t==null?void 0:t.protocol)==="https:"}function Hs(d){d.preventDefault()}function Jt(d){d.preventDefault(),d.stopPropagation()}function $v(d){console.log("Deprecated API usage: "+d)}var dh;class qd{static toDateObject(e){if(e instanceof Date)return e;if(!e||typeof e!="string")return null;n(this,dh)||g(this,dh,new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const t=n(this,dh).exec(e);if(!t)return null;const s=parseInt(t[1],10);let i=parseInt(t[2],10);i=i>=1&&i<=12?i-1:0;let r=parseInt(t[3],10);r=r>=1&&r<=31?r:1;let a=parseInt(t[4],10);a=a>=0&&a<=23?a:0;let o=parseInt(t[5],10);o=o>=0&&o<=59?o:0;let l=parseInt(t[6],10);l=l>=0&&l<=59?l:0;const h=t[7]||"Z";let c=parseInt(t[8],10);c=c>=0&&c<=23?c:0;let u=parseInt(t[9],10)||0;return u=u>=0&&u<=59?u:0,h==="-"?(a+=c,o+=u):h==="+"&&(a-=c,o-=u),new Date(Date.UTC(s,i,r,a,o,l))}}dh=new WeakMap,y(qd,dh);function jv(d,{scale:e=1,rotation:t=0}){const{width:s,height:i}=d.attributes.style,r=[0,0,parseInt(s),parseInt(i)];return new id({viewBox:r,userUnit:1,scale:e,rotation:t})}function nd(d){if(d.startsWith("#")){const e=parseInt(d.slice(1),16);return[(e&16711680)>>16,(e&65280)>>8,e&255]}return d.startsWith("rgb(")?d.slice(4,-1).split(",").map(e=>parseInt(e)):d.startsWith("rgba(")?d.slice(5,-1).split(",").map(e=>parseInt(e)).slice(0,3):(J(`Not a valid color format: "${d}"`),[0,0,0])}function zv(d){const e=document.createElement("span");e.style.visibility="hidden",e.style.colorScheme="only light",document.body.append(e);for(const t of d.keys()){e.style.color=t;const s=window.getComputedStyle(e).color;d.set(t,nd(s))}e.remove()}function zt(d){const{a:e,b:t,c:s,d:i,e:r,f:a}=d.getTransform();return[e,t,s,i,r,a]}function ii(d){const{a:e,b:t,c:s,d:i,e:r,f:a}=d.getTransform().invertSelf();return[e,t,s,i,r,a]}function Ua(d,e,t=!1,s=!0){if(e instanceof id){const{pageWidth:i,pageHeight:r}=e.rawDims,{style:a}=d,o=he.isCSSRoundSupported,l=`var(--total-scale-factor) * ${i}px`,h=`var(--total-scale-factor) * ${r}px`,c=o?`round(down, ${l}, var(--scale-round-x))`:`calc(${l})`,u=o?`round(down, ${h}, var(--scale-round-y))`:`calc(${h})`;!t||e.rotation%180===0?(a.width=c,a.height=u):(a.width=u,a.height=c)}s&&d.setAttribute("data-main-rotation",e.rotation)}class Pi{constructor(){const{pixelRatio:e}=Pi;this.sx=e,this.sy=e}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}limitCanvas(e,t,s,i,r=-1){let a=1/0,o=1/0,l=1/0;s=Pi.capPixels(s,r),s>0&&(a=Math.sqrt(s/(e*t))),i!==-1&&(o=i/e,l=i/t);const h=Math.min(a,o,l);return this.sx>h||this.sy>h?(this.sx=h,this.sy=h,!0):!1}static get pixelRatio(){return globalThis.devicePixelRatio||1}static capPixels(e,t){if(t>=0){const s=Math.ceil(window.screen.availWidth*window.screen.availHeight*this.pixelRatio**2*(1+t/100));return e>0?Math.min(e,s):s}return e}}const Qu=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];class Gv{static get isDarkMode(){var e;return Q(this,"isDarkMode",!!((e=window==null?void 0:window.matchMedia)!=null&&e.call(window,"(prefers-color-scheme: dark)").matches))}}class Vv{static get commentForegroundColor(){const e=document.createElement("span");e.classList.add("comment","sidebar");const{style:t}=e;t.width=t.height="0",t.display="none",t.color="var(--comment-fg-color)",document.body.append(e);const{color:s}=window.getComputedStyle(e);return e.remove(),Q(this,"commentForegroundColor",nd(s))}}function Wv(d,e,t,s){s=Math.min(Math.max(s??1,0),1);const i=255*(1-s);return d=Math.round(d*s+i),e=Math.round(e*s+i),t=Math.round(t*s+i),[d,e,t]}function jp(d,e){const t=d[0]/255,s=d[1]/255,i=d[2]/255,r=Math.max(t,s,i),a=Math.min(t,s,i),o=(r+a)/2;if(r===a)e[0]=e[1]=0;else{const l=r-a;switch(e[1]=o<.5?l/(r+a):l/(2-r-a),r){case t:e[0]=((s-i)/l+(s<i?6:0))*60;break;case s:e[0]=((i-t)/l+2)*60;break;case i:e[0]=((t-s)/l+4)*60;break}}e[2]=o}function Zu(d,e){const t=d[0],s=d[1],i=d[2],r=(1-Math.abs(2*i-1))*s,a=r*(1-Math.abs(t/60%2-1)),o=i-r/2;switch(Math.floor(t/60)){case 0:e[0]=r+o,e[1]=a+o,e[2]=o;break;case 1:e[0]=a+o,e[1]=r+o,e[2]=o;break;case 2:e[0]=o,e[1]=r+o,e[2]=a+o;break;case 3:e[0]=o,e[1]=a+o,e[2]=r+o;break;case 4:e[0]=a+o,e[1]=o,e[2]=r+o;break;case 5:case 6:e[0]=r+o,e[1]=o,e[2]=a+o;break}}function zp(d){return d<=.03928?d/12.92:((d+.055)/1.055)**2.4}function Gp(d,e,t){Zu(d,t),t.map(zp);const s=.2126*t[0]+.7152*t[1]+.0722*t[2];Zu(e,t),t.map(zp);const i=.2126*t[0]+.7152*t[1]+.0722*t[2];return s>i?(s+.05)/(i+.05):(i+.05)/(s+.05)}const Vp=new Map;function Xv(d,e){const t=d[0]+d[1]*256+d[2]*65536+e[0]*16777216+e[1]*4294967296+e[2]*1099511627776;let s=Vp.get(t);if(s)return s;const i=new Float32Array(9),r=i.subarray(0,3),a=i.subarray(3,6);jp(d,a);const o=i.subarray(6,9);jp(e,o);const l=o[2]<.5,h=l?12:4.5;if(a[2]=l?Math.sqrt(a[2]):1-Math.sqrt(1-a[2]),Gp(a,o,r)<h){let c,u;l?(c=a[2],u=1):(c=0,u=a[2]);const f=.005;for(;u-c>f;){const p=a[2]=(c+u)/2;l===Gp(a,o,r)<h?c=p:u=p}a[2]=l?u:c}return Zu(a,r),s=j.makeHexColor(Math.round(r[0]*255),Math.round(r[1]*255),Math.round(r[2]*255)),Vp.set(t,s),s}function bg({html:d,dir:e,className:t},s){const i=document.createDocumentFragment();if(typeof d=="string"){const r=document.createElement("p");r.dir=e||"auto";const a=d.split(/(?:\r\n?|\n)/);for(let o=0,l=a.length;o<l;++o){const h=a[o];r.append(document.createTextNode(h)),o<l-1&&r.append(document.createElement("br"))}i.append(r)}else yg.render({xfaHtml:d,div:i,intent:"richText"});i.firstElementChild.classList.add("richText",t),s.append(i)}function Ag(d){const e=new Path2D;if(!d)return e;for(let t=0,s=d.length;t<s;)switch(d[t++]){case Fl.moveTo:e.moveTo(d[t++],d[t++]);break;case Fl.lineTo:e.lineTo(d[t++],d[t++]);break;case Fl.curveTo:e.bezierCurveTo(d[t++],d[t++],d[t++],d[t++],d[t++],d[t++]);break;case Fl.quadraticCurveTo:e.quadraticCurveTo(d[t++],d[t++],d[t++],d[t++]);break;case Fl.closePath:e.closePath();break;default:J(`Unrecognized drawing path operator: ${d[t-1]}`);break}return e}it(4972);it(4628);it(7642);it(8004);it(3853);it(5876);it(2475);it(5024);it(1698);it(9314);it(1148);it(3579);it(8335);var Tn,Cn,Cs,Rs,uh,Rn,oo,lo,fh,du,wg,Ce,Eg,Sg,Xa,Hl;const Li=class Li{constructor(e){y(this,Ce);y(this,Tn,null);y(this,Cn,null);y(this,Cs);y(this,Rs,null);y(this,uh,null);y(this,Rn,null);y(this,oo,null);y(this,lo,null);g(this,Cs,e),n(Li,fh)||g(Li,fh,Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"}))}render(){const e=g(this,Tn,document.createElement("div"));e.classList.add("editToolbar","hidden"),e.setAttribute("role","toolbar");const t=n(this,Cs)._uiManager._signal;t instanceof AbortSignal&&!t.aborted&&(e.addEventListener("contextmenu",Hs,{signal:t}),e.addEventListener("pointerdown",w(Li,du,wg),{signal:t}));const s=g(this,Rs,document.createElement("div"));s.className="buttons",e.append(s);const i=n(this,Cs).toolbarPosition;if(i){const{style:r}=e,a=n(this,Cs)._uiManager.direction==="ltr"?1-i[0]:i[0];r.insetInlineEnd=`${100*a}%`,r.top=`calc(${100*i[1]}% + var(--editor-toolbar-vert-offset))`}return e}get div(){return n(this,Tn)}hide(){var e;n(this,Tn).classList.add("hidden"),(e=n(this,Cn))==null||e.hideDropdown()}show(){var e,t;n(this,Tn).classList.remove("hidden"),(e=n(this,uh))==null||e.shown(),(t=n(this,Rn))==null||t.shown()}addDeleteButton(){const{editorType:e,_uiManager:t}=n(this,Cs),s=document.createElement("button");s.classList.add("basic","deleteButton"),s.tabIndex=0,s.setAttribute("data-l10n-id",n(Li,fh)[e]),w(this,Ce,Xa).call(this,s)&&s.addEventListener("click",i=>{t.delete()},{signal:t._signal}),n(this,Rs).append(s)}async addAltText(e){const t=await e.render();w(this,Ce,Xa).call(this,t),n(this,Rs).append(t,n(this,Ce,Hl)),g(this,uh,e)}addComment(e,t=null){if(n(this,Rn))return;const s=e.renderForToolbar();if(!s)return;w(this,Ce,Xa).call(this,s);const i=g(this,oo,n(this,Ce,Hl));t?(n(this,Rs).insertBefore(s,t),n(this,Rs).insertBefore(i,t)):n(this,Rs).append(s,i),g(this,Rn,e),e.toolbar=this}addColorPicker(e){if(n(this,Cn))return;g(this,Cn,e);const t=e.renderButton();w(this,Ce,Xa).call(this,t),n(this,Rs).append(t,n(this,Ce,Hl))}async addEditSignatureButton(e){const t=g(this,lo,await e.renderEditButton(n(this,Cs)));w(this,Ce,Xa).call(this,t),n(this,Rs).append(t,n(this,Ce,Hl))}removeButton(e){var t,s;switch(e){case"comment":(t=n(this,Rn))==null||t.removeToolbarCommentButton(),g(this,Rn,null),(s=n(this,oo))==null||s.remove(),g(this,oo,null);break}}async addButton(e,t){switch(e){case"colorPicker":t&&this.addColorPicker(t);break;case"altText":t&&await this.addAltText(t);break;case"editSignature":t&&await this.addEditSignatureButton(t);break;case"delete":this.addDeleteButton();break;case"comment":t&&this.addComment(t);break}}async addButtonBefore(e,t,s){if(!t&&e==="comment")return;const i=n(this,Rs).querySelector(s);i&&e==="comment"&&this.addComment(t,i)}updateEditSignatureButton(e){n(this,lo)&&(n(this,lo).title=e)}remove(){var e;n(this,Tn).remove(),(e=n(this,Cn))==null||e.destroy(),g(this,Cn,null)}};Tn=new WeakMap,Cn=new WeakMap,Cs=new WeakMap,Rs=new WeakMap,uh=new WeakMap,Rn=new WeakMap,oo=new WeakMap,lo=new WeakMap,fh=new WeakMap,du=new WeakSet,wg=function(e){e.stopPropagation()},Ce=new WeakSet,Eg=function(e){n(this,Cs)._focusEventsAllowed=!1,Jt(e)},Sg=function(e){n(this,Cs)._focusEventsAllowed=!0,Jt(e)},Xa=function(e){const t=n(this,Cs)._uiManager._signal;return!(t instanceof AbortSignal)||t.aborted?!1:(e.addEventListener("focusin",w(this,Ce,Eg).bind(this),{capture:!0,signal:t}),e.addEventListener("focusout",w(this,Ce,Sg).bind(this),{capture:!0,signal:t}),e.addEventListener("contextmenu",Hs,{signal:t}),!0)},Hl=function(){const e=document.createElement("div");return e.className="divider",e},y(Li,du),y(Li,fh,null);let qu=Li;var ph,xr,ki,wn,xg,Tg,tf;class Yv{constructor(e){y(this,wn);y(this,ph,null);y(this,xr,null);y(this,ki);g(this,ki,e)}show(e,t,s){const[i,r]=w(this,wn,Tg).call(this,t,s),{style:a}=n(this,xr)||g(this,xr,w(this,wn,xg).call(this));e.append(n(this,xr)),a.insetInlineEnd=`${100*i}%`,a.top=`calc(${100*r}% + var(--editor-toolbar-vert-offset))`}hide(){n(this,xr).remove()}}ph=new WeakMap,xr=new WeakMap,ki=new WeakMap,wn=new WeakSet,xg=function(){const e=g(this,xr,document.createElement("div"));e.className="editToolbar",e.setAttribute("role","toolbar");const t=n(this,ki)._signal;t instanceof AbortSignal&&!t.aborted&&e.addEventListener("contextmenu",Hs,{signal:t});const s=g(this,ph,document.createElement("div"));return s.className="buttons",e.append(s),n(this,ki).hasCommentManager()&&w(this,wn,tf).call(this,"commentButton","pdfjs-comment-floating-button","pdfjs-comment-floating-button-label",()=>{n(this,ki).commentSelection("floating_button")}),w(this,wn,tf).call(this,"highlightButton","pdfjs-highlight-floating-button1","pdfjs-highlight-floating-button-label",()=>{n(this,ki).highlightSelection("floating_button")}),e},Tg=function(e,t){let s=0,i=0;for(const r of e){const a=r.y+r.height;if(a<s)continue;const o=r.x+(t?r.width:0);if(a>s){i=o,s=a;continue}t?o>i&&(i=o):o<i&&(i=o)}return[t?1-i:i,s]},tf=function(e,t,s,i){const r=document.createElement("button");r.classList.add("basic",e),r.tabIndex=0,r.setAttribute("data-l10n-id",t);const a=document.createElement("span");r.append(a),a.className="visuallyHidden",a.setAttribute("data-l10n-id",s);const o=n(this,ki)._signal;o instanceof AbortSignal&&!o.aborted&&(r.addEventListener("contextmenu",Hs,{signal:o}),r.addEventListener("click",i,{signal:o})),n(this,ph).append(r)};function Cg(d,e,t){for(const s of t)e.addEventListener(s,d[s].bind(d))}var Tr,Cr,ho,Rr;const Et=class Et{static initializeAndAddPointerId(e){(n(Et,Cr)||g(Et,Cr,new Set)).add(e)}static setPointer(e,t){n(Et,Tr)||g(Et,Tr,t),n(Et,Rr)??g(Et,Rr,e)}static setTimeStamp(e){g(Et,ho,e)}static isSamePointerId(e){return n(Et,Tr)===e}static isSamePointerIdOrRemove(e){var t;return n(Et,Tr)===e?!0:((t=n(Et,Cr))==null||t.delete(e),!1)}static isSamePointerType(e){return n(Et,Rr)===e}static isInitializedAndDifferentPointerType(e){return n(Et,Rr)!==null&&!Et.isSamePointerType(e)}static isSameTimeStamp(e){return n(Et,ho)===e}static isUsingMultiplePointers(){var e;return((e=n(Et,Cr))==null?void 0:e.size)>=1}static clearPointerType(){g(Et,Rr,null)}static clearPointerIds(){g(Et,Tr,NaN),g(Et,Cr,null)}static clearTimeStamp(){g(Et,ho,NaN)}};Tr=new WeakMap,Cr=new WeakMap,ho=new WeakMap,Rr=new WeakMap,y(Et,Tr,NaN),y(Et,Cr,null),y(Et,ho,NaN),y(Et,Rr,null);let Pe=Et;var uu;class Kv{constructor(){y(this,uu,0)}get id(){return`${ah}${ie(this,uu)._++}`}}uu=new WeakMap;var co,gh,Ie,uo,Ad;const Mp=class Mp{constructor(){y(this,uo);y(this,co,mg());y(this,gh,0);y(this,Ie,null)}static get _isSVGFittingCanvas(){const e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',s=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),i=new Image;i.src=e;const r=i.decode().then(()=>(s.drawImage(i,0,0,1,1,0,0,1,3),new Uint32Array(s.getImageData(0,0,1,1).data.buffer)[0]===0));return Q(this,"_isSVGFittingCanvas",r)}async getFromFile(e){const{lastModified:t,name:s,size:i,type:r}=e;return w(this,uo,Ad).call(this,`${t}_${s}_${i}_${r}`,e)}async getFromUrl(e){return w(this,uo,Ad).call(this,e,e)}async getFromBlob(e,t){const s=await t;return w(this,uo,Ad).call(this,e,s)}async getFromId(e){n(this,Ie)||g(this,Ie,new Map);const t=n(this,Ie).get(e);if(!t)return null;if(t.bitmap)return t.refCounter+=1,t;if(t.file)return this.getFromFile(t.file);if(t.blobPromise){const{blobPromise:s}=t;return delete t.blobPromise,this.getFromBlob(t.id,s)}return this.getFromUrl(t.url)}getFromCanvas(e,t){n(this,Ie)||g(this,Ie,new Map);let s=n(this,Ie).get(e);if(s!=null&&s.bitmap)return s.refCounter+=1,s;const i=new OffscreenCanvas(t.width,t.height);return i.getContext("2d").drawImage(t,0,0),s={bitmap:i.transferToImageBitmap(),id:`image_${n(this,co)}_${ie(this,gh)._++}`,refCounter:1,isSvg:!1},n(this,Ie).set(e,s),n(this,Ie).set(s.id,s),s}getSvgUrl(e){const t=n(this,Ie).get(e);return t!=null&&t.isSvg?t.svgUrl:null}deleteId(e){var i;n(this,Ie)||g(this,Ie,new Map);const t=n(this,Ie).get(e);if(!t||(t.refCounter-=1,t.refCounter!==0))return;const{bitmap:s}=t;if(!t.url&&!t.file){const r=new OffscreenCanvas(s.width,s.height);r.getContext("bitmaprenderer").transferFromImageBitmap(s),t.blobPromise=r.convertToBlob()}(i=s.close)==null||i.call(s),t.bitmap=null}isValidId(e){return e.startsWith(`image_${n(this,co)}_`)}};co=new WeakMap,gh=new WeakMap,Ie=new WeakMap,uo=new WeakSet,Ad=async function(e,t){n(this,Ie)||g(this,Ie,new Map);let s=n(this,Ie).get(e);if(s===null)return null;if(s!=null&&s.bitmap)return s.refCounter+=1,s;try{s||(s={bitmap:null,id:`image_${n(this,co)}_${ie(this,gh)._++}`,refCounter:0,isSvg:!1});let i;if(typeof t=="string"?(s.url=t,i=await sd(t,"blob")):t instanceof File?i=s.file=t:t instanceof Blob&&(i=t),i.type==="image/svg+xml"){const r=Mp._isSVGFittingCanvas,a=new FileReader,o=new Image,l=new Promise((h,c)=>{o.onload=()=>{s.bitmap=o,s.isSvg=!0,h()},a.onload=async()=>{const u=s.svgUrl=a.result;o.src=await r?`${u}#svgView(preserveAspectRatio(none))`:u},o.onerror=a.onerror=c});a.readAsDataURL(i),await l}else s.bitmap=await createImageBitmap(i);s.refCounter=1}catch(i){J(i),s=null}return n(this,Ie).set(e,s),s&&n(this,Ie).set(s.id,s),s};let ef=Mp;var Qt,Pn,mh,jt;class Jv{constructor(e=128){y(this,Qt,[]);y(this,Pn,!1);y(this,mh);y(this,jt,-1);g(this,mh,e)}add({cmd:e,undo:t,post:s,mustExec:i,type:r=NaN,overwriteIfSameType:a=!1,keepUndo:o=!1}){if(i&&e(),n(this,Pn))return;const l={cmd:e,undo:t,post:s,type:r};if(n(this,jt)===-1){n(this,Qt).length>0&&(n(this,Qt).length=0),g(this,jt,0),n(this,Qt).push(l);return}if(a&&n(this,Qt)[n(this,jt)].type===r){o&&(l.undo=n(this,Qt)[n(this,jt)].undo),n(this,Qt)[n(this,jt)]=l;return}const h=n(this,jt)+1;h===n(this,mh)?n(this,Qt).splice(0,1):(g(this,jt,h),h<n(this,Qt).length&&n(this,Qt).splice(h)),n(this,Qt).push(l)}undo(){if(n(this,jt)===-1)return;g(this,Pn,!0);const{undo:e,post:t}=n(this,Qt)[n(this,jt)];e(),t==null||t(),g(this,Pn,!1),g(this,jt,n(this,jt)-1)}redo(){if(n(this,jt)<n(this,Qt).length-1){g(this,jt,n(this,jt)+1),g(this,Pn,!0);const{cmd:e,post:t}=n(this,Qt)[n(this,jt)];e(),t==null||t(),g(this,Pn,!1)}}hasSomethingToUndo(){return n(this,jt)!==-1}hasSomethingToRedo(){return n(this,jt)<n(this,Qt).length-1}cleanType(e){if(n(this,jt)!==-1){for(let t=n(this,jt);t>=0;t--)if(n(this,Qt)[t].type!==e){n(this,Qt).splice(t+1,n(this,jt)-t),g(this,jt,t);return}n(this,Qt).length=0,g(this,jt,-1)}}destroy(){g(this,Qt,null)}}Qt=new WeakMap,Pn=new WeakMap,mh=new WeakMap,jt=new WeakMap;var fu,Rg;class rd{constructor(e){y(this,fu);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:t}=he.platform;for(const[s,i,r={}]of e)for(const a of s){const o=a.startsWith("mac+");t&&o?(this.callbacks.set(a.slice(4),{callback:i,options:r}),this.allKeys.add(a.split("+").at(-1))):!t&&!o&&(this.callbacks.set(a,{callback:i,options:r}),this.allKeys.add(a.split("+").at(-1)))}}exec(e,t){if(!this.allKeys.has(t.key))return;const s=this.callbacks.get(w(this,fu,Rg).call(this,t));if(!s)return;const{callback:i,options:{bubbles:r=!1,args:a=[],checker:o=null}}=s;o&&!o(e,t)||(i.bind(e,...a,t)(),r||Jt(t))}}fu=new WeakSet,Rg=function(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);const t=this.buffer.join("+");return this.buffer.length=0,t};const pu=class pu{get _colors(){const e=new Map([["CanvasText",null],["Canvas",null]]);return zv(e),Q(this,"_colors",e)}convert(e){const t=nd(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(const[s,i]of this._colors)if(i.every((r,a)=>r===t[a]))return pu._colorsMapping.get(s);return t}getHexCode(e){const t=this._colors.get(e);return t?j.makeHexColor(...t):e}};F(pu,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let sf=pu;var fo,ts,po,Vt,ae,go,Ps,mo,Is,De,In,Dn,vo,Mn,ai,Ds,Pr,vh,yh,yo,bh,oi,On,bo,Ln,li,gu,Fn,Ao,Ah,kn,Ir,wo,Nn,wh,ee,At,Ni,Bn,_n,Eh,Eo,Sh,Un,hi,Bi,xh,Th,Ms,H,wd,nf,Pg,Ig,$l,Dg,Mg,Og,rf,Lg,Fg,kg,Ng,ke,Mi,Bg,_g,af,Ug,jl,of;const so=class so{constructor(e,t,s,i,r,a,o,l,h,c,u,f,p,v,m,A){y(this,H);y(this,fo,new AbortController);y(this,ts,null);y(this,po,null);y(this,Vt,new Map);y(this,ae,new Map);y(this,go,null);y(this,Ps,null);y(this,mo,null);y(this,Is,new Jv);y(this,De,null);y(this,In,null);y(this,Dn,null);y(this,vo,0);y(this,Mn,new Set);y(this,ai,null);y(this,Ds,null);y(this,Pr,new Set);F(this,"_editorUndoBar",null);y(this,vh,!1);y(this,yh,!1);y(this,yo,!1);y(this,bh,null);y(this,oi,null);y(this,On,null);y(this,bo,null);y(this,Ln,!1);y(this,li,null);y(this,gu,new Kv);y(this,Fn,!1);y(this,Ao,!1);y(this,Ah,!1);y(this,kn,null);y(this,Ir,null);y(this,wo,null);y(this,Nn,null);y(this,wh,null);y(this,ee,et.NONE);y(this,At,new Set);y(this,Ni,null);y(this,Bn,null);y(this,_n,null);y(this,Eh,null);y(this,Eo,null);y(this,Sh,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1});y(this,Un,[0,0]);y(this,hi,null);y(this,Bi,null);y(this,xh,null);y(this,Th,null);y(this,Ms,null);const b=this._signal=n(this,fo).signal;g(this,Bi,e),g(this,xh,t),g(this,Th,s),g(this,go,i),g(this,De,r),g(this,Bn,a),g(this,Eo,l),this._eventBus=o,o._on("editingaction",this.onEditingAction.bind(this),{signal:b}),o._on("pagechanging",this.onPageChanging.bind(this),{signal:b}),o._on("scalechanging",this.onScaleChanging.bind(this),{signal:b}),o._on("rotationchanging",this.onRotationChanging.bind(this),{signal:b}),o._on("setpreference",this.onSetPreference.bind(this),{signal:b}),o._on("switchannotationeditorparams",S=>this.updateParams(S.type,S.value),{signal:b}),window.addEventListener("pointerdown",()=>{g(this,Ao,!0)},{capture:!0,signal:b}),window.addEventListener("pointerup",()=>{g(this,Ao,!1)},{capture:!0,signal:b}),w(this,H,Dg).call(this),w(this,H,Ng).call(this),w(this,H,rf).call(this),g(this,Ps,l.annotationStorage),g(this,bh,l.filterFactory),g(this,_n,h),g(this,bo,c||null),g(this,vh,u),g(this,yh,f),g(this,yo,p),g(this,wh,v||null),this.viewParameters={realScale:mr.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=m||null,this._supportsPinchToZoom=A!==!1,r==null||r.setSidebarUiManager(this)}static get _keyboardManager(){const e=so.prototype,t=a=>n(a,Bi).contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&a.hasSomethingToControl(),s=(a,{target:o})=>{if(o instanceof HTMLInputElement){const{type:l}=o;return l!=="text"&&l!=="number"}return!0},i=this.TRANSLATE_SMALL,r=this.TRANSLATE_BIG;return Q(this,"_keyboardManager",new rd([[["ctrl+a","mac+meta+a"],e.selectAll,{checker:s}],[["ctrl+z","mac+meta+z"],e.undo,{checker:s}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo,{checker:s}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete,{checker:s}],[["Enter","mac+Enter"],e.addNewEditorFromKeyboard,{checker:(a,{target:o})=>!(o instanceof HTMLButtonElement)&&n(a,Bi).contains(o)&&!a.isEnterHandled}],[[" ","mac+ "],e.addNewEditorFromKeyboard,{checker:(a,{target:o})=>!(o instanceof HTMLButtonElement)&&n(a,Bi).contains(document.activeElement)}],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-i,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-r,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[i,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[r,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-i],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-r],checker:t}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,i],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,r],checker:t}]]))}destroy(){var e,t,s,i,r,a,o,l,h;(e=n(this,Ms))==null||e.resolve(),g(this,Ms,null),(t=n(this,fo))==null||t.abort(),g(this,fo,null),this._signal=null;for(const c of n(this,ae).values())c.destroy();n(this,ae).clear(),n(this,Vt).clear(),n(this,Pr).clear(),(s=n(this,Nn))==null||s.clear(),g(this,ts,null),n(this,At).clear(),n(this,Is).destroy(),(i=n(this,go))==null||i.destroy(),(r=n(this,De))==null||r.destroy(),(a=n(this,Bn))==null||a.destroy(),(o=n(this,li))==null||o.hide(),g(this,li,null),(l=n(this,wo))==null||l.destroy(),g(this,wo,null),g(this,po,null),n(this,oi)&&(clearTimeout(n(this,oi)),g(this,oi,null)),n(this,hi)&&(clearTimeout(n(this,hi)),g(this,hi,null)),(h=this._editorUndoBar)==null||h.destroy(),g(this,Eo,null)}combinedSignal(e){return AbortSignal.any([this._signal,e.signal])}get mlManager(){return n(this,wh)}get useNewAltTextFlow(){return n(this,yh)}get useNewAltTextWhenAddingImage(){return n(this,yo)}get hcmFilter(){return Q(this,"hcmFilter",n(this,_n)?n(this,bh).addHCMFilter(n(this,_n).foreground,n(this,_n).background):"none")}get direction(){return Q(this,"direction",getComputedStyle(n(this,Bi)).direction)}get _highlightColors(){return Q(this,"_highlightColors",n(this,bo)?new Map(n(this,bo).split(",").map(e=>(e=e.split("=").map(t=>t.trim()),e[1]=e[1].toUpperCase(),e))):null)}get highlightColors(){const{_highlightColors:e}=this;if(!e)return Q(this,"highlightColors",null);const t=new Map,s=!!n(this,_n);for(const[i,r]of e){const a=i.endsWith("_HCM");if(s&&a){t.set(i.replace("_HCM",""),r);continue}!s&&!a&&t.set(i,r)}return Q(this,"highlightColors",t)}get highlightColorNames(){return Q(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,e=>e.reverse())):null)}getNonHCMColor(e){if(!this._highlightColors)return e;const t=this.highlightColorNames.get(e);return this._highlightColors.get(t)||e}getNonHCMColorName(e){return this.highlightColorNames.get(e)||e}setCurrentDrawingSession(e){e?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),g(this,Dn,e)}setMainHighlightColorPicker(e){g(this,wo,e)}editAltText(e,t=!1){var s;(s=n(this,go))==null||s.editAltText(this,e,t)}hasCommentManager(){return!!n(this,De)}editComment(e,t,s,i){var r;(r=n(this,De))==null||r.showDialog(this,e,t,s,i)}selectComment(e,t){const s=n(this,ae).get(e),i=s==null?void 0:s.getEditorByUID(t);i==null||i.toggleComment(!0,!0)}updateComment(e){var t;(t=n(this,De))==null||t.updateComment(e.getData())}updatePopupColor(e){var t;(t=n(this,De))==null||t.updatePopupColor(e)}removeComment(e){var t;(t=n(this,De))==null||t.removeComments([e.uid])}toggleComment(e,t,s=void 0){var i;(i=n(this,De))==null||i.toggleCommentPopup(e,t,s)}makeCommentColor(e,t){var s;return e&&((s=n(this,De))==null?void 0:s.makeCommentColor(e,t))||null}getCommentDialogElement(){var e;return((e=n(this,De))==null?void 0:e.dialogElement)||null}async waitForEditorsRendered(e){if(n(this,ae).has(e-1))return;const{resolve:t,promise:s}=Promise.withResolvers(),i=r=>{r.pageNumber===e&&(this._eventBus._off("editorsrendered",i),t())};this._eventBus.on("editorsrendered",i),await s}getSignature(e){var t;(t=n(this,Bn))==null||t.getSignature({uiManager:this,editor:e})}get signatureManager(){return n(this,Bn)}switchToMode(e,t){this._eventBus.on("annotationeditormodechanged",t,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:e})}setPreference(e,t){this._eventBus.dispatch("setpreference",{source:this,name:e,value:t})}onSetPreference({name:e,value:t}){switch(e){case"enableNewAltTextWhenAddingImage":g(this,yo,t);break}}onPageChanging({pageNumber:e}){g(this,vo,e-1)}focusMainContainer(){n(this,Bi).focus()}findParent(e,t){for(const s of n(this,ae).values()){const{x:i,y:r,width:a,height:o}=s.div.getBoundingClientRect();if(e>=i&&e<=i+a&&t>=r&&t<=r+o)return s}return null}disableUserSelect(e=!1){n(this,xh).classList.toggle("noUserSelect",e)}addShouldRescale(e){n(this,Pr).add(e)}removeShouldRescale(e){n(this,Pr).delete(e)}onScaleChanging({scale:e}){var t;this.commitOrRemove(),this.viewParameters.realScale=e*mr.PDF_TO_CSS_UNITS;for(const s of n(this,Pr))s.onScaleChanging();(t=n(this,Dn))==null||t.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}highlightSelection(e="",t=!1){const s=document.getSelection();if(!s||s.isCollapsed)return;const{anchorNode:i,anchorOffset:r,focusNode:a,focusOffset:o}=s,l=s.toString(),c=w(this,H,wd).call(this,s).closest(".textLayer"),u=this.getSelectionBoxes(c);if(!u)return;s.empty();const f=w(this,H,nf).call(this,c),p=n(this,ee)===et.NONE,v=()=>{const m=f==null?void 0:f.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:e,boxes:u,anchorNode:i,anchorOffset:r,focusNode:a,focusOffset:o,text:l});p&&this.showAllEditors("highlight",!0,!0),t&&(m==null||m.editComment())};if(p){this.switchToMode(et.HIGHLIGHT,v);return}v()}commentSelection(e=""){this.highlightSelection(e,!0)}getAndRemoveDataFromAnnotationStorage(e){if(!n(this,Ps))return null;const t=`${ah}${e}`,s=n(this,Ps).getRawValue(t);return s&&n(this,Ps).remove(t),s}addToAnnotationStorage(e){!e.isEmpty()&&n(this,Ps)&&!n(this,Ps).has(e.id)&&n(this,Ps).setValue(e.id,e)}a11yAlert(e,t=null){const s=n(this,Th);s&&(s.setAttribute("data-l10n-id",e),t?s.setAttribute("data-l10n-args",JSON.stringify(t)):s.removeAttribute("data-l10n-args"))}blur(){if(this.isShiftKeyDown=!1,n(this,Ln)&&(g(this,Ln,!1),w(this,H,$l).call(this,"main_toolbar")),!this.hasSelection)return;const{activeElement:e}=document;for(const t of n(this,At))if(t.div.contains(e)){g(this,Ir,[t,e]),t._focusEventsAllowed=!1;break}}focus(){if(!n(this,Ir))return;const[e,t]=n(this,Ir);g(this,Ir,null),t.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this._signal}),t.focus()}addEditListeners(){w(this,H,rf).call(this),this.setEditingState(!0)}removeEditListeners(){w(this,H,Lg).call(this),this.setEditingState(!1)}dragOver(e){for(const{type:t}of e.dataTransfer.items)for(const s of n(this,Ds))if(s.isHandlingMimeForPasting(t)){e.dataTransfer.dropEffect="copy",e.preventDefault();return}}drop(e){for(const t of e.dataTransfer.items)for(const s of n(this,Ds))if(s.isHandlingMimeForPasting(t.type)){s.paste(t,this.currentLayer),e.preventDefault();return}}copy(e){var s;if(e.preventDefault(),(s=n(this,ts))==null||s.commitOrRemove(),!this.hasSelection)return;const t=[];for(const i of n(this,At)){const r=i.serialize(!0);r&&t.push(r)}t.length!==0&&e.clipboardData.setData("application/pdfjs",JSON.stringify(t))}cut(e){this.copy(e),this.delete()}async paste(e){e.preventDefault();const{clipboardData:t}=e;for(const r of t.items)for(const a of n(this,Ds))if(a.isHandlingMimeForPasting(r.type)){a.paste(r,this.currentLayer);return}let s=t.getData("application/pdfjs");if(!s)return;try{s=JSON.parse(s)}catch(r){J(`paste: "${r.message}".`);return}if(!Array.isArray(s))return;this.unselectAll();const i=this.currentLayer;try{const r=[];for(const l of s){const h=await i.deserialize(l);if(!h)return;r.push(h)}const a=()=>{for(const l of r)w(this,H,af).call(this,l);w(this,H,of).call(this,r)},o=()=>{for(const l of r)l.remove()};this.addCommands({cmd:a,undo:o,mustExec:!0})}catch(r){J(`paste: "${r.message}".`)}}keydown(e){!this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!0),n(this,ee)!==et.NONE&&!this.isEditorHandlingKeyboard&&so._keyboardManager.exec(this,e)}keyup(e){this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!1,n(this,Ln)&&(g(this,Ln,!1),w(this,H,$l).call(this,"main_toolbar")))}onEditingAction({name:e}){switch(e){case"undo":case"redo":case"delete":case"selectAll":this[e]();break;case"highlightSelection":this.highlightSelection("context_menu");break;case"commentSelection":this.commentSelection("context_menu");break}}setEditingState(e){e?(w(this,H,Mg).call(this),w(this,H,Fg).call(this),w(this,H,ke).call(this,{isEditing:n(this,ee)!==et.NONE,isEmpty:w(this,H,jl).call(this),hasSomethingToUndo:n(this,Is).hasSomethingToUndo(),hasSomethingToRedo:n(this,Is).hasSomethingToRedo(),hasSelectedEditor:!1})):(w(this,H,Og).call(this),w(this,H,kg).call(this),w(this,H,ke).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!n(this,Ds)){g(this,Ds,e);for(const t of n(this,Ds))w(this,H,Mi).call(this,t.defaultPropertiesToUpdate)}}getId(){return n(this,gu).id}get currentLayer(){return n(this,ae).get(n(this,vo))}getLayer(e){return n(this,ae).get(e)}get currentPageIndex(){return n(this,vo)}addLayer(e){n(this,ae).set(e.pageIndex,e),n(this,Fn)?e.enable():e.disable()}removeLayer(e){n(this,ae).delete(e.pageIndex)}async updateMode(e,t=null,s=!1,i=!1,r=!1,a=!1){var o,l,h,c,u,f;if(n(this,ee)!==e&&!(n(this,Ms)&&(await n(this,Ms).promise,!n(this,Ms)))){if(g(this,Ms,Promise.withResolvers()),(o=n(this,Dn))==null||o.commitOrRemove(),n(this,ee)===et.POPUP&&((l=n(this,De))==null||l.hideSidebar()),(h=n(this,De))==null||h.destroyPopup(),g(this,ee,e),e===et.NONE){this.setEditingState(!1),w(this,H,_g).call(this);for(const p of n(this,Vt).values())p.hideStandaloneCommentButton();(c=this._editorUndoBar)==null||c.hide(),this.toggleComment(null),n(this,Ms).resolve();return}for(const p of n(this,Vt).values())p.addStandaloneCommentButton();e===et.SIGNATURE&&await((u=n(this,Bn))==null?void 0:u.loadSignatures()),s&&Pe.clearPointerType(),this.setEditingState(!0),await w(this,H,Bg).call(this),this.unselectAll();for(const p of n(this,ae).values())p.updateMode(e);if(e===et.POPUP){n(this,po)||g(this,po,await n(this,Eo).getAnnotationsByType(new Set(n(this,Ds).map(m=>m._editorType))));const p=new Set,v=[];for(const m of n(this,Vt).values()){const{annotationElementId:A,hasComment:b,deleted:S}=m;A&&p.add(A),b&&!S&&v.push(m.getData())}for(const m of n(this,po)){const{id:A,popupRef:b,contentsObj:S}=m;b&&(S!=null&&S.str)&&!p.has(A)&&!n(this,Mn).has(A)&&v.push(m)}(f=n(this,De))==null||f.showSidebar(v)}if(!t){i&&this.addNewEditorFromKeyboard(),n(this,Ms).resolve();return}for(const p of n(this,Vt).values())p.uid===t?(this.setSelected(p),a?p.editComment():r?p.enterInEditMode():p.focus()):p.unselect();n(this,Ms).resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(e){e.mode!==n(this,ee)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,...e})}updateParams(e,t){if(n(this,Ds)){switch(e){case dt.CREATE:this.currentLayer.addNewEditor(t);return;case dt.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(n(this,Eh)||g(this,Eh,new Map)).set(e,t),this.showAllEditors("highlight",t);break}if(this.hasSelection)for(const s of n(this,At))s.updateParams(e,t);else for(const s of n(this,Ds))s.updateDefaultParams(e,t)}}showAllEditors(e,t,s=!1){var r;for(const a of n(this,Vt).values())a.editorType===e&&a.show(t);(((r=n(this,Eh))==null?void 0:r.get(dt.HIGHLIGHT_SHOW_ALL))??!0)!==t&&w(this,H,Mi).call(this,[[dt.HIGHLIGHT_SHOW_ALL,t]])}enableWaiting(e=!1){if(n(this,Ah)!==e){g(this,Ah,e);for(const t of n(this,ae).values())e?t.disableClick():t.enableClick(),t.div.classList.toggle("waiting",e)}}*getEditors(e){for(const t of n(this,Vt).values())t.pageIndex===e&&(yield t)}getEditor(e){return n(this,Vt).get(e)}addEditor(e){n(this,Vt).set(e.id,e)}removeEditor(e){var t,s;e.div.contains(document.activeElement)&&(n(this,oi)&&clearTimeout(n(this,oi)),g(this,oi,setTimeout(()=>{this.focusMainContainer(),g(this,oi,null)},0))),n(this,Vt).delete(e.id),e.annotationElementId&&((t=n(this,Nn))==null||t.delete(e.annotationElementId)),this.unselect(e),(!e.annotationElementId||!n(this,Mn).has(e.annotationElementId))&&((s=n(this,Ps))==null||s.remove(e.id))}addDeletedAnnotationElement(e){n(this,Mn).add(e.annotationElementId),this.addChangedExistingAnnotation(e),e.deleted=!0}isDeletedAnnotationElement(e){return n(this,Mn).has(e)}removeDeletedAnnotationElement(e){n(this,Mn).delete(e.annotationElementId),this.removeChangedExistingAnnotation(e),e.deleted=!1}setActiveEditor(e){n(this,ts)!==e&&(g(this,ts,e),e&&w(this,H,Mi).call(this,e.propertiesToUpdate))}updateUI(e){n(this,H,Ug)===e&&w(this,H,Mi).call(this,e.propertiesToUpdate)}updateUIForDefaultProperties(e){w(this,H,Mi).call(this,e.defaultPropertiesToUpdate)}toggleSelected(e){if(n(this,At).has(e)){n(this,At).delete(e),e.unselect(),w(this,H,ke).call(this,{hasSelectedEditor:this.hasSelection});return}n(this,At).add(e),e.select(),w(this,H,Mi).call(this,e.propertiesToUpdate),w(this,H,ke).call(this,{hasSelectedEditor:!0})}setSelected(e){var t;this.updateToolbar({mode:e.mode,editId:e.uid}),(t=n(this,Dn))==null||t.commitOrRemove();for(const s of n(this,At))s!==e&&s.unselect();n(this,At).clear(),n(this,At).add(e),e.select(),w(this,H,Mi).call(this,e.propertiesToUpdate),w(this,H,ke).call(this,{hasSelectedEditor:!0})}isSelected(e){return n(this,At).has(e)}get firstSelectedEditor(){return n(this,At).values().next().value}unselect(e){e.unselect(),n(this,At).delete(e),w(this,H,ke).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return n(this,At).size!==0}get isEnterHandled(){return n(this,At).size===1&&this.firstSelectedEditor.isEnterHandled}undo(){var e;n(this,Is).undo(),w(this,H,ke).call(this,{hasSomethingToUndo:n(this,Is).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:w(this,H,jl).call(this)}),(e=this._editorUndoBar)==null||e.hide()}redo(){n(this,Is).redo(),w(this,H,ke).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:n(this,Is).hasSomethingToRedo(),isEmpty:w(this,H,jl).call(this)})}addCommands(e){n(this,Is).add(e),w(this,H,ke).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:w(this,H,jl).call(this)})}cleanUndoStack(e){n(this,Is).cleanType(e)}delete(){var r;this.commitOrRemove();const e=(r=this.currentLayer)==null?void 0:r.endDrawingSession(!0);if(!this.hasSelection&&!e)return;const t=e?[e]:[...n(this,At)],s=()=>{var a;(a=this._editorUndoBar)==null||a.show(i,t.length===1?t[0].editorType:t.length);for(const o of t)o.remove()},i=()=>{for(const a of t)w(this,H,af).call(this,a)};this.addCommands({cmd:s,undo:i,mustExec:!0})}commitOrRemove(){var e;(e=n(this,ts))==null||e.commitOrRemove()}hasSomethingToControl(){return n(this,ts)||this.hasSelection}selectAll(){for(const e of n(this,At))e.commit();w(this,H,of).call(this,n(this,Vt).values())}unselectAll(){var e;if(!(n(this,ts)&&(n(this,ts).commitOrRemove(),n(this,ee)!==et.NONE))&&!((e=n(this,Dn))!=null&&e.commitOrRemove())&&this.hasSelection){for(const t of n(this,At))t.unselect();n(this,At).clear(),w(this,H,ke).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(e,t,s=!1){if(s||this.commitOrRemove(),!this.hasSelection)return;n(this,Un)[0]+=e,n(this,Un)[1]+=t;const[i,r]=n(this,Un),a=[...n(this,At)],o=1e3;n(this,hi)&&clearTimeout(n(this,hi)),g(this,hi,setTimeout(()=>{g(this,hi,null),n(this,Un)[0]=n(this,Un)[1]=0,this.addCommands({cmd:()=>{for(const l of a)n(this,Vt).has(l.id)&&(l.translateInPage(i,r),l.translationDone())},undo:()=>{for(const l of a)n(this,Vt).has(l.id)&&(l.translateInPage(-i,-r),l.translationDone())},mustExec:!1})},o));for(const l of a)l.translateInPage(e,t),l.translationDone()}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),g(this,ai,new Map);for(const e of n(this,At))n(this,ai).set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!n(this,ai))return!1;this.disableUserSelect(!1);const e=n(this,ai);g(this,ai,null);let t=!1;for(const[{x:i,y:r,pageIndex:a},o]of e)o.newX=i,o.newY=r,o.newPageIndex=a,t||(t=i!==o.savedX||r!==o.savedY||a!==o.savedPageIndex);if(!t)return!1;const s=(i,r,a,o)=>{if(n(this,Vt).has(i.id)){const l=n(this,ae).get(o);l?i._setParentAndPosition(l,r,a):(i.pageIndex=o,i.x=r,i.y=a)}};return this.addCommands({cmd:()=>{for(const[i,{newX:r,newY:a,newPageIndex:o}]of e)s(i,r,a,o)},undo:()=>{for(const[i,{savedX:r,savedY:a,savedPageIndex:o}]of e)s(i,r,a,o)},mustExec:!0}),!0}dragSelectedEditors(e,t){if(n(this,ai))for(const s of n(this,ai).keys())s.drag(e,t)}rebuild(e){if(e.parent===null){const t=this.getLayer(e.pageIndex);t?(t.changeParent(e),t.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}get isEditorHandlingKeyboard(){var e;return((e=this.getActive())==null?void 0:e.shouldGetKeyboardEvents())||n(this,At).size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(e){return n(this,ts)===e}getActive(){return n(this,ts)}getMode(){return n(this,ee)}isEditingMode(){return n(this,ee)!==et.NONE}get imageManager(){return Q(this,"imageManager",new ef)}getSelectionBoxes(e){if(!e)return null;const t=document.getSelection();for(let h=0,c=t.rangeCount;h<c;h++)if(!e.contains(t.getRangeAt(h).commonAncestorContainer))return null;const{x:s,y:i,width:r,height:a}=e.getBoundingClientRect();let o;switch(e.getAttribute("data-main-rotation")){case"90":o=(h,c,u,f)=>({x:(c-i)/a,y:1-(h+u-s)/r,width:f/a,height:u/r});break;case"180":o=(h,c,u,f)=>({x:1-(h+u-s)/r,y:1-(c+f-i)/a,width:u/r,height:f/a});break;case"270":o=(h,c,u,f)=>({x:1-(c+f-i)/a,y:(h-s)/r,width:f/a,height:u/r});break;default:o=(h,c,u,f)=>({x:(h-s)/r,y:(c-i)/a,width:u/r,height:f/a});break}const l=[];for(let h=0,c=t.rangeCount;h<c;h++){const u=t.getRangeAt(h);if(!u.collapsed)for(const{x:f,y:p,width:v,height:m}of u.getClientRects())v===0||m===0||l.push(o(f,p,v,m))}return l.length===0?null:l}addChangedExistingAnnotation({annotationElementId:e,id:t}){(n(this,mo)||g(this,mo,new Map)).set(e,t)}removeChangedExistingAnnotation({annotationElementId:e}){var t;(t=n(this,mo))==null||t.delete(e)}renderAnnotationElement(e){var i;const t=(i=n(this,mo))==null?void 0:i.get(e.data.id);if(!t)return;const s=n(this,Ps).getRawValue(t);s&&(n(this,ee)===et.NONE&&!s.hasBeenModified||s.renderAnnotationElement(e))}setMissingCanvas(e,t,s){var r;const i=(r=n(this,Nn))==null?void 0:r.get(e);i&&(i.setCanvas(t,s),n(this,Nn).delete(e))}addMissingCanvas(e,t){(n(this,Nn)||g(this,Nn,new Map)).set(e,t)}};fo=new WeakMap,ts=new WeakMap,po=new WeakMap,Vt=new WeakMap,ae=new WeakMap,go=new WeakMap,Ps=new WeakMap,mo=new WeakMap,Is=new WeakMap,De=new WeakMap,In=new WeakMap,Dn=new WeakMap,vo=new WeakMap,Mn=new WeakMap,ai=new WeakMap,Ds=new WeakMap,Pr=new WeakMap,vh=new WeakMap,yh=new WeakMap,yo=new WeakMap,bh=new WeakMap,oi=new WeakMap,On=new WeakMap,bo=new WeakMap,Ln=new WeakMap,li=new WeakMap,gu=new WeakMap,Fn=new WeakMap,Ao=new WeakMap,Ah=new WeakMap,kn=new WeakMap,Ir=new WeakMap,wo=new WeakMap,Nn=new WeakMap,wh=new WeakMap,ee=new WeakMap,At=new WeakMap,Ni=new WeakMap,Bn=new WeakMap,_n=new WeakMap,Eh=new WeakMap,Eo=new WeakMap,Sh=new WeakMap,Un=new WeakMap,hi=new WeakMap,Bi=new WeakMap,xh=new WeakMap,Th=new WeakMap,Ms=new WeakMap,H=new WeakSet,wd=function({anchorNode:e}){return e.nodeType===Node.TEXT_NODE?e.parentElement:e},nf=function(e){const{currentLayer:t}=this;if(t.hasTextLayer(e))return t;for(const s of n(this,ae).values())if(s.hasTextLayer(e))return s;return null},Pg=function(){const e=document.getSelection();if(!e||e.isCollapsed)return;const s=w(this,H,wd).call(this,e).closest(".textLayer"),i=this.getSelectionBoxes(s);i&&(n(this,li)||g(this,li,new Yv(this)),n(this,li).show(s,i,this.direction==="ltr"))},Ig=function(){var r,a,o;const e=document.getSelection();if(!e||e.isCollapsed){n(this,Ni)&&((r=n(this,li))==null||r.hide(),g(this,Ni,null),w(this,H,ke).call(this,{hasSelectedText:!1}));return}const{anchorNode:t}=e;if(t===n(this,Ni))return;const i=w(this,H,wd).call(this,e).closest(".textLayer");if(!i){n(this,Ni)&&((a=n(this,li))==null||a.hide(),g(this,Ni,null),w(this,H,ke).call(this,{hasSelectedText:!1}));return}if((o=n(this,li))==null||o.hide(),g(this,Ni,t),w(this,H,ke).call(this,{hasSelectedText:!0}),!(n(this,ee)!==et.HIGHLIGHT&&n(this,ee)!==et.NONE)&&(n(this,ee)===et.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),g(this,Ln,this.isShiftKeyDown),!this.isShiftKeyDown)){const l=n(this,ee)===et.HIGHLIGHT?w(this,H,nf).call(this,i):null;if(l==null||l.toggleDrawing(),n(this,Ao)){const h=new AbortController,c=this.combinedSignal(h),u=f=>{f.type==="pointerup"&&f.button!==0||(h.abort(),l==null||l.toggleDrawing(!0),f.type==="pointerup"&&w(this,H,$l).call(this,"main_toolbar"))};window.addEventListener("pointerup",u,{signal:c}),window.addEventListener("blur",u,{signal:c})}else l==null||l.toggleDrawing(!0),w(this,H,$l).call(this,"main_toolbar")}},$l=function(e=""){n(this,ee)===et.HIGHLIGHT?this.highlightSelection(e):n(this,vh)&&w(this,H,Pg).call(this)},Dg=function(){document.addEventListener("selectionchange",w(this,H,Ig).bind(this),{signal:this._signal})},Mg=function(){if(n(this,On))return;g(this,On,new AbortController);const e=this.combinedSignal(n(this,On));window.addEventListener("focus",this.focus.bind(this),{signal:e}),window.addEventListener("blur",this.blur.bind(this),{signal:e})},Og=function(){var e;(e=n(this,On))==null||e.abort(),g(this,On,null)},rf=function(){if(n(this,kn))return;g(this,kn,new AbortController);const e=this.combinedSignal(n(this,kn));window.addEventListener("keydown",this.keydown.bind(this),{signal:e}),window.addEventListener("keyup",this.keyup.bind(this),{signal:e})},Lg=function(){var e;(e=n(this,kn))==null||e.abort(),g(this,kn,null)},Fg=function(){if(n(this,In))return;g(this,In,new AbortController);const e=this.combinedSignal(n(this,In));document.addEventListener("copy",this.copy.bind(this),{signal:e}),document.addEventListener("cut",this.cut.bind(this),{signal:e}),document.addEventListener("paste",this.paste.bind(this),{signal:e})},kg=function(){var e;(e=n(this,In))==null||e.abort(),g(this,In,null)},Ng=function(){const e=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:e}),document.addEventListener("drop",this.drop.bind(this),{signal:e})},ke=function(e){Object.entries(e).some(([s,i])=>n(this,Sh)[s]!==i)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(n(this,Sh),e)}),n(this,ee)===et.HIGHLIGHT&&e.hasSelectedEditor===!1&&w(this,H,Mi).call(this,[[dt.HIGHLIGHT_FREE,!0]]))},Mi=function(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})},Bg=async function(){if(!n(this,Fn)){g(this,Fn,!0);const e=[];for(const t of n(this,ae).values())e.push(t.enable());await Promise.all(e);for(const t of n(this,Vt).values())t.enable()}},_g=function(){if(this.unselectAll(),n(this,Fn)){g(this,Fn,!1);for(const e of n(this,ae).values())e.disable();for(const e of n(this,Vt).values())e.disable()}},af=function(e){const t=n(this,ae).get(e.pageIndex);t?t.addOrRebuild(e):(this.addEditor(e),this.addToAnnotationStorage(e))},Ug=function(){let e=null;for(e of n(this,At));return e},jl=function(){if(n(this,Vt).size===0)return!0;if(n(this,Vt).size===1)for(const e of n(this,Vt).values())return e.isEmpty();return!1},of=function(e){for(const t of n(this,At))t.unselect();n(this,At).clear();for(const t of e)t.isEmpty()||(n(this,At).add(t),t.select());w(this,H,ke).call(this,{hasSelectedEditor:this.hasSelection})},F(so,"TRANSLATE_SMALL",1),F(so,"TRANSLATE_BIG",10);let Ha=so;var de,ci,zs,So,di,es,xo,ui,We,_i,Dr,fi,Hn,ei,zl,Ed;const Ne=class Ne{constructor(e){y(this,ei);y(this,de,null);y(this,ci,!1);y(this,zs,null);y(this,So,null);y(this,di,null);y(this,es,null);y(this,xo,!1);y(this,ui,null);y(this,We,null);y(this,_i,null);y(this,Dr,null);y(this,fi,!1);g(this,We,e),g(this,fi,e._uiManager.useNewAltTextFlow),n(Ne,Hn)||g(Ne,Hn,Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"}))}static initialize(e){Ne._l10n??(Ne._l10n=e)}async render(){const e=g(this,zs,document.createElement("button"));e.className="altText",e.tabIndex="0";const t=g(this,So,document.createElement("span"));e.append(t),n(this,fi)?(e.classList.add("new"),e.setAttribute("data-l10n-id",n(Ne,Hn).missing),t.setAttribute("data-l10n-id",n(Ne,Hn)["missing-label"])):(e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const s=n(this,We)._uiManager._signal;e.addEventListener("contextmenu",Hs,{signal:s}),e.addEventListener("pointerdown",r=>r.stopPropagation(),{signal:s});const i=r=>{r.preventDefault(),n(this,We)._uiManager.editAltText(n(this,We)),n(this,fi)&&n(this,We)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:n(this,ei,zl)}})};return e.addEventListener("click",i,{capture:!0,signal:s}),e.addEventListener("keydown",r=>{r.target===e&&r.key==="Enter"&&(g(this,xo,!0),i(r))},{signal:s}),await w(this,ei,Ed).call(this),e}finish(){n(this,zs)&&(n(this,zs).focus({focusVisible:n(this,xo)}),g(this,xo,!1))}isEmpty(){return n(this,fi)?n(this,de)===null:!n(this,de)&&!n(this,ci)}hasData(){return n(this,fi)?n(this,de)!==null||!!n(this,_i):this.isEmpty()}get guessedText(){return n(this,_i)}async setGuessedText(e){n(this,de)===null&&(g(this,_i,e),g(this,Dr,await Ne._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:e})),w(this,ei,Ed).call(this))}toggleAltTextBadge(e=!1){var t;if(!n(this,fi)||n(this,de)){(t=n(this,ui))==null||t.remove(),g(this,ui,null);return}if(!n(this,ui)){const s=g(this,ui,document.createElement("div"));s.className="noAltTextBadge",n(this,We).div.append(s)}n(this,ui).classList.toggle("hidden",!e)}serialize(e){let t=n(this,de);return!e&&n(this,_i)===t&&(t=n(this,Dr)),{altText:t,decorative:n(this,ci),guessedText:n(this,_i),textWithDisclaimer:n(this,Dr)}}get data(){return{altText:n(this,de),decorative:n(this,ci)}}set data({altText:e,decorative:t,guessedText:s,textWithDisclaimer:i,cancel:r=!1}){s&&(g(this,_i,s),g(this,Dr,i)),!(n(this,de)===e&&n(this,ci)===t)&&(r||(g(this,de,e),g(this,ci,t)),w(this,ei,Ed).call(this))}toggle(e=!1){n(this,zs)&&(!e&&n(this,es)&&(clearTimeout(n(this,es)),g(this,es,null)),n(this,zs).disabled=!e)}shown(){n(this,We)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:n(this,ei,zl)}})}destroy(){var e,t;(e=n(this,zs))==null||e.remove(),g(this,zs,null),g(this,So,null),g(this,di,null),(t=n(this,ui))==null||t.remove(),g(this,ui,null)}};de=new WeakMap,ci=new WeakMap,zs=new WeakMap,So=new WeakMap,di=new WeakMap,es=new WeakMap,xo=new WeakMap,ui=new WeakMap,We=new WeakMap,_i=new WeakMap,Dr=new WeakMap,fi=new WeakMap,Hn=new WeakMap,ei=new WeakSet,zl=function(){return n(this,de)&&"added"||n(this,de)===null&&this.guessedText&&"review"||"missing"},Ed=async function(){var i,r,a;const e=n(this,zs);if(!e)return;if(n(this,fi)){if(e.classList.toggle("done",!!n(this,de)),e.setAttribute("data-l10n-id",n(Ne,Hn)[n(this,ei,zl)]),(i=n(this,So))==null||i.setAttribute("data-l10n-id",n(Ne,Hn)[`${n(this,ei,zl)}-label`]),!n(this,de)){(r=n(this,di))==null||r.remove();return}}else{if(!n(this,de)&&!n(this,ci)){e.classList.remove("done"),(a=n(this,di))==null||a.remove();return}e.classList.add("done"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let t=n(this,di);if(!t){g(this,di,t=document.createElement("span")),t.className="tooltip",t.setAttribute("role","tooltip"),t.id=`alt-text-tooltip-${n(this,We).id}`;const o=100,l=n(this,We)._uiManager._signal;l.addEventListener("abort",()=>{clearTimeout(n(this,es)),g(this,es,null)},{once:!0}),e.addEventListener("mouseenter",()=>{g(this,es,setTimeout(()=>{g(this,es,null),n(this,di).classList.add("show"),n(this,We)._reportTelemetry({action:"alt_text_tooltip"})},o))},{signal:l}),e.addEventListener("mouseleave",()=>{var h;n(this,es)&&(clearTimeout(n(this,es)),g(this,es,null)),(h=n(this,di))==null||h.classList.remove("show")},{signal:l})}n(this,ci)?t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(t.removeAttribute("data-l10n-id"),t.textContent=n(this,de)),t.parentNode||e.append(t);const s=n(this,We).getElementForAltText();s==null||s.setAttribute("aria-describedby",t.id)},y(Ne,Hn,null),F(Ne,"_l10n",null);let tu=Ne;var be,Os,Mr,kt,Ch,Or,Gs,Lr,Fr,kr,Rh,lf;class hd{constructor(e){y(this,Rh);y(this,be,null);y(this,Os,null);y(this,Mr,!1);y(this,kt,null);y(this,Ch,null);y(this,Or,null);y(this,Gs,null);y(this,Lr,null);y(this,Fr,!1);y(this,kr,null);g(this,kt,e)}renderForToolbar(){const e=g(this,Os,document.createElement("button"));return e.className="comment",w(this,Rh,lf).call(this,e,!1)}renderForStandalone(){const e=g(this,be,document.createElement("button"));e.className="annotationCommentButton";const t=n(this,kt).commentButtonPosition;if(t){const{style:s}=e;s.insetInlineEnd=`calc(${100*(n(this,kt)._uiManager.direction==="ltr"?1-t[0]:t[0])}% - var(--comment-button-dim))`,s.top=`calc(${100*t[1]}% - var(--comment-button-dim))`;const i=n(this,kt).commentButtonColor;i&&(s.backgroundColor=i)}return w(this,Rh,lf).call(this,e,!0)}focusButton(){setTimeout(()=>{var e;(e=n(this,be)??n(this,Os))==null||e.focus()},0)}onUpdatedColor(){if(!n(this,be))return;const e=n(this,kt).commentButtonColor;e&&(n(this,be).style.backgroundColor=e),n(this,kt)._uiManager.updatePopupColor(n(this,kt))}get commentButtonWidth(){var e;return(((e=n(this,be))==null?void 0:e.getBoundingClientRect().width)??0)/n(this,kt).parent.boundingClientRect.width}get commentPopupPositionInLayer(){if(n(this,kr))return n(this,kr);if(!n(this,be))return null;const{x:e,y:t,height:s}=n(this,be).getBoundingClientRect(),{x:i,y:r,width:a,height:o}=n(this,kt).parent.boundingClientRect;return[(e-i)/a,(t+s-r)/o]}set commentPopupPositionInLayer(e){g(this,kr,e)}hasDefaultPopupPosition(){return n(this,kr)===null}removeStandaloneCommentButton(){var e;(e=n(this,be))==null||e.remove(),g(this,be,null)}removeToolbarCommentButton(){var e;(e=n(this,Os))==null||e.remove(),g(this,Os,null)}setCommentButtonStates({selected:e,hasPopup:t}){n(this,be)&&(n(this,be).classList.toggle("selected",e),n(this,be).ariaExpanded=t)}edit(e){const t=this.commentPopupPositionInLayer;let s,i;if(t)[s,i]=t;else{[s,i]=n(this,kt).commentButtonPosition;const{width:c,height:u,x:f,y:p}=n(this,kt);s=f+s*c,i=p+i*u}const r=n(this,kt).parent.boundingClientRect,{x:a,y:o,width:l,height:h}=r;n(this,kt)._uiManager.editComment(n(this,kt),a+s*l,o+i*h,{...e,parentDimensions:r})}finish(){n(this,Os)&&(n(this,Os).focus({focusVisible:n(this,Mr)}),g(this,Mr,!1))}isDeleted(){return n(this,Fr)||n(this,Gs)===""}isEmpty(){return n(this,Gs)===null}hasBeenEdited(){return this.isDeleted()||n(this,Gs)!==n(this,Ch)}serialize(){return this.data}get data(){return{text:n(this,Gs),richText:n(this,Or),date:n(this,Lr),deleted:this.isDeleted()}}set data(e){if(e!==n(this,Gs)&&g(this,Or,null),e===null){g(this,Gs,""),g(this,Fr,!0);return}g(this,Gs,e),g(this,Lr,new Date),g(this,Fr,!1)}setInitialText(e,t=null){g(this,Ch,e),this.data=e,g(this,Lr,null),g(this,Or,t)}shown(){}destroy(){var e,t;(e=n(this,Os))==null||e.remove(),g(this,Os,null),(t=n(this,be))==null||t.remove(),g(this,be,null),g(this,Gs,""),g(this,Or,null),g(this,Lr,null),g(this,kt,null),g(this,Mr,!1),g(this,Fr,!1)}}be=new WeakMap,Os=new WeakMap,Mr=new WeakMap,kt=new WeakMap,Ch=new WeakMap,Or=new WeakMap,Gs=new WeakMap,Lr=new WeakMap,Fr=new WeakMap,kr=new WeakMap,Rh=new WeakSet,lf=function(e,t){if(!n(this,kt)._uiManager.hasCommentManager())return null;e.tabIndex="0",e.ariaHasPopup="dialog",t?(e.ariaControls="commentPopup",e.setAttribute("data-l10n-id","pdfjs-show-comment-button")):(e.ariaControlsElements=[n(this,kt)._uiManager.getCommentDialogElement()],e.setAttribute("data-l10n-id","pdfjs-editor-add-comment-button"));const s=n(this,kt)._uiManager._signal;if(!(s instanceof AbortSignal)||s.aborted)return e;e.addEventListener("contextmenu",Hs,{signal:s}),t&&(e.addEventListener("focusin",r=>{n(this,kt)._focusEventsAllowed=!1,Jt(r)},{capture:!0,signal:s}),e.addEventListener("focusout",r=>{n(this,kt)._focusEventsAllowed=!0,Jt(r)},{capture:!0,signal:s})),e.addEventListener("pointerdown",r=>r.stopPropagation(),{signal:s});const i=r=>{r.preventDefault(),e===n(this,Os)?this.edit():n(this,kt).toggleComment(!0)};return e.addEventListener("click",i,{capture:!0,signal:s}),e.addEventListener("keydown",r=>{r.target===e&&r.key==="Enter"&&(g(this,Mr,!0),i(r))},{signal:s}),e.addEventListener("pointerenter",()=>{n(this,kt).toggleComment(!1,!0)},{signal:s}),e.addEventListener("pointerleave",()=>{n(this,kt).toggleComment(!1,!1)},{signal:s}),e};var To,Nr,Ph,Ih,Dh,Mh,Oh,Ui,Br,Hi,_r,$i,vr,Hg,$g,jg;const Op=class Op{constructor({container:e,isPinchingDisabled:t=null,isPinchingStopped:s=null,onPinchStart:i=null,onPinching:r=null,onPinchEnd:a=null,signal:o}){y(this,vr);y(this,To);y(this,Nr,!1);y(this,Ph,null);y(this,Ih);y(this,Dh);y(this,Mh);y(this,Oh);y(this,Ui,null);y(this,Br);y(this,Hi,null);y(this,_r);y(this,$i,null);g(this,To,e),g(this,Ph,s),g(this,Ih,t),g(this,Dh,i),g(this,Mh,r),g(this,Oh,a),g(this,_r,new AbortController),g(this,Br,AbortSignal.any([o,n(this,_r).signal])),e.addEventListener("touchstart",w(this,vr,Hg).bind(this),{passive:!1,signal:n(this,Br)})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/Pi.pixelRatio}destroy(){var e,t;(e=n(this,_r))==null||e.abort(),g(this,_r,null),(t=n(this,Ui))==null||t.abort(),g(this,Ui,null)}};To=new WeakMap,Nr=new WeakMap,Ph=new WeakMap,Ih=new WeakMap,Dh=new WeakMap,Mh=new WeakMap,Oh=new WeakMap,Ui=new WeakMap,Br=new WeakMap,Hi=new WeakMap,_r=new WeakMap,$i=new WeakMap,vr=new WeakSet,Hg=function(e){var i,r,a;if((i=n(this,Ih))!=null&&i.call(this))return;if(e.touches.length===1){if(n(this,Ui))return;const o=g(this,Ui,new AbortController),l=AbortSignal.any([n(this,Br),o.signal]),h=n(this,To),c={capture:!0,signal:l,passive:!1},u=f=>{var p;f.pointerType==="touch"&&((p=n(this,Ui))==null||p.abort(),g(this,Ui,null))};h.addEventListener("pointerdown",f=>{f.pointerType==="touch"&&(Jt(f),u(f))},c),h.addEventListener("pointerup",u,c),h.addEventListener("pointercancel",u,c);return}if(!n(this,$i)){g(this,$i,new AbortController);const o=AbortSignal.any([n(this,Br),n(this,$i).signal]),l=n(this,To),h={signal:o,capture:!1,passive:!1};l.addEventListener("touchmove",w(this,vr,$g).bind(this),h);const c=w(this,vr,jg).bind(this);l.addEventListener("touchend",c,h),l.addEventListener("touchcancel",c,h),h.capture=!0,l.addEventListener("pointerdown",Jt,h),l.addEventListener("pointermove",Jt,h),l.addEventListener("pointercancel",Jt,h),l.addEventListener("pointerup",Jt,h),(r=n(this,Dh))==null||r.call(this)}if(Jt(e),e.touches.length!==2||(a=n(this,Ph))!=null&&a.call(this)){g(this,Hi,null);return}let[t,s]=e.touches;t.identifier>s.identifier&&([t,s]=[s,t]),g(this,Hi,{touch0X:t.screenX,touch0Y:t.screenY,touch1X:s.screenX,touch1Y:s.screenY})},$g=function(e){var T;if(!n(this,Hi)||e.touches.length!==2)return;Jt(e);let[t,s]=e.touches;t.identifier>s.identifier&&([t,s]=[s,t]);const{screenX:i,screenY:r}=t,{screenX:a,screenY:o}=s,l=n(this,Hi),{touch0X:h,touch0Y:c,touch1X:u,touch1Y:f}=l,p=u-h,v=f-c,m=a-i,A=o-r,b=Math.hypot(m,A)||1,S=Math.hypot(p,v)||1;if(!n(this,Nr)&&Math.abs(S-b)<=Op.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(l.touch0X=i,l.touch0Y=r,l.touch1X=a,l.touch1Y=o,!n(this,Nr)){g(this,Nr,!0);return}const E=[(i+a)/2,(r+o)/2];(T=n(this,Mh))==null||T.call(this,E,S,b)},jg=function(e){var t;e.touches.length>=2||(n(this,$i)&&(n(this,$i).abort(),g(this,$i,null),(t=n(this,Oh))==null||t.call(this)),n(this,Hi)&&(Jt(e),g(this,Hi,null),g(this,Nr,!1)))};let eu=Op;var Ur,Vs,Ht,It,ji,Co,$n,Lh,Ae,Hr,zi,Ls,jn,Fh,$r,ss,kh,jr,Gi,pi,Ro,Po,Fs,zr,Nh,mu,K,hf,Bh,cf,Sd,zg,Gg,df,xd,uf,Vg,Wg,Xg,ff,Yg,pf,Kg,Jg,Qg,gf,Gl;const tt=class tt{constructor(e){y(this,K);y(this,Ur,null);y(this,Vs,null);y(this,Ht,null);y(this,It,null);y(this,ji,null);y(this,Co,!1);y(this,$n,null);y(this,Lh,"");y(this,Ae,null);y(this,Hr,null);y(this,zi,null);y(this,Ls,null);y(this,jn,null);y(this,Fh,"");y(this,$r,!1);y(this,ss,null);y(this,kh,!1);y(this,jr,!1);y(this,Gi,!1);y(this,pi,null);y(this,Ro,0);y(this,Po,0);y(this,Fs,null);y(this,zr,null);F(this,"isSelected",!1);F(this,"_isCopy",!1);F(this,"_editToolbar",null);F(this,"_initialOptions",Object.create(null));F(this,"_initialData",null);F(this,"_isVisible",!0);F(this,"_uiManager",null);F(this,"_focusEventsAllowed",!0);y(this,Nh,!1);y(this,mu,tt._zIndex++);this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null,this.annotationElementId=e.annotationElementId||null,this.creationDate=e.creationDate||new Date,this.modificationDate=e.modificationDate||null,this.canAddComment=!0;const{rotation:t,rawDims:{pageWidth:s,pageHeight:i,pageX:r,pageY:a}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[s,i],this.pageTranslation=[r,a];const[o,l]=this.parentDimensions;this.x=e.x/o,this.y=e.y/l,this.isAttachedToDOM=!1,this.deleted=!1}static get _resizerKeyboardManager(){const e=tt.prototype._resizeWithKeyboard,t=Ha.TRANSLATE_SMALL,s=Ha.TRANSLATE_BIG;return Q(this,"_resizerKeyboardManager",new rd([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-t,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-s,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[t,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[s,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-t]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-s]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,t]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,s]}],[["Escape","mac+Escape"],tt.prototype._stopResizingWithKeyboard]]))}get editorType(){return Object.getPrototypeOf(this).constructor._type}get mode(){return Object.getPrototypeOf(this).constructor._editorType}static get isDrawer(){return!1}static get _defaultLineColor(){return Q(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(e){const t=new Qv({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(e,t){if(tt._l10n??(tt._l10n=e),tt._l10nResizer||(tt._l10nResizer=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"})),tt._borderLineWidth!==-1)return;const s=getComputedStyle(document.documentElement);tt._borderLineWidth=parseFloat(s.getPropertyValue("--outline-width"))||0}static updateDefaultParams(e,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(e){return!1}static paste(e,t){Ot("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return n(this,Nh)}set _isDraggable(e){var t;g(this,Nh,e),(t=this.div)==null||t.classList.toggle("draggable",e)}get uid(){return this.annotationElementId||this.id}get isEnterHandled(){return!0}center(){const[e,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(e*2),this.y+=this.width*e/(t*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(e*2),this.y-=this.width*e/(t*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=n(this,mu)}setParent(e){var t;e!==null?(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions):(w(this,K,Gl).call(this),(t=n(this,Ls))==null||t.remove(),g(this,Ls,null)),this.parent=e}focusin(e){this._focusEventsAllowed&&(n(this,$r)?g(this,$r,!1):this.parent.setSelected(this))}focusout(e){var s;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;const t=e.relatedTarget;t!=null&&t.closest(`#${this.id}`)||(e.preventDefault(),(s=this.parent)!=null&&s.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.isInEditMode()&&this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(e,t,s,i){const[r,a]=this.parentDimensions;[s,i]=this.screenToPageTranslation(s,i),this.x=(e+s)/r,this.y=(t+i)/a,this.fixAndSetPosition()}_moveAfterPaste(e,t){const[s,i]=this.parentDimensions;this.setAt(e*s,t*i,this.width*s,this.height*i),this._onTranslated()}translate(e,t){w(this,K,hf).call(this,this.parentDimensions,e,t)}translateInPage(e,t){n(this,ss)||g(this,ss,[this.x,this.y,this.width,this.height]),w(this,K,hf).call(this,this.pageDimensions,e,t),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(e,t){n(this,ss)||g(this,ss,[this.x,this.y,this.width,this.height]);const{div:s,parentDimensions:[i,r]}=this;if(this.x+=e/i,this.y+=t/r,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:u,y:f}=this.div.getBoundingClientRect();this.parent.findNewParent(this,u,f)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:a,y:o}=this;const[l,h]=this.getBaseTranslation();a+=l,o+=h;const{style:c}=s;c.left=`${(100*a).toFixed(2)}%`,c.top=`${(100*o).toFixed(2)}%`,this._onTranslating(a,o),s.scrollIntoView({block:"nearest"})}_onTranslating(e,t){}_onTranslated(e,t){}get _hasBeenMoved(){return!!n(this,ss)&&(n(this,ss)[0]!==this.x||n(this,ss)[1]!==this.y)}get _hasBeenResized(){return!!n(this,ss)&&(n(this,ss)[2]!==this.width||n(this,ss)[3]!==this.height)}getBaseTranslation(){const[e,t]=this.parentDimensions,{_borderLineWidth:s}=tt,i=s/e,r=s/t;switch(this.rotation){case 90:return[-i,r];case 180:return[i,r];case 270:return[i,-r];default:return[-i,-r]}}get _mustFixPosition(){return!0}fixAndSetPosition(e=this.rotation){const{div:{style:t},pageDimensions:[s,i]}=this;let{x:r,y:a,width:o,height:l}=this;if(o*=s,l*=i,r*=s,a*=i,this._mustFixPosition)switch(e){case 0:r=$e(r,0,s-o),a=$e(a,0,i-l);break;case 90:r=$e(r,0,s-l),a=$e(a,o,i);break;case 180:r=$e(r,o,s),a=$e(a,l,i);break;case 270:r=$e(r,l,s),a=$e(a,0,i-o);break}this.x=r/=s,this.y=a/=i;const[h,c]=this.getBaseTranslation();r+=h,a+=c,t.left=`${(100*r).toFixed(2)}%`,t.top=`${(100*a).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(e,t){var s;return w(s=tt,Bh,cf).call(s,e,t,this.parentRotation)}pageTranslationToScreen(e,t){var s;return w(s=tt,Bh,cf).call(s,e,t,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:e,pageDimensions:[t,s]}=this;return[t*e,s*e]}setDims(){const{div:{style:e},width:t,height:s}=this;e.width=`${(100*t).toFixed(2)}%`,e.height=`${(100*s).toFixed(2)}%`}getInitialTranslation(){return[0,0]}_onResized(){}static _round(e){return Math.round(e*1e4)/1e4}_onResizing(){}altTextFinish(){var e;(e=n(this,Ht))==null||e.finish()}get toolbarButtons(){return null}async addEditToolbar(){if(this._editToolbar||n(this,jr))return this._editToolbar;this._editToolbar=new qu(this),this.div.append(this._editToolbar.render());const{toolbarButtons:e}=this;if(e)for(const[t,s]of e)await this._editToolbar.addButton(t,s);return this.hasComment||this._editToolbar.addButton("comment",this.addCommentButton()),this._editToolbar.addButton("delete"),this._editToolbar}addCommentButtonInToolbar(){var e;(e=this._editToolbar)==null||e.addButtonBefore("comment",this.addCommentButton(),".deleteButton")}removeCommentButtonFromToolbar(){var e;(e=this._editToolbar)==null||e.removeButton("comment")}removeEditToolbar(){var e,t;(e=this._editToolbar)==null||e.remove(),this._editToolbar=null,(t=n(this,Ht))==null||t.destroy()}addContainer(e){var s;const t=(s=this._editToolbar)==null?void 0:s.div;t?t.before(e):this.div.append(e)}getClientDimensions(){return this.div.getBoundingClientRect()}createAltText(){return n(this,Ht)||(tu.initialize(tt._l10n),g(this,Ht,new tu(this)),n(this,Ur)&&(n(this,Ht).data=n(this,Ur),g(this,Ur,null))),n(this,Ht)}get altTextData(){var e;return(e=n(this,Ht))==null?void 0:e.data}set altTextData(e){n(this,Ht)&&(n(this,Ht).data=e)}get guessedAltText(){var e;return(e=n(this,Ht))==null?void 0:e.guessedText}async setGuessedAltText(e){var t;await((t=n(this,Ht))==null?void 0:t.setGuessedText(e))}serializeAltText(e){var t;return(t=n(this,Ht))==null?void 0:t.serialize(e)}hasAltText(){return!!n(this,Ht)&&!n(this,Ht).isEmpty()}hasAltTextData(){var e;return((e=n(this,Ht))==null?void 0:e.hasData())??!1}focusCommentButton(){var e;(e=n(this,It))==null||e.focusButton()}addCommentButton(){return this.canAddComment?n(this,It)||g(this,It,new hd(this)):null}addStandaloneCommentButton(){if(this._uiManager.hasCommentManager()){if(n(this,ji)){this._uiManager.isEditingMode()&&n(this,ji).classList.remove("hidden");return}this.hasComment&&(g(this,ji,n(this,It).renderForStandalone()),this.div.append(n(this,ji)))}}removeStandaloneCommentButton(){n(this,It).removeStandaloneCommentButton(),g(this,ji,null)}hideStandaloneCommentButton(){var e;(e=n(this,ji))==null||e.classList.add("hidden")}get comment(){const{data:{richText:e,text:t,date:s,deleted:i}}=n(this,It);return{text:t,richText:e,date:s,deleted:i,color:this.getNonHCMColor(),opacity:this.opacity??1}}set comment(e){n(this,It)||g(this,It,new hd(this)),n(this,It).data=e,this.hasComment?(this.removeCommentButtonFromToolbar(),this.addStandaloneCommentButton(),this._uiManager.updateComment(this)):(this.addCommentButtonInToolbar(),this.removeStandaloneCommentButton(),this._uiManager.removeComment(this))}setCommentData({comment:e,popupRef:t,richText:s}){if(!t||(n(this,It)||g(this,It,new hd(this)),n(this,It).setInitialText(e,s),!this.annotationElementId))return;const i=this._uiManager.getAndRemoveDataFromAnnotationStorage(this.annotationElementId);i&&this.updateFromAnnotationLayer(i)}get hasEditedComment(){var e;return(e=n(this,It))==null?void 0:e.hasBeenEdited()}get hasDeletedComment(){var e;return(e=n(this,It))==null?void 0:e.isDeleted()}get hasComment(){return!!n(this,It)&&!n(this,It).isEmpty()&&!n(this,It).isDeleted()}async editComment(e){n(this,It)||g(this,It,new hd(this)),n(this,It).edit(e)}toggleComment(e,t=void 0){this.hasComment&&this._uiManager.toggleComment(this,e,t)}setSelectedCommentButton(e){n(this,It).setSelectedButton(e)}addComment(e){if(this.hasEditedComment){const[,,,i]=e.rect,[r]=this.pageDimensions,[a]=this.pageTranslation,o=a+r+1,l=i-100,h=o+180;e.popup={contents:this.comment.text,deleted:this.comment.deleted,rect:[o,l,h,i]}}}updateFromAnnotationLayer({popup:{contents:e,deleted:t}}){n(this,It).data=t?null:e}get parentBoundingClientRect(){return this.parent.boundingClientRect}render(){var a;const e=this.div=document.createElement("div");e.setAttribute("data-editor-rotation",(360-this.rotation)%360),e.className=this.name,e.setAttribute("id",this.id),e.tabIndex=n(this,Co)?-1:0,e.setAttribute("role","application"),this.defaultL10nId&&e.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||e.classList.add("hidden"),this.setInForeground(),w(this,K,pf).call(this);const[t,s]=this.parentDimensions;this.parentRotation%180!==0&&(e.style.maxWidth=`${(100*s/t).toFixed(2)}%`,e.style.maxHeight=`${(100*t/s).toFixed(2)}%`);const[i,r]=this.getInitialTranslation();return this.translate(i,r),Cg(this,e,["keydown","pointerdown","dblclick"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(n(this,zr)||g(this,zr,new eu({container:e,isPinchingDisabled:()=>!this.isSelected,onPinchStart:w(this,K,Vg).bind(this),onPinching:w(this,K,Wg).bind(this),onPinchEnd:w(this,K,Xg).bind(this),signal:this._uiManager._signal}))),this.addStandaloneCommentButton(),(a=this._uiManager._editorUndoBar)==null||a.hide(),e}pointerdown(e){const{isMac:t}=he.platform;if(e.button!==0||e.ctrlKey&&t){e.preventDefault();return}if(g(this,$r,!0),this._isDraggable){w(this,K,Yg).call(this,e);return}w(this,K,ff).call(this,e)}_onStartDragging(){}_onStopDragging(){}moveInDOM(){n(this,pi)&&clearTimeout(n(this,pi)),g(this,pi,setTimeout(()=>{var e;g(this,pi,null),(e=this.parent)==null||e.moveEditorInDOM(this)},0))}_setParentAndPosition(e,t,s){e.changeParent(this),this.x=t,this.y=s,this.fixAndSetPosition(),this._onTranslated()}getRect(e,t,s=this.rotation){const i=this.parentScale,[r,a]=this.pageDimensions,[o,l]=this.pageTranslation,h=e/i,c=t/i,u=this.x*r,f=this.y*a,p=this.width*r,v=this.height*a;switch(s){case 0:return[u+h+o,a-f-c-v+l,u+h+p+o,a-f-c+l];case 90:return[u+c+o,a-f+h+l,u+c+v+o,a-f+h+p+l];case 180:return[u-h-p+o,a-f+c+l,u-h+o,a-f+c+v+l];case 270:return[u-c-v+o,a-f-h-p+l,u-c+o,a-f-h+l];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){const[s,i,r,a]=e,o=r-s,l=a-i;switch(this.rotation){case 0:return[s,t-a,o,l];case 90:return[s,t-i,l,o];case 180:return[r,t-i,o,l];case 270:return[r,t-a,l,o];default:throw new Error("Invalid rotation")}}getPDFRect(){return this.getRect(0,0)}getNonHCMColor(){return this.color&&tt._colorManager.convert(this._uiManager.getNonHCMColor(this.color))}onUpdatedColor(){var e;(e=n(this,It))==null||e.onUpdatedColor()}getData(){const{comment:{text:e,color:t,date:s,opacity:i,deleted:r,richText:a},uid:o,pageIndex:l,creationDate:h,modificationDate:c}=this;return{id:o,pageIndex:l,rect:this.getPDFRect(),richText:a,contentsObj:{str:e},creationDate:h,modificationDate:s||c,popupRef:!r,color:t,opacity:i}}onceAdded(e){}isEmpty(){return!1}enableEditMode(){return this.isInEditMode()?!1:(this.parent.setEditingState(!1),g(this,jr,!0),!0)}disableEditMode(){return this.isInEditMode()?(this.parent.setEditingState(!0),g(this,jr,!1),!0):!1}isInEditMode(){return n(this,jr)}shouldGetKeyboardEvents(){return n(this,Gi)}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:e,left:t,bottom:s,right:i}=this.getClientDimensions(),{innerHeight:r,innerWidth:a}=window;return t<a&&i>0&&e<r&&s>0}rebuild(){w(this,K,pf).call(this)}rotate(e){}resize(){}serializeDeleted(){var e;return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:((e=this._initialData)==null?void 0:e.popupRef)||""}}serialize(e=!1,t=null){var s;return{annotationType:this.mode,pageIndex:this.pageIndex,rect:this.getPDFRect(),rotation:this.rotation,structTreeParentId:this._structTreeParentId,popupRef:((s=this._initialData)==null?void 0:s.popupRef)||""}}static async deserialize(e,t,s){const i=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:s,annotationElementId:e.annotationElementId,creationDate:e.creationDate,modificationDate:e.modificationDate});i.rotation=e.rotation,g(i,Ur,e.accessibilityData),i._isCopy=e.isCopy||!1;const[r,a]=i.pageDimensions,[o,l,h,c]=i.getRectInCurrentCoords(e.rect,a);return i.x=o/r,i.y=l/a,i.width=h/r,i.height=c/a,i}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){var e,t,s;if((e=n(this,jn))==null||e.abort(),g(this,jn,null),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.hideCommentPopup(),n(this,pi)&&(clearTimeout(n(this,pi)),g(this,pi,null)),w(this,K,Gl).call(this),this.removeEditToolbar(),n(this,Fs)){for(const i of n(this,Fs).values())clearTimeout(i);g(this,Fs,null)}this.parent=null,(t=n(this,zr))==null||t.destroy(),g(this,zr,null),(s=n(this,Ls))==null||s.remove(),g(this,Ls,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(w(this,K,zg).call(this),n(this,Ae).classList.remove("hidden"))}get toolbarPosition(){return null}get commentButtonPosition(){return this._uiManager.direction==="ltr"?[1,0]:[0,0]}get commentButtonPositionInPage(){const{commentButtonPosition:[e,t]}=this,[s,i,r,a]=this.getPDFRect();return[tt._round(s+(r-s)*e),tt._round(i+(a-i)*(1-t))]}get commentButtonColor(){return this._uiManager.makeCommentColor(this.getNonHCMColor(),this.opacity)}get commentPopupPosition(){return n(this,It).commentPopupPositionInLayer}set commentPopupPosition(e){n(this,It).commentPopupPositionInLayer=e}hasDefaultPopupPosition(){return n(this,It).hasDefaultPopupPosition()}get commentButtonWidth(){return n(this,It).commentButtonWidth}get elementBeforePopup(){return this.div}setCommentButtonStates(e){var t;(t=n(this,It))==null||t.setCommentButtonStates(e)}keydown(e){if(!this.isResizable||e.target!==this.div||e.key!=="Enter")return;this._uiManager.setSelected(this),g(this,zi,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const t=n(this,Ae).children;if(!n(this,Vs)){g(this,Vs,Array.from(t));const a=w(this,K,Kg).bind(this),o=w(this,K,Jg).bind(this),l=this._uiManager._signal;for(const h of n(this,Vs)){const c=h.getAttribute("data-resizer-name");h.setAttribute("role","spinbutton"),h.addEventListener("keydown",a,{signal:l}),h.addEventListener("blur",o,{signal:l}),h.addEventListener("focus",w(this,K,Qg).bind(this,c),{signal:l}),h.setAttribute("data-l10n-id",tt._l10nResizer[c])}}const s=n(this,Vs)[0];let i=0;for(const a of t){if(a===s)break;i++}const r=(360-this.rotation+this.parentRotation)%360/90*(n(this,Vs).length/4);if(r!==i){if(r<i)for(let o=0;o<i-r;o++)n(this,Ae).append(n(this,Ae).firstElementChild);else if(r>i)for(let o=0;o<r-i;o++)n(this,Ae).firstElementChild.before(n(this,Ae).lastElementChild);let a=0;for(const o of t){const h=n(this,Vs)[a++].getAttribute("data-resizer-name");o.setAttribute("data-l10n-id",tt._l10nResizer[h])}}w(this,K,gf).call(this,0),g(this,Gi,!0),n(this,Ae).firstElementChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}_resizeWithKeyboard(e,t){n(this,Gi)&&w(this,K,uf).call(this,n(this,Fh),{deltaX:e,deltaY:t,fromKeyboard:!0})}_stopResizingWithKeyboard(){w(this,K,Gl).call(this),this.div.focus()}select(){var e,t,s;if(this.isSelected&&this._editToolbar){this._editToolbar.show();return}if(this.isSelected=!0,this.makeResizable(),(e=this.div)==null||e.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{var i,r;(i=this.div)!=null&&i.classList.contains("selectedEditor")&&((r=this._editToolbar)==null||r.show())});return}(t=this._editToolbar)==null||t.show(),(s=n(this,Ht))==null||s.toggleAltTextBadge(!1)}focus(){this.div&&!this.div.contains(document.activeElement)&&setTimeout(()=>{var e;return(e=this.div)==null?void 0:e.focus({preventScroll:!0})},0)}unselect(){var e,t,s,i,r;this.isSelected&&(this.isSelected=!1,(e=n(this,Ae))==null||e.classList.add("hidden"),(t=this.div)==null||t.classList.remove("selectedEditor"),(s=this.div)!=null&&s.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),(i=this._editToolbar)==null||i.hide(),(r=n(this,Ht))==null||r.toggleAltTextBadge(!0),this.hideCommentPopup())}hideCommentPopup(){this.hasComment&&this._uiManager.toggleComment(null)}updateParams(e,t){}disableEditing(){}enableEditing(){}get canChangeContent(){return!1}enterInEditMode(){this.canChangeContent&&(this.enableEditMode(),this.div.focus())}dblclick(e){e.target.nodeName!=="BUTTON"&&(this.enterInEditMode(),this.parent.updateToolbar({mode:this.constructor._editorType,editId:this.uid}))}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return n(this,kh)}set isEditing(e){g(this,kh,e),this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(e,t=!1){if(t){n(this,Fs)||g(this,Fs,new Map);const{action:s}=e;let i=n(this,Fs).get(s);i&&clearTimeout(i),i=setTimeout(()=>{this._reportTelemetry(e),n(this,Fs).delete(s),n(this,Fs).size===0&&g(this,Fs,null)},tt._telemetryTimeout),n(this,Fs).set(s,i);return}e.type||(e.type=this.editorType),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})}show(e=this._isVisible){this.div.classList.toggle("hidden",!e),this._isVisible=e}enable(){this.div&&(this.div.tabIndex=0),g(this,Co,!1)}disable(){this.div&&(this.div.tabIndex=-1),g(this,Co,!0)}updateFakeAnnotationElement(e){if(!n(this,Ls)&&!this.deleted){g(this,Ls,e.addFakeAnnotation(this));return}if(this.deleted){n(this,Ls).remove(),g(this,Ls,null);return}(this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized)&&n(this,Ls).updateEdited({rect:this.getPDFRect(),popup:this.comment})}renderAnnotationElement(e){if(this.deleted)return e.hide(),null;let t=e.container.querySelector(".annotationContent");if(!t)t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),e.container.prepend(t);else if(t.nodeName==="CANVAS"){const s=t;t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),s.before(t)}return t}resetAnnotationElement(e){const{firstElementChild:t}=e.container;(t==null?void 0:t.nodeName)==="DIV"&&t.classList.contains("annotationContent")&&t.remove()}};Ur=new WeakMap,Vs=new WeakMap,Ht=new WeakMap,It=new WeakMap,ji=new WeakMap,Co=new WeakMap,$n=new WeakMap,Lh=new WeakMap,Ae=new WeakMap,Hr=new WeakMap,zi=new WeakMap,Ls=new WeakMap,jn=new WeakMap,Fh=new WeakMap,$r=new WeakMap,ss=new WeakMap,kh=new WeakMap,jr=new WeakMap,Gi=new WeakMap,pi=new WeakMap,Ro=new WeakMap,Po=new WeakMap,Fs=new WeakMap,zr=new WeakMap,Nh=new WeakMap,mu=new WeakMap,K=new WeakSet,hf=function([e,t],s,i){[s,i]=this.screenToPageTranslation(s,i),this.x+=s/e,this.y+=i/t,this._onTranslating(this.x,this.y),this.fixAndSetPosition()},Bh=new WeakSet,cf=function(e,t,s){switch(s){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}},Sd=function(e){switch(e){case 90:{const[t,s]=this.pageDimensions;return[0,-t/s,s/t,0]}case 180:return[-1,0,0,-1];case 270:{const[t,s]=this.pageDimensions;return[0,t/s,-s/t,0]}default:return[1,0,0,1]}},zg=function(){if(n(this,Ae))return;g(this,Ae,document.createElement("div")),n(this,Ae).classList.add("resizers");const e=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],t=this._uiManager._signal;for(const s of e){const i=document.createElement("div");n(this,Ae).append(i),i.classList.add("resizer",s),i.setAttribute("data-resizer-name",s),i.addEventListener("pointerdown",w(this,K,Gg).bind(this,s),{signal:t}),i.addEventListener("contextmenu",Hs,{signal:t}),i.tabIndex=-1}this.div.prepend(n(this,Ae))},Gg=function(e,t){var c;t.preventDefault();const{isMac:s}=he.platform;if(t.button!==0||t.ctrlKey&&s)return;(c=n(this,Ht))==null||c.toggle(!1);const i=this._isDraggable;this._isDraggable=!1,g(this,Hr,[t.screenX,t.screenY]);const r=new AbortController,a=this._uiManager.combinedSignal(r);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",w(this,K,uf).bind(this,e),{passive:!0,capture:!0,signal:a}),window.addEventListener("touchmove",Jt,{passive:!1,signal:a}),window.addEventListener("contextmenu",Hs,{signal:a}),g(this,zi,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const o=this.parent.div.style.cursor,l=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;const h=()=>{var u;r.abort(),this.parent.togglePointerEvents(!0),(u=n(this,Ht))==null||u.toggle(!0),this._isDraggable=i,this.parent.div.style.cursor=o,this.div.style.cursor=l,w(this,K,xd).call(this)};window.addEventListener("pointerup",h,{signal:a}),window.addEventListener("blur",h,{signal:a})},df=function(e,t,s,i){this.width=s,this.height=i,this.x=e,this.y=t,this.setDims(),this.fixAndSetPosition(),this._onResized()},xd=function(){if(!n(this,zi))return;const{savedX:e,savedY:t,savedWidth:s,savedHeight:i}=n(this,zi);g(this,zi,null);const r=this.x,a=this.y,o=this.width,l=this.height;r===e&&a===t&&o===s&&l===i||this.addCommands({cmd:w(this,K,df).bind(this,r,a,o,l),undo:w(this,K,df).bind(this,e,t,s,i),mustExec:!0})},uf=function(e,t){const[s,i]=this.parentDimensions,r=this.x,a=this.y,o=this.width,l=this.height,h=tt.MIN_SIZE/s,c=tt.MIN_SIZE/i,u=w(this,K,Sd).call(this,this.rotation),f=(B,L)=>[u[0]*B+u[2]*L,u[1]*B+u[3]*L],p=w(this,K,Sd).call(this,360-this.rotation),v=(B,L)=>[p[0]*B+p[2]*L,p[1]*B+p[3]*L];let m,A,b=!1,S=!1;switch(e){case"topLeft":b=!0,m=(B,L)=>[0,0],A=(B,L)=>[B,L];break;case"topMiddle":m=(B,L)=>[B/2,0],A=(B,L)=>[B/2,L];break;case"topRight":b=!0,m=(B,L)=>[B,0],A=(B,L)=>[0,L];break;case"middleRight":S=!0,m=(B,L)=>[B,L/2],A=(B,L)=>[0,L/2];break;case"bottomRight":b=!0,m=(B,L)=>[B,L],A=(B,L)=>[0,0];break;case"bottomMiddle":m=(B,L)=>[B/2,L],A=(B,L)=>[B/2,0];break;case"bottomLeft":b=!0,m=(B,L)=>[0,L],A=(B,L)=>[B,0];break;case"middleLeft":S=!0,m=(B,L)=>[0,L/2],A=(B,L)=>[B,L/2];break}const E=m(o,l),T=A(o,l);let x=f(...T);const C=tt._round(r+x[0]),R=tt._round(a+x[1]);let I=1,P=1,M,D;if(t.fromKeyboard)({deltaX:M,deltaY:D}=t);else{const{screenX:B,screenY:L}=t,[z,nt]=n(this,Hr);[M,D]=this.screenToPageTranslation(B-z,L-nt),n(this,Hr)[0]=B,n(this,Hr)[1]=L}if([M,D]=v(M/s,D/i),b){const B=Math.hypot(o,l);I=P=Math.max(Math.min(Math.hypot(T[0]-E[0]-M,T[1]-E[1]-D)/B,1/o,1/l),h/o,c/l)}else S?I=$e(Math.abs(T[0]-E[0]-M),h,1)/o:P=$e(Math.abs(T[1]-E[1]-D),c,1)/l;const _=tt._round(o*I),k=tt._round(l*P);x=f(...A(_,k));const N=C-x[0],G=R-x[1];n(this,ss)||g(this,ss,[this.x,this.y,this.width,this.height]),this.width=_,this.height=k,this.x=N,this.y=G,this.setDims(),this.fixAndSetPosition(),this._onResizing()},Vg=function(){var e;g(this,zi,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height}),(e=n(this,Ht))==null||e.toggle(!1),this.parent.togglePointerEvents(!1)},Wg=function(e,t,s){let r=.7*(s/t)+1-.7;if(r===1)return;const a=w(this,K,Sd).call(this,this.rotation),o=(C,R)=>[a[0]*C+a[2]*R,a[1]*C+a[3]*R],[l,h]=this.parentDimensions,c=this.x,u=this.y,f=this.width,p=this.height,v=tt.MIN_SIZE/l,m=tt.MIN_SIZE/h;r=Math.max(Math.min(r,1/f,1/p),v/f,m/p);const A=tt._round(f*r),b=tt._round(p*r);if(A===f&&b===p)return;n(this,ss)||g(this,ss,[c,u,f,p]);const S=o(f/2,p/2),E=tt._round(c+S[0]),T=tt._round(u+S[1]),x=o(A/2,b/2);this.x=E-x[0],this.y=T-x[1],this.width=A,this.height=b,this.setDims(),this.fixAndSetPosition(),this._onResizing()},Xg=function(){var e;(e=n(this,Ht))==null||e.toggle(!0),this.parent.togglePointerEvents(!0),w(this,K,xd).call(this)},ff=function(e){const{isMac:t}=he.platform;e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this)},Yg=function(e){const{isSelected:t}=this;this._uiManager.setUpDragSession();let s=!1;const i=new AbortController,r=this._uiManager.combinedSignal(i),a={capture:!0,passive:!1,signal:r},o=h=>{i.abort(),g(this,$n,null),g(this,$r,!1),this._uiManager.endDragSession()||w(this,K,ff).call(this,h),s&&this._onStopDragging()};t&&(g(this,Ro,e.clientX),g(this,Po,e.clientY),g(this,$n,e.pointerId),g(this,Lh,e.pointerType),window.addEventListener("pointermove",h=>{s||(s=!0,this._uiManager.toggleComment(this,!0,!1),this._onStartDragging());const{clientX:c,clientY:u,pointerId:f}=h;if(f!==n(this,$n)){Jt(h);return}const[p,v]=this.screenToPageTranslation(c-n(this,Ro),u-n(this,Po));g(this,Ro,c),g(this,Po,u),this._uiManager.dragSelectedEditors(p,v)},a),window.addEventListener("touchmove",Jt,a),window.addEventListener("pointerdown",h=>{h.pointerType===n(this,Lh)&&(n(this,zr)||h.isPrimary)&&o(h),Jt(h)},a));const l=h=>{if(!n(this,$n)||n(this,$n)===h.pointerId){o(h);return}Jt(h)};window.addEventListener("pointerup",l,{signal:r}),window.addEventListener("blur",l,{signal:r})},pf=function(){if(n(this,jn)||!this.div)return;g(this,jn,new AbortController);const e=this._uiManager.combinedSignal(n(this,jn));this.div.addEventListener("focusin",this.focusin.bind(this),{signal:e}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:e})},Kg=function(e){tt._resizerKeyboardManager.exec(this,e)},Jg=function(e){var t;n(this,Gi)&&((t=e.relatedTarget)==null?void 0:t.parentNode)!==n(this,Ae)&&w(this,K,Gl).call(this)},Qg=function(e){g(this,Fh,n(this,Gi)?e:"")},gf=function(e){if(n(this,Vs))for(const t of n(this,Vs))t.tabIndex=e},Gl=function(){g(this,Gi,!1),w(this,K,gf).call(this,-1),w(this,K,xd).call(this)},y(tt,Bh),F(tt,"_l10n",null),F(tt,"_l10nResizer",null),F(tt,"_borderLineWidth",-1),F(tt,"_colorManager",new sf),F(tt,"_zIndex",1),F(tt,"_telemetryTimeout",1e3);let Nt=tt;class Qv extends Nt{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const Wp=3285377520,xs=4294901760,ni=65535;class Zg{constructor(e){this.h1=e?e&4294967295:Wp,this.h2=e?e&4294967295:Wp}update(e){let t,s;if(typeof e=="string"){t=new Uint8Array(e.length*2),s=0;for(let m=0,A=e.length;m<A;m++){const b=e.charCodeAt(m);b<=255?t[s++]=b:(t[s++]=b>>>8,t[s++]=b&255)}}else if(ArrayBuffer.isView(e))t=e.slice(),s=t.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const i=s>>2,r=s-i*4,a=new Uint32Array(t.buffer,0,i);let o=0,l=0,h=this.h1,c=this.h2;const u=3432918353,f=461845907,p=u&ni,v=f&ni;for(let m=0;m<i;m++)m&1?(o=a[m],o=o*u&xs|o*p&ni,o=o<<15|o>>>17,o=o*f&xs|o*v&ni,h^=o,h=h<<13|h>>>19,h=h*5+3864292196):(l=a[m],l=l*u&xs|l*p&ni,l=l<<15|l>>>17,l=l*f&xs|l*v&ni,c^=l,c=c<<13|c>>>19,c=c*5+3864292196);switch(o=0,r){case 3:o^=t[i*4+2]<<16;case 2:o^=t[i*4+1]<<8;case 1:o^=t[i*4],o=o*u&xs|o*p&ni,o=o<<15|o>>>17,o=o*f&xs|o*v&ni,i&1?h^=o:c^=o}this.h1=h,this.h2=c}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=e*3981806797&xs|e*36045&ni,t=t*4283543511&xs|((t<<16|e>>>16)*2950163797&xs)>>>16,e^=t>>>1,e=e*444984403&xs|e*60499&ni,t=t*3301882366&xs|((t<<16|e>>>16)*3120437893&xs)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}}const mf=Object.freeze({map:null,hash:"",transfer:void 0});var Gr,Vr,Vi,we,vu,qg;class xp{constructor(){y(this,vu);y(this,Gr,!1);y(this,Vr,null);y(this,Vi,null);y(this,we,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){const s=n(this,we).get(e);return s===void 0?t:Object.assign(t,s)}getRawValue(e){return n(this,we).get(e)}remove(e){const t=n(this,we).get(e);if(t!==void 0&&(t instanceof Nt&&n(this,Vi).delete(t.annotationElementId),n(this,we).delete(e),n(this,we).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function")){for(const s of n(this,we).values())if(s instanceof Nt)return;this.onAnnotationEditor(null)}}setValue(e,t){const s=n(this,we).get(e);let i=!1;if(s!==void 0)for(const[r,a]of Object.entries(t))s[r]!==a&&(i=!0,s[r]=a);else i=!0,n(this,we).set(e,t);i&&w(this,vu,qg).call(this),t instanceof Nt&&((n(this,Vi)||g(this,Vi,new Map)).set(t.annotationElementId,t),typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(t.constructor._type))}has(e){return n(this,we).has(e)}get size(){return n(this,we).size}resetModified(){n(this,Gr)&&(g(this,Gr,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new tm(this)}get serializable(){if(n(this,we).size===0)return mf;const e=new Map,t=new Zg,s=[],i=Object.create(null);let r=!1;for(const[a,o]of n(this,we)){const l=o instanceof Nt?o.serialize(!1,i):o;l&&(e.set(a,l),t.update(`${a}:${JSON.stringify(l)}`),r||(r=!!l.bitmap))}if(r)for(const a of e.values())a.bitmap&&s.push(a.bitmap);return e.size>0?{map:e,hash:t.hexdigest(),transfer:s}:mf}get editorStats(){let e=null;const t=new Map;let s=0,i=0;for(const r of n(this,we).values()){if(!(r instanceof Nt)){r.popup&&(r.popup.deleted?i+=1:s+=1);continue}r.isCommentDeleted?i+=1:r.hasEditedComment&&(s+=1);const a=r.telemetryFinalData;if(!a)continue;const{type:o}=a;t.has(o)||t.set(o,Object.getPrototypeOf(r).constructor),e||(e=Object.create(null));const l=e[o]||(e[o]=new Map);for(const[h,c]of Object.entries(a)){if(h==="type")continue;let u=l.get(h);u||(u=new Map,l.set(h,u));const f=u.get(c)??0;u.set(c,f+1)}}if((i>0||s>0)&&(e||(e=Object.create(null)),e.comments={deleted:i,edited:s}),!e)return null;for(const[r,a]of t)e[r]=a.computeTelemetryFinalData(e[r]);return e}resetModifiedIds(){g(this,Vr,null)}updateEditor(e,t){var i;const s=(i=n(this,Vi))==null?void 0:i.get(e);return s?(s.updateFromAnnotationLayer(t),!0):!1}getEditor(e){var t;return((t=n(this,Vi))==null?void 0:t.get(e))||null}get modifiedIds(){if(n(this,Vr))return n(this,Vr);const e=[];if(n(this,Vi))for(const t of n(this,Vi).values())t.serialize()&&e.push(t.annotationElementId);return g(this,Vr,{ids:new Set(e),hash:e.join(",")})}[Symbol.iterator](){return n(this,we).entries()}}Gr=new WeakMap,Vr=new WeakMap,Vi=new WeakMap,we=new WeakMap,vu=new WeakSet,qg=function(){n(this,Gr)||(g(this,Gr,!0),typeof this.onSetModified=="function"&&this.onSetModified())};var _h;class tm extends xp{constructor(t){super();y(this,_h);const{map:s,hash:i,transfer:r}=t.serializable,a=structuredClone(s,r?{transfer:r}:null);g(this,_h,{map:a,hash:i,transfer:r})}get print(){Ot("Should not call PrintAnnotationStorage.print")}get serializable(){return n(this,_h)}get modifiedIds(){return Q(this,"modifiedIds",{ids:new Set,hash:""})}}_h=new WeakMap;var Io;class Zv{constructor({ownerDocument:e=globalThis.document,styleElement:t=null}){y(this,Io,new Set);this._document=e,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(const e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),n(this,Io).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:e,disableFontFace:t,_inspectFont:s}){if(!(!e||n(this,Io).has(e.loadedName))){if(ut(!t,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:i,src:r,style:a}=e,o=new FontFace(i,r,a);this.addNativeFontFace(o);try{await o.load(),n(this,Io).add(i),s==null||s(e)}catch{J(`Cannot load system font: ${e.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(o)}return}Ot("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(e){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo){await this.loadSystemFont(e);return}if(this.isFontLoadingAPISupported){const s=e.createNativeFontFace();if(s){this.addNativeFontFace(s);try{await s.loaded}catch(i){throw J(`Failed to load font '${s.family}': '${i}'.`),e.disableFontFace=!0,i}}return}const t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;await new Promise(s=>{const i=this._queueLoadingCallback(s);this._prepareFontLoadEvent(e,i)})}}get isFontLoadingAPISupported(){var t;const e=!!((t=this._document)!=null&&t.fonts);return Q(this,"isFontLoadingAPISupported",e)}get isSyncFontLoadingSupported(){return Q(this,"isSyncFontLoadingSupported",He||he.platform.isFirefox)}_queueLoadingCallback(e){function t(){for(ut(!i.done,"completeRequest() cannot be called twice."),i.done=!0;s.length>0&&s[0].done;){const r=s.shift();setTimeout(r.callback,0)}}const{loadingRequests:s}=this,i={done:!1,complete:t,callback:e};return s.push(i),i}get _loadTestFont(){const e=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return Q(this,"_loadTestFont",e)}_prepareFontLoadEvent(e,t){function s(T,x){return T.charCodeAt(x)<<24|T.charCodeAt(x+1)<<16|T.charCodeAt(x+2)<<8|T.charCodeAt(x+3)&255}function i(T,x,C,R){const I=T.substring(0,x),P=T.substring(x+C);return I+R+P}let r,a;const o=this._document.createElement("canvas");o.width=1,o.height=1;const l=o.getContext("2d");let h=0;function c(T,x){if(++h>30){J("Load test font never loaded."),x();return}if(l.font="30px "+T,l.fillText(".",0,20),l.getImageData(0,0,1,1).data[3]>0){x();return}setTimeout(c.bind(null,T,x))}const u=`lt${Date.now()}${this.loadTestFontId++}`;let f=this._loadTestFont;f=i(f,976,u.length,u);const v=16,m=1482184792;let A=s(f,v);for(r=0,a=u.length-3;r<a;r+=4)A=A-m+s(u,r)|0;r<u.length&&(A=A-m+s(u+"XXX",r)|0),f=i(f,v,4,Ov(A));const b=`url(data:font/opentype;base64,${btoa(f)});`,S=`@font-face {font-family:"${u}";src:${b}}`;this.insertRule(S);const E=this._document.createElement("div");E.style.visibility="hidden",E.style.width=E.style.height="10px",E.style.position="absolute",E.style.top=E.style.left="0px";for(const T of[e.loadedName,u]){const x=this._document.createElement("span");x.textContent="Hi",x.style.fontFamily=T,E.append(x)}this._document.body.append(E),c(u,()=>{E.remove(),t.complete()})}}Io=new WeakMap;var St;class qv{constructor(e,t=null,s,i){y(this,St);this.compiledGlyphs=Object.create(null),g(this,St,e),this._inspectFont=t,s&&Object.assign(this,s),i&&(this.charProcOperatorList=i)}createNativeFontFace(){var t;if(!this.data||this.disableFontFace)return null;let e;if(!this.cssFontInfo)e=new FontFace(this.loadedName,this.data,{});else{const s={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(s.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,s)}return(t=this._inspectFont)==null||t.call(this,this),e}createFontFaceRule(){var s;if(!this.data||this.disableFontFace)return null;const e=`url(data:${this.mimetype};base64,${vg(this.data)});`;let t;if(!this.cssFontInfo)t=`@font-face {font-family:"${this.loadedName}";src:${e}}`;else{let i=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(i+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),t=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${i}src:${e}}`}return(s=this._inspectFont)==null||s.call(this,this,e),t}getPathGenerator(e,t){if(this.compiledGlyphs[t]!==void 0)return this.compiledGlyphs[t];const s=this.loadedName+"_path_"+t;let i;try{i=e.get(s)}catch(a){J(`getPathGenerator - ignoring character: "${a}".`)}const r=Ag(i==null?void 0:i.path);return this.fontExtraProperties||e.delete(s),this.compiledGlyphs[t]=r}get black(){return n(this,St).black}get bold(){return n(this,St).bold}get disableFontFace(){return n(this,St).disableFontFace??!1}set disableFontFace(e){Q(this,"disableFontFace",!!e)}get fontExtraProperties(){return n(this,St).fontExtraProperties??!1}get isInvalidPDFjsFont(){return n(this,St).isInvalidPDFjsFont}get isType3Font(){return n(this,St).isType3Font}get italic(){return n(this,St).italic}get missingFile(){return n(this,St).missingFile}get remeasure(){return n(this,St).remeasure}get vertical(){return n(this,St).vertical}get ascent(){return n(this,St).ascent}get defaultWidth(){return n(this,St).defaultWidth}get descent(){return n(this,St).descent}get bbox(){return n(this,St).bbox}set bbox(e){Q(this,"bbox",e)}get fontMatrix(){return n(this,St).fontMatrix}get fallbackName(){return n(this,St).fallbackName}get loadedName(){return n(this,St).loadedName}get mimetype(){return n(this,St).mimetype}get name(){return n(this,St).name}get data(){return n(this,St).data}clearData(){n(this,St).clearData()}get cssFontInfo(){return n(this,St).cssFontInfo}get systemFontInfo(){return n(this,St).systemFontInfo}get defaultVMetrics(){return n(this,St).defaultVMetrics}}St=new WeakMap;var Do,Mo,Uh,Oo,Td;const io=class io{constructor(e){y(this,Oo);y(this,Do);y(this,Mo);y(this,Uh);g(this,Do,e),g(this,Mo,new DataView(n(this,Do))),g(this,Uh,new TextDecoder)}static write(e){const t=new TextEncoder,s={};let i=0;for(const h of io.strings){const c=t.encode(e[h]);s[h]=c,i+=4+c.length}const r=new ArrayBuffer(i),a=new Uint8Array(r),o=new DataView(r);let l=0;for(const h of io.strings){const c=s[h],u=c.length;o.setUint32(l,u),a.set(c,l+4),l+=4+u}return ut(l===r.byteLength,"CssFontInfo.write: Buffer overflow"),r}get fontFamily(){return w(this,Oo,Td).call(this,0)}get fontWeight(){return w(this,Oo,Td).call(this,1)}get italicAngle(){return w(this,Oo,Td).call(this,2)}};Do=new WeakMap,Mo=new WeakMap,Uh=new WeakMap,Oo=new WeakSet,Td=function(e){ut(e<io.strings.length,"Invalid string index");let t=0;for(let i=0;i<e;i++)t+=n(this,Mo).getUint32(t)+4;const s=n(this,Mo).getUint32(t);return n(this,Uh).decode(new Uint8Array(n(this,Do),t+4,s))},F(io,"strings",["fontFamily","fontWeight","italicAngle"]);let su=io;var zn,gi,Wr,Xr,Vl;const no=class no{constructor(e){y(this,Xr);y(this,zn);y(this,gi);y(this,Wr);g(this,zn,e),g(this,gi,new DataView(n(this,zn))),g(this,Wr,new TextDecoder)}static write(e){const t=new TextEncoder,s={};let i=0;for(const f of no.strings){const p=t.encode(e[f]);s[f]=p,i+=4+p.length}i+=4;let r,a,o=1+i;e.style&&(r=t.encode(e.style.style),a=t.encode(e.style.weight),o+=4+r.length+4+a.length);const l=new ArrayBuffer(o),h=new Uint8Array(l),c=new DataView(l);let u=0;c.setUint8(u++,e.guessFallback?1:0),c.setUint32(u,0),u+=4,i=0;for(const f of no.strings){const p=s[f],v=p.length;i+=4+v,c.setUint32(u,v),h.set(p,u+4),u+=4+v}return c.setUint32(u-i-4,i),e.style&&(c.setUint32(u,r.length),h.set(r,u+4),u+=4+r.length,c.setUint32(u,a.length),h.set(a,u+4),u+=4+a.length),ut(u<=l.byteLength,"SubstitionInfo.write: Buffer overflow"),l.transferToFixedLength(u)}get guessFallback(){return n(this,gi).getUint8(0)!==0}get css(){return w(this,Xr,Vl).call(this,0)}get loadedName(){return w(this,Xr,Vl).call(this,1)}get baseFontName(){return w(this,Xr,Vl).call(this,2)}get src(){return w(this,Xr,Vl).call(this,3)}get style(){let e=1;e+=4+n(this,gi).getUint32(e);const t=n(this,gi).getUint32(e),s=n(this,Wr).decode(new Uint8Array(n(this,zn),e+4,t));e+=4+t;const i=n(this,gi).getUint32(e),r=n(this,Wr).decode(new Uint8Array(n(this,zn),e+4,i));return{style:s,weight:r}}};zn=new WeakMap,gi=new WeakMap,Wr=new WeakMap,Xr=new WeakSet,Vl=function(e){ut(e<no.strings.length,"Invalid string index");let t=5;for(let i=0;i<e;i++)t+=n(this,gi).getUint32(t)+4;const s=n(this,gi).getUint32(t);return n(this,Wr).decode(new Uint8Array(n(this,zn),t+4,s))},F(no,"strings",["css","loadedName","baseFontName","src"]);let iu=no;var Lo,Fo,ko,No,is,mi,Hh,xt,Kt,$s,Cd,Wl;const st=class st{constructor({data:e,extra:t}){y(this,Kt);y(this,mi);y(this,Hh);y(this,xt);g(this,mi,e),g(this,Hh,new TextDecoder),g(this,xt,new DataView(n(this,mi))),t&&Object.assign(this,t)}get black(){return w(this,Kt,$s).call(this,0)}get bold(){return w(this,Kt,$s).call(this,1)}get disableFontFace(){return w(this,Kt,$s).call(this,2)}get fontExtraProperties(){return w(this,Kt,$s).call(this,3)}get isInvalidPDFjsFont(){return w(this,Kt,$s).call(this,4)}get isType3Font(){return w(this,Kt,$s).call(this,5)}get italic(){return w(this,Kt,$s).call(this,6)}get missingFile(){return w(this,Kt,$s).call(this,7)}get remeasure(){return w(this,Kt,$s).call(this,8)}get vertical(){return w(this,Kt,$s).call(this,9)}get ascent(){return w(this,Kt,Cd).call(this,0)}get defaultWidth(){return w(this,Kt,Cd).call(this,1)}get descent(){return w(this,Kt,Cd).call(this,2)}get bbox(){let e=n(st,Fo);if(n(this,xt).getUint8(e)===0)return;e+=1;const s=[];for(let i=0;i<4;i++)s.push(n(this,xt).getInt16(e,!0)),e+=2;return s}get fontMatrix(){let e=n(st,ko);if(n(this,xt).getUint8(e)===0)return;e+=1;const s=[];for(let i=0;i<6;i++)s.push(n(this,xt).getFloat64(e,!0)),e+=8;return s}get defaultVMetrics(){let e=n(st,No);if(n(this,xt).getUint8(e)===0)return;e+=1;const s=[];for(let i=0;i<3;i++)s.push(n(this,xt).getInt16(e,!0)),e+=2;return s}get fallbackName(){return w(this,Kt,Wl).call(this,0)}get loadedName(){return w(this,Kt,Wl).call(this,1)}get mimetype(){return w(this,Kt,Wl).call(this,2)}get name(){return w(this,Kt,Wl).call(this,3)}get data(){let e=n(st,is);const t=n(this,xt).getUint32(e);e+=4+t;const s=n(this,xt).getUint32(e);e+=4+s;const i=n(this,xt).getUint32(e);e+=4+i;const r=n(this,xt).getUint32(e);if(r!==0)return new Uint8Array(n(this,mi),e+4,r)}clearData(){let e=n(st,is);const t=n(this,xt).getUint32(e);e+=4+t;const s=n(this,xt).getUint32(e);e+=4+s;const i=n(this,xt).getUint32(e);e+=4+i;const r=n(this,xt).getUint32(e);new Uint8Array(n(this,mi),e+4,r).fill(0),n(this,xt).setUint32(e,0)}get cssFontInfo(){let e=n(st,is);const t=n(this,xt).getUint32(e);e+=4+t;const s=n(this,xt).getUint32(e);e+=4+s;const i=n(this,xt).getUint32(e);if(i===0)return null;const r=new Uint8Array(i);return r.set(new Uint8Array(n(this,mi),e+4,i)),new su(r.buffer)}get systemFontInfo(){let e=n(st,is);const t=n(this,xt).getUint32(e);e+=4+t;const s=n(this,xt).getUint32(e);if(s===0)return null;const i=new Uint8Array(s);return i.set(new Uint8Array(n(this,mi),e+4,s)),new iu(i.buffer)}static write(e){const t=e.systemFontInfo?iu.write(e.systemFontInfo):null,s=e.cssFontInfo?su.write(e.cssFontInfo):null,i=new TextEncoder,r={};let a=0;for(const m of st.strings)r[m]=i.encode(e[m]),a+=4+r[m].length;const o=n(st,is)+4+a+4+(t?t.byteLength:0)+4+(s?s.byteLength:0)+4+(e.data?e.data.length:0),l=new ArrayBuffer(o),h=new Uint8Array(l),c=new DataView(l);let u=0;const f=st.bools.length;let p=0,v=0;for(let m=0;m<f;m++){const A=e[st.bools[m]];p|=(A===void 0?0:A?2:1)<<v,v+=2,(v===8||m===f-1)&&(c.setUint8(u++,p),p=0,v=0)}ut(u===n(st,Lo),"FontInfo.write: Boolean properties offset mismatch");for(const m of st.numbers)c.setFloat64(u,e[m]),u+=8;if(ut(u===n(st,Fo),"FontInfo.write: Number properties offset mismatch"),e.bbox){c.setUint8(u++,4);for(const m of e.bbox)c.setInt16(u,m,!0),u+=2}else c.setUint8(u++,0),u+=2*4;if(ut(u===n(st,ko),"FontInfo.write: BBox properties offset mismatch"),e.fontMatrix){c.setUint8(u++,6);for(const m of e.fontMatrix)c.setFloat64(u,m,!0),u+=8}else c.setUint8(u++,0),u+=8*6;if(ut(u===n(st,No),"FontInfo.write: FontMatrix properties offset mismatch"),e.defaultVMetrics){c.setUint8(u++,1);for(const m of e.defaultVMetrics)c.setInt16(u,m,!0),u+=2}else c.setUint8(u++,0),u+=3*2;ut(u===n(st,is),"FontInfo.write: DefaultVMetrics properties offset mismatch"),c.setUint32(n(st,is),0),u+=4;for(const m of st.strings){const A=r[m],b=A.length;c.setUint32(u,b),h.set(A,u+4),u+=4+b}if(c.setUint32(n(st,is),u-n(st,is)-4),!t)c.setUint32(u,0),u+=4;else{const m=t.byteLength;c.setUint32(u,m),ut(u+4+m<=l.byteLength,"FontInfo.write: Buffer overflow at systemFontInfo"),h.set(new Uint8Array(t),u+4),u+=4+m}if(!s)c.setUint32(u,0),u+=4;else{const m=s.byteLength;c.setUint32(u,m),ut(u+4+m<=l.byteLength,"FontInfo.write: Buffer overflow at cssFontInfo"),h.set(new Uint8Array(s),u+4),u+=4+m}return e.data===void 0?(c.setUint32(u,0),u+=4):(c.setUint32(u,e.data.length),h.set(e.data,u+4),u+=4+e.data.length),ut(u<=l.byteLength,"FontInfo.write: Buffer overflow"),l.transferToFixedLength(u)}};Lo=new WeakMap,Fo=new WeakMap,ko=new WeakMap,No=new WeakMap,is=new WeakMap,mi=new WeakMap,Hh=new WeakMap,xt=new WeakMap,Kt=new WeakSet,$s=function(e){ut(e<st.bools.length,"Invalid boolean index");const t=Math.floor(e/4),s=e*2%8,i=n(this,xt).getUint8(t)>>s&3;return i===0?void 0:i===2},Cd=function(e){return ut(e<st.numbers.length,"Invalid number index"),n(this,xt).getFloat64(n(st,Lo)+e*8)},Wl=function(e){ut(e<st.strings.length,"Invalid string index");let t=n(st,is)+4;for(let r=0;r<e;r++)t+=n(this,xt).getUint32(t)+4;const s=n(this,xt).getUint32(t),i=new Uint8Array(s);return i.set(new Uint8Array(n(this,mi),t+4,s)),n(this,Hh).decode(i)},F(st,"bools",["black","bold","disableFontFace","fontExtraProperties","isInvalidPDFjsFont","isType3Font","italic","missingFile","remeasure","vertical"]),F(st,"numbers",["ascent","defaultWidth","descent"]),F(st,"strings",["fallbackName","loadedName","mimetype","name"]),y(st,Lo,Math.ceil(st.bools.length*2/8)),y(st,Fo,n(st,Lo)+st.numbers.length*8),y(st,ko,n(st,Fo)+1+2*4),y(st,No,n(st,ko)+1+8*6),y(st,is,n(st,No)+1+2*3);let vf=st;var $h,jh,zh,Gh,Vh,Wh,Xh,Yh;const Ft=class Ft{constructor(e){this.buffer=e,this.view=new DataView(e),this.data=new Uint8Array(e)}static write(e){let t,s=null,i=[],r=[],a=[],o=[],l=null,h=null;switch(e[0]){case"RadialAxial":t=e[1]==="axial"?1:2,s=e[2],a=e[3],t===1?i.push(...e[4],...e[5]):i.push(e[4][0],e[4][1],e[6],e[5][0],e[5][1],e[7]);break;case"Mesh":t=3,l=e[1],i=e[2],r=e[3],o=e[4]||[],s=e[6],h=e[7];break;default:throw new Error(`Unsupported pattern type: ${e[0]}`)}const c=Math.floor(i.length/2),u=Math.floor(r.length/3),f=a.length,p=o.length;let v=0;for(const x of o)v+=1,v=Math.ceil(v/4)*4,v+=4+x.coords.length*4,v+=4+x.colors.length*4,x.verticesPerRow!==void 0&&(v+=4);const m=20+c*8+u*3+f*8+(s?16:0)+(h?3:0)+v,A=new ArrayBuffer(m),b=new DataView(A),S=new Uint8Array(A);b.setUint8(n(Ft,$h),t),b.setUint8(n(Ft,jh),s?1:0),b.setUint8(n(Ft,zh),h?1:0),b.setUint8(n(Ft,Gh),l),b.setUint32(n(Ft,Vh),c,!0),b.setUint32(n(Ft,Wh),u,!0),b.setUint32(n(Ft,Xh),f,!0),b.setUint32(n(Ft,Yh),p,!0);let E=20;new Float32Array(A,E,c*2).set(i),E+=c*8,S.set(r,E),E+=u*3;for(const[x,C]of a)b.setFloat32(E,x,!0),E+=4,b.setUint32(E,parseInt(C.slice(1),16),!0),E+=4;if(s)for(const x of s)b.setFloat32(E,x,!0),E+=4;h&&(S.set(h,E),E+=3);for(let x=0;x<o.length;x++){const C=o[x];b.setUint8(E,C.type),E+=1,E=Math.ceil(E/4)*4,b.setUint32(E,C.coords.length,!0),E+=4,new Int32Array(A,E,C.coords.length).set(C.coords),E+=C.coords.length*4,b.setUint32(E,C.colors.length,!0),E+=4,new Int32Array(A,E,C.colors.length).set(C.colors),E+=C.colors.length*4,C.verticesPerRow!==void 0&&(b.setUint32(E,C.verticesPerRow,!0),E+=4)}return A}getIR(){const e=this.view,t=this.data[n(Ft,$h)],s=!!this.data[n(Ft,jh)],i=!!this.data[n(Ft,zh)],r=e.getUint32(n(Ft,Vh),!0),a=e.getUint32(n(Ft,Wh),!0),o=e.getUint32(n(Ft,Xh),!0),l=e.getUint32(n(Ft,Yh),!0);let h=20;const c=new Float32Array(this.buffer,h,r*2);h+=r*8;const u=new Uint8Array(this.buffer,h,a*3);h+=a*3;const f=[];for(let A=0;A<o;++A){const b=e.getFloat32(h,!0);h+=4;const S=e.getUint32(h,!0);h+=4,f.push([b,`#${S.toString(16).padStart(6,"0")}`])}let p=null;if(s){p=[];for(let A=0;A<4;++A)p.push(e.getFloat32(h,!0)),h+=4}let v=null;i&&(v=new Uint8Array(this.buffer,h,3),h+=3);const m=[];for(let A=0;A<l;++A){const b=e.getUint8(h);h+=1,h=Math.ceil(h/4)*4;const S=e.getUint32(h,!0);h+=4;const E=new Int32Array(this.buffer,h,S);h+=S*4;const T=e.getUint32(h,!0);h+=4;const x=new Int32Array(this.buffer,h,T);h+=T*4;const C={type:b,coords:E,colors:x};b===Yu.LATTICE&&(C.verticesPerRow=e.getUint32(h,!0),h+=4),m.push(C)}if(t===1)return["RadialAxial","axial",p,f,Array.from(c.slice(0,2)),Array.from(c.slice(2,4)),null,null];if(t===2)return["RadialAxial","radial",p,f,[c[0],c[1]],[c[3],c[4]],c[2],c[5]];if(t===3){const A=this.data[n(Ft,Gh)];let b=null;if(c.length>0){let S=c[0],E=c[0],T=c[1],x=c[1];for(let C=0;C<c.length;C+=2){const R=c[C],I=c[C+1];S=S>R?R:S,T=T>I?I:T,E=E<R?R:E,x=x<I?I:x}b=[S,T,E,x]}return["Mesh",A,c,u,m,b,p,v]}throw new Error(`Unsupported pattern kind: ${t}`)}};$h=new WeakMap,jh=new WeakMap,zh=new WeakMap,Gh=new WeakMap,Vh=new WeakMap,Wh=new WeakMap,Xh=new WeakMap,Yh=new WeakMap,y(Ft,$h,0),y(Ft,jh,1),y(Ft,zh,2),y(Ft,Gh,3),y(Ft,Vh,4),y(Ft,Wh,8),y(Ft,Xh,12),y(Ft,Yh,16);let yf=Ft;var Bo;class ty{constructor(e){y(this,Bo);g(this,Bo,e)}static write(e){let t,s;return he.isFloat16ArraySupported?(s=new ArrayBuffer(e.length*2),t=new Float16Array(s)):(s=new ArrayBuffer(e.length*4),t=new Float32Array(s)),t.set(e),s}get path(){return he.isFloat16ArraySupported?new Float16Array(n(this,Bo)):new Float32Array(n(this,Bo))}}Bo=new WeakMap;function ey(d){if(d instanceof URL)return d.href;if(typeof d=="string"){if(He)return d;const e=URL.parse(d,window.location);if(e)return e.href}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function sy(d){if(He&&typeof Buffer<"u"&&d instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(d instanceof Uint8Array&&d.byteLength===d.buffer.byteLength)return d;if(typeof d=="string")return ed(d);if(d instanceof ArrayBuffer||ArrayBuffer.isView(d)||typeof d=="object"&&!isNaN(d==null?void 0:d.length))return new Uint8Array(d);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function cd(d){if(typeof d!="string")return null;if(d.endsWith("/"))return d;throw new Error(`Invalid factory url: "${d}" must include trailing slash.`)}const bf=d=>typeof d=="object"&&Number.isInteger(d==null?void 0:d.num)&&d.num>=0&&Number.isInteger(d==null?void 0:d.gen)&&d.gen>=0,iy=d=>typeof d=="object"&&typeof(d==null?void 0:d.name)=="string",ny=Bv.bind(null,bf,iy);var Wi,yu;class ry{constructor(){y(this,Wi,new Map);y(this,yu,Promise.resolve())}postMessage(e,t){const s={data:structuredClone(e,t?{transfer:t}:null)};n(this,yu).then(()=>{for(const[i]of n(this,Wi))i.call(this,s)})}addEventListener(e,t,s=null){let i=null;if((s==null?void 0:s.signal)instanceof AbortSignal){const{signal:r}=s;if(r.aborted){J("LoopbackPort - cannot use an `aborted` signal.");return}const a=()=>this.removeEventListener(e,t);i=()=>r.removeEventListener("abort",a),r.addEventListener("abort",a)}n(this,Wi).set(t,i)}removeEventListener(e,t){const s=n(this,Wi).get(t);s==null||s(),n(this,Wi).delete(t)}terminate(){for(const[,e]of n(this,Wi))e==null||e();n(this,Wi).clear()}}Wi=new WeakMap,yu=new WeakMap;const dd={DATA:1,ERROR:2},qt={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function Xp(){}function Ge(d){if(d instanceof gr||d instanceof Ku||d instanceof Up||d instanceof Zd||d instanceof Uu)return d;switch(d instanceof Error||typeof d=="object"&&d!==null||Ot('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),d.name){case"AbortException":return new gr(d.message);case"InvalidPDFException":return new Ku(d.message);case"PasswordException":return new Up(d.message,d.code);case"ResponseException":return new Zd(d.message,d.status,d.missing);case"UnknownErrorException":return new Uu(d.message,d.details)}return new Uu(d.message,d.toString())}var _o,Us,em,sm,im,Rd;class Xl{constructor(e,t,s){y(this,Us);y(this,_o,new AbortController);this.sourceName=e,this.targetName=t,this.comObj=s,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),s.addEventListener("message",w(this,Us,em).bind(this),{signal:n(this,_o).signal})}on(e,t){const s=this.actionHandler;if(s[e])throw new Error(`There is already an actionName called "${e}"`);s[e]=t}send(e,t,s){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},s)}sendWithPromise(e,t,s){const i=this.callbackId++,r=Promise.withResolvers();this.callbackCapabilities[i]=r;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:i,data:t},s)}catch(a){r.reject(a)}return r.promise}sendWithStream(e,t,s,i){const r=this.streamId++,a=this.sourceName,o=this.targetName,l=this.comObj;return new ReadableStream({start:h=>{const c=Promise.withResolvers();return this.streamControllers[r]={controller:h,startCall:c,pullCall:null,cancelCall:null,isClosed:!1},l.postMessage({sourceName:a,targetName:o,action:e,streamId:r,data:t,desiredSize:h.desiredSize},i),c.promise},pull:h=>{const c=Promise.withResolvers();return this.streamControllers[r].pullCall=c,l.postMessage({sourceName:a,targetName:o,stream:qt.PULL,streamId:r,desiredSize:h.desiredSize}),c.promise},cancel:h=>{ut(h instanceof Error,"cancel must have a valid reason");const c=Promise.withResolvers();return this.streamControllers[r].cancelCall=c,this.streamControllers[r].isClosed=!0,l.postMessage({sourceName:a,targetName:o,stream:qt.CANCEL,streamId:r,reason:Ge(h)}),c.promise}},s)}destroy(){var e;(e=n(this,_o))==null||e.abort(),g(this,_o,null)}}_o=new WeakMap,Us=new WeakSet,em=function({data:e}){if(e.targetName!==this.sourceName)return;if(e.stream){w(this,Us,im).call(this,e);return}if(e.callback){const s=e.callbackId,i=this.callbackCapabilities[s];if(!i)throw new Error(`Cannot resolve callback ${s}`);if(delete this.callbackCapabilities[s],e.callback===dd.DATA)i.resolve(e.data);else if(e.callback===dd.ERROR)i.reject(Ge(e.reason));else throw new Error("Unexpected callback case");return}const t=this.actionHandler[e.action];if(!t)throw new Error(`Unknown action from worker: ${e.action}`);if(e.callbackId){const s=this.sourceName,i=e.sourceName,r=this.comObj;Promise.try(t,e.data).then(function(a){r.postMessage({sourceName:s,targetName:i,callback:dd.DATA,callbackId:e.callbackId,data:a})},function(a){r.postMessage({sourceName:s,targetName:i,callback:dd.ERROR,callbackId:e.callbackId,reason:Ge(a)})});return}if(e.streamId){w(this,Us,sm).call(this,e);return}t(e.data)},sm=function(e){const t=e.streamId,s=this.sourceName,i=e.sourceName,r=this.comObj,a=this,o=this.actionHandler[e.action],l={enqueue(h,c=1,u){if(this.isCancelled)return;const f=this.desiredSize;this.desiredSize-=c,f>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),r.postMessage({sourceName:s,targetName:i,stream:qt.ENQUEUE,streamId:t,chunk:h},u)},close(){this.isCancelled||(this.isCancelled=!0,r.postMessage({sourceName:s,targetName:i,stream:qt.CLOSE,streamId:t}),delete a.streamSinks[t])},error(h){ut(h instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,r.postMessage({sourceName:s,targetName:i,stream:qt.ERROR,streamId:t,reason:Ge(h)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};l.sinkCapability.resolve(),l.ready=l.sinkCapability.promise,this.streamSinks[t]=l,Promise.try(o,e.data,l).then(function(){r.postMessage({sourceName:s,targetName:i,stream:qt.START_COMPLETE,streamId:t,success:!0})},function(h){r.postMessage({sourceName:s,targetName:i,stream:qt.START_COMPLETE,streamId:t,reason:Ge(h)})})},im=function(e){const t=e.streamId,s=this.sourceName,i=e.sourceName,r=this.comObj,a=this.streamControllers[t],o=this.streamSinks[t];switch(e.stream){case qt.START_COMPLETE:e.success?a.startCall.resolve():a.startCall.reject(Ge(e.reason));break;case qt.PULL_COMPLETE:e.success?a.pullCall.resolve():a.pullCall.reject(Ge(e.reason));break;case qt.PULL:if(!o){r.postMessage({sourceName:s,targetName:i,stream:qt.PULL_COMPLETE,streamId:t,success:!0});break}o.desiredSize<=0&&e.desiredSize>0&&o.sinkCapability.resolve(),o.desiredSize=e.desiredSize,Promise.try(o.onPull||Xp).then(function(){r.postMessage({sourceName:s,targetName:i,stream:qt.PULL_COMPLETE,streamId:t,success:!0})},function(h){r.postMessage({sourceName:s,targetName:i,stream:qt.PULL_COMPLETE,streamId:t,reason:Ge(h)})});break;case qt.ENQUEUE:if(ut(a,"enqueue should have stream controller"),a.isClosed)break;a.controller.enqueue(e.chunk);break;case qt.CLOSE:if(ut(a,"close should have stream controller"),a.isClosed)break;a.isClosed=!0,a.controller.close(),w(this,Us,Rd).call(this,a,t);break;case qt.ERROR:ut(a,"error should have stream controller"),a.controller.error(Ge(e.reason)),w(this,Us,Rd).call(this,a,t);break;case qt.CANCEL_COMPLETE:e.success?a.cancelCall.resolve():a.cancelCall.reject(Ge(e.reason)),w(this,Us,Rd).call(this,a,t);break;case qt.CANCEL:if(!o)break;const l=Ge(e.reason);Promise.try(o.onCancel||Xp,l).then(function(){r.postMessage({sourceName:s,targetName:i,stream:qt.CANCEL_COMPLETE,streamId:t,success:!0})},function(h){r.postMessage({sourceName:s,targetName:i,stream:qt.CANCEL_COMPLETE,streamId:t,reason:Ge(h)})}),o.sinkCapability.reject(l),o.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}},Rd=async function(e,t){var s,i,r;await Promise.allSettled([(s=e.startCall)==null?void 0:s.promise,(i=e.pullCall)==null?void 0:i.promise,(r=e.cancelCall)==null?void 0:r.promise]),delete this.streamControllers[t]};var Kh;class nm{constructor({enableHWA:e=!1}){y(this,Kh,!1);g(this,Kh,e)}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");const s=this._createCanvas(e,t);return{canvas:s,context:s.getContext("2d",{willReadFrequently:!n(this,Kh)})}}reset(e,t,s){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||s<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=s}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){Ot("Abstract method `_createCanvas` called.")}}Kh=new WeakMap;class ay extends nm{constructor({ownerDocument:e=globalThis.document,enableHWA:t=!1}){super({enableHWA:t}),this._document=e}_createCanvas(e,t){const s=this._document.createElement("canvas");return s.width=e,s.height=t,s}}class rm{constructor({baseUrl:e=null,isCompressed:t=!0}){this.baseUrl=e,this.isCompressed=t}async fetch({name:e}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!e)throw new Error("CMap name must be specified.");const t=this.baseUrl+e+(this.isCompressed?".bcmap":"");return this._fetch(t).then(s=>({cMapData:s,isCompressed:this.isCompressed})).catch(s=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${t}`)})}async _fetch(e){Ot("Abstract method `_fetch` called.")}}class Yp extends rm{async _fetch(e){const t=await sd(e,this.isCompressed?"arraybuffer":"text");return t instanceof ArrayBuffer?new Uint8Array(t):ed(t)}}it(2489);class am{addFilter(e){return"none"}addHCMFilter(e,t){return"none"}addAlphaFilter(e){return"none"}addLuminosityFilter(e){return"none"}addHighlightHCMFilter(e,t,s,i,r){return"none"}destroy(e=!1){}}var Yr,Uo,Xi,Yi,Me,Kr,Jr,V,Re,Yl,Ya,Pd,Ka,om,Af,Ja,Kl,Jl,wf,Ql;class oy extends am{constructor({docId:t,ownerDocument:s=globalThis.document}){super();y(this,V);y(this,Yr);y(this,Uo);y(this,Xi);y(this,Yi);y(this,Me);y(this,Kr);y(this,Jr,0);g(this,Yi,t),g(this,Me,s)}addFilter(t){if(!t)return"none";let s=n(this,V,Re).get(t);if(s)return s;const[i,r,a]=w(this,V,Pd).call(this,t),o=t.length===1?i:`${i}${r}${a}`;if(s=n(this,V,Re).get(o),s)return n(this,V,Re).set(t,s),s;const l=`g_${n(this,Yi)}_transfer_map_${ie(this,Jr)._++}`,h=w(this,V,Ka).call(this,l);n(this,V,Re).set(t,h),n(this,V,Re).set(o,h);const c=w(this,V,Ja).call(this,l);return w(this,V,Jl).call(this,i,r,a,c),h}addHCMFilter(t,s){var v;const i=`${t}-${s}`,r="base";let a=n(this,V,Yl).get(r);if((a==null?void 0:a.key)===i||(a?((v=a.filter)==null||v.remove(),a.key=i,a.url="none",a.filter=null):(a={key:i,url:"none",filter:null},n(this,V,Yl).set(r,a)),!t||!s))return a.url;const o=w(this,V,Ql).call(this,t);t=j.makeHexColor(...o);const l=w(this,V,Ql).call(this,s);if(s=j.makeHexColor(...l),n(this,V,Ya).style.color="",t==="#000000"&&s==="#ffffff"||t===s)return a.url;const h=new Array(256);for(let m=0;m<=255;m++){const A=m/255;h[m]=A<=.03928?A/12.92:((A+.055)/1.055)**2.4}const c=h.join(","),u=`g_${n(this,Yi)}_hcm_filter`,f=a.filter=w(this,V,Ja).call(this,u);w(this,V,Jl).call(this,c,c,c,f),w(this,V,Af).call(this,f);const p=(m,A)=>{const b=o[m]/255,S=l[m]/255,E=new Array(A+1);for(let T=0;T<=A;T++)E[T]=b+T/A*(S-b);return E.join(",")};return w(this,V,Jl).call(this,p(0,5),p(1,5),p(2,5),f),a.url=w(this,V,Ka).call(this,u),a.url}addAlphaFilter(t){let s=n(this,V,Re).get(t);if(s)return s;const[i]=w(this,V,Pd).call(this,[t]),r=`alpha_${i}`;if(s=n(this,V,Re).get(r),s)return n(this,V,Re).set(t,s),s;const a=`g_${n(this,Yi)}_alpha_map_${ie(this,Jr)._++}`,o=w(this,V,Ka).call(this,a);n(this,V,Re).set(t,o),n(this,V,Re).set(r,o);const l=w(this,V,Ja).call(this,a);return w(this,V,wf).call(this,i,l),o}addLuminosityFilter(t){let s=n(this,V,Re).get(t||"luminosity");if(s)return s;let i,r;if(t?([i]=w(this,V,Pd).call(this,[t]),r=`luminosity_${i}`):r="luminosity",s=n(this,V,Re).get(r),s)return n(this,V,Re).set(t,s),s;const a=`g_${n(this,Yi)}_luminosity_map_${ie(this,Jr)._++}`,o=w(this,V,Ka).call(this,a);n(this,V,Re).set(t,o),n(this,V,Re).set(r,o);const l=w(this,V,Ja).call(this,a);return w(this,V,om).call(this,l),t&&w(this,V,wf).call(this,i,l),o}addHighlightHCMFilter(t,s,i,r,a){var S;const o=`${s}-${i}-${r}-${a}`;let l=n(this,V,Yl).get(t);if((l==null?void 0:l.key)===o||(l?((S=l.filter)==null||S.remove(),l.key=o,l.url="none",l.filter=null):(l={key:o,url:"none",filter:null},n(this,V,Yl).set(t,l)),!s||!i))return l.url;const[h,c]=[s,i].map(w(this,V,Ql).bind(this));let u=Math.round(.2126*h[0]+.7152*h[1]+.0722*h[2]),f=Math.round(.2126*c[0]+.7152*c[1]+.0722*c[2]),[p,v]=[r,a].map(w(this,V,Ql).bind(this));f<u&&([u,f,p,v]=[f,u,v,p]),n(this,V,Ya).style.color="";const m=(E,T,x)=>{const C=new Array(256),R=(f-u)/x,I=E/255,P=(T-E)/(255*x);let M=0;for(let D=0;D<=x;D++){const _=Math.round(u+D*R),k=I+D*P;for(let N=M;N<=_;N++)C[N]=k;M=_+1}for(let D=M;D<256;D++)C[D]=C[M-1];return C.join(",")},A=`g_${n(this,Yi)}_hcm_${t}_filter`,b=l.filter=w(this,V,Ja).call(this,A);return w(this,V,Af).call(this,b),w(this,V,Jl).call(this,m(p[0],v[0],5),m(p[1],v[1],5),m(p[2],v[2],5),b),l.url=w(this,V,Ka).call(this,A),l.url}destroy(t=!1){var s,i,r,a;t&&((s=n(this,Kr))!=null&&s.size)||((i=n(this,Xi))==null||i.parentNode.parentNode.remove(),g(this,Xi,null),(r=n(this,Uo))==null||r.clear(),g(this,Uo,null),(a=n(this,Kr))==null||a.clear(),g(this,Kr,null),g(this,Jr,0))}}Yr=new WeakMap,Uo=new WeakMap,Xi=new WeakMap,Yi=new WeakMap,Me=new WeakMap,Kr=new WeakMap,Jr=new WeakMap,V=new WeakSet,Re=function(){return n(this,Uo)||g(this,Uo,new Map)},Yl=function(){return n(this,Kr)||g(this,Kr,new Map)},Ya=function(){if(!n(this,Xi)){const t=n(this,Me).createElement("div"),{style:s}=t;s.visibility="hidden",s.contain="strict",s.width=s.height=0,s.position="absolute",s.top=s.left=0,s.zIndex=-1;const i=n(this,Me).createElementNS(Di,"svg");i.setAttribute("width",0),i.setAttribute("height",0),g(this,Xi,n(this,Me).createElementNS(Di,"defs")),t.append(i),i.append(n(this,Xi)),n(this,Me).body.append(t)}return n(this,Xi)},Pd=function(t){if(t.length===1){const h=t[0],c=new Array(256);for(let f=0;f<256;f++)c[f]=h[f]/255;const u=c.join(",");return[u,u,u]}const[s,i,r]=t,a=new Array(256),o=new Array(256),l=new Array(256);for(let h=0;h<256;h++)a[h]=s[h]/255,o[h]=i[h]/255,l[h]=r[h]/255;return[a.join(","),o.join(","),l.join(",")]},Ka=function(t){if(n(this,Yr)===void 0){g(this,Yr,"");const s=n(this,Me).URL;s!==n(this,Me).baseURI&&(Lu(s)?J('#createUrl: ignore "data:"-URL for performance reasons.'):g(this,Yr,pg(s,"")))}return`url(${n(this,Yr)}#${t})`},om=function(t){const s=n(this,Me).createElementNS(Di,"feColorMatrix");s.setAttribute("type","matrix"),s.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(s)},Af=function(t){const s=n(this,Me).createElementNS(Di,"feColorMatrix");s.setAttribute("type","matrix"),s.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(s)},Ja=function(t){const s=n(this,Me).createElementNS(Di,"filter");return s.setAttribute("color-interpolation-filters","sRGB"),s.setAttribute("id",t),n(this,V,Ya).append(s),s},Kl=function(t,s,i){const r=n(this,Me).createElementNS(Di,s);r.setAttribute("type","discrete"),r.setAttribute("tableValues",i),t.append(r)},Jl=function(t,s,i,r){const a=n(this,Me).createElementNS(Di,"feComponentTransfer");r.append(a),w(this,V,Kl).call(this,a,"feFuncR",t),w(this,V,Kl).call(this,a,"feFuncG",s),w(this,V,Kl).call(this,a,"feFuncB",i)},wf=function(t,s){const i=n(this,Me).createElementNS(Di,"feComponentTransfer");s.append(i),w(this,V,Kl).call(this,i,"feFuncA",t)},Ql=function(t){return n(this,V,Ya).style.color=t,nd(getComputedStyle(n(this,V,Ya)).getPropertyValue("color"))};class lm{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!e)throw new Error("Font filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(s=>{throw new Error(`Unable to load font data at: ${t}`)})}async _fetch(e){Ot("Abstract method `_fetch` called.")}}class Kp extends lm{async _fetch(e){const t=await sd(e,"arraybuffer");return new Uint8Array(t)}}class hm{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `wasmUrl` API parameter is provided.");if(!e)throw new Error("Wasm filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(s=>{throw new Error(`Unable to load wasm data at: ${t}`)})}async _fetch(e){Ot("Abstract method `_fetch` called.")}}class Jp extends hm{async _fetch(e){const t=await sd(e,"arraybuffer");return new Uint8Array(t)}}var dg;if(He){let d;try{const e=process.getBuiltinModule("module").createRequire(import.meta.url);try{d=e("@napi-rs/canvas")}catch(t){J(`Cannot load "@napi-rs/canvas" package: "${t}".`)}}catch(e){J(`Cannot access the \`require\` function: "${e}".`)}globalThis.DOMMatrix||(d!=null&&d.DOMMatrix?globalThis.DOMMatrix=d.DOMMatrix:J("Cannot polyfill `DOMMatrix`, rendering may be broken.")),globalThis.ImageData||(d!=null&&d.ImageData?globalThis.ImageData=d.ImageData:J("Cannot polyfill `ImageData`, rendering may be broken.")),globalThis.Path2D||(d!=null&&d.Path2D?globalThis.Path2D=d.Path2D:J("Cannot polyfill `Path2D`, rendering may be broken.")),(dg=globalThis.navigator)!=null&&dg.language||(globalThis.navigator={language:"en-US",platform:"",userAgent:""})}async function Tp(d){const t=await process.getBuiltinModule("fs").promises.readFile(d);return new Uint8Array(t)}class ly extends am{}class hy extends nm{_createCanvas(e,t){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(e,t)}}class cy extends rm{async _fetch(e){return Tp(e)}}class dy extends lm{async _fetch(e){return Tp(e)}}class uy extends hm{async _fetch(e){return Tp(e)}}it(7588);const Va="__forcedDependency",{floor:Qp,ceil:Zp}=Math;function ud(d,e,t,s,i,r){d[e*4+0]=Math.min(d[e*4+0],t),d[e*4+1]=Math.min(d[e*4+1],s),d[e*4+2]=Math.max(d[e*4+2],i),d[e*4+3]=Math.max(d[e*4+3],r)}const Ef=new Uint32Array(new Uint8Array([255,255,0,0]).buffer)[0];var Ho,Gn;class fy{constructor(e,t){y(this,Ho);y(this,Gn);g(this,Ho,e),g(this,Gn,t)}get length(){return n(this,Ho).length}isEmpty(e){return n(this,Ho)[e]===Ef}minX(e){return n(this,Gn)[e*4+0]/256}minY(e){return n(this,Gn)[e*4+1]/256}maxX(e){return(n(this,Gn)[e*4+2]+1)/256}maxY(e){return(n(this,Gn)[e*4+3]+1)/256}}Ho=new WeakMap,Gn=new WeakMap;const fd=(d,e)=>{if(!d)return;let t=d.get(e);return t||(t={dependencies:new Set,isRenderingOperation:!1},d.set(e,t)),t};var Xe,Ye,Qr,Ws,Zr,Ki,wt,Tt,Ji,Ke,Jh,$o,qr,ta,Qi,Oe,vi,Qh,Sf;class py{constructor(e,t,s=!1){y(this,Qh);y(this,Xe,{__proto__:null});y(this,Ye,{__proto__:null,transform:[],moveText:[],sameLineText:[],[Va]:[]});y(this,Qr,new Map);y(this,Ws,[]);y(this,Zr,[]);y(this,Ki,[[1,0,0,1,0,0]]);y(this,wt,[-1/0,-1/0,1/0,1/0]);y(this,Tt,new Float64Array([1/0,1/0,-1/0,-1/0]));y(this,Ji,-1);y(this,Ke,new Set);y(this,Jh,new Map);y(this,$o,new Map);y(this,qr);y(this,ta);y(this,Qi);y(this,Oe);y(this,vi);g(this,qr,e.width),g(this,ta,e.height),w(this,Qh,Sf).call(this,t),s&&g(this,vi,new Map)}growOperationsCount(e){e>=n(this,Oe).length&&w(this,Qh,Sf).call(this,e,n(this,Oe))}save(e){return g(this,Xe,{__proto__:n(this,Xe)}),g(this,Ye,{__proto__:n(this,Ye),transform:{__proto__:n(this,Ye).transform},moveText:{__proto__:n(this,Ye).moveText},sameLineText:{__proto__:n(this,Ye).sameLineText},[Va]:{__proto__:n(this,Ye)[Va]}}),g(this,wt,{__proto__:n(this,wt)}),n(this,Ws).push(e),this}restore(e){var i;const t=Object.getPrototypeOf(n(this,Xe));if(t===null)return this;g(this,Xe,t),g(this,Ye,Object.getPrototypeOf(n(this,Ye))),g(this,wt,Object.getPrototypeOf(n(this,wt)));const s=n(this,Ws).pop();return s!==void 0&&((i=fd(n(this,vi),e))==null||i.dependencies.add(s),n(this,Oe)[e]=n(this,Oe)[s]),this}recordOpenMarker(e){return n(this,Ws).push(e),this}getOpenMarker(){return n(this,Ws).length===0?null:n(this,Ws).at(-1)}recordCloseMarker(e){var s;const t=n(this,Ws).pop();return t!==void 0&&((s=fd(n(this,vi),e))==null||s.dependencies.add(t),n(this,Oe)[e]=n(this,Oe)[t]),this}beginMarkedContent(e){return n(this,Zr).push(e),this}endMarkedContent(e){var s;const t=n(this,Zr).pop();return t!==void 0&&((s=fd(n(this,vi),e))==null||s.dependencies.add(t),n(this,Oe)[e]=n(this,Oe)[t]),this}pushBaseTransform(e){return n(this,Ki).push(j.multiplyByDOMMatrix(n(this,Ki).at(-1),e.getTransform())),this}popBaseTransform(){return n(this,Ki).length>1&&n(this,Ki).pop(),this}recordSimpleData(e,t){return n(this,Xe)[e]=t,this}recordIncrementalData(e,t){return n(this,Ye)[e].push(t),this}resetIncrementalData(e,t){return n(this,Ye)[e].length=0,this}recordNamedData(e,t){return n(this,Qr).set(e,t),this}recordSimpleDataFromNamed(e,t,s){n(this,Xe)[e]=n(this,Qr).get(t)??s}recordFutureForcedDependency(e,t){return this.recordIncrementalData(Va,t),this}inheritSimpleDataAsFutureForcedDependencies(e){for(const t of e)t in n(this,Xe)&&this.recordFutureForcedDependency(t,n(this,Xe)[t]);return this}inheritPendingDependenciesAsFutureForcedDependencies(){for(const e of n(this,Ke))this.recordFutureForcedDependency(Va,e);return this}resetBBox(e){return n(this,Ji)!==e&&(g(this,Ji,e),n(this,Tt)[0]=1/0,n(this,Tt)[1]=1/0,n(this,Tt)[2]=-1/0,n(this,Tt)[3]=-1/0),this}recordClipBox(e,t,s,i,r,a){const o=j.multiplyByDOMMatrix(n(this,Ki).at(-1),t.getTransform()),l=[1/0,1/0,-1/0,-1/0];j.axialAlignedBoundingBox([s,r,i,a],o,l);const h=j.intersect(n(this,wt),l);return h?(n(this,wt)[0]=h[0],n(this,wt)[1]=h[1],n(this,wt)[2]=h[2],n(this,wt)[3]=h[3]):(n(this,wt)[0]=n(this,wt)[1]=1/0,n(this,wt)[2]=n(this,wt)[3]=-1/0),this}recordBBox(e,t,s,i,r,a){const o=n(this,wt);if(o[0]===1/0)return this;const l=j.multiplyByDOMMatrix(n(this,Ki).at(-1),t.getTransform());if(o[0]===-1/0)return j.axialAlignedBoundingBox([s,r,i,a],l,n(this,Tt)),this;const h=[1/0,1/0,-1/0,-1/0];return j.axialAlignedBoundingBox([s,r,i,a],l,h),n(this,Tt)[0]=Math.min(n(this,Tt)[0],Math.max(h[0],o[0])),n(this,Tt)[1]=Math.min(n(this,Tt)[1],Math.max(h[1],o[1])),n(this,Tt)[2]=Math.max(n(this,Tt)[2],Math.min(h[2],o[2])),n(this,Tt)[3]=Math.max(n(this,Tt)[3],Math.min(h[3],o[3])),this}recordCharacterBBox(e,t,s,i=1,r=0,a=0,o){const l=s.bbox;let h,c;if(l&&(h=l[2]!==l[0]&&l[3]!==l[1]&&n(this,$o).get(s),h!==!1&&(c=[0,0,0,0],j.axialAlignedBoundingBox(l,s.fontMatrix,c),(i!==1||r!==0||a!==0)&&j.scaleMinMax([i,0,0,-i,r,a],c),h)))return this.recordBBox(e,t,c[0],c[2],c[1],c[3]);if(!o)return this.recordFullPageBBox(e);const u=o();return l&&c&&h===void 0&&(h=c[0]<=r-u.actualBoundingBoxLeft&&c[2]>=r+u.actualBoundingBoxRight&&c[1]<=a-u.actualBoundingBoxAscent&&c[3]>=a+u.actualBoundingBoxDescent,n(this,$o).set(s,h),h)?this.recordBBox(e,t,c[0],c[2],c[1],c[3]):this.recordBBox(e,t,r-u.actualBoundingBoxLeft,r+u.actualBoundingBoxRight,a-u.actualBoundingBoxAscent,a+u.actualBoundingBoxDescent)}recordFullPageBBox(e){return n(this,Tt)[0]=Math.max(0,n(this,wt)[0]),n(this,Tt)[1]=Math.max(0,n(this,wt)[1]),n(this,Tt)[2]=Math.min(n(this,qr),n(this,wt)[2]),n(this,Tt)[3]=Math.min(n(this,ta),n(this,wt)[3]),this}getSimpleIndex(e){return n(this,Xe)[e]}recordDependencies(e,t){const s=n(this,Ke),i=n(this,Xe),r=n(this,Ye);for(const a of t)a in n(this,Xe)?s.add(i[a]):a in r&&r[a].forEach(s.add,s);return this}recordNamedDependency(e,t){return n(this,Qr).has(t)&&n(this,Ke).add(n(this,Qr).get(t)),this}recordOperation(e,t=!1){if(this.recordDependencies(e,[Va]),n(this,vi)){const s=fd(n(this,vi),e),{dependencies:i}=s;n(this,Ke).forEach(i.add,i),n(this,Ws).forEach(i.add,i),n(this,Zr).forEach(i.add,i),i.delete(e),s.isRenderingOperation=!0}if(n(this,Ji)===e){const s=Qp(n(this,Tt)[0]*256/n(this,qr)),i=Qp(n(this,Tt)[1]*256/n(this,ta)),r=Zp(n(this,Tt)[2]*256/n(this,qr)),a=Zp(n(this,Tt)[3]*256/n(this,ta));ud(n(this,Qi),e,s,i,r,a);for(const o of n(this,Ke))o!==e&&ud(n(this,Qi),o,s,i,r,a);for(const o of n(this,Ws))o!==e&&ud(n(this,Qi),o,s,i,r,a);for(const o of n(this,Zr))o!==e&&ud(n(this,Qi),o,s,i,r,a);t||(n(this,Ke).clear(),g(this,Ji,-1))}return this}recordShowTextOperation(e,t=!1){const s=Array.from(n(this,Ke));this.recordOperation(e,t),this.recordIncrementalData("sameLineText",e);for(const i of s)this.recordIncrementalData("sameLineText",i);return this}bboxToClipBoxDropOperation(e,t=!1){return n(this,Ji)===e&&(g(this,Ji,-1),n(this,wt)[0]=Math.max(n(this,wt)[0],n(this,Tt)[0]),n(this,wt)[1]=Math.max(n(this,wt)[1],n(this,Tt)[1]),n(this,wt)[2]=Math.min(n(this,wt)[2],n(this,Tt)[2]),n(this,wt)[3]=Math.min(n(this,wt)[3],n(this,Tt)[3]),t||n(this,Ke).clear()),this}_takePendingDependencies(){const e=n(this,Ke);return g(this,Ke,new Set),e}_extractOperation(e){const t=n(this,Jh).get(e);return n(this,Jh).delete(e),t}_pushPendingDependencies(e){for(const t of e)n(this,Ke).add(t)}take(){return n(this,$o).clear(),new fy(n(this,Oe),n(this,Qi))}takeDebugMetadata(){return n(this,vi)}}Xe=new WeakMap,Ye=new WeakMap,Qr=new WeakMap,Ws=new WeakMap,Zr=new WeakMap,Ki=new WeakMap,wt=new WeakMap,Tt=new WeakMap,Ji=new WeakMap,Ke=new WeakMap,Jh=new WeakMap,$o=new WeakMap,qr=new WeakMap,ta=new WeakMap,Qi=new WeakMap,Oe=new WeakMap,vi=new WeakMap,Qh=new WeakSet,Sf=function(e,t){const s=new ArrayBuffer(e*4);g(this,Qi,new Uint8ClampedArray(s)),g(this,Oe,new Uint32Array(s)),t&&t.length>0?(n(this,Oe).set(t),n(this,Oe).fill(Ef,t.length)):n(this,Oe).fill(Ef)};var Dt,Wt,Xs,jo,zo;const Lp=class Lp{constructor(e,t,s){y(this,Dt);y(this,Wt);y(this,Xs);y(this,jo,0);y(this,zo,0);if(e instanceof Lp&&n(e,Xs)===!!s)return e;g(this,Dt,e),g(this,Wt,t),g(this,Xs,!!s)}growOperationsCount(){throw new Error("Unreachable")}save(e){return ie(this,zo)._++,n(this,Dt).save(n(this,Wt)),this}restore(e){return n(this,zo)>0&&(n(this,Dt).restore(n(this,Wt)),ie(this,zo)._--),this}recordOpenMarker(e){return ie(this,jo)._++,this}getOpenMarker(){return n(this,jo)>0?n(this,Wt):n(this,Dt).getOpenMarker()}recordCloseMarker(e){return ie(this,jo)._--,this}beginMarkedContent(e){return this}endMarkedContent(e){return this}pushBaseTransform(e){return n(this,Dt).pushBaseTransform(e),this}popBaseTransform(){return n(this,Dt).popBaseTransform(),this}recordSimpleData(e,t){return n(this,Dt).recordSimpleData(e,n(this,Wt)),this}recordIncrementalData(e,t){return n(this,Dt).recordIncrementalData(e,n(this,Wt)),this}resetIncrementalData(e,t){return n(this,Dt).resetIncrementalData(e,n(this,Wt)),this}recordNamedData(e,t){return this}recordSimpleDataFromNamed(e,t,s){return n(this,Dt).recordSimpleDataFromNamed(e,t,n(this,Wt)),this}recordFutureForcedDependency(e,t){return n(this,Dt).recordFutureForcedDependency(e,n(this,Wt)),this}inheritSimpleDataAsFutureForcedDependencies(e){return n(this,Dt).inheritSimpleDataAsFutureForcedDependencies(e),this}inheritPendingDependenciesAsFutureForcedDependencies(){return n(this,Dt).inheritPendingDependenciesAsFutureForcedDependencies(),this}resetBBox(e){return n(this,Xs)||n(this,Dt).resetBBox(n(this,Wt)),this}recordClipBox(e,t,s,i,r,a){return n(this,Xs)||n(this,Dt).recordClipBox(n(this,Wt),t,s,i,r,a),this}recordBBox(e,t,s,i,r,a){return n(this,Xs)||n(this,Dt).recordBBox(n(this,Wt),t,s,i,r,a),this}recordCharacterBBox(e,t,s,i,r,a,o){return n(this,Xs)||n(this,Dt).recordCharacterBBox(n(this,Wt),t,s,i,r,a,o),this}recordFullPageBBox(e){return n(this,Xs)||n(this,Dt).recordFullPageBBox(n(this,Wt)),this}getSimpleIndex(e){return n(this,Dt).getSimpleIndex(e)}recordDependencies(e,t){return n(this,Dt).recordDependencies(n(this,Wt),t),this}recordNamedDependency(e,t){return n(this,Dt).recordNamedDependency(n(this,Wt),t),this}recordOperation(e){return n(this,Dt).recordOperation(n(this,Wt),!0),this}recordShowTextOperation(e){return n(this,Dt).recordShowTextOperation(n(this,Wt),!0),this}bboxToClipBoxDropOperation(e){return n(this,Xs)||n(this,Dt).bboxToClipBoxDropOperation(n(this,Wt),!0),this}take(){throw new Error("Unreachable")}takeDebugMetadata(){throw new Error("Unreachable")}};Dt=new WeakMap,Wt=new WeakMap,Xs=new WeakMap,jo=new WeakMap,zo=new WeakMap;let nu=Lp;const Ts={stroke:["path","transform","filter","strokeColor","strokeAlpha","lineWidth","lineCap","lineJoin","miterLimit","dash"],fill:["path","transform","filter","fillColor","fillAlpha","globalCompositeOperation","SMask"],imageXObject:["transform","SMask","filter","fillAlpha","strokeAlpha","globalCompositeOperation"],rawFillPath:["filter","fillColor","fillAlpha"],showText:["transform","leading","charSpacing","wordSpacing","hScale","textRise","moveText","textMatrix","font","fontObj","filter","fillColor","textRenderingMode","SMask","fillAlpha","strokeAlpha","globalCompositeOperation","sameLineText"],transform:["transform"],transformAndFill:["transform","fillColor"]},xe={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function xf(d,e){if(!e)return;const t=e[2]-e[0],s=e[3]-e[1],i=new Path2D;i.rect(e[0],e[1],t,s),d.clip(i)}class Cp{isModifyingCurrentTransform(){return!1}getPattern(){Ot("Abstract method `getPattern` called.")}}class gy extends Cp{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}isOriginBased(){return this._p0[0]===0&&this._p0[1]===0&&(!this.isRadial()||this._p1[0]===0&&this._p1[1]===0)}isRadial(){return this._type==="radial"}_createGradient(e,t=null){let s,i=this._p0,r=this._p1;if(t&&(i=i.slice(),r=r.slice(),j.applyTransform(i,t),j.applyTransform(r,t)),this._type==="axial")s=e.createLinearGradient(i[0],i[1],r[0],r[1]);else if(this._type==="radial"){let a=this._r0,o=this._r1;if(t){const l=new Float32Array(2);j.singularValueDecompose2dScale(t,l),a*=l[0],o*=l[0]}s=e.createRadialGradient(i[0],i[1],a,r[0],r[1],o)}for(const a of this._colorStops)s.addColorStop(a[0],a[1]);return s}getPattern(e,t,s,i){let r;if(i===xe.STROKE||i===xe.FILL){if(this.isOriginBased()){let f=j.transform(s,t.baseTransform);this.matrix&&(f=j.transform(f,this.matrix));const p=.001,v=Math.hypot(f[0],f[1]),m=Math.hypot(f[2],f[3]),A=(f[0]*f[2]+f[1]*f[3])/(v*m);if(Math.abs(A)<p)if(this.isRadial()){if(Math.abs(v-m)<p)return this._createGradient(e,f)}else return this._createGradient(e,f)}const a=t.current.getClippedPathBoundingBox(i,zt(e))||[0,0,0,0],o=Math.ceil(a[2]-a[0])||1,l=Math.ceil(a[3]-a[1])||1,h=t.cachedCanvases.getCanvas("pattern",o,l),c=h.context;c.clearRect(0,0,c.canvas.width,c.canvas.height),c.beginPath(),c.rect(0,0,c.canvas.width,c.canvas.height),c.translate(-a[0],-a[1]),s=j.transform(s,[1,0,0,1,a[0],a[1]]),c.transform(...t.baseTransform),this.matrix&&c.transform(...this.matrix),xf(c,this._bbox),c.fillStyle=this._createGradient(c),c.fill(),r=e.createPattern(h.canvas,"no-repeat");const u=new DOMMatrix(s);r.setTransform(u)}else xf(e,this._bbox),r=this._createGradient(e);return r}}function ju(d,e,t,s,i,r,a,o){const l=e.coords,h=e.colors,c=d.data,u=d.width*4;let f;l[t+1]>l[s+1]&&(f=t,t=s,s=f,f=r,r=a,a=f),l[s+1]>l[i+1]&&(f=s,s=i,i=f,f=a,a=o,o=f),l[t+1]>l[s+1]&&(f=t,t=s,s=f,f=r,r=a,a=f);const p=(l[t]+e.offsetX)*e.scaleX,v=(l[t+1]+e.offsetY)*e.scaleY,m=(l[s]+e.offsetX)*e.scaleX,A=(l[s+1]+e.offsetY)*e.scaleY,b=(l[i]+e.offsetX)*e.scaleX,S=(l[i+1]+e.offsetY)*e.scaleY;if(v>=S)return;const E=h[r],T=h[r+1],x=h[r+2],C=h[a],R=h[a+1],I=h[a+2],P=h[o],M=h[o+1],D=h[o+2],_=Math.round(v),k=Math.round(S);let N,G,B,L,z,nt,ht,Pt;for(let Z=_;Z<=k;Z++){if(Z<A){const O=Z<v?0:(v-Z)/(v-A);N=p-(p-m)*O,G=E-(E-C)*O,B=T-(T-R)*O,L=x-(x-I)*O}else{let O;Z>S?O=1:A===S?O=0:O=(A-Z)/(A-S),N=m-(m-b)*O,G=C-(C-P)*O,B=R-(R-M)*O,L=I-(I-D)*O}let ot;Z<v?ot=0:Z>S?ot=1:ot=(v-Z)/(v-S),z=p-(p-b)*ot,nt=E-(E-P)*ot,ht=T-(T-M)*ot,Pt=x-(x-D)*ot;const bt=Math.round(Math.min(N,z)),gt=Math.round(Math.max(N,z));let U=u*Z+bt*4;for(let O=bt;O<=gt;O++)ot=(N-O)/(N-z),ot<0?ot=0:ot>1&&(ot=1),c[U++]=G-(G-nt)*ot|0,c[U++]=B-(B-ht)*ot|0,c[U++]=L-(L-Pt)*ot|0,c[U++]=255}}function my(d,e,t){const s=e.coords,i=e.colors;let r,a;switch(e.type){case Yu.LATTICE:const o=e.verticesPerRow,l=Math.floor(s.length/o)-1,h=o-1;for(r=0;r<l;r++){let c=r*o;for(let u=0;u<h;u++,c++)ju(d,t,s[c],s[c+1],s[c+o],i[c],i[c+1],i[c+o]),ju(d,t,s[c+o+1],s[c+1],s[c+o],i[c+o+1],i[c+1],i[c+o])}break;case Yu.TRIANGLES:for(r=0,a=s.length;r<a;r+=3)ju(d,t,s[r],s[r+1],s[r+2],i[r],i[r+1],i[r+2]);break;default:throw new Error("illegal figure")}}class vy extends Cp{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[6],this._background=e[7],this.matrix=null}_createMeshCanvas(e,t,s){const o=Math.floor(this._bounds[0]),l=Math.floor(this._bounds[1]),h=Math.ceil(this._bounds[2])-o,c=Math.ceil(this._bounds[3])-l,u=Math.min(Math.ceil(Math.abs(h*e[0]*1.1)),3e3),f=Math.min(Math.ceil(Math.abs(c*e[1]*1.1)),3e3),p=h/u,v=c/f,m={coords:this._coords,colors:this._colors,offsetX:-o,offsetY:-l,scaleX:1/p,scaleY:1/v},A=u+2*2,b=f+2*2,S=s.getCanvas("mesh",A,b),E=S.context,T=E.createImageData(u,f);if(t){const C=T.data;for(let R=0,I=C.length;R<I;R+=4)C[R]=t[0],C[R+1]=t[1],C[R+2]=t[2],C[R+3]=255}for(const C of this._figures)my(T,C,m);return E.putImageData(T,2,2),{canvas:S.canvas,offsetX:o-2*p,offsetY:l-2*v,scaleX:p,scaleY:v}}isModifyingCurrentTransform(){return!0}getPattern(e,t,s,i){xf(e,this._bbox);const r=new Float32Array(2);if(i===xe.SHADING)j.singularValueDecompose2dScale(zt(e),r);else if(this.matrix){j.singularValueDecompose2dScale(this.matrix,r);const[o,l]=r;j.singularValueDecompose2dScale(t.baseTransform,r),r[0]*=o,r[1]*=l}else j.singularValueDecompose2dScale(t.baseTransform,r);const a=this._createMeshCanvas(r,i===xe.SHADING?null:this._background,t.cachedCanvases);return i!==xe.SHADING&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(a.offsetX,a.offsetY),e.scale(a.scaleX,a.scaleY),e.createPattern(a.canvas,"no-repeat")}}class yy extends Cp{getPattern(){return"hotpink"}}function by(d){switch(d[0]){case"RadialAxial":return new gy(d);case"Mesh":return new vy(d);case"Dummy":return new yy}throw new Error(`Unknown IR type: ${d[0]}`)}const qp={COLORED:1,UNCOLORED:2},bu=class bu{constructor(e,t,s,i){this.color=e[1],this.operatorList=e[2],this.matrix=e[3],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.ctx=t,this.canvasGraphicsFactory=s,this.baseTransform=i}createPatternCanvas(e,t){var nt,ht;const{bbox:s,operatorList:i,paintType:r,tilingType:a,color:o,canvasGraphicsFactory:l}=this;let{xstep:h,ystep:c}=this;h=Math.abs(h),c=Math.abs(c),Ou("TilingType: "+a);const u=s[0],f=s[1],p=s[2],v=s[3],m=p-u,A=v-f,b=new Float32Array(2);j.singularValueDecompose2dScale(this.matrix,b);const[S,E]=b;j.singularValueDecompose2dScale(this.baseTransform,b);const T=S*b[0],x=E*b[1];let C=m,R=A,I=!1,P=!1;const M=Math.ceil(h*T),D=Math.ceil(c*x),_=Math.ceil(m*T),k=Math.ceil(A*x);M>=_?C=h:I=!0,D>=k?R=c:P=!0;const N=this.getSizeAndScale(C,this.ctx.canvas.width,T),G=this.getSizeAndScale(R,this.ctx.canvas.height,x),B=e.cachedCanvases.getCanvas("pattern",N.size,G.size),L=B.context,z=l.createCanvasGraphics(L,t);if(z.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(z,r,o),L.translate(-N.scale*u,-G.scale*f),z.transform(0,N.scale,0,0,G.scale,0,0),L.save(),(nt=z.dependencyTracker)==null||nt.save(),this.clipBbox(z,u,f,p,v),z.baseTransform=zt(z.ctx),z.executeOperatorList(i),z.endDrawing(),(ht=z.dependencyTracker)==null||ht.restore(),L.restore(),I||P){const Pt=B.canvas;I&&(C=h),P&&(R=c);const Z=this.getSizeAndScale(C,this.ctx.canvas.width,T),ot=this.getSizeAndScale(R,this.ctx.canvas.height,x),bt=Z.size,gt=ot.size,U=e.cachedCanvases.getCanvas("pattern-workaround",bt,gt),O=U.context,$=I?Math.floor(m/h):0,q=P?Math.floor(A/c):0;for(let mt=0;mt<=$;mt++)for(let Y=0;Y<=q;Y++)O.drawImage(Pt,bt*mt,gt*Y,bt,gt,0,0,bt,gt);return{canvas:U.canvas,scaleX:Z.scale,scaleY:ot.scale,offsetX:u,offsetY:f}}return{canvas:B.canvas,scaleX:N.scale,scaleY:G.scale,offsetX:u,offsetY:f}}getSizeAndScale(e,t,s){const i=Math.max(bu.MAX_PATTERN_SIZE,t);let r=Math.ceil(e*s);return r>=i?r=i:s=r/e,{scale:s,size:r}}clipBbox(e,t,s,i,r){const a=i-t,o=r-s;e.ctx.rect(t,s,a,o),j.axialAlignedBoundingBox([t,s,i,r],zt(e.ctx),e.current.minMax),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,t,s){const i=e.ctx,r=e.current;switch(t){case qp.COLORED:const{fillStyle:a,strokeStyle:o}=this.ctx;i.fillStyle=r.fillColor=a,i.strokeStyle=r.strokeColor=o;break;case qp.UNCOLORED:i.fillStyle=i.strokeStyle=s,r.fillColor=r.strokeColor=s;break;default:throw new Mv(`Unsupported paint type: ${t}`)}}isModifyingCurrentTransform(){return!1}getPattern(e,t,s,i,r){let a=s;i!==xe.SHADING&&(a=j.transform(a,t.baseTransform),this.matrix&&(a=j.transform(a,this.matrix)));const o=this.createPatternCanvas(t,r);let l=new DOMMatrix(a);l=l.translate(o.offsetX,o.offsetY),l=l.scale(1/o.scaleX,1/o.scaleY);const h=e.createPattern(o.canvas,"repeat");return h.setTransform(l),h}};F(bu,"MAX_PATTERN_SIZE",3e3);let Tf=bu;function Ay({src:d,srcPos:e=0,dest:t,width:s,height:i,nonBlackColor:r=4294967295,inverseDecode:a=!1}){const o=he.isLittleEndian?4278190080:255,[l,h]=a?[r,o]:[o,r],c=s>>3,u=s&7,f=d.length;t=new Uint32Array(t.buffer);let p=0;for(let v=0;v<i;v++){for(const A=e+c;e<A;e++){const b=e<f?d[e]:255;t[p++]=b&128?h:l,t[p++]=b&64?h:l,t[p++]=b&32?h:l,t[p++]=b&16?h:l,t[p++]=b&8?h:l,t[p++]=b&4?h:l,t[p++]=b&2?h:l,t[p++]=b&1?h:l}if(u===0)continue;const m=e<f?d[e++]:255;for(let A=0;A<u;A++)t[p++]=m&1<<7-A?h:l}return{srcPos:e,destPos:p}}const tg=16,eg=100,wy=15,sg=10,Ze=16,zu=new DOMMatrix,As=new Float32Array(2),eo=new Float32Array([1/0,1/0,-1/0,-1/0]);function Ey(d,e){if(d._removeMirroring)throw new Error("Context is already forwarding operations.");d.__originalSave=d.save,d.__originalRestore=d.restore,d.__originalRotate=d.rotate,d.__originalScale=d.scale,d.__originalTranslate=d.translate,d.__originalTransform=d.transform,d.__originalSetTransform=d.setTransform,d.__originalResetTransform=d.resetTransform,d.__originalClip=d.clip,d.__originalMoveTo=d.moveTo,d.__originalLineTo=d.lineTo,d.__originalBezierCurveTo=d.bezierCurveTo,d.__originalRect=d.rect,d.__originalClosePath=d.closePath,d.__originalBeginPath=d.beginPath,d._removeMirroring=()=>{d.save=d.__originalSave,d.restore=d.__originalRestore,d.rotate=d.__originalRotate,d.scale=d.__originalScale,d.translate=d.__originalTranslate,d.transform=d.__originalTransform,d.setTransform=d.__originalSetTransform,d.resetTransform=d.__originalResetTransform,d.clip=d.__originalClip,d.moveTo=d.__originalMoveTo,d.lineTo=d.__originalLineTo,d.bezierCurveTo=d.__originalBezierCurveTo,d.rect=d.__originalRect,d.closePath=d.__originalClosePath,d.beginPath=d.__originalBeginPath,delete d._removeMirroring},d.save=function(){e.save(),this.__originalSave()},d.restore=function(){e.restore(),this.__originalRestore()},d.translate=function(t,s){e.translate(t,s),this.__originalTranslate(t,s)},d.scale=function(t,s){e.scale(t,s),this.__originalScale(t,s)},d.transform=function(t,s,i,r,a,o){e.transform(t,s,i,r,a,o),this.__originalTransform(t,s,i,r,a,o)},d.setTransform=function(t,s,i,r,a,o){e.setTransform(t,s,i,r,a,o),this.__originalSetTransform(t,s,i,r,a,o)},d.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},d.rotate=function(t){e.rotate(t),this.__originalRotate(t)},d.clip=function(t){e.clip(t),this.__originalClip(t)},d.moveTo=function(t,s){e.moveTo(t,s),this.__originalMoveTo(t,s)},d.lineTo=function(t,s){e.lineTo(t,s),this.__originalLineTo(t,s)},d.bezierCurveTo=function(t,s,i,r,a,o){e.bezierCurveTo(t,s,i,r,a,o),this.__originalBezierCurveTo(t,s,i,r,a,o)},d.rect=function(t,s,i,r){e.rect(t,s,i,r),this.__originalRect(t,s,i,r)},d.closePath=function(){e.closePath(),this.__originalClosePath()},d.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}class Sy{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,s){let i;return this.cache[e]!==void 0?(i=this.cache[e],this.canvasFactory.reset(i,t,s)):(i=this.canvasFactory.create(t,s),this.cache[e]=i),i}delete(e){delete this.cache[e]}clear(){for(const e in this.cache){const t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}}function pd(d,e,t,s,i,r,a,o,l,h){const[c,u,f,p,v,m]=zt(d);if(u===0&&f===0){const S=a*c+v,E=Math.round(S),T=o*p+m,x=Math.round(T),C=(a+l)*c+v,R=Math.abs(Math.round(C)-E)||1,I=(o+h)*p+m,P=Math.abs(Math.round(I)-x)||1;return d.setTransform(Math.sign(c),0,0,Math.sign(p),E,x),d.drawImage(e,t,s,i,r,0,0,R,P),d.setTransform(c,u,f,p,v,m),[R,P]}if(c===0&&p===0){const S=o*f+v,E=Math.round(S),T=a*u+m,x=Math.round(T),C=(o+h)*f+v,R=Math.abs(Math.round(C)-E)||1,I=(a+l)*u+m,P=Math.abs(Math.round(I)-x)||1;return d.setTransform(0,Math.sign(u),Math.sign(f),0,E,x),d.drawImage(e,t,s,i,r,0,0,P,R),d.setTransform(c,u,f,p,v,m),[P,R]}d.drawImage(e,t,s,i,r,a,o,l,h);const A=Math.hypot(c,u),b=Math.hypot(f,p);return[A*l,b*h]}class ig{constructor(e,t,s){F(this,"alphaIsShape",!1);F(this,"fontSize",0);F(this,"fontSizeScale",1);F(this,"textMatrix",null);F(this,"textMatrixScale",1);F(this,"fontMatrix",Xu);F(this,"leading",0);F(this,"x",0);F(this,"y",0);F(this,"lineX",0);F(this,"lineY",0);F(this,"charSpacing",0);F(this,"wordSpacing",0);F(this,"textHScale",1);F(this,"textRenderingMode",ne.FILL);F(this,"textRise",0);F(this,"fillColor","#000000");F(this,"strokeColor","#000000");F(this,"patternFill",!1);F(this,"patternStroke",!1);F(this,"fillAlpha",1);F(this,"strokeAlpha",1);F(this,"lineWidth",1);F(this,"activeSMask",null);F(this,"transferMaps","none");s==null||s(this),this.clipBox=new Float32Array([0,0,e,t]),this.minMax=eo.slice()}clone(){const e=Object.create(this);return e.clipBox=this.clipBox.slice(),e.minMax=this.minMax.slice(),e}getPathBoundingBox(e=xe.FILL,t=null){const s=this.minMax.slice();if(e===xe.STROKE){t||Ot("Stroke bounding box must include transform."),j.singularValueDecompose2dScale(t,As);const i=As[0]*this.lineWidth/2,r=As[1]*this.lineWidth/2;s[0]-=i,s[1]-=r,s[2]+=i,s[3]+=r}return s}updateClipFromPath(){const e=j.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minMax[0]===1/0}startNewPathAndClipBox(e){this.clipBox.set(e,0),this.minMax.set(eo,0)}getClippedPathBoundingBox(e=xe.FILL,t=null){return j.intersect(this.clipBox,this.getPathBoundingBox(e,t))}}function ng(d,e){if(e instanceof ImageData){d.putImageData(e,0,0);return}const t=e.height,s=e.width,i=t%Ze,r=(t-i)/Ze,a=i===0?r:r+1,o=d.createImageData(s,Ze);let l=0,h;const c=e.data,u=o.data;let f,p,v,m;if(e.kind===yd.GRAYSCALE_1BPP){const A=c.byteLength,b=new Uint32Array(u.buffer,0,u.byteLength>>2),S=b.length,E=s+7>>3,T=4294967295,x=he.isLittleEndian?4278190080:255;for(f=0;f<a;f++){for(v=f<r?Ze:i,h=0,p=0;p<v;p++){const C=A-l;let R=0;const I=C>E?s:C*8-7,P=I&-8;let M=0,D=0;for(;R<P;R+=8)D=c[l++],b[h++]=D&128?T:x,b[h++]=D&64?T:x,b[h++]=D&32?T:x,b[h++]=D&16?T:x,b[h++]=D&8?T:x,b[h++]=D&4?T:x,b[h++]=D&2?T:x,b[h++]=D&1?T:x;for(;R<I;R++)M===0&&(D=c[l++],M=128),b[h++]=D&M?T:x,M>>=1}for(;h<S;)b[h++]=0;d.putImageData(o,0,f*Ze)}}else if(e.kind===yd.RGBA_32BPP){for(p=0,m=s*Ze*4,f=0;f<r;f++)u.set(c.subarray(l,l+m)),l+=m,d.putImageData(o,0,p),p+=Ze;f<a&&(m=s*i*4,u.set(c.subarray(l,l+m)),d.putImageData(o,0,p))}else if(e.kind===yd.RGB_24BPP)for(v=Ze,m=s*v,f=0;f<a;f++){for(f>=r&&(v=i,m=s*v),h=0,p=m;p--;)u[h++]=c[l++],u[h++]=c[l++],u[h++]=c[l++],u[h++]=255;d.putImageData(o,0,f*Ze)}else throw new Error(`bad image kind: ${e.kind}`)}function rg(d,e){if(e.bitmap){d.drawImage(e.bitmap,0,0);return}const t=e.height,s=e.width,i=t%Ze,r=(t-i)/Ze,a=i===0?r:r+1,o=d.createImageData(s,Ze);let l=0;const h=e.data,c=o.data;for(let u=0;u<a;u++){const f=u<r?Ze:i;({srcPos:l}=Ay({src:h,srcPos:l,dest:c,width:s,height:f,nonBlackColor:0})),d.putImageData(o,0,u*Ze)}}function kl(d,e){const t=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const s of t)d[s]!==void 0&&(e[s]=d[s]);d.setLineDash!==void 0&&(e.setLineDash(d.getLineDash()),e.lineDashOffset=d.lineDashOffset)}function gd(d){d.strokeStyle=d.fillStyle="#000000",d.fillRule="nonzero",d.globalAlpha=1,d.lineWidth=1,d.lineCap="butt",d.lineJoin="miter",d.miterLimit=10,d.globalCompositeOperation="source-over",d.font="10px sans-serif",d.setLineDash!==void 0&&(d.setLineDash([]),d.lineDashOffset=0);const{filter:e}=d;e!=="none"&&e!==""&&(d.filter="none")}function ag(d,e){if(e)return!0;j.singularValueDecompose2dScale(d,As);const t=Math.fround(Pi.pixelRatio*mr.PDF_TO_CSS_UNITS);return As[0]<=t&&As[1]<=t}const xy=["butt","round","square"],Ty=["miter","round","bevel"],Cy={},og={};var si,Cf,Rf,Pf;const Fp=class Fp{constructor(e,t,s,i,r,{optionalContentConfig:a,markedContentStack:o=null},l,h,c){y(this,si);this.ctx=e,this.current=new ig(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=s,this.canvasFactory=i,this.filterFactory=r,this.groupStack=[],this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=o||[],this.optionalContentConfig=a,this.cachedCanvases=new Sy(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=l,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=h,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map,this.dependencyTracker=c??null}getObject(e,t,s=null){var i;return typeof t=="string"?((i=this.dependencyTracker)==null||i.recordNamedDependency(e,t),t.startsWith("g_")?this.commonObjs.get(t):this.objs.get(t)):s}beginDrawing({transform:e,viewport:t,transparency:s=!1,background:i=null}){const r=this.ctx.canvas.width,a=this.ctx.canvas.height,o=this.ctx.fillStyle;if(this.ctx.fillStyle=i||"#ffffff",this.ctx.fillRect(0,0,r,a),this.ctx.fillStyle=o,s){const l=this.cachedCanvases.getCanvas("transparent",r,a);this.compositeCtx=this.ctx,this.transparentCanvas=l.canvas,this.ctx=l.context,this.ctx.save(),this.ctx.transform(...zt(this.compositeCtx))}this.ctx.save(),gd(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...t.transform),this.viewportScale=t.scale,this.baseTransform=zt(this.ctx)}executeOperatorList(e,t,s,i,r){var b;const a=e.argsArray,o=e.fnArray;let l=t||0;const h=a.length;if(h===l)return l;const c=h-l>sg&&typeof s=="function",u=c?Date.now()+wy:0;let f=0;const p=this.commonObjs,v=this.objs;let m,A;for(;;){if(i!==void 0&&l===i.nextBreakPoint)return i.breakIt(l,s),l;if(!r||r(l))if(m=o[l],A=a[l]??null,m!==oh.dependency)A===null?this[m](l):this[m](l,...A);else for(const S of A){(b=this.dependencyTracker)==null||b.recordNamedData(S,l);const E=S.startsWith("g_")?p:v;if(!E.has(S))return E.get(S,s),l}if(l++,l===h)return l;if(c&&++f>sg){if(Date.now()>u)return s(),l;f=0}}}endDrawing(){w(this,si,Cf).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const e of this._cachedBitmapsMap.values()){for(const t of e.values())typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),w(this,si,Rf).call(this)}_scaleImage(e,t){const s=e.width??e.displayWidth,i=e.height??e.displayHeight;let r=Math.max(Math.hypot(t[0],t[1]),1),a=Math.max(Math.hypot(t[2],t[3]),1),o=s,l=i,h="prescale1",c,u;for(;r>2&&o>1||a>2&&l>1;){let f=o,p=l;r>2&&o>1&&(f=o>=16384?Math.floor(o/2)-1||1:Math.ceil(o/2),r/=o/f),a>2&&l>1&&(p=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l)/2,a/=l/p),c=this.cachedCanvases.getCanvas(h,f,p),u=c.context,u.clearRect(0,0,f,p),u.drawImage(e,0,0,o,l,0,0,f,p),e=c.canvas,o=f,l=p,h=h==="prescale1"?"prescale2":"prescale1"}return{img:e,paintWidth:o,paintHeight:l}}_createMaskCanvas(e,t){var M,D;const s=this.ctx,{width:i,height:r}=t,a=this.current.fillColor,o=this.current.patternFill,l=zt(s);let h,c,u,f;if((t.bitmap||t.data)&&t.count>1){const _=t.bitmap||t.data.buffer;c=JSON.stringify(o?l:[l.slice(0,4),a]),h=this._cachedBitmapsMap.get(_),h||(h=new Map,this._cachedBitmapsMap.set(_,h));const k=h.get(c);if(k&&!o){const N=Math.round(Math.min(l[0],l[2])+l[4]),G=Math.round(Math.min(l[1],l[3])+l[5]);return(M=this.dependencyTracker)==null||M.recordDependencies(e,Ts.transformAndFill),{canvas:k,offsetX:N,offsetY:G}}u=k}u||(f=this.cachedCanvases.getCanvas("maskCanvas",i,r),rg(f.context,t));let p=j.transform(l,[1/i,0,0,-1/r,0,0]);p=j.transform(p,[1,0,0,1,0,-r]);const v=eo.slice();j.axialAlignedBoundingBox([0,0,i,r],p,v);const[m,A,b,S]=v,E=Math.round(b-m)||1,T=Math.round(S-A)||1,x=this.cachedCanvases.getCanvas("fillCanvas",E,T),C=x.context,R=m,I=A;C.translate(-R,-I),C.transform(...p),u||(u=this._scaleImage(f.canvas,ii(C)),u=u.img,h&&o&&h.set(c,u)),C.imageSmoothingEnabled=ag(zt(C),t.interpolate),pd(C,u,0,0,u.width,u.height,0,0,i,r),C.globalCompositeOperation="source-in";const P=j.transform(ii(C),[1,0,0,1,-R,-I]);return C.fillStyle=o?a.getPattern(s,this,P,xe.FILL,e):a,C.fillRect(0,0,i,r),h&&!o&&(this.cachedCanvases.delete("fillCanvas"),h.set(c,x.canvas)),(D=this.dependencyTracker)==null||D.recordDependencies(e,Ts.transformAndFill),{canvas:x.canvas,offsetX:Math.round(R),offsetY:Math.round(I)}}setLineWidth(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("lineWidth",e),t!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=t,this.ctx.lineWidth=t}setLineCap(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("lineCap",e),this.ctx.lineCap=xy[t]}setLineJoin(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("lineJoin",e),this.ctx.lineJoin=Ty[t]}setMiterLimit(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("miterLimit",e),this.ctx.miterLimit=t}setDash(e,t,s){var r;(r=this.dependencyTracker)==null||r.recordSimpleData("dash",e);const i=this.ctx;i.setLineDash!==void 0&&(i.setLineDash(t),i.lineDashOffset=s)}setRenderingIntent(e,t){}setFlatness(e,t){}setGState(e,t){var s,i,r,a,o;for(const[l,h]of t)switch(l){case"LW":this.setLineWidth(e,h);break;case"LC":this.setLineCap(e,h);break;case"LJ":this.setLineJoin(e,h);break;case"ML":this.setMiterLimit(e,h);break;case"D":this.setDash(e,h[0],h[1]);break;case"RI":this.setRenderingIntent(e,h);break;case"FL":this.setFlatness(e,h);break;case"Font":this.setFont(e,h[0],h[1]);break;case"CA":(s=this.dependencyTracker)==null||s.recordSimpleData("strokeAlpha",e),this.current.strokeAlpha=h;break;case"ca":(i=this.dependencyTracker)==null||i.recordSimpleData("fillAlpha",e),this.ctx.globalAlpha=this.current.fillAlpha=h;break;case"BM":(r=this.dependencyTracker)==null||r.recordSimpleData("globalCompositeOperation",e),this.ctx.globalCompositeOperation=h;break;case"SMask":(a=this.dependencyTracker)==null||a.recordSimpleData("SMask",e),this.current.activeSMask=h?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":(o=this.dependencyTracker)==null||o.recordSimpleData("filter",e),this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(h);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(e){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const t=this.ctx.canvas.width,s=this.ctx.canvas.height,i="smaskGroupAt"+this.groupLevel,r=this.cachedCanvases.getCanvas(i,t,s);this.suspendedCtx=this.ctx;const a=this.ctx=r.context;a.setTransform(this.suspendedCtx.getTransform()),kl(this.suspendedCtx,a),Ey(a,this.suspendedCtx),this.setGState(e,[["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),kl(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const t=this.current.activeSMask,s=this.suspendedCtx;this.composeSMask(s,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(e,t,s,i){const r=i[0],a=i[1],o=i[2]-r,l=i[3]-a;o===0||l===0||(this.genericComposeSMask(t.context,s,o,l,t.subtype,t.backdrop,t.transferMap,r,a,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(s.canvas,0,0),e.restore())}genericComposeSMask(e,t,s,i,r,a,o,l,h,c,u){let f=e.canvas,p=l-c,v=h-u;if(a)if(p<0||v<0||p+s>f.width||v+i>f.height){const A=this.cachedCanvases.getCanvas("maskExtension",s,i),b=A.context;b.drawImage(f,-p,-v),b.globalCompositeOperation="destination-atop",b.fillStyle=a,b.fillRect(0,0,s,i),b.globalCompositeOperation="source-over",f=A.canvas,p=v=0}else{e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0);const A=new Path2D;A.rect(p,v,s,i),e.clip(A),e.globalCompositeOperation="destination-atop",e.fillStyle=a,e.fillRect(p,v,s,i),e.restore()}t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0),r==="Alpha"&&o?t.filter=this.filterFactory.addAlphaFilter(o):r==="Luminosity"&&(t.filter=this.filterFactory.addLuminosityFilter(o));const m=new Path2D;m.rect(l,h,s,i),t.clip(m),t.globalCompositeOperation="destination-in",t.drawImage(f,p,v,s,i,l,h,s,i),t.restore()}save(e){var s;this.inSMaskMode&&kl(this.ctx,this.suspendedCtx),this.ctx.save();const t=this.current;this.stateStack.push(t),this.current=t.clone(),(s=this.dependencyTracker)==null||s.save(e)}restore(e){var t;if((t=this.dependencyTracker)==null||t.restore(e),this.stateStack.length===0){this.inSMaskMode&&this.endSMaskMode();return}this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&kl(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}transform(e,t,s,i,r,a,o){var l;(l=this.dependencyTracker)==null||l.recordIncrementalData("transform",e),this.ctx.transform(t,s,i,r,a,o),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,t,s,i){let[r]=s;if(!i){r||(r=s[0]=new Path2D),this[t](e,r);return}if(this.dependencyTracker!==null){const a=t===oh.stroke?this.current.lineWidth/2:0;this.dependencyTracker.resetBBox(e).recordBBox(e,this.ctx,i[0]-a,i[2]+a,i[1]-a,i[3]+a).recordDependencies(e,["transform"])}r instanceof Path2D||(r=s[0]=Ag(r)),j.axialAlignedBoundingBox(i,zt(this.ctx),this.current.minMax),this[t](e,r),this._pathStartIdx=e}closePath(e){this.ctx.closePath()}stroke(e,t,s=!0){var a;const i=this.ctx,r=this.current.strokeColor;if(i.globalAlpha=this.current.strokeAlpha,this.contentVisible)if(typeof r=="object"&&(r!=null&&r.getPattern)){const o=r.isModifyingCurrentTransform()?i.getTransform():null;if(i.save(),i.strokeStyle=r.getPattern(i,this,ii(i),xe.STROKE,e),o){const l=new Path2D;l.addPath(t,i.getTransform().invertSelf().multiplySelf(o)),t=l}this.rescaleAndStroke(t,!1),i.restore()}else this.rescaleAndStroke(t,!0);(a=this.dependencyTracker)==null||a.recordDependencies(e,Ts.stroke),s&&this.consumePath(e,t,this.current.getClippedPathBoundingBox(xe.STROKE,zt(this.ctx))),i.globalAlpha=this.current.fillAlpha}closeStroke(e,t){this.stroke(e,t)}fill(e,t,s=!0){var h,c,u;const i=this.ctx,r=this.current.fillColor,a=this.current.patternFill;let o=!1;if(a){const f=r.isModifyingCurrentTransform()?i.getTransform():null;if((h=this.dependencyTracker)==null||h.save(e),i.save(),i.fillStyle=r.getPattern(i,this,ii(i),xe.FILL,e),f){const p=new Path2D;p.addPath(t,i.getTransform().invertSelf().multiplySelf(f)),t=p}o=!0}const l=this.current.getClippedPathBoundingBox();this.contentVisible&&l!==null&&(this.pendingEOFill?(i.fill(t,"evenodd"),this.pendingEOFill=!1):i.fill(t)),(c=this.dependencyTracker)==null||c.recordDependencies(e,Ts.fill),o&&(i.restore(),(u=this.dependencyTracker)==null||u.restore(e)),s&&this.consumePath(e,t,l)}eoFill(e,t){this.pendingEOFill=!0,this.fill(e,t)}fillStroke(e,t){this.fill(e,t,!1),this.stroke(e,t,!1),this.consumePath(e,t)}eoFillStroke(e,t){this.pendingEOFill=!0,this.fillStroke(e,t)}closeFillStroke(e,t){this.fillStroke(e,t)}closeEOFillStroke(e,t){this.pendingEOFill=!0,this.fillStroke(e,t)}endPath(e,t){this.consumePath(e,t)}rawFillPath(e,t){var s;this.ctx.fill(t),(s=this.dependencyTracker)==null||s.recordDependencies(e,Ts.rawFillPath).recordOperation(e)}clip(e){var t;(t=this.dependencyTracker)==null||t.recordFutureForcedDependency("clipMode",e),this.pendingClip=Cy}eoClip(e){var t;(t=this.dependencyTracker)==null||t.recordFutureForcedDependency("clipMode",e),this.pendingClip=og}beginText(e){var t;this.current.textMatrix=null,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0,(t=this.dependencyTracker)==null||t.recordOpenMarker(e).resetIncrementalData("sameLineText").resetIncrementalData("moveText",e)}endText(e){const t=this.pendingTextPaths,s=this.ctx;if(this.dependencyTracker){const{dependencyTracker:i}=this;t!==void 0&&i.recordFutureForcedDependency("textClip",i.getOpenMarker()).recordFutureForcedDependency("textClip",e),i.recordCloseMarker(e)}if(t!==void 0){const i=new Path2D,r=s.getTransform().invertSelf();for(const{transform:a,x:o,y:l,fontSize:h,path:c}of t)c&&i.addPath(c,new DOMMatrix(a).preMultiplySelf(r).translate(o,l).scale(h,-h));s.clip(i)}delete this.pendingTextPaths}setCharSpacing(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("charSpacing",e),this.current.charSpacing=t}setWordSpacing(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("wordSpacing",e),this.current.wordSpacing=t}setHScale(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("hScale",e),this.current.textHScale=t/100}setLeading(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("leading",e),this.current.leading=-t}setFont(e,t,s){var u,f;(u=this.dependencyTracker)==null||u.recordSimpleData("font",e).recordSimpleDataFromNamed("fontObj",t,e);const i=this.commonObjs.get(t),r=this.current;if(!i)throw new Error(`Can't find font for ${t}`);if(r.fontMatrix=i.fontMatrix||Xu,(r.fontMatrix[0]===0||r.fontMatrix[3]===0)&&J("Invalid font matrix for font "+t),s<0?(s=-s,r.fontDirection=-1):r.fontDirection=1,this.current.font=i,this.current.fontSize=s,i.isType3Font)return;const a=i.loadedName||"sans-serif",o=((f=i.systemFontInfo)==null?void 0:f.css)||`"${a}", ${i.fallbackName}`;let l="normal";i.black?l="900":i.bold&&(l="bold");const h=i.italic?"italic":"normal";let c=s;s<tg?c=tg:s>eg&&(c=eg),this.current.fontSizeScale=s/c,this.ctx.font=`${h} ${l} ${c}px ${o}`}setTextRenderingMode(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("textRenderingMode",e),this.current.textRenderingMode=t}setTextRise(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("textRise",e),this.current.textRise=t}moveText(e,t,s){var i;(i=this.dependencyTracker)==null||i.resetIncrementalData("sameLineText").recordIncrementalData("moveText",e),this.current.x=this.current.lineX+=t,this.current.y=this.current.lineY+=s}setLeadingMoveText(e,t,s){this.setLeading(e,-s),this.moveText(e,t,s)}setTextMatrix(e,t){var i;(i=this.dependencyTracker)==null||i.resetIncrementalData("sameLineText").recordSimpleData("textMatrix",e);const{current:s}=this;s.textMatrix=t,s.textMatrixScale=Math.hypot(t[0],t[1]),s.x=s.lineX=0,s.y=s.lineY=0}nextLine(e){var t;this.moveText(e,0,this.current.leading),(t=this.dependencyTracker)==null||t.recordIncrementalData("moveText",this.dependencyTracker.getSimpleIndex("leading")??e)}paintChar(e,t,s,i,r,a){var b,S,E,T;const o=this.ctx,l=this.current,h=l.font,c=l.textRenderingMode,u=l.fontSize/l.fontSizeScale,f=c&ne.FILL_STROKE_MASK,p=!!(c&ne.ADD_TO_PATH_FLAG),v=l.patternFill&&!h.missingFile,m=l.patternStroke&&!h.missingFile;let A;if((h.disableFontFace||p||v||m)&&!h.missingFile&&(A=h.getPathGenerator(this.commonObjs,t)),A&&(h.disableFontFace||v||m)){o.save(),o.translate(s,i),o.scale(u,-u),(b=this.dependencyTracker)==null||b.recordCharacterBBox(e,o,h);let x;if(f===ne.FILL||f===ne.FILL_STROKE)if(r){x=o.getTransform(),o.setTransform(...r);const C=w(this,si,Pf).call(this,A,x,r);o.fill(C)}else o.fill(A);if(f===ne.STROKE||f===ne.FILL_STROKE)if(a){x||(x=o.getTransform()),o.setTransform(...a);const{a:C,b:R,c:I,d:P}=x,M=j.inverseTransform(a),D=j.transform([C,R,I,P,0,0],M);j.singularValueDecompose2dScale(D,As),o.lineWidth*=Math.max(As[0],As[1])/u,o.stroke(w(this,si,Pf).call(this,A,x,a))}else o.lineWidth/=u,o.stroke(A);o.restore()}else(f===ne.FILL||f===ne.FILL_STROKE)&&(o.fillText(t,s,i),(S=this.dependencyTracker)==null||S.recordCharacterBBox(e,o,h,u,s,i,()=>o.measureText(t))),(f===ne.STROKE||f===ne.FILL_STROKE)&&(this.dependencyTracker&&((E=this.dependencyTracker)==null||E.recordCharacterBBox(e,o,h,u,s,i,()=>o.measureText(t)).recordDependencies(e,Ts.stroke)),o.strokeText(t,s,i));p&&((this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:zt(o),x:s,y:i,fontSize:u,path:A}),(T=this.dependencyTracker)==null||T.recordCharacterBBox(e,o,h,u,s,i))}get isFontSubpixelAAEnabled(){const{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);const t=e.getImageData(0,0,10,10).data;let s=!1;for(let i=3;i<t.length;i+=4)if(t[i]>0&&t[i]<255){s=!0;break}return Q(this,"isFontSubpixelAAEnabled",s)}showText(e,t){var D,_,k,N;this.dependencyTracker&&(this.dependencyTracker.recordDependencies(e,Ts.showText).resetBBox(e),this.current.textRenderingMode&ne.ADD_TO_PATH_FLAG&&this.dependencyTracker.recordFutureForcedDependency("textClip",e).inheritPendingDependenciesAsFutureForcedDependencies());const s=this.current,i=s.font;if(i.isType3Font){this.showType3Text(e,t),(D=this.dependencyTracker)==null||D.recordShowTextOperation(e);return}const r=s.fontSize;if(r===0){(_=this.dependencyTracker)==null||_.recordOperation(e);return}const a=this.ctx,o=s.fontSizeScale,l=s.charSpacing,h=s.wordSpacing,c=s.fontDirection,u=s.textHScale*c,f=t.length,p=i.vertical,v=p?1:-1,m=i.defaultVMetrics,A=r*s.fontMatrix[0],b=s.textRenderingMode===ne.FILL&&!i.disableFontFace&&!s.patternFill;a.save(),s.textMatrix&&a.transform(...s.textMatrix),a.translate(s.x,s.y+s.textRise),c>0?a.scale(u,-1):a.scale(u,1);let S,E;const T=s.textRenderingMode&ne.FILL_STROKE_MASK,x=T===ne.FILL||T===ne.FILL_STROKE,C=T===ne.STROKE||T===ne.FILL_STROKE;if(x&&s.patternFill){a.save();const G=s.fillColor.getPattern(a,this,ii(a),xe.FILL,e);S=zt(a),a.restore(),a.fillStyle=G}if(C&&s.patternStroke){a.save();const G=s.strokeColor.getPattern(a,this,ii(a),xe.STROKE,e);E=zt(a),a.restore(),a.strokeStyle=G}let R=s.lineWidth;const I=s.textMatrixScale;if(I===0||R===0?C&&(R=this.getSinglePixelWidth()):R/=I,o!==1&&(a.scale(o,o),R/=o),a.lineWidth=R,i.isInvalidPDFjsFont){const G=[];let B=0;for(const z of t)G.push(z.unicode),B+=z.width;const L=G.join("");if(a.fillText(L,0,0),this.dependencyTracker!==null){const z=a.measureText(L);this.dependencyTracker.recordBBox(e,this.ctx,-z.actualBoundingBoxLeft,z.actualBoundingBoxRight,-z.actualBoundingBoxAscent,z.actualBoundingBoxDescent).recordShowTextOperation(e)}s.x+=B*A*u,a.restore(),this.compose();return}let P=0,M;for(M=0;M<f;++M){const G=t[M];if(typeof G=="number"){P+=v*G*r/1e3;continue}let B=!1;const L=(G.isSpace?h:0)+l,z=G.fontChar,nt=G.accent;let ht,Pt,Z=G.width;if(p){const gt=G.vmetric||m,U=-(G.vmetric?gt[1]:Z*.5)*A,O=gt[2]*A;Z=gt?-gt[0]:Z,ht=U/o,Pt=(P+O)/o}else ht=P/o,Pt=0;let ot;if(i.remeasure&&Z>0){ot=a.measureText(z);const gt=ot.width*1e3/r*o;if(Z<gt&&this.isFontSubpixelAAEnabled){const U=Z/gt;B=!0,a.save(),a.scale(U,1),ht/=U}else Z!==gt&&(ht+=(Z-gt)/2e3*r/o)}if(this.contentVisible&&(G.isInFont||i.missingFile)){if(b&&!nt)a.fillText(z,ht,Pt),(k=this.dependencyTracker)==null||k.recordCharacterBBox(e,a,ot?{bbox:null}:i,r/o,ht,Pt,()=>ot??a.measureText(z));else if(this.paintChar(e,z,ht,Pt,S,E),nt){const gt=ht+r*nt.offset.x/o,U=Pt-r*nt.offset.y/o;this.paintChar(e,nt.fontChar,gt,U,S,E)}}const bt=p?Z*A-L*c:Z*A+L*c;P+=bt,B&&a.restore()}p?s.y-=P:s.x+=P*u,a.restore(),this.compose(),(N=this.dependencyTracker)==null||N.recordShowTextOperation(e)}showType3Text(e,t){const s=this.ctx,i=this.current,r=i.font,a=i.fontSize,o=i.fontDirection,l=r.vertical?1:-1,h=i.charSpacing,c=i.wordSpacing,u=i.textHScale*o,f=i.fontMatrix||Xu,p=t.length,v=i.textRenderingMode===ne.INVISIBLE;let m,A,b,S;if(v||a===0)return;this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,s.save(),i.textMatrix&&s.transform(...i.textMatrix),s.translate(i.x,i.y+i.textRise),s.scale(u,o);const E=this.dependencyTracker;for(this.dependencyTracker=E?new nu(E,e):null,m=0;m<p;++m){if(A=t[m],typeof A=="number"){S=l*A*a/1e3,this.ctx.translate(S,0),i.x+=S*u;continue}const T=(A.isSpace?c:0)+h,x=r.charProcOperatorList[A.operatorListId];x?this.contentVisible&&(this.save(),s.scale(a,a),s.transform(...f),this.executeOperatorList(x),this.restore()):J(`Type3 character "${A.operatorListId}" is not available.`);const C=[A.width,0];j.applyTransform(C,f),b=C[0]*a+T,s.translate(b,0),i.x+=b*u}s.restore(),E&&(this.dependencyTracker=E)}setCharWidth(e,t,s){}setCharWidthAndBounds(e,t,s,i,r,a,o){var h;const l=new Path2D;l.rect(i,r,a-i,o-r),this.ctx.clip(l),(h=this.dependencyTracker)==null||h.recordBBox(e,this.ctx,i,a,r,o).recordClipBox(e,this.ctx,i,a,r,o),this.endPath(e)}getColorN_Pattern(e,t){let s;if(t[0]==="TilingPattern"){const i=this.baseTransform||zt(this.ctx),r={createCanvasGraphics:(a,o)=>new Fp(a,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack},void 0,void 0,this.dependencyTracker?new nu(this.dependencyTracker,o,!0):null)};s=new Tf(t,this.ctx,r,i)}else s=this._getPattern(e,t[1],t[2]);return s}setStrokeColorN(e,...t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("strokeColor",e),this.current.strokeColor=this.getColorN_Pattern(e,t),this.current.patternStroke=!0}setFillColorN(e,...t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("fillColor",e),this.current.fillColor=this.getColorN_Pattern(e,t),this.current.patternFill=!0}setStrokeRGBColor(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("strokeColor",e),this.ctx.strokeStyle=this.current.strokeColor=t,this.current.patternStroke=!1}setStrokeTransparent(e){var t;(t=this.dependencyTracker)==null||t.recordSimpleData("strokeColor",e),this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("fillColor",e),this.ctx.fillStyle=this.current.fillColor=t,this.current.patternFill=!1}setFillTransparent(e){var t;(t=this.dependencyTracker)==null||t.recordSimpleData("fillColor",e),this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(e,t,s=null){let i;return this.cachedPatterns.has(t)?i=this.cachedPatterns.get(t):(i=by(this.getObject(e,t)),this.cachedPatterns.set(t,i)),s&&(i.matrix=s),i}shadingFill(e,t){var a;if(!this.contentVisible)return;const s=this.ctx;this.save(e);const i=this._getPattern(e,t);s.fillStyle=i.getPattern(s,this,ii(s),xe.SHADING,e);const r=ii(s);if(r){const{width:o,height:l}=s.canvas,h=eo.slice();j.axialAlignedBoundingBox([0,0,o,l],r,h);const[c,u,f,p]=h;this.ctx.fillRect(c,u,f-c,p-u)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);(a=this.dependencyTracker)==null||a.resetBBox(e).recordFullPageBBox(e).recordDependencies(e,Ts.transform).recordDependencies(e,Ts.fill).recordOperation(e),this.compose(this.current.getClippedPathBoundingBox()),this.restore(e)}beginInlineImage(){Ot("Should not call beginInlineImage")}beginImageData(){Ot("Should not call beginImageData")}paintFormXObjectBegin(e,t,s){var i;if(this.contentVisible&&(this.save(e),this.baseTransformStack.push(this.baseTransform),t&&this.transform(e,...t),this.baseTransform=zt(this.ctx),s)){j.axialAlignedBoundingBox(s,this.baseTransform,this.current.minMax);const[r,a,o,l]=s,h=new Path2D;h.rect(r,a,o-r,l-a),this.ctx.clip(h),(i=this.dependencyTracker)==null||i.recordClipBox(e,this.ctx,r,o,a,l),this.endPath(e)}}paintFormXObjectEnd(e){this.contentVisible&&(this.restore(e),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e,t){var E;if(!this.contentVisible)return;this.save(e),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const s=this.ctx;t.isolated||Ou("TODO: Support non-isolated groups."),t.knockout&&J("Knockout groups not supported.");const i=zt(s);if(t.matrix&&s.transform(...t.matrix),!t.bbox)throw new Error("Bounding box is required.");let r=eo.slice();j.axialAlignedBoundingBox(t.bbox,zt(s),r);const a=[0,0,s.canvas.width,s.canvas.height];r=j.intersect(r,a)||[0,0,0,0];const o=Math.floor(r[0]),l=Math.floor(r[1]),h=Math.max(Math.ceil(r[2])-o,1),c=Math.max(Math.ceil(r[3])-l,1);this.current.startNewPathAndClipBox([0,0,h,c]);let u="groupAt"+this.groupLevel;t.smask&&(u+="_smask_"+this.smaskCounter++%2);const f=this.cachedCanvases.getCanvas(u,h,c),p=f.context;p.translate(-o,-l),p.transform(...i);let v=new Path2D;const[m,A,b,S]=t.bbox;if(v.rect(m,A,b-m,S-A),t.matrix){const T=new Path2D;T.addPath(v,new DOMMatrix(t.matrix)),v=T}p.clip(v),t.smask&&this.smaskStack.push({canvas:f.canvas,context:p,offsetX:o,offsetY:l,subtype:t.smask.subtype,backdrop:t.smask.backdrop,transferMap:t.smask.transferMap||null,startTransformInverse:null}),(!t.smask||this.dependencyTracker)&&(s.setTransform(1,0,0,1,0,0),s.translate(o,l),s.save()),kl(s,p),this.ctx=p,(E=this.dependencyTracker)==null||E.inheritSimpleDataAsFutureForcedDependencies(["fillAlpha","strokeAlpha","globalCompositeOperation"]).pushBaseTransform(s),this.setGState(e,[["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(s),this.groupLevel++}endGroup(e,t){var r;if(!this.contentVisible)return;this.groupLevel--;const s=this.ctx,i=this.groupStack.pop();if(this.ctx=i,this.ctx.imageSmoothingEnabled=!1,(r=this.dependencyTracker)==null||r.popBaseTransform(),t.smask)this.tempSMask=this.smaskStack.pop(),this.restore(e),this.dependencyTracker&&this.ctx.restore();else{this.ctx.restore();const a=zt(this.ctx);this.restore(e),this.ctx.save(),this.ctx.setTransform(...a);const o=eo.slice();j.axialAlignedBoundingBox([0,0,s.canvas.width,s.canvas.height],a,o),this.ctx.drawImage(s.canvas,0,0),this.ctx.restore(),this.compose(o)}}beginAnnotation(e,t,s,i,r,a){if(w(this,si,Cf).call(this),gd(this.ctx),this.ctx.save(),this.save(e),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),s){const o=s[2]-s[0],l=s[3]-s[1];if(a&&this.annotationCanvasMap){i=i.slice(),i[4]-=s[0],i[5]-=s[1],s=s.slice(),s[0]=s[1]=0,s[2]=o,s[3]=l,j.singularValueDecompose2dScale(zt(this.ctx),As);const{viewportScale:h}=this,c=Math.ceil(o*this.outputScaleX*h),u=Math.ceil(l*this.outputScaleY*h);this.annotationCanvas=this.canvasFactory.create(c,u);const{canvas:f,context:p}=this.annotationCanvas;this.annotationCanvasMap.set(t,f),this.annotationCanvas.savedCtx=this.ctx,this.ctx=p,this.ctx.save(),this.ctx.setTransform(As[0],0,0,-As[1],0,l*As[1]),gd(this.ctx)}else{gd(this.ctx),this.endPath(e);const h=new Path2D;h.rect(s[0],s[1],o,l),this.ctx.clip(h)}}this.current=new ig(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(e,...i),this.transform(e,...r)}endAnnotation(e){this.annotationCanvas&&(this.ctx.restore(),w(this,si,Rf).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e,t){var o;if(!this.contentVisible)return;const s=t.count;t=this.getObject(e,t.data,t),t.count=s;const i=this.ctx,r=this._createMaskCanvas(e,t),a=r.canvas;i.save(),i.setTransform(1,0,0,1,0,0),i.drawImage(a,r.offsetX,r.offsetY),(o=this.dependencyTracker)==null||o.resetBBox(e).recordBBox(e,this.ctx,r.offsetX,r.offsetX+a.width,r.offsetY,r.offsetY+a.height).recordOperation(e),i.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t,s,i=0,r=0,a,o){var u,f,p;if(!this.contentVisible)return;t=this.getObject(e,t.data,t);const l=this.ctx;l.save();const h=zt(l);l.transform(s,i,r,a,0,0);const c=this._createMaskCanvas(e,t);l.setTransform(1,0,0,1,c.offsetX-h[4],c.offsetY-h[5]),(u=this.dependencyTracker)==null||u.resetBBox(e);for(let v=0,m=o.length;v<m;v+=2){const A=j.transform(h,[s,i,r,a,o[v],o[v+1]]);l.drawImage(c.canvas,A[4],A[5]),(f=this.dependencyTracker)==null||f.recordBBox(e,this.ctx,A[4],A[4]+c.canvas.width,A[5],A[5]+c.canvas.height)}l.restore(),this.compose(),(p=this.dependencyTracker)==null||p.recordOperation(e)}paintImageMaskXObjectGroup(e,t){var a,o,l;if(!this.contentVisible)return;const s=this.ctx,i=this.current.fillColor,r=this.current.patternFill;(a=this.dependencyTracker)==null||a.resetBBox(e).recordDependencies(e,Ts.transformAndFill);for(const h of t){const{data:c,width:u,height:f,transform:p}=h,v=this.cachedCanvases.getCanvas("maskCanvas",u,f),m=v.context;m.save();const A=this.getObject(e,c,h);rg(m,A),m.globalCompositeOperation="source-in",m.fillStyle=r?i.getPattern(m,this,ii(s),xe.FILL,e):i,m.fillRect(0,0,u,f),m.restore(),s.save(),s.transform(...p),s.scale(1,-1),pd(s,v.canvas,0,0,u,f,0,-1,1,1),(o=this.dependencyTracker)==null||o.recordBBox(e,s,0,u,0,f),s.restore()}this.compose(),(l=this.dependencyTracker)==null||l.recordOperation(e)}paintImageXObject(e,t){if(!this.contentVisible)return;const s=this.getObject(e,t);if(!s){J("Dependent image isn't ready yet");return}this.paintInlineImageXObject(e,s)}paintImageXObjectRepeat(e,t,s,i,r){if(!this.contentVisible)return;const a=this.getObject(e,t);if(!a){J("Dependent image isn't ready yet");return}const o=a.width,l=a.height,h=[];for(let c=0,u=r.length;c<u;c+=2)h.push({transform:[s,0,0,i,r[c],r[c+1]],x:0,y:0,w:o,h:l});this.paintInlineImageXObjectGroup(e,a,h)}applyTransferMapsToCanvas(e){return this.current.transferMaps!=="none"&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if(this.current.transferMaps==="none")return e.bitmap;const{bitmap:t,width:s,height:i}=e,r=this.cachedCanvases.getCanvas("inlineImage",s,i),a=r.context;return a.filter=this.current.transferMaps,a.drawImage(t,0,0),a.filter="none",r.canvas}paintInlineImageXObject(e,t){var h;if(!this.contentVisible)return;const s=t.width,i=t.height,r=this.ctx;this.save(e);const{filter:a}=r;a!=="none"&&a!==""&&(r.filter="none"),r.scale(1/s,-1/i);let o;if(t.bitmap)o=this.applyTransferMapsToBitmap(t);else if(typeof HTMLElement=="function"&&t instanceof HTMLElement||!t.data)o=t;else{const u=this.cachedCanvases.getCanvas("inlineImage",s,i).context;ng(u,t),o=this.applyTransferMapsToCanvas(u)}const l=this._scaleImage(o,ii(r));r.imageSmoothingEnabled=ag(zt(r),t.interpolate),(h=this.dependencyTracker)==null||h.resetBBox(e).recordBBox(e,r,0,s,-i,0).recordDependencies(e,Ts.imageXObject).recordOperation(e),pd(r,l.img,0,0,l.paintWidth,l.paintHeight,0,-i,s,i),this.compose(),this.restore(e)}paintInlineImageXObjectGroup(e,t,s){var a,o,l;if(!this.contentVisible)return;const i=this.ctx;let r;if(t.bitmap)r=t.bitmap;else{const h=t.width,c=t.height,f=this.cachedCanvases.getCanvas("inlineImage",h,c).context;ng(f,t),r=this.applyTransferMapsToCanvas(f)}(a=this.dependencyTracker)==null||a.resetBBox(e);for(const h of s)i.save(),i.transform(...h.transform),i.scale(1,-1),pd(i,r,h.x,h.y,h.w,h.h,0,-1,1,1),(o=this.dependencyTracker)==null||o.recordBBox(e,i,0,1,-1,0),i.restore();(l=this.dependencyTracker)==null||l.recordOperation(e),this.compose()}paintSolidColorImageMask(e){var t;this.contentVisible&&((t=this.dependencyTracker)==null||t.resetBBox(e).recordBBox(e,this.ctx,0,1,0,1).recordDependencies(e,Ts.fill).recordOperation(e),this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e,t){}markPointProps(e,t,s){}beginMarkedContent(e,t){var s;(s=this.dependencyTracker)==null||s.beginMarkedContent(e),this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t,s){var i;(i=this.dependencyTracker)==null||i.beginMarkedContent(e),t==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(s)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(e){var t;(t=this.dependencyTracker)==null||t.endMarkedContent(e),this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(e){}endCompat(e){}consumePath(e,t,s){var a,o;const i=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(s);const r=this.ctx;this.pendingClip?(i||(this.pendingClip===og?r.clip(t,"evenodd"):r.clip(t)),this.pendingClip=null,(a=this.dependencyTracker)==null||a.bboxToClipBoxDropOperation(e).recordFutureForcedDependency("clipPath",e)):(o=this.dependencyTracker)==null||o.recordOperation(e),this.current.startNewPathAndClipBox(this.current.clipBox)}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const e=zt(this.ctx);if(e[1]===0&&e[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{const t=Math.abs(e[0]*e[3]-e[2]*e[1]),s=Math.hypot(e[0],e[2]),i=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(s,i)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:e}=this.current,{a:t,b:s,c:i,d:r}=this.ctx.getTransform();let a,o;if(s===0&&i===0){const l=Math.abs(t),h=Math.abs(r);if(l===h)if(e===0)a=o=1/l;else{const c=l*e;a=o=c<1?1/c:1}else if(e===0)a=1/l,o=1/h;else{const c=l*e,u=h*e;a=c<1?1/c:1,o=u<1?1/u:1}}else{const l=Math.abs(t*r-s*i),h=Math.hypot(t,s),c=Math.hypot(i,r);if(e===0)a=c/l,o=h/l;else{const u=e*l;a=c>u?c/u:1,o=h>u?h/u:1}}this._cachedScaleForStroking[0]=a,this._cachedScaleForStroking[1]=o}return this._cachedScaleForStroking}rescaleAndStroke(e,t){const{ctx:s,current:{lineWidth:i}}=this,[r,a]=this.getScaleForStroking();if(r===a){s.lineWidth=(i||1)*r,s.stroke(e);return}const o=s.getLineDash();t&&s.save(),s.scale(r,a),zu.a=1/r,zu.d=1/a;const l=new Path2D;if(l.addPath(e,zu),o.length>0){const h=Math.max(r,a);s.setLineDash(o.map(c=>c/h)),s.lineDashOffset/=h}s.lineWidth=i||1,s.stroke(l),t&&s.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}};si=new WeakSet,Cf=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},Rf=function(){if(this.pageColors){const e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(e!=="none"){const t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}},Pf=function(e,t,s){const i=new Path2D;return i.addPath(e,new DOMMatrix(s).invertSelf().multiplySelf(t)),i};let ao=Fp;for(const d in oh)ao.prototype[d]!==void 0&&(ao.prototype[oh[d]]=ao.prototype[d]);var Zh,qh;class mn{static get workerPort(){return n(this,Zh)}static set workerPort(e){if(!(typeof Worker<"u"&&e instanceof Worker)&&e!==null)throw new Error("Invalid `workerPort` type.");g(this,Zh,e)}static get workerSrc(){return n(this,qh)}static set workerSrc(e){if(typeof e!="string")throw new Error("Invalid `workerSrc` type.");g(this,qh,e)}}Zh=new WeakMap,qh=new WeakMap,y(mn,Zh,null),y(mn,qh,"");var Go,tc;class Ry{constructor({parsedData:e,rawData:t}){y(this,Go);y(this,tc);g(this,Go,e),g(this,tc,t)}getRaw(){return n(this,tc)}get(e){return n(this,Go).get(e)??null}[Symbol.iterator](){return n(this,Go).entries()}}Go=new WeakMap,tc=new WeakMap;const Qa=Symbol("INTERNAL");var ec,sc,ic,Vo;class Py{constructor(e,{name:t,intent:s,usage:i,rbGroups:r}){y(this,ec,!1);y(this,sc,!1);y(this,ic,!1);y(this,Vo,!0);g(this,ec,!!(e&bs.DISPLAY)),g(this,sc,!!(e&bs.PRINT)),this.name=t,this.intent=s,this.usage=i,this.rbGroups=r}get visible(){if(n(this,ic))return n(this,Vo);if(!n(this,Vo))return!1;const{print:e,view:t}=this.usage;return n(this,ec)?(t==null?void 0:t.viewState)!=="OFF":n(this,sc)?(e==null?void 0:e.printState)!=="OFF":!0}_setVisible(e,t,s=!1){e!==Qa&&Ot("Internal method `_setVisible` called."),g(this,ic,s),g(this,Vo,t)}}ec=new WeakMap,sc=new WeakMap,ic=new WeakMap,Vo=new WeakMap;var Vn,Ct,Wo,Xo,nc,If;class Iy{constructor(e,t=bs.DISPLAY){y(this,nc);y(this,Vn,null);y(this,Ct,new Map);y(this,Wo,null);y(this,Xo,null);if(this.renderingIntent=t,this.name=null,this.creator=null,e!==null){this.name=e.name,this.creator=e.creator,g(this,Xo,e.order);for(const s of e.groups)n(this,Ct).set(s.id,new Py(t,s));if(e.baseState==="OFF")for(const s of n(this,Ct).values())s._setVisible(Qa,!1);for(const s of e.on)n(this,Ct).get(s)._setVisible(Qa,!0);for(const s of e.off)n(this,Ct).get(s)._setVisible(Qa,!1);g(this,Wo,this.getHash())}}isVisible(e){if(n(this,Ct).size===0)return!0;if(!e)return Ou("Optional content group not defined."),!0;if(e.type==="OCG")return n(this,Ct).has(e.id)?n(this,Ct).get(e.id).visible:(J(`Optional content group not found: ${e.id}`),!0);if(e.type==="OCMD"){if(e.expression)return w(this,nc,If).call(this,e.expression);if(!e.policy||e.policy==="AnyOn"){for(const t of e.ids){if(!n(this,Ct).has(t))return J(`Optional content group not found: ${t}`),!0;if(n(this,Ct).get(t).visible)return!0}return!1}else if(e.policy==="AllOn"){for(const t of e.ids){if(!n(this,Ct).has(t))return J(`Optional content group not found: ${t}`),!0;if(!n(this,Ct).get(t).visible)return!1}return!0}else if(e.policy==="AnyOff"){for(const t of e.ids){if(!n(this,Ct).has(t))return J(`Optional content group not found: ${t}`),!0;if(!n(this,Ct).get(t).visible)return!0}return!1}else if(e.policy==="AllOff"){for(const t of e.ids){if(!n(this,Ct).has(t))return J(`Optional content group not found: ${t}`),!0;if(n(this,Ct).get(t).visible)return!1}return!0}return J(`Unknown optional content policy ${e.policy}.`),!0}return J(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0,s=!0){var r;const i=n(this,Ct).get(e);if(!i){J(`Optional content group not found: ${e}`);return}if(s&&t&&i.rbGroups.length)for(const a of i.rbGroups)for(const o of a)o!==e&&((r=n(this,Ct).get(o))==null||r._setVisible(Qa,!1,!0));i._setVisible(Qa,!!t,!0),g(this,Vn,null)}setOCGState({state:e,preserveRB:t}){let s;for(const i of e){switch(i){case"ON":case"OFF":case"Toggle":s=i;continue}const r=n(this,Ct).get(i);if(r)switch(s){case"ON":this.setVisibility(i,!0,t);break;case"OFF":this.setVisibility(i,!1,t);break;case"Toggle":this.setVisibility(i,!r.visible,t);break}}g(this,Vn,null)}get hasInitialVisibility(){return n(this,Wo)===null||this.getHash()===n(this,Wo)}getOrder(){return n(this,Ct).size?n(this,Xo)?n(this,Xo).slice():[...n(this,Ct).keys()]:null}getGroup(e){return n(this,Ct).get(e)||null}getHash(){if(n(this,Vn)!==null)return n(this,Vn);const e=new Zg;for(const[t,s]of n(this,Ct))e.update(`${t}:${s.visible}`);return g(this,Vn,e.hexdigest())}[Symbol.iterator](){return n(this,Ct).entries()}}Vn=new WeakMap,Ct=new WeakMap,Wo=new WeakMap,Xo=new WeakMap,nc=new WeakSet,If=function(e){const t=e.length;if(t<2)return!0;const s=e[0];for(let i=1;i<t;i++){const r=e[i];let a;if(Array.isArray(r))a=w(this,nc,If).call(this,r);else if(n(this,Ct).has(r))a=n(this,Ct).get(r).visible;else return J(`Optional content group not found: ${r}`),!0;switch(s){case"And":if(!a)return!1;break;case"Or":if(a)return!0;break;case"Not":return!a;default:return!0}}return s==="And"};class Dy{constructor(e,{disableRange:t=!1,disableStream:s=!1}){ut(e,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:i,initialData:r,progressiveDone:a,contentDispositionFilename:o}=e;if(this._queuedChunks=[],this._progressiveDone=a,this._contentDispositionFilename=o,(r==null?void 0:r.length)>0){const l=r instanceof Uint8Array&&r.byteLength===r.buffer.byteLength?r.buffer:new Uint8Array(r).buffer;this._queuedChunks.push(l)}this._pdfDataRangeTransport=e,this._isStreamingSupported=!s,this._isRangeSupported=!t,this._contentLength=i,this._fullRequestReader=null,this._rangeReaders=[],e.addRangeListener((l,h)=>{this._onReceiveData({begin:l,chunk:h})}),e.addProgressListener((l,h)=>{this._onProgress({loaded:l,total:h})}),e.addProgressiveReadListener(l=>{this._onReceiveData({chunk:l})}),e.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),e.transportReady()}_onReceiveData({begin:e,chunk:t}){const s=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;if(e===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(s):this._queuedChunks.push(s);else{const i=this._rangeReaders.some(function(r){return r._begin!==e?!1:(r._enqueue(s),!0)});ut(i,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}_onProgress(e){var t,s,i,r;e.total===void 0?(s=(t=this._rangeReaders[0])==null?void 0:t.onProgress)==null||s.call(t,{loaded:e.loaded}):(r=(i=this._fullRequestReader)==null?void 0:i.onProgress)==null||r.call(i,{loaded:e.loaded,total:e.total})}_onProgressiveDone(){var e;(e=this._fullRequestReader)==null||e.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){const t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){ut(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const e=this._queuedChunks;return this._queuedChunks=null,new My(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const s=new Oy(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(s),s}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const s of this._rangeReaders.slice(0))s.cancel(e);this._pdfDataRangeTransport.abort()}}class My{constructor(e,t,s=!1,i=null){this._stream=e,this._done=s||!1,this._filename=Sp(i)?i:null,this._queuedChunks=t||[],this._loaded=0;for(const r of this._queuedChunks)this._loaded+=r.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class Oy{constructor(e,t,s){this._stream=e,this._begin=t,this._end=s,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(this._requests.length===0)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function Ly(d){let e=!0,t=s("filename\\*","i").exec(d);if(t){t=t[1];let c=o(t);return c=unescape(c),c=l(c),c=h(c),r(c)}if(t=a(d),t){const c=h(t);return r(c)}if(t=s("filename","i").exec(d),t){t=t[1];let c=o(t);return c=h(c),r(c)}function s(c,u){return new RegExp("(?:^|;)\\s*"+c+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',u)}function i(c,u){if(c){if(!/^[\x00-\xFF]+$/.test(u))return u;try{const f=new TextDecoder(c,{fatal:!0}),p=ed(u);u=f.decode(p),e=!1}catch{}}return u}function r(c){return e&&/[\x80-\xff]/.test(c)&&(c=i("utf-8",c),e&&(c=i("iso-8859-1",c))),c}function a(c){const u=[];let f;const p=s("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(f=p.exec(c))!==null;){let[,m,A,b]=f;if(m=parseInt(m,10),m in u){if(m===0)break;continue}u[m]=[A,b]}const v=[];for(let m=0;m<u.length&&m in u;++m){let[A,b]=u[m];b=o(b),A&&(b=unescape(b),m===0&&(b=l(b))),v.push(b)}return v.join("")}function o(c){if(c.startsWith('"')){const u=c.slice(1).split('\\"');for(let f=0;f<u.length;++f){const p=u[f].indexOf('"');p!==-1&&(u[f]=u[f].slice(0,p),u.length=f+1),u[f]=u[f].replaceAll(/\\(.)/g,"$1")}c=u.join('"')}return c}function l(c){const u=c.indexOf("'");if(u===-1)return c;const f=c.slice(0,u),v=c.slice(u+1).replace(/^[^']*'/,"");return i(f,v)}function h(c){return!c.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(c)?c:c.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(u,f,p,v){if(p==="q"||p==="Q")return v=v.replaceAll("_"," "),v=v.replaceAll(/=([0-9a-fA-F]{2})/g,function(m,A){return String.fromCharCode(parseInt(A,16))}),i(f,v);try{v=atob(v)}catch{}return i(f,v)})}return""}function cm(d,e){const t=new Headers;if(!d||!e||typeof e!="object")return t;for(const s in e){const i=e[s];i!==void 0&&t.append(s,i)}return t}function Fu(d){var e;return((e=URL.parse(d))==null?void 0:e.origin)??null}function dm({responseHeaders:d,isHttp:e,rangeChunkSize:t,disableRange:s}){const i={allowRangeRequests:!1,suggestedLength:void 0},r=parseInt(d.get("Content-Length"),10);return!Number.isInteger(r)||(i.suggestedLength=r,r<=2*t)||s||!e||d.get("Accept-Ranges")!=="bytes"||(d.get("Content-Encoding")||"identity")!=="identity"||(i.allowRangeRequests=!0),i}function um(d){const e=d.get("Content-Disposition");if(e){let t=Ly(e);if(t.includes("%"))try{t=decodeURIComponent(t)}catch{}if(Sp(t))return t}return null}function ad(d,e){return new Zd(`Unexpected server response (${d}) while retrieving PDF "${e}".`,d,d===404||d===0&&e.startsWith("file:"))}function fm(d){return d===200||d===206}function pm(d,e,t){return{method:"GET",headers:d,signal:t.signal,mode:"cors",credentials:e?"include":"same-origin",redirect:"follow"}}function gm(d){return d instanceof Uint8Array?d.buffer:d instanceof ArrayBuffer?d:(J(`getArrayBuffer - unexpected data format: ${d}`),new Uint8Array(d).buffer)}class Fy{constructor(e){F(this,"_responseOrigin",null);this.source=e,this.isHttp=/^https?:/i.test(e.url),this.headers=cm(this.isHttp,e.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}getFullReader(){return ut(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new ky(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const s=new Ny(this,e,t);return this._rangeRequestReaders.push(s),s}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const s of this._rangeRequestReaders.slice(0))s.cancel(e)}}class ky{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;const t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange;const s=new Headers(e.headers),i=t.url;fetch(i,pm(s,this._withCredentials,this._abortController)).then(r=>{if(e._responseOrigin=Fu(r.url),!fm(r.status))throw ad(r.status,i);this._reader=r.body.getReader(),this._headersCapability.resolve();const a=r.headers,{allowRangeRequests:o,suggestedLength:l}=dm({responseHeaders:a,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=o,this._contentLength=l||this._contentLength,this._filename=um(a),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new gr("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;await this._headersCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded,total:this._contentLength}),{value:gm(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}}class Ny{constructor(e,t,s){this._stream=e,this._reader=null,this._loaded=0;const i=e.source;this._withCredentials=i.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!i.disableStream,this._abortController=new AbortController;const r=new Headers(e.headers);r.append("Range",`bytes=${t}-${s-1}`);const a=i.url;fetch(a,pm(r,this._withCredentials,this._abortController)).then(o=>{const l=Fu(o.url);if(l!==e._responseOrigin)throw new Error(`Expected range response-origin "${l}" to match "${e._responseOrigin}".`);if(!fm(o.status))throw ad(o.status,a);this._readCapability.resolve(),this._reader=o.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;await this._readCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded}),{value:gm(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}}const Gu=200,Vu=206;function By(d){const e=d.response;return typeof e!="string"?e:ed(e).buffer}class _y{constructor({url:e,httpHeaders:t,withCredentials:s}){F(this,"_responseOrigin",null);this.url=e,this.isHttp=/^https?:/i.test(e),this.headers=cm(this.isHttp,t),this.withCredentials=s||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(e){const t=new XMLHttpRequest,s=this.currXhrId++,i=this.pendingRequests[s]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(const[r,a]of this.headers)t.setRequestHeader(r,a);return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),i.expectedStatus=Vu):i.expectedStatus=Gu,t.responseType="arraybuffer",ut(e.onError,"Expected `onError` callback to be provided."),t.onerror=()=>{e.onError(t.status)},t.onreadystatechange=this.onStateChange.bind(this,s),t.onprogress=this.onProgress.bind(this,s),i.onHeadersReceived=e.onHeadersReceived,i.onDone=e.onDone,i.onError=e.onError,i.onProgress=e.onProgress,t.send(null),s}onProgress(e,t){var i;const s=this.pendingRequests[e];s&&((i=s.onProgress)==null||i.call(s,t))}onStateChange(e,t){const s=this.pendingRequests[e];if(!s)return;const i=s.xhr;if(i.readyState>=2&&s.onHeadersReceived&&(s.onHeadersReceived(),delete s.onHeadersReceived),i.readyState!==4||!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],i.status===0&&this.isHttp){s.onError(i.status);return}const r=i.status||Gu;if(!(r===Gu&&s.expectedStatus===Vu)&&r!==s.expectedStatus){s.onError(i.status);return}const o=By(i);if(r===Vu){const l=i.getResponseHeader("Content-Range"),h=/bytes (\d+)-(\d+)\/(\d+)/.exec(l);h?s.onDone({begin:parseInt(h[1],10),chunk:o}):(J('Missing or invalid "Content-Range" header.'),s.onError(0))}else o?s.onDone({begin:0,chunk:o}):s.onError(i.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){const t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}}class Uy{constructor(e){this._source=e,this._manager=new _y(e),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){const t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return ut(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new Hy(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){const s=new $y(this._manager,e,t);return s.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(s),s}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const s of this._rangeRequestReaders.slice(0))s.cancel(e)}}class Hy{constructor(e,t){this._manager=e,this._url=t.url,this._fullRequestId=e.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const e=this._fullRequestId,t=this._manager.getRequestXhr(e);this._manager._responseOrigin=Fu(t.responseURL);const s=t.getAllResponseHeaders(),i=new Headers(s?s.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(o=>{const[l,...h]=o.split(": ");return[l,h.join(": ")]}):[]),{allowRangeRequests:r,suggestedLength:a}=dm({responseHeaders:i,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});r&&(this._isRangeSupported=!0),this._contentLength=a||this._contentLength,this._filename=um(i),this._isRangeSupported&&this._manager.abortRequest(e),this._headersCapability.resolve()}_onDone(e){if(e&&(this._requests.length>0?this._requests.shift().resolve({value:e.chunk,done:!1}):this._cachedChunks.push(e.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){this._storedError=ad(e,this._url),this._headersCapability.reject(this._storedError);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){var t;(t=this.onProgress)==null||t.call(this,{loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._headersCapability.reject(e);for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class $y{constructor(e,t,s){this._manager=e,this._url=e.url,this._requestId=e.request({begin:t,end:s,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){var t;const e=Fu((t=this._manager.getRequestXhr(this._requestId))==null?void 0:t.responseURL);e!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${e}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){var e;(e=this.onClosed)==null||e.call(this,this)}_onDone(e){const t=e.chunk;this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0;for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){this._storedError??(this._storedError=ad(e,this._url));for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){var t;this.isStreamingSupported||(t=this.onProgress)==null||t.call(this,{loaded:e.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const jy=/^[a-z][a-z0-9\-+.]+:/i;function zy(d){if(jy.test(d))return new URL(d);const e=process.getBuiltinModule("url");return new URL(e.pathToFileURL(d))}class Gy{constructor(e){this.source=e,this.url=zy(e.url),ut(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}getFullReader(){return ut(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new Vy(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const s=new Wy(this,e,t);return this._rangeRequestReaders.push(s),s}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const s of this._rangeRequestReaders.slice(0))s.cancel(e)}}class Vy{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;const t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const s=process.getBuiltinModule("fs");s.promises.lstat(this._url).then(i=>{this._contentLength=i.size,this._setReadableStream(s.createReadStream(this._url)),this._headersCapability.resolve()},i=>{i.code==="ENOENT"&&(i=ad(0,this._url.href)),this._storedError=i,this._headersCapability.reject(i)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new gr("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class Wy{constructor(e,t,s){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const i=e.source;this._isStreamingSupported=!i.disableStream;const r=process.getBuiltinModule("fs");this._setReadableStream(r.createReadStream(this._url,{start:t,end:s-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const Nl=Symbol("INITIAL_DATA");var ns,rc,Df;class mm{constructor(){y(this,rc);y(this,ns,Object.create(null))}get(e,t=null){if(t){const i=w(this,rc,Df).call(this,e);return i.promise.then(()=>t(i.data)),null}const s=n(this,ns)[e];if(!s||s.data===Nl)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return s.data}has(e){const t=n(this,ns)[e];return!!t&&t.data!==Nl}delete(e){const t=n(this,ns)[e];return!t||t.data===Nl?!1:(delete n(this,ns)[e],!0)}resolve(e,t=null){const s=w(this,rc,Df).call(this,e);s.data=t,s.resolve()}clear(){var e;for(const t in n(this,ns)){const{data:s}=n(this,ns)[t];(e=s==null?void 0:s.bitmap)==null||e.close()}g(this,ns,Object.create(null))}*[Symbol.iterator](){for(const e in n(this,ns)){const{data:t}=n(this,ns)[e];t!==Nl&&(yield[e,t])}}}ns=new WeakMap,rc=new WeakSet,Df=function(e){var t;return(t=n(this,ns))[e]||(t[e]={...Promise.withResolvers(),data:Nl})};const Xy=1e5,lg=30;var ug,Wn,rs,ac,oc,ea,Zi,lc,hc,sa,cc,Yo,Xn,Ko,dc,Jo,ia,uc,fc,Qo,na,pc,Zo,qo,En,vm,ym,Mf,Es,Id,Of,bm,Am;const ye=class ye{constructor({textContentSource:e,container:t,viewport:s}){y(this,En);y(this,Wn,Promise.withResolvers());y(this,rs,null);y(this,ac,!1);y(this,oc,!!((ug=globalThis.FontInspector)!=null&&ug.enabled));y(this,ea,null);y(this,Zi,null);y(this,lc,0);y(this,hc,0);y(this,sa,null);y(this,cc,null);y(this,Yo,0);y(this,Xn,0);y(this,Ko,Object.create(null));y(this,dc,[]);y(this,Jo,null);y(this,ia,[]);y(this,uc,new WeakMap);y(this,fc,null);var l;if(e instanceof ReadableStream)g(this,Jo,e);else if(typeof e=="object")g(this,Jo,new ReadableStream({start(h){h.enqueue(e),h.close()}}));else throw new Error('No "textContentSource" parameter specified.');g(this,rs,g(this,cc,t)),g(this,Xn,s.scale*Pi.pixelRatio),g(this,Yo,s.rotation),g(this,Zi,{div:null,properties:null,ctx:null});const{pageWidth:i,pageHeight:r,pageX:a,pageY:o}=s.rawDims;g(this,fc,[1,0,0,-1,-a,o+r]),g(this,hc,i),g(this,lc,r),w(l=ye,Es,bm).call(l),t.style.setProperty("--min-font-size",n(ye,Zo)),Ua(t,s),n(this,Wn).promise.finally(()=>{n(ye,qo).delete(this),g(this,Zi,null),g(this,Ko,null)}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:e,isFirefox:t}=he.platform;return Q(this,"fontFamilyMap",new Map([["sans-serif",`${e&&t?"Calibri, ":""}sans-serif`],["monospace",`${e&&t?"Lucida Console, ":""}monospace`]]))}render(){const e=()=>{n(this,sa).read().then(({value:t,done:s})=>{if(s){n(this,Wn).resolve();return}n(this,ea)??g(this,ea,t.lang),Object.assign(n(this,Ko),t.styles),w(this,En,vm).call(this,t.items),e()},n(this,Wn).reject)};return g(this,sa,n(this,Jo).getReader()),n(ye,qo).add(this),e(),n(this,Wn).promise}update({viewport:e,onBefore:t=null}){var r;const s=e.scale*Pi.pixelRatio,i=e.rotation;if(i!==n(this,Yo)&&(t==null||t(),g(this,Yo,i),Ua(n(this,cc),{rotation:i})),s!==n(this,Xn)){t==null||t(),g(this,Xn,s);const a={div:null,properties:null,ctx:w(r=ye,Es,Id).call(r,n(this,ea))};for(const o of n(this,ia))a.properties=n(this,uc).get(o),a.div=o,w(this,En,Mf).call(this,a)}}cancel(){var t;const e=new gr("TextLayer task cancelled.");(t=n(this,sa))==null||t.cancel(e).catch(()=>{}),g(this,sa,null),n(this,Wn).reject(e)}get textDivs(){return n(this,ia)}get textContentItemsStr(){return n(this,dc)}static cleanup(){if(!(n(this,qo).size>0)){n(this,Qo).clear();for(const{canvas:e}of n(this,na).values())e.remove();n(this,na).clear()}}};Wn=new WeakMap,rs=new WeakMap,ac=new WeakMap,oc=new WeakMap,ea=new WeakMap,Zi=new WeakMap,lc=new WeakMap,hc=new WeakMap,sa=new WeakMap,cc=new WeakMap,Yo=new WeakMap,Xn=new WeakMap,Ko=new WeakMap,dc=new WeakMap,Jo=new WeakMap,ia=new WeakMap,uc=new WeakMap,fc=new WeakMap,Qo=new WeakMap,na=new WeakMap,pc=new WeakMap,Zo=new WeakMap,qo=new WeakMap,En=new WeakSet,vm=function(e){var i,r;if(n(this,ac))return;(r=n(this,Zi)).ctx??(r.ctx=w(i=ye,Es,Id).call(i,n(this,ea)));const t=n(this,ia),s=n(this,dc);for(const a of e){if(t.length>Xy){J("Ignoring additional textDivs for performance reasons."),g(this,ac,!0);return}if(a.str===void 0){if(a.type==="beginMarkedContentProps"||a.type==="beginMarkedContent"){const o=n(this,rs);g(this,rs,document.createElement("span")),n(this,rs).classList.add("markedContent"),a.id&&n(this,rs).setAttribute("id",`${a.id}`),o.append(n(this,rs))}else a.type==="endMarkedContent"&&g(this,rs,n(this,rs).parentNode);continue}s.push(a.str),w(this,En,ym).call(this,a)}},ym=function(e){var v;const t=document.createElement("span"),s={angle:0,canvasWidth:0,hasText:e.str!=="",hasEOL:e.hasEOL,fontSize:0};n(this,ia).push(t);const i=j.transform(n(this,fc),e.transform);let r=Math.atan2(i[1],i[0]);const a=n(this,Ko)[e.fontName];a.vertical&&(r+=Math.PI/2);let o=n(this,oc)&&a.fontSubstitution||a.fontFamily;o=ye.fontFamilyMap.get(o)||o;const l=Math.hypot(i[2],i[3]),h=l*w(v=ye,Es,Am).call(v,o,a,n(this,ea));let c,u;r===0?(c=i[4],u=i[5]-h):(c=i[4]+h*Math.sin(r),u=i[5]-h*Math.cos(r));const f=t.style;f.left=`${(100*c/n(this,hc)).toFixed(2)}%`,f.top=`${(100*u/n(this,lc)).toFixed(2)}%`,f.setProperty("--font-height",`${l.toFixed(2)}px`),f.fontFamily=o,s.fontSize=l,t.setAttribute("role","presentation"),t.textContent=e.str,t.dir=e.dir,n(this,oc)&&(t.dataset.fontName=a.fontSubstitutionLoadedName||e.fontName),r!==0&&(s.angle=r*(180/Math.PI));let p=!1;if(e.str.length>1)p=!0;else if(e.str!==" "&&e.transform[0]!==e.transform[3]){const m=Math.abs(e.transform[0]),A=Math.abs(e.transform[3]);m!==A&&Math.max(m,A)/Math.min(m,A)>1.5&&(p=!0)}if(p&&(s.canvasWidth=a.vertical?e.height:e.width),n(this,uc).set(t,s),n(this,Zi).div=t,n(this,Zi).properties=s,w(this,En,Mf).call(this,n(this,Zi)),s.hasText&&n(this,rs).append(t),s.hasEOL){const m=document.createElement("br");m.setAttribute("role","presentation"),n(this,rs).append(m)}},Mf=function(e){var a;const{div:t,properties:s,ctx:i}=e,{style:r}=t;if(s.canvasWidth!==0&&s.hasText){const{fontFamily:o}=r,{canvasWidth:l,fontSize:h}=s;w(a=ye,Es,Of).call(a,i,h*n(this,Xn),o);const{width:c}=i.measureText(t.textContent);c>0&&r.setProperty("--scale-x",l*n(this,Xn)/c)}s.angle!==0&&r.setProperty("--rotate",`${s.angle}deg`)},Es=new WeakSet,Id=function(e=null){let t=n(this,na).get(e||(e=""));if(!t){const s=document.createElement("canvas");s.className="hiddenCanvasElement",s.lang=e,document.body.append(s),t=s.getContext("2d",{alpha:!1,willReadFrequently:!0}),n(this,na).set(e,t),n(this,pc).set(t,{size:0,family:""})}return t},Of=function(e,t,s){const i=n(this,pc).get(e);t===i.size&&s===i.family||(e.font=`${t}px ${s}`,i.size=t,i.family=s)},bm=function(){if(n(this,Zo)!==null)return;const e=document.createElement("div");e.style.opacity=0,e.style.lineHeight=1,e.style.fontSize="1px",e.style.position="absolute",e.textContent="X",document.body.append(e),g(this,Zo,e.getBoundingClientRect().height),e.remove()},Am=function(e,t,s){const i=n(this,Qo).get(e);if(i)return i;const r=w(this,Es,Id).call(this,s);r.canvas.width=r.canvas.height=lg,w(this,Es,Of).call(this,r,lg,e);const a=r.measureText(""),o=a.fontBoundingBoxAscent,l=Math.abs(a.fontBoundingBoxDescent);r.canvas.width=r.canvas.height=0;let h=.8;return o?h=o/(o+l):(he.platform.isFirefox&&J("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),t.ascent?h=t.ascent:t.descent&&(h=1+t.descent)),n(this,Qo).set(e,h),h},y(ye,Es),y(ye,Qo,new Map),y(ye,na,new Map),y(ye,pc,new WeakMap),y(ye,Zo,null),y(ye,qo,new Set);let hh=ye;const Yy=100;function Ky(d={}){typeof d=="string"||d instanceof URL?d={url:d}:(d instanceof ArrayBuffer||ArrayBuffer.isView(d))&&(d={data:d});const e=new Lf,{docId:t}=e,s=d.url?ey(d.url):null,i=d.data?sy(d.data):null,r=d.httpHeaders||null,a=d.withCredentials===!0,o=d.password??null,l=d.range instanceof wm?d.range:null,h=Number.isInteger(d.rangeChunkSize)&&d.rangeChunkSize>0?d.rangeChunkSize:2**16;let c=d.worker instanceof ch?d.worker:null;const u=d.verbosity,f=typeof d.docBaseUrl=="string"&&!Lu(d.docBaseUrl)?d.docBaseUrl:null,p=cd(d.cMapUrl),v=d.cMapPacked!==!1,m=d.CMapReaderFactory||(He?cy:Yp),A=cd(d.iccUrl),b=cd(d.standardFontDataUrl),S=d.StandardFontDataFactory||(He?dy:Kp),E=cd(d.wasmUrl),T=d.WasmFactory||(He?uy:Jp),x=d.stopAtErrors!==!0,C=Number.isInteger(d.maxImageSize)&&d.maxImageSize>-1?d.maxImageSize:-1,R=d.isEvalSupported!==!1,I=typeof d.isOffscreenCanvasSupported=="boolean"?d.isOffscreenCanvasSupported:!He,P=typeof d.isImageDecoderSupported=="boolean"?d.isImageDecoderSupported:!He&&(he.platform.isFirefox||!globalThis.chrome),M=Number.isInteger(d.canvasMaxAreaInBytes)?d.canvasMaxAreaInBytes:-1,D=typeof d.disableFontFace=="boolean"?d.disableFontFace:He,_=d.fontExtraProperties===!0,k=d.enableXfa===!0,N=d.ownerDocument||globalThis.document,G=d.disableRange===!0,B=d.disableStream===!0,L=d.disableAutoFetch===!0,z=d.pdfBug===!0,nt=d.CanvasFactory||(He?hy:ay),ht=d.FilterFactory||(He?ly:oy),Pt=d.enableHWA===!0,Z=d.useWasm!==!1,ot=l?l.length:d.length??NaN,bt=typeof d.useSystemFonts=="boolean"?d.useSystemFonts:!He&&!D,gt=typeof d.useWorkerFetch=="boolean"?d.useWorkerFetch:!!(m===Yp&&S===Kp&&T===Jp&&p&&b&&E&&Ul(p,document.baseURI)&&Ul(b,document.baseURI)&&Ul(E,document.baseURI)),U=null;Pv(u);const O={canvasFactory:new nt({ownerDocument:N,enableHWA:Pt}),filterFactory:new ht({docId:t,ownerDocument:N}),cMapReaderFactory:gt?null:new m({baseUrl:p,isCompressed:v}),standardFontDataFactory:gt?null:new S({baseUrl:b}),wasmFactory:gt?null:new T({baseUrl:E})};c||(c=ch.create({verbosity:u,port:mn.workerPort}),e._worker=c);const $={docId:t,apiVersion:"5.4.530",data:i,password:o,disableAutoFetch:L,rangeChunkSize:h,length:ot,docBaseUrl:f,enableXfa:k,evaluatorOptions:{maxImageSize:C,disableFontFace:D,ignoreErrors:x,isEvalSupported:R,isOffscreenCanvasSupported:I,isImageDecoderSupported:P,canvasMaxAreaInBytes:M,fontExtraProperties:_,useSystemFonts:bt,useWasm:Z,useWorkerFetch:gt,cMapUrl:p,iccUrl:A,standardFontDataUrl:b,wasmUrl:E}},q={ownerDocument:N,pdfBug:z,styleElement:U,loadingParams:{disableAutoFetch:L,enableXfa:k}};return c.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");if(c.destroyed)throw new Error("Worker was destroyed");const mt=c.messageHandler.sendWithPromise("GetDocRequest",$,i?[i.buffer]:null);let Y;if(l)Y=new Dy(l,{disableRange:G,disableStream:B});else if(!i){if(!s)throw new Error("getDocument - no `url` parameter provided.");const Lt=Ul(s)?Fy:He?Gy:Uy;Y=new Lt({url:s,length:ot,httpHeaders:r,withCredentials:a,rangeChunkSize:h,disableRange:G,disableStream:B})}return mt.then(Lt=>{if(e.destroyed)throw new Error("Loading aborted");if(c.destroyed)throw new Error("Worker was destroyed");const Bt=new Xl(t,Lt,c.port),Ss=new Zy(Bt,e,Y,q,O,Pt);e._transport=Ss,Bt.send("Ready",null)})}).catch(e._capability.reject),e}var Au;const wu=class wu{constructor(){F(this,"_capability",Promise.withResolvers());F(this,"_transport",null);F(this,"_worker",null);F(this,"docId",`d${ie(wu,Au)._++}`);F(this,"destroyed",!1);F(this,"onPassword",null);F(this,"onProgress",null)}get promise(){return this._capability.promise}async destroy(){var e,t,s,i;this.destroyed=!0;try{(e=this._worker)!=null&&e.port&&(this._worker._pendingDestroy=!0),await((t=this._transport)==null?void 0:t.destroy())}catch(r){throw(s=this._worker)!=null&&s.port&&delete this._worker._pendingDestroy,r}this._transport=null,(i=this._worker)==null||i.destroy(),this._worker=null}async getData(){return this._transport.getData()}};Au=new WeakMap,y(wu,Au,0);let Lf=wu;var ra,gc,mc,vc,yc;class wm{constructor(e,t,s=!1,i=null){y(this,ra,Promise.withResolvers());y(this,gc,[]);y(this,mc,[]);y(this,vc,[]);y(this,yc,[]);this.length=e,this.initialData=t,this.progressiveDone=s,this.contentDispositionFilename=i}addRangeListener(e){n(this,yc).push(e)}addProgressListener(e){n(this,vc).push(e)}addProgressiveReadListener(e){n(this,mc).push(e)}addProgressiveDoneListener(e){n(this,gc).push(e)}onDataRange(e,t){for(const s of n(this,yc))s(e,t)}onDataProgress(e,t){n(this,ra).promise.then(()=>{for(const s of n(this,vc))s(e,t)})}onDataProgressiveRead(e){n(this,ra).promise.then(()=>{for(const t of n(this,mc))t(e)})}onDataProgressiveDone(){n(this,ra).promise.then(()=>{for(const e of n(this,gc))e()})}transportReady(){n(this,ra).resolve()}requestDataRange(e,t){Ot("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}ra=new WeakMap,gc=new WeakMap,mc=new WeakMap,vc=new WeakMap,yc=new WeakMap;class Jy{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return Q(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getAnnotationsByType(e,t){return this._transport.getAnnotationsByType(e,t)}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getOptionalContentConfig(t)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}extractPages(e){return this._transport.extractPages(e)}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(e){return this._transport.cachedPageNumber(e)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}var qi,aa,Zl;class Qy{constructor(e,t,s,i=!1){y(this,aa);y(this,qi,!1);this._pageIndex=e,this._pageInfo=t,this._transport=s,this._stats=i?new $p:null,this._pdfBug=i,this.commonObjs=s.commonObjs,this.objs=new mm,this._intentStates=new Map,this.destroyed=!1,this.recordedBBoxes=null}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:s=0,offsetY:i=0,dontFlip:r=!1}={}){return new id({viewBox:this.view,userUnit:this.userUnit,scale:e,rotation:t,offsetX:s,offsetY:i,dontFlip:r})}getAnnotations({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return Q(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var e;return((e=this._transport._htmlForXfa)==null?void 0:e.children[this._pageIndex])||null}render({canvasContext:e,canvas:t=e.canvas,viewport:s,intent:i="display",annotationMode:r=xn.ENABLE,transform:a=null,background:o=null,optionalContentConfigPromise:l=null,annotationCanvasMap:h=null,pageColors:c=null,printAnnotationStorage:u=null,isEditing:f=!1,recordOperations:p=!1,operationsFilter:v=null}){var P,M,D;(P=this._stats)==null||P.time("Overall");const m=this._transport.getRenderingIntent(i,r,u,f),{renderingIntent:A,cacheKey:b}=m;g(this,qi,!1),l||(l=this._transport.getOptionalContentConfig(A));let S=this._intentStates.get(b);S||(S=Object.create(null),this._intentStates.set(b,S)),S.streamReaderCancelTimeout&&(clearTimeout(S.streamReaderCancelTimeout),S.streamReaderCancelTimeout=null);const E=!!(A&bs.PRINT);S.displayReadyCapability||(S.displayReadyCapability=Promise.withResolvers(),S.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(M=this._stats)==null||M.time("Page Request"),this._pumpOperatorList(m));const T=!!(this._pdfBug&&((D=globalThis.StepperManager)!=null&&D.enabled)),x=!this.recordedBBoxes&&(p||T),C=_=>{var k,N;if(S.renderTasks.delete(R),x){const G=(k=R.gfx)==null?void 0:k.dependencyTracker.take();G&&(R.stepper&&R.stepper.setOperatorBBoxes(G,R.gfx.dependencyTracker.takeDebugMetadata()),p&&(this.recordedBBoxes=G))}E&&g(this,qi,!0),w(this,aa,Zl).call(this),_?(R.capability.reject(_),this._abortOperatorList({intentState:S,reason:_ instanceof Error?_:new Error(_)})):R.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),(N=globalThis.Stats)!=null&&N.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},R=new Ff({callback:C,params:{canvas:t,canvasContext:e,dependencyTracker:x?new py(t,S.operatorList.length,T):null,viewport:s,transform:a,background:o},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:h,operatorList:S.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!E,pdfBug:this._pdfBug,pageColors:c,enableHWA:this._transport.enableHWA,operationsFilter:v});(S.renderTasks||(S.renderTasks=new Set)).add(R);const I=R.task;return Promise.all([S.displayReadyCapability.promise,l]).then(([_,k])=>{var N;if(this.destroyed){C();return}if((N=this._stats)==null||N.time("Rendering"),!(k.renderingIntent&A))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");R.initializeGraphics({transparency:_,optionalContentConfig:k}),R.operatorListChanged()}).catch(C),I}getOperatorList({intent:e="display",annotationMode:t=xn.ENABLE,printAnnotationStorage:s=null,isEditing:i=!1}={}){var h;function r(){o.operatorList.lastChunk&&(o.opListReadCapability.resolve(o.operatorList),o.renderTasks.delete(l))}const a=this._transport.getRenderingIntent(e,t,s,i,!0);let o=this._intentStates.get(a.cacheKey);o||(o=Object.create(null),this._intentStates.set(a.cacheKey,o));let l;return o.opListReadCapability||(l=Object.create(null),l.operatorListChanged=r,o.opListReadCapability=Promise.withResolvers(),(o.renderTasks||(o.renderTasks=new Set)).add(l),o.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(h=this._stats)==null||h.time("Page Request"),this._pumpOperatorList(a)),o.opListReadCapability.promise}streamTextContent({includeMarkedContent:e=!1,disableNormalization:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:e===!0,disableNormalization:t===!0},{highWaterMark:100,size(i){return i.items.length}})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then(s=>lh.textContent(s));const t=this.streamTextContent(e);return new Promise(function(s,i){function r(){a.read().then(function({value:l,done:h}){if(h){s(o);return}o.lang??(o.lang=l.lang),Object.assign(o.styles,l.styles),o.items.push(...l.items),r()},i)}const a=t.getReader(),o={items:[],styles:Object.create(null),lang:null};r()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const e=[];for(const t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(const s of t.renderTasks)e.push(s.completed),s.cancel();return this.objs.clear(),g(this,qi,!1),Promise.all(e)}cleanup(e=!1){g(this,qi,!0);const t=w(this,aa,Zl).call(this);return e&&t&&this._stats&&(this._stats=new $p),t}_startRenderPage(e,t){var i,r;const s=this._intentStates.get(t);s&&((i=this._stats)==null||i.timeEnd("Page Request"),(r=s.displayReadyCapability)==null||r.resolve(e))}_renderPageChunk(e,t){for(let s=0,i=e.length;s<i;s++)t.operatorList.fnArray.push(e.fnArray[s]),t.operatorList.argsArray.push(e.argsArray[s]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(const s of t.renderTasks)s.operatorListChanged();e.lastChunk&&w(this,aa,Zl).call(this)}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageSerializable:s,modifiedIds:i}){const{map:r,transfer:a}=s,l=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:r,modifiedIds:i},a).getReader(),h=this._intentStates.get(t);h.streamReader=l;const c=()=>{l.read().then(({value:u,done:f})=>{if(f){h.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(u,h),c())},u=>{if(h.streamReader=null,!this._transport.destroyed){if(h.operatorList){h.operatorList.lastChunk=!0;for(const f of h.renderTasks)f.operatorListChanged();w(this,aa,Zl).call(this)}if(h.displayReadyCapability)h.displayReadyCapability.reject(u);else if(h.opListReadCapability)h.opListReadCapability.reject(u);else throw u}})};c()}_abortOperatorList({intentState:e,reason:t,force:s=!1}){if(e.streamReader){if(e.streamReaderCancelTimeout&&(clearTimeout(e.streamReaderCancelTimeout),e.streamReaderCancelTimeout=null),!s){if(e.renderTasks.size>0)return;if(t instanceof Ep){let i=Yy;t.extraDelay>0&&t.extraDelay<1e3&&(i+=t.extraDelay),e.streamReaderCancelTimeout=setTimeout(()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:t,force:!0})},i);return}}if(e.streamReader.cancel(new gr(t.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(const[i,r]of this._intentStates)if(r===e){this._intentStates.delete(i);break}this.cleanup()}}}get stats(){return this._stats}}qi=new WeakMap,aa=new WeakSet,Zl=function(){if(!n(this,qi)||this.destroyed)return!1;for(const{renderTasks:e,operatorList:t}of this._intentStates.values())if(e.size>0||!t.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),g(this,qi,!1),!0};var Yn,Ys,tn,oa,Eu,la,ha,je,Dd,Em,Sm,ql,tl,Md;const Ut=class Ut{constructor({name:e=null,port:t=null,verbosity:s=Iv()}={}){y(this,je);y(this,Yn,Promise.withResolvers());y(this,Ys,null);y(this,tn,null);y(this,oa,null);if(this.name=e,this.destroyed=!1,this.verbosity=s,t){if(n(Ut,ha).has(t))throw new Error("Cannot use more than one PDFWorker per port.");n(Ut,ha).set(t,this),w(this,je,Em).call(this,t)}else w(this,je,Sm).call(this)}get promise(){return n(this,Yn).promise}get port(){return n(this,tn)}get messageHandler(){return n(this,Ys)}destroy(){var e,t;this.destroyed=!0,(e=n(this,oa))==null||e.terminate(),g(this,oa,null),n(Ut,ha).delete(n(this,tn)),g(this,tn,null),(t=n(this,Ys))==null||t.destroy(),g(this,Ys,null)}static create(e){const t=n(this,ha).get(e==null?void 0:e.port);if(t){if(t._pendingDestroy)throw new Error("PDFWorker.create - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return t}return new Ut(e)}static get workerSrc(){if(mn.workerSrc)return mn.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return Q(this,"_setupFakeWorkerGlobal",(async()=>n(this,tl,Md)?n(this,tl,Md):(await import(this.workerSrc)).WorkerMessageHandler)())}};Yn=new WeakMap,Ys=new WeakMap,tn=new WeakMap,oa=new WeakMap,Eu=new WeakMap,la=new WeakMap,ha=new WeakMap,je=new WeakSet,Dd=function(){n(this,Yn).resolve(),n(this,Ys).send("configure",{verbosity:this.verbosity})},Em=function(e){g(this,tn,e),g(this,Ys,new Xl("main","worker",e)),n(this,Ys).on("ready",()=>{}),w(this,je,Dd).call(this)},Sm=function(){if(n(Ut,la)||n(Ut,tl,Md)){w(this,je,ql).call(this);return}let{workerSrc:e}=Ut;try{Ut._isSameOrigin(window.location,e)||(e=Ut._createCDNWrapper(new URL(e,window.location).href));const t=new Worker(e,{type:"module"}),s=new Xl("main","worker",t),i=()=>{r.abort(),s.destroy(),t.terminate(),this.destroyed?n(this,Yn).reject(new Error("Worker was destroyed")):w(this,je,ql).call(this)},r=new AbortController;t.addEventListener("error",()=>{n(this,oa)||i()},{signal:r.signal}),s.on("test",o=>{if(r.abort(),this.destroyed||!o){i();return}g(this,Ys,s),g(this,tn,t),g(this,oa,t),w(this,je,Dd).call(this)}),s.on("ready",o=>{if(r.abort(),this.destroyed){i();return}try{a()}catch{w(this,je,ql).call(this)}});const a=()=>{const o=new Uint8Array;s.send("test",o,[o.buffer])};a();return}catch{Ou("The worker has been disabled.")}w(this,je,ql).call(this)},ql=function(){n(Ut,la)||(J("Setting up fake worker."),g(Ut,la,!0)),Ut._setupFakeWorkerGlobal.then(e=>{if(this.destroyed){n(this,Yn).reject(new Error("Worker was destroyed"));return}const t=new ry;g(this,tn,t);const s=`fake${ie(Ut,Eu)._++}`,i=new Xl(s+"_worker",s,t);e.setup(i,t),g(this,Ys,new Xl(s,s+"_worker",t)),w(this,je,Dd).call(this)}).catch(e=>{n(this,Yn).reject(new Error(`Setting up fake worker failed: "${e.message}".`))})},tl=new WeakSet,Md=function(){var e;try{return((e=globalThis.pdfjsWorker)==null?void 0:e.WorkerMessageHandler)||null}catch{return null}},y(Ut,tl),y(Ut,Eu,0),y(Ut,la,!1),y(Ut,ha,new WeakMap),He&&(g(Ut,la,!0),mn.workerSrc||(mn.workerSrc="./pdf.worker.mjs")),Ut._isSameOrigin=(e,t)=>{const s=URL.parse(e);if(!(s!=null&&s.origin)||s.origin==="null")return!1;const i=new URL(t,s);return s.origin===i.origin},Ut._createCDNWrapper=e=>{const t=`await import("${e}");`;return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))},Ut.fromPort=e=>{if($v("`PDFWorker.fromPort` - please use `PDFWorker.create` instead."),!(e!=null&&e.port))throw new Error("PDFWorker.fromPort - invalid method signature.");return Ut.create(e)};let ch=Ut;var en,yi,el,sl,sn,ca,th;class Zy{constructor(e,t,s,i,r,a){y(this,ca);y(this,en,new Map);y(this,yi,new Map);y(this,el,new Map);y(this,sl,new Map);y(this,sn,null);this.messageHandler=e,this.loadingTask=t,this.commonObjs=new mm,this.fontLoader=new Zv({ownerDocument:i.ownerDocument,styleElement:i.styleElement}),this.loadingParams=i.loadingParams,this._params=i,this.canvasFactory=r.canvasFactory,this.filterFactory=r.filterFactory,this.cMapReaderFactory=r.cMapReaderFactory,this.standardFontDataFactory=r.standardFontDataFactory,this.wasmFactory=r.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=s,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.enableHWA=a,this.setupMessageHandler()}get annotationStorage(){return Q(this,"annotationStorage",new xp)}getRenderingIntent(e,t=xn.ENABLE,s=null,i=!1,r=!1){let a=bs.DISPLAY,o=mf;switch(e){case"any":a=bs.ANY;break;case"display":break;case"print":a=bs.PRINT;break;default:J(`getRenderingIntent - invalid intent: ${e}`)}const l=a&bs.PRINT&&s instanceof tm?s:this.annotationStorage;switch(t){case xn.DISABLE:a+=bs.ANNOTATIONS_DISABLE;break;case xn.ENABLE:break;case xn.ENABLE_FORMS:a+=bs.ANNOTATIONS_FORMS;break;case xn.ENABLE_STORAGE:a+=bs.ANNOTATIONS_STORAGE,o=l.serializable;break;default:J(`getRenderingIntent - invalid annotationMode: ${t}`)}i&&(a+=bs.IS_EDITING),r&&(a+=bs.OPLIST);const{ids:h,hash:c}=l.modifiedIds,u=[a,o.hash,c];return{renderingIntent:a,cacheKey:u.join("_"),annotationStorageSerializable:o,modifiedIds:h}}destroy(){var s;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),(s=n(this,sn))==null||s.reject(new Error("Worker was destroyed during onPassword callback"));const e=[];for(const i of n(this,yi).values())e.push(i._destroy());n(this,yi).clear(),n(this,el).clear(),n(this,sl).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then(()=>{var i,r;this.commonObjs.clear(),this.fontLoader.clear(),n(this,en).clear(),this.filterFactory.destroy(),hh.cleanup(),(i=this._networkStream)==null||i.cancelAllRequests(new gr("Worker was terminated.")),(r=this.messageHandler)==null||r.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:e,loadingTask:t}=this;e.on("GetReader",(s,i)=>{ut(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=r=>{this._lastProgress={loaded:r.loaded,total:r.total}},i.onPull=()=>{this._fullReader.read().then(function({value:r,done:a}){if(a){i.close();return}ut(r instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(r),1,[r])}).catch(r=>{i.error(r)})},i.onCancel=r=>{this._fullReader.cancel(r),i.ready.catch(a=>{if(!this.destroyed)throw a})}}),e.on("ReaderHeadersReady",async s=>{var o;await this._fullReader.headersReady;const{isStreamingSupported:i,isRangeSupported:r,contentLength:a}=this._fullReader;return(!i||!r)&&(this._lastProgress&&((o=t.onProgress)==null||o.call(t,this._lastProgress)),this._fullReader.onProgress=l=>{var h;(h=t.onProgress)==null||h.call(t,{loaded:l.loaded,total:l.total})}),{isStreamingSupported:i,isRangeSupported:r,contentLength:a}}),e.on("GetRangeReader",(s,i)=>{ut(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const r=this._networkStream.getRangeReader(s.begin,s.end);if(!r){i.close();return}i.onPull=()=>{r.read().then(function({value:a,done:o}){if(o){i.close();return}ut(a instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(a),1,[a])}).catch(a=>{i.error(a)})},i.onCancel=a=>{r.cancel(a),i.ready.catch(o=>{if(!this.destroyed)throw o})}}),e.on("GetDoc",({pdfInfo:s})=>{this._numPages=s.numPages,this._htmlForXfa=s.htmlForXfa,delete s.htmlForXfa,t._capability.resolve(new Jy(s,this))}),e.on("DocException",s=>{t._capability.reject(Ge(s))}),e.on("PasswordRequest",s=>{g(this,sn,Promise.withResolvers());try{if(!t.onPassword)throw Ge(s);const i=r=>{r instanceof Error?n(this,sn).reject(r):n(this,sn).resolve({password:r})};t.onPassword(i,s.code)}catch(i){n(this,sn).reject(i)}return n(this,sn).promise}),e.on("DataLoaded",s=>{var i;(i=t.onProgress)==null||i.call(t,{loaded:s.length,total:s.length}),this.downloadInfoCapability.resolve(s)}),e.on("StartRenderPage",s=>{if(this.destroyed)return;n(this,yi).get(s.pageIndex)._startRenderPage(s.transparency,s.cacheKey)}),e.on("commonobj",([s,i,r])=>{var a;if(this.destroyed||this.commonObjs.has(s))return null;switch(i){case"Font":if("error"in r){const f=r.error;J(`Error during font loading: ${f}`),this.commonObjs.resolve(s,f);break}const o=new vf(r),l=this._params.pdfBug&&((a=globalThis.FontInspector)!=null&&a.enabled)?(f,p)=>globalThis.FontInspector.fontAdded(f,p):null,h=new qv(o,l,r.extra,r.charProcOperatorList);this.fontLoader.bind(h).catch(()=>e.sendWithPromise("FontFallback",{id:s})).finally(()=>{!h.fontExtraProperties&&h.data&&h.clearData(),this.commonObjs.resolve(s,h)});break;case"CopyLocalImage":const{imageRef:c}=r;ut(c,"The imageRef must be defined.");for(const f of n(this,yi).values())for(const[,p]of f.objs)if((p==null?void 0:p.ref)===c)return p.dataLen?(this.commonObjs.resolve(s,structuredClone(p)),p.dataLen):null;break;case"FontPath":this.commonObjs.resolve(s,new ty(r));break;case"Image":this.commonObjs.resolve(s,r);break;case"Pattern":const u=new yf(r);this.commonObjs.resolve(s,u.getIR());break;default:throw new Error(`Got unknown common object type ${i}`)}return null}),e.on("obj",([s,i,r,a])=>{var l;if(this.destroyed)return;const o=n(this,yi).get(i);if(!o.objs.has(s)){if(o._intentStates.size===0){(l=a==null?void 0:a.bitmap)==null||l.close();return}switch(r){case"Image":case"Pattern":o.objs.resolve(s,a);break;default:throw new Error(`Got unknown object type ${r}`)}}}),e.on("DocProgress",s=>{var i;this.destroyed||(i=t.onProgress)==null||i.call(t,{loaded:s.loaded,total:s.total})}),e.on("FetchBinaryData",async s=>{if(this.destroyed)throw new Error("Worker was destroyed.");const i=this[s.type];if(!i)throw new Error(`${s.type} not initialized, see the \`useWorkerFetch\` parameter.`);return i.fetch(s)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var s;this.annotationStorage.size<=0&&J("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:e,transfer:t}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:e,filename:((s=this._fullReader)==null?void 0:s.filename)??null},t).finally(()=>{this.annotationStorage.resetModified()})}extractPages(e){return this.messageHandler.sendWithPromise("ExtractPages",{pageInfos:e})}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));const t=e-1,s=n(this,el).get(t);if(s)return s;const i=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then(r=>{if(this.destroyed)throw new Error("Transport destroyed");r.refStr&&n(this,sl).set(r.refStr,e);const a=new Qy(t,r,this,this._params.pdfBug);return n(this,yi).set(t,a),a});return n(this,el).set(t,i),i}getPageIndex(e){return bf(e)?this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}getFieldObjects(){return w(this,ca,th).call(this,"GetFieldObjects")}hasJSActions(){return w(this,ca,th).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return typeof e!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getAnnotationsByType(e,t){return this.messageHandler.sendWithPromise("GetAnnotationsByType",{types:e,pageIndexesToSkip:t})}getDocJSActions(){return w(this,ca,th).call(this,"GetDocJSActions")}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(e){return w(this,ca,th).call(this,"GetOptionalContentConfig").then(t=>new Iy(t,e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const e="GetMetadata",t=n(this,en).get(e);if(t)return t;const s=this.messageHandler.sendWithPromise(e,null).then(i=>{var r,a;return{info:i[0],metadata:i[1]?new Ry(i[1]):null,contentDispositionFilename:((r=this._fullReader)==null?void 0:r.filename)??null,contentLength:((a=this._fullReader)==null?void 0:a.contentLength)??null,hasStructTree:i[2]}});return n(this,en).set(e,s),s}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(e=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const t of n(this,yi).values())if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),n(this,en).clear(),this.filterFactory.destroy(!0),hh.cleanup()}}cachedPageNumber(e){if(!bf(e))return null;const t=e.gen===0?`${e.num}R`:`${e.num}R${e.gen}`;return n(this,sl).get(t)??null}}en=new WeakMap,yi=new WeakMap,el=new WeakMap,sl=new WeakMap,sn=new WeakMap,ca=new WeakSet,th=function(e,t=null){const s=n(this,en).get(e);if(s)return s;const i=this.messageHandler.sendWithPromise(e,t);return n(this,en).set(e,i),i};var Kn;class qy{constructor(e){y(this,Kn,null);F(this,"onContinue",null);F(this,"onError",null);g(this,Kn,e)}get promise(){return n(this,Kn).capability.promise}cancel(e=0){n(this,Kn).cancel(null,e)}get separateAnnots(){const{separateAnnots:e}=n(this,Kn).operatorList;if(!e)return!1;const{annotationCanvasMap:t}=n(this,Kn);return e.form||e.canvas&&(t==null?void 0:t.size)>0}}Kn=new WeakMap;var Jn,da;const Er=class Er{constructor({callback:e,params:t,objs:s,commonObjs:i,annotationCanvasMap:r,operatorList:a,pageIndex:o,canvasFactory:l,filterFactory:h,useRequestAnimationFrame:c=!1,pdfBug:u=!1,pageColors:f=null,enableHWA:p=!1,operationsFilter:v=null}){y(this,Jn,null);this.callback=e,this.params=t,this.objs=s,this.commonObjs=i,this.annotationCanvasMap=r,this.operatorListIdx=null,this.operatorList=a,this._pageIndex=o,this.canvasFactory=l,this.filterFactory=h,this._pdfBug=u,this.pageColors=f,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=c===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new qy(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvas,this._canvasContext=t.canvas?null:t.canvasContext,this._enableHWA=p,this._dependencyTracker=t.dependencyTracker,this._operationsFilter=v}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){var l,h;if(this.cancelled)return;if(this._canvas){if(n(Er,da).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");n(Er,da).add(this._canvas)}this._pdfBug&&((l=globalThis.StepperManager)!=null&&l.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{viewport:s,transform:i,background:r,dependencyTracker:a}=this.params,o=this._canvasContext||this._canvas.getContext("2d",{alpha:!1,willReadFrequently:!this._enableHWA});this.gfx=new ao(o,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:t},this.annotationCanvasMap,this.pageColors,a),this.gfx.beginDrawing({transform:i,viewport:s,transparency:e,background:r}),this.operatorListIdx=0,this.graphicsReady=!0,(h=this.graphicsReadyCallback)==null||h.call(this)}cancel(e=null,t=0){var s,i,r;this.running=!1,this.cancelled=!0,(s=this.gfx)==null||s.endDrawing(),n(this,Jn)&&(window.cancelAnimationFrame(n(this,Jn)),g(this,Jn,null)),n(Er,da).delete(this._canvas),e||(e=new Ep(`Rendering cancelled, page ${this._pageIndex+1}`,t)),this.callback(e),(r=(i=this.task).onError)==null||r.call(i,e)}operatorListChanged(){var e,t;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(e=this.gfx.dependencyTracker)==null||e.growOperationsCount(this.operatorList.fnArray.length),(t=this.stepper)==null||t.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?g(this,Jn,window.requestAnimationFrame(()=>{g(this,Jn,null),this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper,this._operationsFilter),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),n(Er,da).delete(this._canvas),this.callback())))}};Jn=new WeakMap,da=new WeakMap,y(Er,da,new WeakSet);let Ff=Er;const tb="5.4.530",eb="50cc4adac";var as,ua,il,oe,bc,nl,nn,Ac,Qn,Ks,wc,Rt,kf,Nf,Bf,yr,xm,Sn;const Ve=class Ve{constructor({editor:e=null,uiManager:t=null}){y(this,Rt);y(this,as,null);y(this,ua,null);y(this,il);y(this,oe,null);y(this,bc,!1);y(this,nl,!1);y(this,nn,null);y(this,Ac);y(this,Qn,null);y(this,Ks,null);var s,i;e?(g(this,nl,!1),g(this,nn,e)):g(this,nl,!0),g(this,Ks,(e==null?void 0:e._uiManager)||t),g(this,Ac,n(this,Ks)._eventBus),g(this,il,((s=e==null?void 0:e.color)==null?void 0:s.toUpperCase())||((i=n(this,Ks))==null?void 0:i.highlightColors.values().next().value)||"#FFFF98"),n(Ve,wc)||g(Ve,wc,Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"}))}static get _keyboardManager(){return Q(this,"_keyboardManager",new rd([[["Escape","mac+Escape"],Ve.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],Ve.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],Ve.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],Ve.prototype._moveToPrevious],[["Home","mac+Home"],Ve.prototype._moveToBeginning],[["End","mac+End"],Ve.prototype._moveToEnd]]))}renderButton(){const e=g(this,as,document.createElement("button"));e.className="colorPicker",e.tabIndex="0",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),e.ariaHasPopup="true",n(this,nn)&&(e.ariaControls=`${n(this,nn).id}_colorpicker_dropdown`);const t=n(this,Ks)._signal;e.addEventListener("click",w(this,Rt,yr).bind(this),{signal:t}),e.addEventListener("keydown",w(this,Rt,Bf).bind(this),{signal:t});const s=g(this,ua,document.createElement("span"));return s.className="swatch",s.ariaHidden="true",s.style.backgroundColor=n(this,il),e.append(s),e}renderMainDropdown(){const e=g(this,oe,w(this,Rt,kf).call(this));return e.ariaOrientation="horizontal",e.ariaLabelledBy="highlightColorPickerLabel",e}_colorSelectFromKeyboard(e){if(e.target===n(this,as)){w(this,Rt,yr).call(this,e);return}const t=e.target.getAttribute("data-color");t&&w(this,Rt,Nf).call(this,t,e)}_moveToNext(e){var t,s;if(!n(this,Rt,Sn)){w(this,Rt,yr).call(this,e);return}if(e.target===n(this,as)){(t=n(this,oe).firstElementChild)==null||t.focus();return}(s=e.target.nextSibling)==null||s.focus()}_moveToPrevious(e){var t,s;if(e.target===((t=n(this,oe))==null?void 0:t.firstElementChild)||e.target===n(this,as)){n(this,Rt,Sn)&&this._hideDropdownFromKeyboard();return}n(this,Rt,Sn)||w(this,Rt,yr).call(this,e),(s=e.target.previousSibling)==null||s.focus()}_moveToBeginning(e){var t;if(!n(this,Rt,Sn)){w(this,Rt,yr).call(this,e);return}(t=n(this,oe).firstElementChild)==null||t.focus()}_moveToEnd(e){var t;if(!n(this,Rt,Sn)){w(this,Rt,yr).call(this,e);return}(t=n(this,oe).lastElementChild)==null||t.focus()}hideDropdown(){var e,t;(e=n(this,oe))==null||e.classList.add("hidden"),n(this,as).ariaExpanded="false",(t=n(this,Qn))==null||t.abort(),g(this,Qn,null)}_hideDropdownFromKeyboard(){var e;if(!n(this,nl)){if(!n(this,Rt,Sn)){(e=n(this,nn))==null||e.unselect();return}this.hideDropdown(),n(this,as).focus({preventScroll:!0,focusVisible:n(this,bc)})}}updateColor(e){if(n(this,ua)&&(n(this,ua).style.backgroundColor=e),!n(this,oe))return;const t=n(this,Ks).highlightColors.values();for(const s of n(this,oe).children)s.ariaSelected=t.next().value===e.toUpperCase()}destroy(){var e,t;(e=n(this,as))==null||e.remove(),g(this,as,null),g(this,ua,null),(t=n(this,oe))==null||t.remove(),g(this,oe,null)}};as=new WeakMap,ua=new WeakMap,il=new WeakMap,oe=new WeakMap,bc=new WeakMap,nl=new WeakMap,nn=new WeakMap,Ac=new WeakMap,Qn=new WeakMap,Ks=new WeakMap,wc=new WeakMap,Rt=new WeakSet,kf=function(){const e=document.createElement("div"),t=n(this,Ks)._signal;e.addEventListener("contextmenu",Hs,{signal:t}),e.className="dropdown",e.role="listbox",e.ariaMultiSelectable="false",e.ariaOrientation="vertical",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown"),n(this,nn)&&(e.id=`${n(this,nn).id}_colorpicker_dropdown`);for(const[s,i]of n(this,Ks).highlightColors){const r=document.createElement("button");r.tabIndex="0",r.role="option",r.setAttribute("data-color",i),r.title=s,r.setAttribute("data-l10n-id",n(Ve,wc)[s]);const a=document.createElement("span");r.append(a),a.className="swatch",a.style.backgroundColor=i,r.ariaSelected=i===n(this,il),r.addEventListener("click",w(this,Rt,Nf).bind(this,i),{signal:t}),e.append(r)}return e.addEventListener("keydown",w(this,Rt,Bf).bind(this),{signal:t}),e},Nf=function(e,t){t.stopPropagation(),n(this,Ac).dispatch("switchannotationeditorparams",{source:this,type:dt.HIGHLIGHT_COLOR,value:e}),this.updateColor(e)},Bf=function(e){Ve._keyboardManager.exec(this,e)},yr=function(e){if(n(this,Rt,Sn)){this.hideDropdown();return}if(g(this,bc,e.detail===0),n(this,Qn)||(g(this,Qn,new AbortController),window.addEventListener("pointerdown",w(this,Rt,xm).bind(this),{signal:n(this,Ks).combinedSignal(n(this,Qn))})),n(this,as).ariaExpanded="true",n(this,oe)){n(this,oe).classList.remove("hidden");return}const t=g(this,oe,w(this,Rt,kf).call(this));n(this,as).append(t)},xm=function(e){var t;(t=n(this,oe))!=null&&t.contains(e.target)||this.hideDropdown()},Sn=function(){return n(this,oe)&&!n(this,oe).classList.contains("hidden")},y(Ve,wc,null);let ru=Ve;var bi,Ec,rl,Sc;const Sr=class Sr{constructor(e){y(this,bi,null);y(this,Ec,null);y(this,rl,null);g(this,Ec,e),g(this,rl,e._uiManager),n(Sr,Sc)||g(Sr,Sc,Object.freeze({freetext:"pdfjs-editor-color-picker-free-text-input",ink:"pdfjs-editor-color-picker-ink-input"}))}renderButton(){if(n(this,bi))return n(this,bi);const{editorType:e,colorType:t,color:s}=n(this,Ec),i=g(this,bi,document.createElement("input"));return i.type="color",i.value=s||"#000000",i.className="basicColorPicker",i.tabIndex=0,i.setAttribute("data-l10n-id",n(Sr,Sc)[e]),i.addEventListener("input",()=>{n(this,rl).updateParams(t,i.value)},{signal:n(this,rl)._signal}),i}update(e){n(this,bi)&&(n(this,bi).value=e)}destroy(){var e;(e=n(this,bi))==null||e.remove(),g(this,bi,null)}hideDropdown(){}};bi=new WeakMap,Ec=new WeakMap,rl=new WeakMap,Sc=new WeakMap,y(Sr,Sc,null);let au=Sr;it(116);it(531);function hg(d){return Math.floor(Math.max(0,Math.min(1,d))*255).toString(16).padStart(2,"0")}function Bl(d){return Math.max(0,Math.min(255,255*d))}class cg{static CMYK_G([e,t,s,i]){return["G",1-Math.min(1,.3*e+.59*s+.11*t+i)]}static G_CMYK([e]){return["CMYK",0,0,0,1-e]}static G_RGB([e]){return["RGB",e,e,e]}static G_rgb([e]){return e=Bl(e),[e,e,e]}static G_HTML([e]){const t=hg(e);return`#${t}${t}${t}`}static RGB_G([e,t,s]){return["G",.3*e+.59*t+.11*s]}static RGB_rgb(e){return e.map(Bl)}static RGB_HTML(e){return`#${e.map(hg).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([e,t,s,i]){return["RGB",1-Math.min(1,e+i),1-Math.min(1,s+i),1-Math.min(1,t+i)]}static CMYK_rgb([e,t,s,i]){return[Bl(1-Math.min(1,e+i)),Bl(1-Math.min(1,s+i)),Bl(1-Math.min(1,t+i))]}static CMYK_HTML(e){const t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK([e,t,s]){const i=1-e,r=1-t,a=1-s,o=Math.min(i,r,a);return["CMYK",i,r,a,o]}}class sb{create(e,t,s=!1){if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");const i=this._createSVG("svg:svg");return i.setAttribute("version","1.1"),s||(i.setAttribute("width",`${e}px`),i.setAttribute("height",`${t}px`)),i.setAttribute("preserveAspectRatio","none"),i.setAttribute("viewBox",`0 0 ${e} ${t}`),i}createElement(e){if(typeof e!="string")throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){Ot("Abstract method `_createSVG` called.")}}class ou extends sb{_createSVG(e){return document.createElementNS(Di,e)}}const ib=9,$a=new WeakSet,nb=new Date().getTimezoneOffset()*60*1e3;class Wu{static create(e){switch(e.data.annotationType){case te.LINK:return new Rp(e);case te.TEXT:return new ab(e);case te.WIDGET:switch(e.data.fieldType){case"Tx":return new ob(e);case"Btn":return e.data.radioButton?new Rm(e):e.data.checkBox?new hb(e):new cb(e);case"Ch":return new db(e);case"Sig":return new lb(e)}return new za(e);case te.POPUP:return new Uf(e);case te.FREETEXT:return new Om(e);case te.LINE:return new fb(e);case te.SQUARE:return new pb(e);case te.CIRCLE:return new gb(e);case te.POLYLINE:return new Lm(e);case te.CARET:return new vb(e);case te.INK:return new Pp(e);case te.POLYGON:return new mb(e);case te.HIGHLIGHT:return new Fm(e);case te.UNDERLINE:return new yb(e);case te.SQUIGGLY:return new bb(e);case te.STRIKEOUT:return new Ab(e);case te.STAMP:return new km(e);case te.FILEATTACHMENT:return new wb(e);default:return new Gt(e)}}}var fa,al,ks,xc,_f;const kp=class kp{constructor(e,{isRenderable:t=!1,ignoreBorder:s=!1,createQuadrilaterals:i=!1}={}){y(this,xc);y(this,fa,null);y(this,al,!1);y(this,ks,null);this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableComment=e.enableComment,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,this.hasOwnCommentButton=!1,t&&(this.contentElement=this.container=this._createContainer(s)),i&&this._createQuadrilaterals()}static _hasPopupData({contentsObj:e,richText:t}){return!!(e!=null&&e.str||t!=null&&t.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return kp._hasPopupData(this.data)||this.enableComment&&!!this.commentText}get commentData(){var s;const{data:e}=this,t=(s=this.annotationStorage)==null?void 0:s.getEditor(e.id);return t?t.getData():e}get hasCommentButton(){return this.enableComment&&this.hasPopupElement}get commentButtonPosition(){var o;const e=(o=this.annotationStorage)==null?void 0:o.getEditor(this.data.id);if(e)return e.commentButtonPositionInPage;const{quadPoints:t,inkLists:s,rect:i}=this.data;let r=-1/0,a=-1/0;if((t==null?void 0:t.length)>=8){for(let l=0;l<t.length;l+=8)t[l+1]>a?(a=t[l+1],r=t[l+2]):t[l+1]===a&&(r=Math.max(r,t[l+2]));return[r,a]}if((s==null?void 0:s.length)>=1){for(const l of s)for(let h=0,c=l.length;h<c;h+=2)l[h+1]>a?(a=l[h+1],r=l[h]):l[h+1]===a&&(r=Math.max(r,l[h]));if(r!==1/0)return[r,a]}return i?[i[2],i[3]]:null}_normalizePoint(e){const{page:{view:t},viewport:{rawDims:{pageWidth:s,pageHeight:i,pageX:r,pageY:a}}}=this.parent;return e[1]=t[3]-e[1]+t[1],e[0]=100*(e[0]-r)/s,e[1]=100*(e[1]-a)/i,e}get commentText(){var t,s,i;const{data:e}=this;return((s=(t=this.annotationStorage.getRawValue(`${ah}${e.id}`))==null?void 0:t.popup)==null?void 0:s.contents)||((i=e.contentsObj)==null?void 0:i.str)||""}set commentText(e){const{data:t}=this,s={deleted:!e,contents:e||""};this.annotationStorage.updateEditor(t.id,{popup:s})||this.annotationStorage.setValue(`${ah}${t.id}`,{id:t.id,annotationType:t.annotationType,pageIndex:this.parent.page._pageIndex,popup:s,popupRef:t.popupRef,modificationDate:new Date}),e||this.removePopup()}removePopup(){var e,t;(t=((e=n(this,ks))==null?void 0:e.popup)||this.popup)==null||t.remove(),g(this,ks,this.popup=null)}updateEdited(e){var r;if(!this.container)return;e.rect&&(n(this,fa)||g(this,fa,{rect:this.data.rect.slice(0)}));const{rect:t,popup:s}=e;t&&w(this,xc,_f).call(this,t);let i=((r=n(this,ks))==null?void 0:r.popup)||this.popup;!i&&(s!=null&&s.text)&&(this._createPopup(s),i=n(this,ks).popup),i&&(i.updateEdited(e),s!=null&&s.deleted&&(i.remove(),g(this,ks,null),this.popup=null))}resetEdited(){var e;n(this,fa)&&(w(this,xc,_f).call(this,n(this,fa).rect),(e=n(this,ks))==null||e.popup.resetEdited(),g(this,fa,null))}_createContainer(e){const{data:t,parent:{page:s,viewport:i}}=this,r=document.createElement("section");r.setAttribute("data-annotation-id",t.id),!(this instanceof za)&&!(this instanceof Rp)&&(r.tabIndex=0);const{style:a}=r;if(a.zIndex=this.parent.zIndex,this.parent.zIndex+=2,t.alternativeText&&(r.title=t.alternativeText),t.noRotate&&r.classList.add("norotate"),!t.rect||this instanceof Uf){const{rotation:m}=t;return!t.hasOwnCanvas&&m!==0&&this.setRotation(m,r),r}const{width:o,height:l}=this;if(!e&&t.borderStyle.width>0){a.borderWidth=`${t.borderStyle.width}px`;const m=t.borderStyle.horizontalCornerRadius,A=t.borderStyle.verticalCornerRadius;if(m>0||A>0){const S=`calc(${m}px * var(--total-scale-factor)) / calc(${A}px * var(--total-scale-factor))`;a.borderRadius=S}else if(this instanceof Rm){const S=`calc(${o}px * var(--total-scale-factor)) / calc(${l}px * var(--total-scale-factor))`;a.borderRadius=S}switch(t.borderStyle.style){case Wa.SOLID:a.borderStyle="solid";break;case Wa.DASHED:a.borderStyle="dashed";break;case Wa.BEVELED:J("Unimplemented border style: beveled");break;case Wa.INSET:J("Unimplemented border style: inset");break;case Wa.UNDERLINE:a.borderBottomStyle="solid";break}const b=t.borderColor||null;b?(g(this,al,!0),a.borderColor=j.makeHexColor(b[0]|0,b[1]|0,b[2]|0)):a.borderWidth=0}const h=j.normalizeRect([t.rect[0],s.view[3]-t.rect[1]+s.view[1],t.rect[2],s.view[3]-t.rect[3]+s.view[1]]),{pageWidth:c,pageHeight:u,pageX:f,pageY:p}=i.rawDims;a.left=`${100*(h[0]-f)/c}%`,a.top=`${100*(h[1]-p)/u}%`;const{rotation:v}=t;return t.hasOwnCanvas||v===0?(a.width=`${100*o/c}%`,a.height=`${100*l/u}%`):this.setRotation(v,r),r}setRotation(e,t=this.container){if(!this.data.rect)return;const{pageWidth:s,pageHeight:i}=this.parent.viewport.rawDims;let{width:r,height:a}=this;e%180!==0&&([r,a]=[a,r]),t.style.width=`${100*r/s}%`,t.style.height=`${100*a/i}%`,t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){const e=(t,s,i)=>{const r=i.detail[t],a=r[0],o=r.slice(1);i.target.style[s]=cg[`${a}_HTML`](o),this.annotationStorage.setValue(this.data.id,{[s]:cg[`${a}_rgb`](o)})};return Q(this,"_commonActions",{display:t=>{const{display:s}=t.detail,i=s%2===1;this.container.style.visibility=i?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:i,noPrint:s===1||s===2})},print:t=>{this.annotationStorage.setValue(this.data.id,{noPrint:!t.detail.print})},hidden:t=>{const{hidden:s}=t.detail;this.container.style.visibility=s?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:s,noView:s})},focus:t=>{setTimeout(()=>t.target.focus({preventScroll:!1}),0)},userName:t=>{t.target.title=t.detail.userName},readonly:t=>{t.target.disabled=t.detail.readonly},required:t=>{this._setRequired(t.target,t.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:t=>{const s=t.detail.rotation;this.setRotation(s),this.annotationStorage.setValue(this.data.id,{rotation:s})}})}_dispatchEventFromSandbox(e,t){const s=this._commonActions;for(const i of Object.keys(t.detail)){const r=e[i]||s[i];r==null||r(t)}}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;const t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;const s=this._commonActions;for(const[i,r]of Object.entries(t)){const a=s[i];if(a){const o={detail:{[i]:r},target:e};a(o),delete t[i]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:e}=this.data;if(!e)return;const[t,s,i,r]=this.data.rect.map(m=>Math.fround(m));if(e.length===8){const[m,A,b,S]=e.subarray(2,6);if(i===m&&r===A&&t===b&&s===S)return}const{style:a}=this.container;let o;if(n(this,al)){const{borderColor:m,borderWidth:A}=a;a.borderWidth=0,o=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${m}" stroke-width="${A}">`],this.container.classList.add("hasBorder")}const l=i-t,h=r-s,{svgFactory:c}=this,u=c.createElement("svg");u.classList.add("quadrilateralsContainer"),u.setAttribute("width",0),u.setAttribute("height",0),u.role="none";const f=c.createElement("defs");u.append(f);const p=c.createElement("clipPath"),v=`clippath_${this.data.id}`;p.setAttribute("id",v),p.setAttribute("clipPathUnits","objectBoundingBox"),f.append(p);for(let m=2,A=e.length;m<A;m+=8){const b=e[m],S=e[m+1],E=e[m+2],T=e[m+3],x=c.createElement("rect"),C=(E-t)/l,R=(r-S)/h,I=(b-E)/l,P=(S-T)/h;x.setAttribute("x",C),x.setAttribute("y",R),x.setAttribute("width",I),x.setAttribute("height",P),p.append(x),o==null||o.push(`<rect vector-effect="non-scaling-stroke" x="${C}" y="${R}" width="${I}" height="${P}"/>`)}n(this,al)&&(o.push("</g></svg>')"),a.backgroundImage=o.join("")),this.container.append(u),this.container.style.clipPath=`url(#${v})`}_createPopup(e=null){const{data:t}=this;let s,i;e?(s={str:e.text},i=e.date):(s=t.contentsObj,i=t.modificationDate),g(this,ks,new Uf({data:{color:t.color,titleObj:t.titleObj,modificationDate:i,contentsObj:s,richText:t.richText,parentRect:t.rect,borderStyle:0,id:`popup_${t.id}`,rotation:t.rotation,noRotate:!0},linkService:this.linkService,parent:this.parent,elements:[this]}))}get hasPopupElement(){return!!(n(this,ks)||this.popup||this.data.popupRef)}get extraPopupElement(){return n(this,ks)}render(){Ot("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,t=null){const s=[];if(this._fieldObjects){const i=this._fieldObjects[e];if(i)for(const{page:r,id:a,exportValues:o}of i){if(r===-1||a===t)continue;const l=typeof o=="string"?o:null,h=document.querySelector(`[data-element-id="${a}"]`);if(h&&!$a.has(h)){J(`_getElementsByName - element not allowed: ${a}`);continue}s.push({id:a,exportValue:l,domElement:h})}return s}for(const i of document.getElementsByName(e)){const{exportValue:r}=i,a=i.getAttribute("data-element-id");a!==t&&$a.has(i)&&s.push({id:a,exportValue:r,domElement:i})}return s}show(){var e;this.container&&(this.container.hidden=!1),(e=this.popup)==null||e.maybeShow()}hide(){var e;this.container&&(this.container.hidden=!0),(e=this.popup)==null||e.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(const t of e)t.classList.add("highlightArea");else e.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:e,data:{id:t}}=this;this.container.addEventListener("dblclick",()=>{var s;(s=this.linkService.eventBus)==null||s.dispatch("switchannotationeditormode",{source:this,mode:e,editId:t,mustEnterInEditMode:!0})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}};fa=new WeakMap,al=new WeakMap,ks=new WeakMap,xc=new WeakSet,_f=function(e){const{container:{style:t},data:{rect:s,rotation:i},parent:{viewport:{rawDims:{pageWidth:r,pageHeight:a,pageX:o,pageY:l}}}}=this;s==null||s.splice(0,4,...e),t.left=`${100*(e[0]-o)/r}%`,t.top=`${100*(a-e[3]+l)/a}%`,i===0?(t.width=`${100*(e[2]-e[0])/r}%`,t.height=`${100*(e[3]-e[1])/a}%`):this.setRotation(i)};let Gt=kp;class rb extends Gt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.editor=e.editor}render(){return this.container.className="editorAnnotation",this.container}createOrUpdatePopup(){const{editor:e}=this;e.hasComment&&this._createPopup(e.comment)}get hasCommentButton(){return this.enableComment&&this.editor.hasComment}get commentButtonPosition(){return this.editor.commentButtonPositionInPage}get commentText(){return this.editor.comment.text}set commentText(e){this.editor.comment=e,e||this.removePopup()}get commentData(){return this.editor.getData()}remove(){this.parent.removeAnnotation(this.data.id),this.container.remove(),this.container=null,this.removePopup()}}var ws,br,Tm,Cm;class Rp extends Gt{constructor(t,s=null){super(t,{isRenderable:!0,ignoreBorder:!!(s!=null&&s.ignoreBorder),createQuadrilaterals:!0});y(this,ws);this.isTooltipOnly=t.data.isTooltipOnly}render(){const{data:t,linkService:s}=this,i=document.createElement("a");i.setAttribute("data-element-id",t.id);let r=!1;return t.url?(s.addLinkAttributes(i,t.url,t.newWindow),r=!0):t.action?(this._bindNamedAction(i,t.action,t.overlaidText),r=!0):t.attachment?(w(this,ws,Tm).call(this,i,t.attachment,t.overlaidText,t.attachmentDest),r=!0):t.setOCGState?(w(this,ws,Cm).call(this,i,t.setOCGState,t.overlaidText),r=!0):t.dest?(this._bindLink(i,t.dest,t.overlaidText),r=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(i,t),r=!0),t.resetForm?(this._bindResetFormAction(i,t.resetForm),r=!0):this.isTooltipOnly&&!r&&(this._bindLink(i,""),r=!0)),this.container.classList.add("linkAnnotation"),r&&(this.contentElement=i,this.container.append(i)),this.container}_bindLink(t,s,i=""){t.href=this.linkService.getDestinationHash(s),t.onclick=()=>(s&&this.linkService.goToDestination(s),!1),(s||s==="")&&w(this,ws,br).call(this),i&&(t.title=i)}_bindNamedAction(t,s,i=""){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(s),!1),i&&(t.title=i),w(this,ws,br).call(this)}_bindJSAction(t,s){t.href=this.linkService.getAnchorUrl("");const i=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const r of Object.keys(s.actions)){const a=i.get(r);a&&(t[a]=()=>{var o;return(o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:s.id,name:r}}),!1})}s.overlaidText&&(t.title=s.overlaidText),t.onclick||(t.onclick=()=>!1),w(this,ws,br).call(this)}_bindResetFormAction(t,s){const i=t.onclick;if(i||(t.href=this.linkService.getAnchorUrl("")),w(this,ws,br).call(this),!this._fieldObjects){J('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),i||(t.onclick=()=>!1);return}t.onclick=()=>{var u;i==null||i();const{fields:r,refs:a,include:o}=s,l=[];if(r.length!==0||a.length!==0){const f=new Set(a);for(const p of r){const v=this._fieldObjects[p]||[];for(const{id:m}of v)f.add(m)}for(const p of Object.values(this._fieldObjects))for(const v of p)f.has(v.id)===o&&l.push(v)}else for(const f of Object.values(this._fieldObjects))l.push(...f);const h=this.annotationStorage,c=[];for(const f of l){const{id:p}=f;switch(c.push(p),f.type){case"text":{const m=f.defaultValue||"";h.setValue(p,{value:m});break}case"checkbox":case"radiobutton":{const m=f.defaultValue===f.exportValues;h.setValue(p,{value:m});break}case"combobox":case"listbox":{const m=f.defaultValue||"";h.setValue(p,{value:m});break}default:continue}const v=document.querySelector(`[data-element-id="${p}"]`);if(v){if(!$a.has(v)){J(`_bindResetFormAction - element not allowed: ${p}`);continue}}else continue;v.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((u=this.linkService.eventBus)==null||u.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:c,name:"ResetForm"}})),!1}}}ws=new WeakSet,br=function(){this.container.setAttribute("data-internal-link","")},Tm=function(t,s,i="",r=null){t.href=this.linkService.getAnchorUrl(""),s.description?t.title=s.description:i&&(t.title=i),t.onclick=()=>{var a;return(a=this.downloadManager)==null||a.openOrDownloadData(s.content,s.filename,r),!1},w(this,ws,br).call(this)},Cm=function(t,s,i=""){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(s),!1),i&&(t.title=i),w(this,ws,br).call(this)};class ab extends Gt{constructor(e){super(e,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),e.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.append(e),this.container}}class za extends Gt{render(){return this.container}showElementAndHideCanvas(e){var t;this.data.hasOwnCanvas&&(((t=e.previousSibling)==null?void 0:t.nodeName)==="CANVAS"&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){return he.platform.isMac?e.metaKey:e.ctrlKey}_setEventListener(e,t,s,i,r){s.includes("mouse")?e.addEventListener(s,a=>{var o;(o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:r(a),shift:a.shiftKey,modifier:this._getKeyModifier(a)}})}):e.addEventListener(s,a=>{var o;if(s==="blur"){if(!t.focused||!a.relatedTarget)return;t.focused=!1}else if(s==="focus"){if(t.focused)return;t.focused=!0}r&&((o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:r(a)}}))})}_setEventListeners(e,t,s,i){var r,a,o;for(const[l,h]of s)(h==="Action"||(r=this.data.actions)!=null&&r[h])&&((h==="Focus"||h==="Blur")&&(t||(t={focused:!1})),this._setEventListener(e,t,l,h,i),h==="Focus"&&!((a=this.data.actions)!=null&&a.Blur)?this._setEventListener(e,t,"blur","Blur",null):h==="Blur"&&!((o=this.data.actions)!=null&&o.Focus)&&this._setEventListener(e,t,"focus","Focus",null))}_setBackgroundColor(e){const t=this.data.backgroundColor||null;e.style.backgroundColor=t===null?"transparent":j.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){const t=["left","center","right"],{fontColor:s}=this.data.defaultAppearanceData,i=this.data.defaultAppearanceData.fontSize||ib,r=e.style;let a;const o=2,l=h=>Math.round(10*h)/10;if(this.data.multiLine){const h=Math.abs(this.data.rect[3]-this.data.rect[1]-o),c=Math.round(h/(_u*i))||1,u=h/c;a=Math.min(i,l(u/_u))}else{const h=Math.abs(this.data.rect[3]-this.data.rect[1]-o);a=Math.min(i,l(h/_u))}r.fontSize=`calc(${a}px * var(--total-scale-factor))`,r.color=j.makeHexColor(s[0],s[1],s[2]),this.data.textAlignment!==null&&(r.textAlign=t[this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}}class ob extends za{constructor(e){const t=e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue;super(e,{isRenderable:t})}setPropertyOnSiblings(e,t,s,i){const r=this.annotationStorage;for(const a of this._getElementsByName(e.name,e.id))a.domElement&&(a.domElement[t]=s),r.setValue(a.id,{[i]:s})}render(){var i,r;const e=this.annotationStorage,t=this.data.id;this.container.classList.add("textWidgetAnnotation");let s=null;if(this.renderForms){const a=e.getValue(t,{value:this.data.fieldValue});let o=a.value||"";const l=e.getValue(t,{charLimit:this.data.maxLen}).charLimit;l&&o.length>l&&(o=o.slice(0,l));let h=a.formattedValue||((i=this.data.textContent)==null?void 0:i.join(`
`))||null;h&&this.data.comb&&(h=h.replaceAll(/\s+/g,""));const c={userValue:o,formattedValue:h,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(s=document.createElement("textarea"),s.textContent=h??o,this.data.doNotScroll&&(s.style.overflowY="hidden")):(s=document.createElement("input"),s.type=this.data.password?"password":"text",s.setAttribute("value",h??o),this.data.doNotScroll&&(s.style.overflowX="hidden")),this.data.hasOwnCanvas&&(s.hidden=!0),$a.add(s),this.contentElement=s,s.setAttribute("data-element-id",t),s.disabled=this.data.readOnly,s.name=this.data.fieldName,s.tabIndex=0;const{datetimeFormat:u,datetimeType:f,timeStep:p}=this.data,v=!!f&&this.enableScripting;u&&(s.title=u),this._setRequired(s,this.data.required),l&&(s.maxLength=l),s.addEventListener("input",A=>{e.setValue(t,{value:A.target.value}),this.setPropertyOnSiblings(s,"value",A.target.value,"value"),c.formattedValue=null}),s.addEventListener("resetform",A=>{const b=this.data.defaultFieldValue??"";s.value=c.userValue=b,c.formattedValue=null});let m=A=>{const{formattedValue:b}=c;b!=null&&(A.target.value=b),A.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){s.addEventListener("focus",b=>{var E;if(c.focused)return;const{target:S}=b;if(v&&(S.type=f,p&&(S.step=p)),c.userValue){const T=c.userValue;if(v)if(f==="time"){const x=new Date(T),C=[x.getHours(),x.getMinutes(),x.getSeconds()];S.value=C.map(R=>R.toString().padStart(2,"0")).join(":")}else S.value=new Date(T-nb).toISOString().split(f==="date"?"T":".",1)[0];else S.value=T}c.lastCommittedValue=S.value,c.commitKey=1,(E=this.data.actions)!=null&&E.Focus||(c.focused=!0)}),s.addEventListener("updatefromsandbox",b=>{this.showElementAndHideCanvas(b.target);const S={value(E){c.userValue=E.detail.value??"",v||e.setValue(t,{value:c.userValue.toString()}),E.target.value=c.userValue},formattedValue(E){const{formattedValue:T}=E.detail;c.formattedValue=T,T!=null&&E.target!==document.activeElement&&(E.target.value=T);const x={formattedValue:T};v&&(x.value=T),e.setValue(t,x)},selRange(E){E.target.setSelectionRange(...E.detail.selRange)},charLimit:E=>{var R;const{charLimit:T}=E.detail,{target:x}=E;if(T===0){x.removeAttribute("maxLength");return}x.setAttribute("maxLength",T);let C=c.userValue;!C||C.length<=T||(C=C.slice(0,T),x.value=c.userValue=C,e.setValue(t,{value:C}),(R=this.linkService.eventBus)==null||R.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:C,willCommit:!0,commitKey:1,selStart:x.selectionStart,selEnd:x.selectionEnd}}))}};this._dispatchEventFromSandbox(S,b)}),s.addEventListener("keydown",b=>{var T;c.commitKey=1;let S=-1;if(b.key==="Escape"?S=0:b.key==="Enter"&&!this.data.multiLine?S=2:b.key==="Tab"&&(c.commitKey=3),S===-1)return;const{value:E}=b.target;c.lastCommittedValue!==E&&(c.lastCommittedValue=E,c.userValue=E,(T=this.linkService.eventBus)==null||T.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:E,willCommit:!0,commitKey:S,selStart:b.target.selectionStart,selEnd:b.target.selectionEnd}}))});const A=m;m=null,s.addEventListener("blur",b=>{var T,x;if(!c.focused||!b.relatedTarget)return;(T=this.data.actions)!=null&&T.Blur||(c.focused=!1);const{target:S}=b;let{value:E}=S;if(v){if(E&&f==="time"){const C=E.split(":").map(R=>parseInt(R,10));E=new Date(2e3,0,1,C[0],C[1],C[2]||0).valueOf(),S.step=""}else E.includes("T")||(E=`${E}T00:00`),E=new Date(E).valueOf();S.type="text"}c.userValue=E,c.lastCommittedValue!==E&&((x=this.linkService.eventBus)==null||x.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:E,willCommit:!0,commitKey:c.commitKey,selStart:b.target.selectionStart,selEnd:b.target.selectionEnd}})),A(b)}),(r=this.data.actions)!=null&&r.Keystroke&&s.addEventListener("beforeinput",b=>{var P;c.lastCommittedValue=null;const{data:S,target:E}=b,{value:T,selectionStart:x,selectionEnd:C}=E;let R=x,I=C;switch(b.inputType){case"deleteWordBackward":{const M=T.substring(0,x).match(/\w*[^\w]*$/);M&&(R-=M[0].length);break}case"deleteWordForward":{const M=T.substring(x).match(/^[^\w]*\w*/);M&&(I+=M[0].length);break}case"deleteContentBackward":x===C&&(R-=1);break;case"deleteContentForward":x===C&&(I+=1);break}b.preventDefault(),(P=this.linkService.eventBus)==null||P.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:T,change:S||"",willCommit:!1,selStart:R,selEnd:I}})}),this._setEventListeners(s,c,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],b=>b.target.value)}if(m&&s.addEventListener("blur",m),this.data.comb){const b=(this.data.rect[2]-this.data.rect[0])/l;s.classList.add("comb"),s.style.letterSpacing=`calc(${b}px * var(--total-scale-factor) - 1ch)`}}else s=document.createElement("div"),s.textContent=this.data.fieldValue,s.style.verticalAlign="middle",s.style.display="table-cell",this.data.hasOwnCanvas&&(s.hidden=!0);return this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class lb extends za{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}}class hb extends za{constructor(e){super(e,{isRenderable:e.renderForms})}render(){const e=this.annotationStorage,t=this.data,s=t.id;let i=e.getValue(s,{value:t.exportValue===t.fieldValue}).value;typeof i=="string"&&(i=i!=="Off",e.setValue(s,{value:i})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const r=document.createElement("input");return $a.add(r),r.setAttribute("data-element-id",s),r.disabled=t.readOnly,this._setRequired(r,this.data.required),r.type="checkbox",r.name=t.fieldName,i&&r.setAttribute("checked",!0),r.setAttribute("exportValue",t.exportValue),r.tabIndex=0,r.addEventListener("change",a=>{const{name:o,checked:l}=a.target;for(const h of this._getElementsByName(o,s)){const c=l&&h.exportValue===t.exportValue;h.domElement&&(h.domElement.checked=c),e.setValue(h.id,{value:c})}e.setValue(s,{value:l})}),r.addEventListener("resetform",a=>{const o=t.defaultFieldValue||"Off";a.target.checked=o===t.exportValue}),this.enableScripting&&this.hasJSActions&&(r.addEventListener("updatefromsandbox",a=>{const o={value(l){l.target.checked=l.detail.value!=="Off",e.setValue(s,{value:l.target.checked})}};this._dispatchEventFromSandbox(o,a)}),this._setEventListeners(r,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)),this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class Rm extends za{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const e=this.annotationStorage,t=this.data,s=t.id;let i=e.getValue(s,{value:t.fieldValue===t.buttonValue}).value;if(typeof i=="string"&&(i=i!==t.buttonValue,e.setValue(s,{value:i})),i)for(const a of this._getElementsByName(t.fieldName,s))e.setValue(a.id,{value:!1});const r=document.createElement("input");if($a.add(r),r.setAttribute("data-element-id",s),r.disabled=t.readOnly,this._setRequired(r,this.data.required),r.type="radio",r.name=t.fieldName,i&&r.setAttribute("checked",!0),r.tabIndex=0,r.addEventListener("change",a=>{const{name:o,checked:l}=a.target;for(const h of this._getElementsByName(o,s))e.setValue(h.id,{value:!1});e.setValue(s,{value:l})}),r.addEventListener("resetform",a=>{const o=t.defaultFieldValue;a.target.checked=o!=null&&o===t.buttonValue}),this.enableScripting&&this.hasJSActions){const a=t.buttonValue;r.addEventListener("updatefromsandbox",o=>{const l={value:h=>{const c=a===h.detail.value;for(const u of this._getElementsByName(h.target.name)){const f=c&&u.id===s;u.domElement&&(u.domElement.checked=f),e.setValue(u.id,{value:f})}}};this._dispatchEventFromSandbox(l,o)}),this._setEventListeners(r,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.checked)}return this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class cb extends Rp{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){const e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton");const t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",s=>{this._dispatchEventFromSandbox({},s)})),e}}class db extends za{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const e=this.annotationStorage,t=this.data.id,s=e.getValue(t,{value:this.data.fieldValue}),i=document.createElement("select");$a.add(i),i.setAttribute("data-element-id",t),i.disabled=this.data.readOnly,this._setRequired(i,this.data.required),i.name=this.data.fieldName,i.tabIndex=0;let r=this.data.combo&&this.data.options.length>0;this.data.combo||(i.size=this.data.options.length,this.data.multiSelect&&(i.multiple=!0)),i.addEventListener("resetform",c=>{const u=this.data.defaultFieldValue;for(const f of i.options)f.selected=f.value===u});for(const c of this.data.options){const u=document.createElement("option");u.textContent=c.displayValue,u.value=c.exportValue,s.value.includes(c.exportValue)&&(u.setAttribute("selected",!0),r=!1),i.append(u)}let a=null;if(r){const c=document.createElement("option");c.value=" ",c.setAttribute("hidden",!0),c.setAttribute("selected",!0),i.prepend(c),a=()=>{c.remove(),i.removeEventListener("input",a),a=null},i.addEventListener("input",a)}const o=c=>{const u=c?"value":"textContent",{options:f,multiple:p}=i;return p?Array.prototype.filter.call(f,v=>v.selected).map(v=>v[u]):f.selectedIndex===-1?null:f[f.selectedIndex][u]};let l=o(!1);const h=c=>{const u=c.target.options;return Array.prototype.map.call(u,f=>({displayValue:f.textContent,exportValue:f.value}))};return this.enableScripting&&this.hasJSActions?(i.addEventListener("updatefromsandbox",c=>{const u={value(f){a==null||a();const p=f.detail.value,v=new Set(Array.isArray(p)?p:[p]);for(const m of i.options)m.selected=v.has(m.value);e.setValue(t,{value:o(!0)}),l=o(!1)},multipleSelection(f){i.multiple=!0},remove(f){const p=i.options,v=f.detail.remove;p[v].selected=!1,i.remove(v),p.length>0&&Array.prototype.findIndex.call(p,A=>A.selected)===-1&&(p[0].selected=!0),e.setValue(t,{value:o(!0),items:h(f)}),l=o(!1)},clear(f){for(;i.length!==0;)i.remove(0);e.setValue(t,{value:null,items:[]}),l=o(!1)},insert(f){const{index:p,displayValue:v,exportValue:m}=f.detail.insert,A=i.children[p],b=document.createElement("option");b.textContent=v,b.value=m,A?A.before(b):i.append(b),e.setValue(t,{value:o(!0),items:h(f)}),l=o(!1)},items(f){const{items:p}=f.detail;for(;i.length!==0;)i.remove(0);for(const v of p){const{displayValue:m,exportValue:A}=v,b=document.createElement("option");b.textContent=m,b.value=A,i.append(b)}i.options.length>0&&(i.options[0].selected=!0),e.setValue(t,{value:o(!0),items:h(f)}),l=o(!1)},indices(f){const p=new Set(f.detail.indices);for(const v of f.target.options)v.selected=p.has(v.index);e.setValue(t,{value:o(!0)}),l=o(!1)},editable(f){f.target.disabled=!f.detail.editable}};this._dispatchEventFromSandbox(u,c)}),i.addEventListener("input",c=>{var p;const u=o(!0),f=o(!1);e.setValue(t,{value:u}),c.preventDefault(),(p=this.linkService.eventBus)==null||p.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:l,change:f,changeEx:u,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(i,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],c=>c.target.value)):i.addEventListener("input",function(c){e.setValue(t,{value:o(!0)})}),this.data.combo&&this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}var Tc,Hf;class Uf extends Gt{constructor(t){const{data:s,elements:i,parent:r}=t,a=!!r._commentManager;super(t,{isRenderable:!a&&Gt._hasPopupData(s)});y(this,Tc);if(this.elements=i,a&&Gt._hasPopupData(s)){const o=this.popup=w(this,Tc,Hf).call(this);for(const l of i)l.popup=o}else this.popup=null}render(){const{container:t}=this;t.classList.add("popupAnnotation"),t.role="comment";const s=this.popup=w(this,Tc,Hf).call(this),i=[];for(const r of this.elements)r.popup=s,r.container.ariaHasPopup="dialog",i.push(r.data.id),r.addHighlightArea();return this.container.setAttribute("aria-controls",i.map(r=>`${to}${r}`).join(",")),this.container}}Tc=new WeakSet,Hf=function(){return new ub({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate||this.data.creationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open,commentManager:this.parent._commentManager})};var os,Zn,Su,xu,ol,ll,Xt,Ai,qn,pa,hl,cl,wi,ls,rn,an,Yt,on,tr,Cc,ln,dl,ga,er,ue,sr,at,Od,$f,jf,zf,Ld,Gf,Pm,Im,Dm,Mm,Fd,kd,Vf;class ub{constructor({container:e,color:t,elements:s,titleObj:i,modificationDate:r,contentsObj:a,richText:o,parent:l,rect:h,parentRect:c,open:u,commentManager:f=null}){y(this,at);y(this,os,null);y(this,Zn,w(this,at,Dm).bind(this));y(this,Su,w(this,at,Vf).bind(this));y(this,xu,w(this,at,kd).bind(this));y(this,ol,w(this,at,Fd).bind(this));y(this,ll,null);y(this,Xt,null);y(this,Ai,null);y(this,qn,null);y(this,pa,null);y(this,hl,null);y(this,cl,null);y(this,wi,!1);y(this,ls,null);y(this,rn,null);y(this,an,null);y(this,Yt,null);y(this,on,null);y(this,tr,null);y(this,Cc,null);y(this,ln,null);y(this,dl,null);y(this,ga,null);y(this,er,!1);y(this,ue,null);y(this,sr,null);g(this,Xt,e),g(this,dl,i),g(this,Ai,a),g(this,ln,o),g(this,hl,l),g(this,ll,t),g(this,Cc,h),g(this,cl,c),g(this,pa,s),g(this,os,f),g(this,ue,s[0]),g(this,qn,qd.toDateObject(r)),this.trigger=s.flatMap(p=>p.getElementsToTriggerPopup()),f||(w(this,at,Od).call(this),n(this,Xt).hidden=!0,u&&w(this,at,Fd).call(this))}renderCommentButton(){if(n(this,Yt)){n(this,Yt).parentNode||n(this,ue).container.after(n(this,Yt));return}if(n(this,on)||w(this,at,$f).call(this),!n(this,on))return;const{signal:e}=g(this,rn,new AbortController),t=n(this,ue).hasOwnCommentButton,s=()=>{n(this,os).toggleCommentPopup(this,!0,void 0,!t)},i=()=>{n(this,os).toggleCommentPopup(this,!1,!0,!t)},r=()=>{n(this,os).toggleCommentPopup(this,!1,!1)};if(t){g(this,Yt,n(this,ue).container);for(const a of this.trigger)a.ariaHasPopup="dialog",a.ariaControls="commentPopup",a.addEventListener("keydown",n(this,Zn),{signal:e}),a.addEventListener("click",s,{signal:e}),a.addEventListener("pointerenter",i,{signal:e}),a.addEventListener("pointerleave",r,{signal:e}),a.classList.add("popupTriggerArea")}else{const a=g(this,Yt,document.createElement("button"));a.className="annotationCommentButton";const o=n(this,ue).container;a.style.zIndex=o.style.zIndex+1,a.tabIndex=0,a.ariaHasPopup="dialog",a.ariaControls="commentPopup",a.setAttribute("data-l10n-id","pdfjs-show-comment-button"),w(this,at,zf).call(this),w(this,at,jf).call(this),a.addEventListener("keydown",n(this,Zn),{signal:e}),a.addEventListener("click",s,{signal:e}),a.addEventListener("pointerenter",i,{signal:e}),a.addEventListener("pointerleave",r,{signal:e}),o.after(a)}}get commentButtonColor(){const{color:e,opacity:t}=n(this,ue).commentData;return e?n(this,hl)._commentManager.makeCommentColor(e,t):null}focusCommentButton(){setTimeout(()=>{var e;(e=n(this,Yt))==null||e.focus()},0)}getData(){const{richText:e,color:t,opacity:s,creationDate:i,modificationDate:r}=n(this,ue).commentData;return{contentsObj:{str:this.comment},richText:e,color:t,opacity:s,creationDate:i,modificationDate:r}}get elementBeforePopup(){return n(this,Yt)}get comment(){return n(this,sr)||g(this,sr,n(this,ue).commentText),n(this,sr)}set comment(e){e!==this.comment&&(n(this,ue).commentText=g(this,sr,e))}focus(){var e;(e=n(this,ue).container)==null||e.focus()}get parentBoundingClientRect(){return n(this,ue).layer.getBoundingClientRect()}setCommentButtonStates({selected:e,hasPopup:t}){n(this,Yt)&&(n(this,Yt).classList.toggle("selected",e),n(this,Yt).ariaExpanded=t)}setSelectedCommentButton(e){n(this,Yt).classList.toggle("selected",e)}get commentPopupPosition(){if(n(this,tr))return n(this,tr);const{x:e,y:t,height:s}=n(this,Yt).getBoundingClientRect(),{x:i,y:r,width:a,height:o}=n(this,ue).layer.getBoundingClientRect();return[(e-i)/a,(t+s-r)/o]}set commentPopupPosition(e){g(this,tr,e)}hasDefaultPopupPosition(){return n(this,tr)===null}get commentButtonPosition(){return n(this,on)}get commentButtonWidth(){return n(this,Yt).getBoundingClientRect().width/this.parentBoundingClientRect.width}editComment(e){const[t,s]=n(this,tr)||this.commentButtonPosition.map(h=>h/100),i=this.parentBoundingClientRect,{x:r,y:a,width:o,height:l}=i;n(this,os).showDialog(null,this,r+t*o,a+s*l,{...e,parentDimensions:i})}render(){var s,i;if(n(this,ls))return;const e=g(this,ls,document.createElement("div"));if(e.className="popup",n(this,ll)){const r=e.style.outlineColor=j.makeHexColor(...n(this,ll));e.style.backgroundColor=`color-mix(in srgb, ${r} 30%, white)`}const t=document.createElement("span");if(t.className="header",(s=n(this,dl))!=null&&s.str){const r=document.createElement("span");r.className="title",t.append(r),{dir:r.dir,str:r.textContent}=n(this,dl)}if(e.append(t),n(this,qn)){const r=document.createElement("time");r.className="popupDate",r.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),r.setAttribute("data-l10n-args",JSON.stringify({dateObj:n(this,qn).valueOf()})),r.dateTime=n(this,qn).toISOString(),t.append(r)}bg({html:n(this,at,Ld)||n(this,Ai).str,dir:(i=n(this,Ai))==null?void 0:i.dir,className:"popupContent"},e),n(this,Xt).append(e)}updateEdited({rect:e,popup:t,deleted:s}){var i;if(n(this,os)){s?(this.remove(),g(this,sr,null)):t&&(t.deleted?this.remove():(w(this,at,zf).call(this),g(this,sr,t.text))),e&&(g(this,on,null),w(this,at,$f).call(this),w(this,at,jf).call(this));return}if(s||t!=null&&t.deleted){this.remove();return}w(this,at,Od).call(this),n(this,ga)||g(this,ga,{contentsObj:n(this,Ai),richText:n(this,ln)}),e&&g(this,an,null),t&&t.text&&(g(this,ln,w(this,at,Im).call(this,t.text)),g(this,qn,qd.toDateObject(t.date)),g(this,Ai,null)),(i=n(this,ls))==null||i.remove(),g(this,ls,null)}resetEdited(){var e;n(this,ga)&&({contentsObj:ie(this,Ai)._,richText:ie(this,ln)._}=n(this,ga),g(this,ga,null),(e=n(this,ls))==null||e.remove(),g(this,ls,null),g(this,an,null))}remove(){var e,t,s;if((e=n(this,rn))==null||e.abort(),g(this,rn,null),(t=n(this,ls))==null||t.remove(),g(this,ls,null),g(this,er,!1),g(this,wi,!1),(s=n(this,Yt))==null||s.remove(),g(this,Yt,null),this.trigger)for(const i of this.trigger)i.classList.remove("popupTriggerArea")}forceHide(){g(this,er,this.isVisible),n(this,er)&&(n(this,Xt).hidden=!0)}maybeShow(){n(this,os)||(w(this,at,Od).call(this),n(this,er)&&(n(this,ls)||w(this,at,kd).call(this),g(this,er,!1),n(this,Xt).hidden=!1))}get isVisible(){return n(this,os)?!1:n(this,Xt).hidden===!1}}os=new WeakMap,Zn=new WeakMap,Su=new WeakMap,xu=new WeakMap,ol=new WeakMap,ll=new WeakMap,Xt=new WeakMap,Ai=new WeakMap,qn=new WeakMap,pa=new WeakMap,hl=new WeakMap,cl=new WeakMap,wi=new WeakMap,ls=new WeakMap,rn=new WeakMap,an=new WeakMap,Yt=new WeakMap,on=new WeakMap,tr=new WeakMap,Cc=new WeakMap,ln=new WeakMap,dl=new WeakMap,ga=new WeakMap,er=new WeakMap,ue=new WeakMap,sr=new WeakMap,at=new WeakSet,Od=function(){var t;if(n(this,rn))return;g(this,rn,new AbortController);const{signal:e}=n(this,rn);for(const s of this.trigger)s.addEventListener("click",n(this,ol),{signal:e}),s.addEventListener("pointerenter",n(this,xu),{signal:e}),s.addEventListener("pointerleave",n(this,Su),{signal:e}),s.classList.add("popupTriggerArea");for(const s of n(this,pa))(t=s.container)==null||t.addEventListener("keydown",n(this,Zn),{signal:e})},$f=function(){const e=n(this,pa).find(t=>t.hasCommentButton);e&&g(this,on,e._normalizePoint(e.commentButtonPosition))},jf=function(){if(n(this,ue).extraPopupElement&&!n(this,ue).editor)return;n(this,Yt)||this.renderCommentButton();const[e,t]=n(this,on),{style:s}=n(this,Yt);s.left=`calc(${e}%)`,s.top=`calc(${t}% - var(--comment-button-dim))`},zf=function(){n(this,ue).extraPopupElement||(n(this,Yt)||this.renderCommentButton(),n(this,Yt).style.backgroundColor=this.commentButtonColor||"")},Ld=function(){const e=n(this,ln),t=n(this,Ai);return e!=null&&e.str&&(!(t!=null&&t.str)||t.str===e.str)&&n(this,ln).html||null},Gf=function(){var e,t,s;return((s=(t=(e=n(this,at,Ld))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:s.fontSize)||0},Pm=function(){var e,t,s;return((s=(t=(e=n(this,at,Ld))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:s.color)||null},Im=function(e){const t=[],s={str:e,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:t}]}},i={style:{color:n(this,at,Pm),fontSize:n(this,at,Gf)?`calc(${n(this,at,Gf)}px * var(--total-scale-factor))`:""}};for(const r of e.split(`
`))t.push({name:"span",value:r,attributes:i});return s},Dm=function(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||(e.key==="Enter"||e.key==="Escape"&&n(this,wi))&&w(this,at,Fd).call(this)},Mm=function(){if(n(this,an)!==null)return;const{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:s,pageX:i,pageY:r}}}=n(this,hl);let a=!!n(this,cl),o=a?n(this,cl):n(this,Cc);for(const v of n(this,pa))if(!o||j.intersect(v.data.rect,o)!==null){o=v.data.rect,a=!0;break}const l=j.normalizeRect([o[0],e[3]-o[1]+e[1],o[2],e[3]-o[3]+e[1]]),c=a?o[2]-o[0]+5:0,u=l[0]+c,f=l[1];g(this,an,[100*(u-i)/t,100*(f-r)/s]);const{style:p}=n(this,Xt);p.left=`${n(this,an)[0]}%`,p.top=`${n(this,an)[1]}%`},Fd=function(){if(n(this,os)){n(this,os).toggleCommentPopup(this,!1);return}g(this,wi,!n(this,wi)),n(this,wi)?(w(this,at,kd).call(this),n(this,Xt).addEventListener("click",n(this,ol)),n(this,Xt).addEventListener("keydown",n(this,Zn))):(w(this,at,Vf).call(this),n(this,Xt).removeEventListener("click",n(this,ol)),n(this,Xt).removeEventListener("keydown",n(this,Zn)))},kd=function(){n(this,ls)||this.render(),this.isVisible?n(this,wi)&&n(this,Xt).classList.add("focused"):(w(this,at,Mm).call(this),n(this,Xt).hidden=!1,n(this,Xt).style.zIndex=parseInt(n(this,Xt).style.zIndex)+1e3)},Vf=function(){n(this,Xt).classList.remove("focused"),!(n(this,wi)||!this.isVisible)&&(n(this,Xt).hidden=!0,n(this,Xt).style.zIndex=parseInt(n(this,Xt).style.zIndex)-1e3)};class Om extends Gt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.textContent=e.data.textContent,this.textPosition=e.data.textPosition,this.annotationEditorType=et.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const e=this.contentElement=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(const t of this.textContent){const s=document.createElement("span");s.textContent=t,e.append(s)}this.container.append(e)}return!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this._editOnDoubleClick(),this.container}}var Rc;class fb extends Gt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});y(this,Rc,null)}render(){this.container.classList.add("lineAnnotation");const{data:t,width:s,height:i}=this,r=this.svgFactory.create(s,i,!0),a=g(this,Rc,this.svgFactory.createElement("svg:line"));return a.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),a.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),a.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),a.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),a.setAttribute("stroke-width",t.borderStyle.width||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),r.append(a),this.container.append(r),!t.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return n(this,Rc)}addHighlightArea(){this.container.classList.add("highlightArea")}}Rc=new WeakMap;var Pc;class pb extends Gt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});y(this,Pc,null)}render(){this.container.classList.add("squareAnnotation");const{data:t,width:s,height:i}=this,r=this.svgFactory.create(s,i,!0),a=t.borderStyle.width,o=g(this,Pc,this.svgFactory.createElement("svg:rect"));return o.setAttribute("x",a/2),o.setAttribute("y",a/2),o.setAttribute("width",s-a),o.setAttribute("height",i-a),o.setAttribute("stroke-width",a||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),r.append(o),this.container.append(r),!t.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return n(this,Pc)}addHighlightArea(){this.container.classList.add("highlightArea")}}Pc=new WeakMap;var Ic;class gb extends Gt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});y(this,Ic,null)}render(){this.container.classList.add("circleAnnotation");const{data:t,width:s,height:i}=this,r=this.svgFactory.create(s,i,!0),a=t.borderStyle.width,o=g(this,Ic,this.svgFactory.createElement("svg:ellipse"));return o.setAttribute("cx",s/2),o.setAttribute("cy",i/2),o.setAttribute("rx",s/2-a/2),o.setAttribute("ry",i/2-a/2),o.setAttribute("stroke-width",a||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),r.append(o),this.container.append(r),!t.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return n(this,Ic)}addHighlightArea(){this.container.classList.add("highlightArea")}}Ic=new WeakMap;var Dc;class Lm extends Gt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});y(this,Dc,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,vertices:s,borderStyle:i,popupRef:r},width:a,height:o}=this;if(!s)return this.container;const l=this.svgFactory.create(a,o,!0);let h=[];for(let u=0,f=s.length;u<f;u+=2){const p=s[u]-t[0],v=t[3]-s[u+1];h.push(`${p},${v}`)}h=h.join(" ");const c=g(this,Dc,this.svgFactory.createElement(this.svgElementName));return c.setAttribute("points",h),c.setAttribute("stroke-width",i.width||1),c.setAttribute("stroke","transparent"),c.setAttribute("fill","transparent"),l.append(c),this.container.append(l),!r&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return n(this,Dc)}addHighlightArea(){this.container.classList.add("highlightArea")}}Dc=new WeakMap;class mb extends Lm{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class vb extends Gt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}}var Mc,ma,Oc,Wf;class Pp extends Gt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});y(this,Oc);y(this,Mc,null);y(this,ma,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?et.HIGHLIGHT:et.INK}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,rotation:s,inkLists:i,borderStyle:r,popupRef:a}}=this,{transform:o,width:l,height:h}=w(this,Oc,Wf).call(this,s,t),c=this.svgFactory.create(l,h,!0),u=g(this,Mc,this.svgFactory.createElement("svg:g"));c.append(u),u.setAttribute("stroke-width",r.width||1),u.setAttribute("stroke-linecap","round"),u.setAttribute("stroke-linejoin","round"),u.setAttribute("stroke-miterlimit",10),u.setAttribute("stroke","transparent"),u.setAttribute("fill","transparent"),u.setAttribute("transform",o);for(let f=0,p=i.length;f<p;f++){const v=this.svgFactory.createElement(this.svgElementName);n(this,ma).push(v),v.setAttribute("points",i[f].join(",")),u.append(v)}return!a&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.append(c),this._editOnDoubleClick(),this.container}updateEdited(t){super.updateEdited(t);const{thickness:s,points:i,rect:r}=t,a=n(this,Mc);if(s>=0&&a.setAttribute("stroke-width",s||1),i)for(let o=0,l=n(this,ma).length;o<l;o++)n(this,ma)[o].setAttribute("points",i[o].join(","));if(r){const{transform:o,width:l,height:h}=w(this,Oc,Wf).call(this,this.data.rotation,r);a.parentElement.setAttribute("viewBox",`0 0 ${l} ${h}`),a.setAttribute("transform",o)}}getElementsToTriggerPopup(){return n(this,ma)}addHighlightArea(){this.container.classList.add("highlightArea")}}Mc=new WeakMap,ma=new WeakMap,Oc=new WeakSet,Wf=function(t,s){switch(t){case 90:return{transform:`rotate(90) translate(${-s[0]},${s[1]}) scale(1,-1)`,width:s[3]-s[1],height:s[2]-s[0]};case 180:return{transform:`rotate(180) translate(${-s[2]},${s[1]}) scale(1,-1)`,width:s[2]-s[0],height:s[3]-s[1]};case 270:return{transform:`rotate(270) translate(${-s[2]},${s[3]}) scale(1,-1)`,width:s[3]-s[1],height:s[2]-s[0]};default:return{transform:`translate(${-s[0]},${s[3]}) scale(1,-1)`,width:s[2]-s[0],height:s[3]-s[1]}}};class Fm extends Gt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=et.HIGHLIGHT}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),e){const s=document.createElement("mark");s.classList.add("overlaidText"),s.textContent=e,this.container.append(s)}return this.container}}class yb extends Gt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("underlineAnnotation"),e){const s=document.createElement("u");s.classList.add("overlaidText"),s.textContent=e,this.container.append(s)}return this.container}}class bb extends Gt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("squigglyAnnotation"),e){const s=document.createElement("u");s.classList.add("overlaidText"),s.textContent=e,this.container.append(s)}return this.container}}class Ab extends Gt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("strikeoutAnnotation"),e){const s=document.createElement("s");s.classList.add("overlaidText"),s.textContent=e,this.container.append(s)}return this.container}}class km extends Gt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=et.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this._editOnDoubleClick(),this.container}}var Lc,Fc,Xf;class wb extends Gt{constructor(t){var i;super(t,{isRenderable:!0});y(this,Fc);y(this,Lc,null);const{file:s}=this.data;this.filename=s.filename,this.content=s.content,(i=this.linkService.eventBus)==null||i.dispatch("fileattachmentannotation",{source:this,...s})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:t,data:s}=this;let i;s.hasAppearance||s.fillAlpha===0?i=document.createElement("div"):(i=document.createElement("img"),i.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(s.name)?"paperclip":"pushpin"}.svg`,s.fillAlpha&&s.fillAlpha<1&&(i.style=`filter: opacity(${Math.round(s.fillAlpha*100)}%);`)),i.addEventListener("dblclick",w(this,Fc,Xf).bind(this)),g(this,Lc,i);const{isMac:r}=he.platform;return t.addEventListener("keydown",a=>{a.key==="Enter"&&(r?a.metaKey:a.ctrlKey)&&w(this,Fc,Xf).call(this)}),!s.popupRef&&this.hasPopupData?(this.hasOwnCommentButton=!0,this._createPopup()):i.classList.add("popupTriggerArea"),t.append(i),t}getElementsToTriggerPopup(){return n(this,Lc)}addHighlightArea(){this.container.classList.add("highlightArea")}}Lc=new WeakMap,Fc=new WeakSet,Xf=function(){var t;(t=this.downloadManager)==null||t.openOrDownloadData(this.content,this.filename)};var va,ya,ul,ir,kc,ba,hs,Nc,bn,Nd,Kf;const Np=class Np{constructor({div:e,accessibilityManager:t,annotationCanvasMap:s,annotationEditorUIManager:i,page:r,viewport:a,structTreeLayer:o,commentManager:l,linkService:h,annotationStorage:c}){y(this,bn);y(this,va,null);y(this,ya,null);y(this,ul,null);y(this,ir,new Map);y(this,kc,null);y(this,ba,null);y(this,hs,[]);y(this,Nc,!1);this.div=e,g(this,va,t),g(this,ya,s),g(this,kc,o||null),g(this,ba,h||null),g(this,ul,c||new xp),this.page=r,this.viewport=a,this.zIndex=0,this._annotationEditorUIManager=i,this._commentManager=l||null}hasEditableAnnotations(){return n(this,ir).size>0}async render(e){var o;const{annotations:t}=e,s=this.div;Ua(s,this.viewport);const i=new Map,r=[],a={data:null,layer:s,linkService:n(this,ba),downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:e.renderForms!==!1,svgFactory:new ou,annotationStorage:n(this,ul),enableComment:e.enableComment===!0,enableScripting:e.enableScripting===!0,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(const l of t){if(l.noHTML)continue;const h=l.annotationType===te.POPUP;if(h){const f=i.get(l.id);if(!f)continue;if(!this._commentManager){r.push(l);continue}a.elements=f}else if(l.rect[2]===l.rect[0]||l.rect[3]===l.rect[1])continue;a.data=l;const c=Wu.create(a);if(!c.isRenderable)continue;if(!h&&(n(this,hs).push(c),l.popupRef)){const f=i.get(l.popupRef);f?f.push(c):i.set(l.popupRef,[c])}const u=c.render();l.hidden&&(u.style.visibility="hidden"),c._isEditable&&(n(this,ir).set(c.data.id,c),(o=this._annotationEditorUIManager)==null||o.renderAnnotationElement(c))}await w(this,bn,Nd).call(this);for(const l of r){const h=a.elements=i.get(l.id);a.data=l;const c=Wu.create(a);if(!c.isRenderable)continue;const u=c.render();c.contentElement.id=`${to}${l.id}`,l.hidden&&(u.style.visibility="hidden"),h.at(-1).container.after(u)}w(this,bn,Kf).call(this)}async addLinkAnnotations(e){const t={data:null,layer:this.div,linkService:n(this,ba),svgFactory:new ou,parent:this};for(const s of e){s.borderStyle||(s.borderStyle=Np._defaultBorderStyle),t.data=s;const i=Wu.create(t);i.isRenderable&&(i.render(),i.contentElement.id=`${to}${s.id}`,n(this,hs).push(i))}await w(this,bn,Nd).call(this)}update({viewport:e}){const t=this.div;this.viewport=e,Ua(t,{rotation:e.rotation}),w(this,bn,Kf).call(this),t.hidden=!1}getEditableAnnotations(){return Array.from(n(this,ir).values())}getEditableAnnotation(e){return n(this,ir).get(e)}addFakeAnnotation(e){const{div:t}=this,{id:s,rotation:i}=e,r=new rb({data:{id:s,rect:e.getPDFRect(),rotation:i},editor:e,layer:t,parent:this,enableComment:!!this._commentManager,linkService:n(this,ba),annotationStorage:n(this,ul)});return r.render(),r.contentElement.id=`${to}${s}`,r.createOrUpdatePopup(),n(this,hs).push(r),r}removeAnnotation(e){var i;const t=n(this,hs).findIndex(r=>r.data.id===e);if(t<0)return;const[s]=n(this,hs).splice(t,1);(i=n(this,va))==null||i.removePointerInTextLayer(s.contentElement)}updateFakeAnnotations(e){if(e.length!==0){for(const t of e)t.updateFakeAnnotationElement(this);w(this,bn,Nd).call(this)}}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}static get _defaultBorderStyle(){return Q(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:Wa.SOLID,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}};va=new WeakMap,ya=new WeakMap,ul=new WeakMap,ir=new WeakMap,kc=new WeakMap,ba=new WeakMap,hs=new WeakMap,Nc=new WeakMap,bn=new WeakSet,Nd=async function(){var s,i,r;if(n(this,hs).length===0)return;this.div.replaceChildren();const e=[];if(!n(this,Nc)){g(this,Nc,!0);for(const{contentElement:a,data:{id:o}}of n(this,hs)){const l=a.id=`${to}${o}`;e.push((s=n(this,kc))==null?void 0:s.getAriaAttributes(l).then(h=>{if(h)for(const[c,u]of h)a.setAttribute(c,u)}))}}n(this,hs).sort(({data:{rect:[a,o,l,h]}},{data:{rect:[c,u,f,p]}})=>{if(a===l&&o===h)return 1;if(c===f&&u===p)return-1;const v=h,m=o,A=(o+h)/2,b=p,S=u,E=(u+p)/2;if(A>=b&&E<=m)return-1;if(E>=v&&A<=S)return 1;const T=(a+l)/2,x=(c+f)/2;return T-x});const t=document.createDocumentFragment();for(const a of n(this,hs))t.append(a.container),this._commentManager?(r=((i=a.extraPopupElement)==null?void 0:i.popup)||a.popup)==null||r.renderCommentButton():a.extraPopupElement&&t.append(a.extraPopupElement.render());if(this.div.append(t),await Promise.all(e),n(this,va))for(const a of n(this,hs))n(this,va).addPointerInTextLayer(a.contentElement,!1)},Kf=function(){var t;if(!n(this,ya))return;const e=this.div;for(const[s,i]of n(this,ya)){const r=e.querySelector(`[data-annotation-id="${s}"]`);if(!r)continue;i.className="annotationContent";const{firstChild:a}=r;a?a.nodeName==="CANVAS"?a.replaceWith(i):a.classList.contains("annotationContent")?a.after(i):a.before(i):r.append(i);const o=n(this,ir).get(s);o&&(o._hasNoCanvas?((t=this._annotationEditorUIManager)==null||t.setMissingCanvas(s,r.id,i),o._hasNoCanvas=!1):o.canvas=i)}n(this,ya).clear()};let Yf=Np;const md=/\r\n?|\n/g;var cs,Bc,Aa,ds,se,Nm,Bm,_m,Bd,An,_d,Ud,Um,Qf,Hm;const _t=class _t extends Nt{constructor(t){super({...t,name:"freeTextEditor"});y(this,se);y(this,cs,"");y(this,Bc,`${this.id}-editor`);y(this,Aa,null);y(this,ds);F(this,"_colorPicker",null);this.color=t.color||_t._defaultColor||Nt._defaultLineColor,g(this,ds,t.fontSize||_t._defaultFontSize),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-freetext-added-alert"),this.canAddComment=!1}static get _keyboardManager(){const t=_t.prototype,s=a=>a.isEmpty(),i=Ha.TRANSLATE_SMALL,r=Ha.TRANSLATE_BIG;return Q(this,"_keyboardManager",new rd([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-i,0],checker:s}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-r,0],checker:s}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[i,0],checker:s}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[r,0],checker:s}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-i],checker:s}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-r],checker:s}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,i],checker:s}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,r],checker:s}]]))}static initialize(t,s){Nt.initialize(t,s);const i=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(i.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,s){switch(t){case dt.FREETEXT_SIZE:_t._defaultFontSize=s;break;case dt.FREETEXT_COLOR:_t._defaultColor=s;break}}updateParams(t,s){switch(t){case dt.FREETEXT_SIZE:w(this,se,Nm).call(this,s);break;case dt.FREETEXT_COLOR:w(this,se,Bm).call(this,s);break}}static get defaultPropertiesToUpdate(){return[[dt.FREETEXT_SIZE,_t._defaultFontSize],[dt.FREETEXT_COLOR,_t._defaultColor||Nt._defaultLineColor]]}get propertiesToUpdate(){return[[dt.FREETEXT_SIZE,n(this,ds)],[dt.FREETEXT_COLOR,this.color]]}get toolbarButtons(){return this._colorPicker||(this._colorPicker=new au(this)),[["colorPicker",this._colorPicker]]}get colorType(){return dt.FREETEXT_COLOR}onUpdatedColor(){var t;this.editorDiv.style.color=this.color,(t=this._colorPicker)==null||t.update(this.color),super.onUpdatedColor()}_translateEmpty(t,s){this._uiManager.translateSelectedEditors(t,s,!0)}getInitialTranslation(){const t=this.parentScale;return[-_t._internalPadding*t,-(_t._internalPadding+n(this,ds))*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(!super.enableEditMode())return!1;this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),g(this,Aa,new AbortController);const t=this._uiManager.combinedSignal(n(this,Aa));return this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t}),!0}disableEditMode(){var t;return super.disableEditMode()?(this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",n(this,Bc)),this._isDraggable=!0,(t=n(this,Aa))==null||t.abort(),g(this,Aa,null),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"),!0):!1}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(t){var s;this.width||(this.enableEditMode(),t&&this.editorDiv.focus(),(s=this._initialOptions)!=null&&s.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const t=n(this,cs),s=g(this,cs,w(this,se,_m).call(this).trimEnd());if(t===s)return;const i=r=>{if(g(this,cs,r),!r){this.remove();return}w(this,se,Ud).call(this),this._uiManager.rebuild(this),w(this,se,Bd).call(this)};this.addCommands({cmd:()=>{i(s)},undo:()=>{i(t)},mustExec:!1}),w(this,se,Bd).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){_t._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}get canChangeContent(){return!0}render(){if(this.div)return this.div;let t,s;(this._isCopy||this.annotationElementId)&&(t=this.x,s=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",n(this,Bc)),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:i}=this.editorDiv;if(i.fontSize=`calc(${n(this,ds)}px * var(--total-scale-factor))`,i.color=this.color,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),this._isCopy||this.annotationElementId){const[r,a]=this.parentDimensions;if(this.annotationElementId){const{position:o}=this._initialData;let[l,h]=this.getInitialTranslation();[l,h]=this.pageTranslationToScreen(l,h);const[c,u]=this.pageDimensions,[f,p]=this.pageTranslation;let v,m;switch(this.rotation){case 0:v=t+(o[0]-f)/c,m=s+this.height-(o[1]-p)/u;break;case 90:v=t+(o[0]-f)/c,m=s-(o[1]-p)/u,[l,h]=[h,-l];break;case 180:v=t-this.width+(o[0]-f)/c,m=s-(o[1]-p)/u,[l,h]=[-l,-h];break;case 270:v=t+(o[0]-f-this.height*u)/c,m=s+(o[1]-p-this.width*c)/u,[l,h]=[-h,l];break}this.setAt(v*r,m*a,l,h)}else this._moveAfterPaste(t,s);w(this,se,Ud).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}editorDivPaste(t){var v,m,A;const s=t.clipboardData||window.clipboardData,{types:i}=s;if(i.length===1&&i[0]==="text/plain")return;t.preventDefault();const r=w(v=_t,An,Qf).call(v,s.getData("text")||"").replaceAll(md,`
`);if(!r)return;const a=window.getSelection();if(!a.rangeCount)return;this.editorDiv.normalize(),a.deleteFromDocument();const o=a.getRangeAt(0);if(!r.includes(`
`)){o.insertNode(document.createTextNode(r)),this.editorDiv.normalize(),a.collapseToStart();return}const{startContainer:l,startOffset:h}=o,c=[],u=[];if(l.nodeType===Node.TEXT_NODE){const b=l.parentElement;if(u.push(l.nodeValue.slice(h).replaceAll(md,"")),b!==this.editorDiv){let S=c;for(const E of this.editorDiv.childNodes){if(E===b){S=u;continue}S.push(w(m=_t,An,_d).call(m,E))}}c.push(l.nodeValue.slice(0,h).replaceAll(md,""))}else if(l===this.editorDiv){let b=c,S=0;for(const E of this.editorDiv.childNodes)S++===h&&(b=u),b.push(w(A=_t,An,_d).call(A,E))}g(this,cs,`${c.join(`
`)}${r}${u.join(`
`)}`),w(this,se,Ud).call(this);const f=new Range;let p=Math.sumPrecise(c.map(b=>b.length));for(const{firstChild:b}of this.editorDiv.childNodes)if(b.nodeType===Node.TEXT_NODE){const S=b.nodeValue.length;if(p<=S){f.setStart(b,p),f.setEnd(b,p);break}p-=S}a.removeAllRanges(),a.addRange(f)}get contentDiv(){return this.editorDiv}getPDFRect(){const t=_t._internalPadding*this.parentScale;return this.getRect(t,t)}static async deserialize(t,s,i){var o;let r=null;if(t instanceof Om){const{data:{defaultAppearanceData:{fontSize:l,fontColor:h},rect:c,rotation:u,id:f,popupRef:p,richText:v,contentsObj:m,creationDate:A,modificationDate:b},textContent:S,textPosition:E,parent:{page:{pageNumber:T}}}=t;if(!S||S.length===0)return null;r=t={annotationType:et.FREETEXT,color:Array.from(h),fontSize:l,value:S.join(`
`),position:E,pageIndex:T-1,rect:c.slice(0),rotation:u,annotationElementId:f,id:f,deleted:!1,popupRef:p,comment:(m==null?void 0:m.str)||null,richText:v,creationDate:A,modificationDate:b}}const a=await super.deserialize(t,s,i);return g(a,ds,t.fontSize),a.color=j.makeHexColor(...t.color),g(a,cs,w(o=_t,An,Qf).call(o,t.value)),a._initialData=r,t.comment&&a.setCommentData(t),a}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const s=Nt._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.color),i=Object.assign(super.serialize(t),{color:s,fontSize:n(this,ds),value:w(this,se,Um).call(this)});return this.addComment(i),t?(i.isCopy=!0,i):this.annotationElementId&&!w(this,se,Hm).call(this,i)?null:(i.id=this.annotationElementId,i)}renderAnnotationElement(t){const s=super.renderAnnotationElement(t);if(!s)return null;const{style:i}=s;i.fontSize=`calc(${n(this,ds)}px * var(--total-scale-factor))`,i.color=this.color,s.replaceChildren();for(const r of n(this,cs).split(`
`)){const a=document.createElement("div");a.append(r?document.createTextNode(r):document.createElement("br")),s.append(a)}return t.updateEdited({rect:this.getPDFRect(),popup:this._uiManager.hasCommentManager()||this.hasEditedComment?this.comment:{text:n(this,cs)}}),s}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}};cs=new WeakMap,Bc=new WeakMap,Aa=new WeakMap,ds=new WeakMap,se=new WeakSet,Nm=function(t){const s=r=>{this.editorDiv.style.fontSize=`calc(${r}px * var(--total-scale-factor))`,this.translate(0,-(r-n(this,ds))*this.parentScale),g(this,ds,r),w(this,se,Bd).call(this)},i=n(this,ds);this.addCommands({cmd:s.bind(this,t),undo:s.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:dt.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},Bm=function(t){const s=r=>{this.color=r,this.onUpdatedColor()},i=this.color;this.addCommands({cmd:s.bind(this,t),undo:s.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:dt.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},_m=function(){var i;const t=[];this.editorDiv.normalize();let s=null;for(const r of this.editorDiv.childNodes)(s==null?void 0:s.nodeType)===Node.TEXT_NODE&&r.nodeName==="BR"||(t.push(w(i=_t,An,_d).call(i,r)),s=r);return t.join(`
`)},Bd=function(){const[t,s]=this.parentDimensions;let i;if(this.isAttachedToDOM)i=this.div.getBoundingClientRect();else{const{currentLayer:r,div:a}=this,o=a.style.display,l=a.classList.contains("hidden");a.classList.remove("hidden"),a.style.display="hidden",r.div.append(this.div),i=a.getBoundingClientRect(),a.remove(),a.style.display=o,a.classList.toggle("hidden",l)}this.rotation%180===this.parentRotation%180?(this.width=i.width/t,this.height=i.height/s):(this.width=i.height/t,this.height=i.width/s),this.fixAndSetPosition()},An=new WeakSet,_d=function(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(md,"")},Ud=function(){if(this.editorDiv.replaceChildren(),!!n(this,cs))for(const t of n(this,cs).split(`
`)){const s=document.createElement("div");s.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(s)}},Um=function(){return n(this,cs).replaceAll(" "," ")},Qf=function(t){return t.replaceAll(" "," ")},Hm=function(t){const{value:s,fontSize:i,color:r,pageIndex:a}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||t.value!==s||t.fontSize!==i||t.color.some((o,l)=>o!==r[l])||t.pageIndex!==a},y(_t,An),F(_t,"_freeTextDefaultContent",""),F(_t,"_internalPadding",0),F(_t,"_defaultColor",null),F(_t,"_defaultFontSize",10),F(_t,"_type","freetext"),F(_t,"_editorType",et.FREETEXT);let Jf=_t;class W{toSVGPath(){Ot("Abstract method `toSVGPath` must be implemented.")}get box(){Ot("Abstract getter `box` must be implemented.")}serialize(e,t){Ot("Abstract method `serialize` must be implemented.")}static _rescale(e,t,s,i,r,a){a||(a=new Float32Array(e.length));for(let o=0,l=e.length;o<l;o+=2)a[o]=t+e[o]*i,a[o+1]=s+e[o+1]*r;return a}static _rescaleAndSwap(e,t,s,i,r,a){a||(a=new Float32Array(e.length));for(let o=0,l=e.length;o<l;o+=2)a[o]=t+e[o+1]*i,a[o+1]=s+e[o]*r;return a}static _translate(e,t,s,i){i||(i=new Float32Array(e.length));for(let r=0,a=e.length;r<a;r+=2)i[r]=t+e[r],i[r+1]=s+e[r+1];return i}static svgRound(e){return Math.round(e*1e4)}static _normalizePoint(e,t,s,i,r){switch(r){case 90:return[1-t/s,e/i];case 180:return[1-e/s,1-t/i];case 270:return[t/s,1-e/i];default:return[e/s,t/i]}}static _normalizePagePoint(e,t,s){switch(s){case 90:return[1-t,e];case 180:return[1-e,1-t];case 270:return[t,1-e];default:return[e,t]}}static createBezierPoints(e,t,s,i,r,a){return[(e+5*s)/6,(t+5*i)/6,(5*s+r)/6,(5*i+a)/6,(s+r)/2,(i+a)/2]}}F(W,"PRECISION",1e-4);var us,Js,fl,pl,Ei,lt,wa,Ea,_c,Uc,gl,ml,nr,Hc,Tu,Cu,le,eh,$m,jm,zm,Gm,Vm,Wm;const Fi=class Fi{constructor({x:e,y:t},s,i,r,a,o=0){y(this,le);y(this,us);y(this,Js,[]);y(this,fl);y(this,pl);y(this,Ei,[]);y(this,lt,new Float32Array(18));y(this,wa);y(this,Ea);y(this,_c);y(this,Uc);y(this,gl);y(this,ml);y(this,nr,[]);g(this,us,s),g(this,ml,r*i),g(this,pl,a),n(this,lt).set([NaN,NaN,NaN,NaN,e,t],6),g(this,fl,o),g(this,Uc,n(Fi,Hc)*i),g(this,_c,n(Fi,Cu)*i),g(this,gl,i),n(this,nr).push(e,t)}isEmpty(){return isNaN(n(this,lt)[8])}add({x:e,y:t}){var P;g(this,wa,e),g(this,Ea,t);const[s,i,r,a]=n(this,us);let[o,l,h,c]=n(this,lt).subarray(8,12);const u=e-h,f=t-c,p=Math.hypot(u,f);if(p<n(this,_c))return!1;const v=p-n(this,Uc),m=v/p,A=m*u,b=m*f;let S=o,E=l;o=h,l=c,h+=A,c+=b,(P=n(this,nr))==null||P.push(e,t);const T=-b/v,x=A/v,C=T*n(this,ml),R=x*n(this,ml);return n(this,lt).set(n(this,lt).subarray(2,8),0),n(this,lt).set([h+C,c+R],4),n(this,lt).set(n(this,lt).subarray(14,18),12),n(this,lt).set([h-C,c-R],16),isNaN(n(this,lt)[6])?(n(this,Ei).length===0&&(n(this,lt).set([o+C,l+R],2),n(this,Ei).push(NaN,NaN,NaN,NaN,(o+C-s)/r,(l+R-i)/a),n(this,lt).set([o-C,l-R],14),n(this,Js).push(NaN,NaN,NaN,NaN,(o-C-s)/r,(l-R-i)/a)),n(this,lt).set([S,E,o,l,h,c],6),!this.isEmpty()):(n(this,lt).set([S,E,o,l,h,c],6),Math.abs(Math.atan2(E-l,S-o)-Math.atan2(b,A))<Math.PI/2?([o,l,h,c]=n(this,lt).subarray(2,6),n(this,Ei).push(NaN,NaN,NaN,NaN,((o+h)/2-s)/r,((l+c)/2-i)/a),[o,l,S,E]=n(this,lt).subarray(14,18),n(this,Js).push(NaN,NaN,NaN,NaN,((S+o)/2-s)/r,((E+l)/2-i)/a),!0):([S,E,o,l,h,c]=n(this,lt).subarray(0,6),n(this,Ei).push(((S+5*o)/6-s)/r,((E+5*l)/6-i)/a,((5*o+h)/6-s)/r,((5*l+c)/6-i)/a,((o+h)/2-s)/r,((l+c)/2-i)/a),[h,c,o,l,S,E]=n(this,lt).subarray(12,18),n(this,Js).push(((S+5*o)/6-s)/r,((E+5*l)/6-i)/a,((5*o+h)/6-s)/r,((5*l+c)/6-i)/a,((o+h)/2-s)/r,((l+c)/2-i)/a),!0))}toSVGPath(){if(this.isEmpty())return"";const e=n(this,Ei),t=n(this,Js);if(isNaN(n(this,lt)[6])&&!this.isEmpty())return w(this,le,$m).call(this);const s=[];s.push(`M${e[4]} ${e[5]}`);for(let i=6;i<e.length;i+=6)isNaN(e[i])?s.push(`L${e[i+4]} ${e[i+5]}`):s.push(`C${e[i]} ${e[i+1]} ${e[i+2]} ${e[i+3]} ${e[i+4]} ${e[i+5]}`);w(this,le,zm).call(this,s);for(let i=t.length-6;i>=6;i-=6)isNaN(t[i])?s.push(`L${t[i+4]} ${t[i+5]}`):s.push(`C${t[i]} ${t[i+1]} ${t[i+2]} ${t[i+3]} ${t[i+4]} ${t[i+5]}`);return w(this,le,jm).call(this,s),s.join(" ")}newFreeDrawOutline(e,t,s,i,r,a){return new Xm(e,t,s,i,r,a)}getOutlines(){var u;const e=n(this,Ei),t=n(this,Js),s=n(this,lt),[i,r,a,o]=n(this,us),l=new Float32Array((((u=n(this,nr))==null?void 0:u.length)??0)+2);for(let f=0,p=l.length-2;f<p;f+=2)l[f]=(n(this,nr)[f]-i)/a,l[f+1]=(n(this,nr)[f+1]-r)/o;if(l[l.length-2]=(n(this,wa)-i)/a,l[l.length-1]=(n(this,Ea)-r)/o,isNaN(s[6])&&!this.isEmpty())return w(this,le,Gm).call(this,l);const h=new Float32Array(n(this,Ei).length+24+n(this,Js).length);let c=e.length;for(let f=0;f<c;f+=2){if(isNaN(e[f])){h[f]=h[f+1]=NaN;continue}h[f]=e[f],h[f+1]=e[f+1]}c=w(this,le,Wm).call(this,h,c);for(let f=t.length-6;f>=6;f-=6)for(let p=0;p<6;p+=2){if(isNaN(t[f+p])){h[c]=h[c+1]=NaN,c+=2;continue}h[c]=t[f+p],h[c+1]=t[f+p+1],c+=2}return w(this,le,Vm).call(this,h,c),this.newFreeDrawOutline(h,l,n(this,us),n(this,gl),n(this,fl),n(this,pl))}};us=new WeakMap,Js=new WeakMap,fl=new WeakMap,pl=new WeakMap,Ei=new WeakMap,lt=new WeakMap,wa=new WeakMap,Ea=new WeakMap,_c=new WeakMap,Uc=new WeakMap,gl=new WeakMap,ml=new WeakMap,nr=new WeakMap,Hc=new WeakMap,Tu=new WeakMap,Cu=new WeakMap,le=new WeakSet,eh=function(){const e=n(this,lt).subarray(4,6),t=n(this,lt).subarray(16,18),[s,i,r,a]=n(this,us);return[(n(this,wa)+(e[0]-t[0])/2-s)/r,(n(this,Ea)+(e[1]-t[1])/2-i)/a,(n(this,wa)+(t[0]-e[0])/2-s)/r,(n(this,Ea)+(t[1]-e[1])/2-i)/a]},$m=function(){const[e,t,s,i]=n(this,us),[r,a,o,l]=w(this,le,eh).call(this);return`M${(n(this,lt)[2]-e)/s} ${(n(this,lt)[3]-t)/i} L${(n(this,lt)[4]-e)/s} ${(n(this,lt)[5]-t)/i} L${r} ${a} L${o} ${l} L${(n(this,lt)[16]-e)/s} ${(n(this,lt)[17]-t)/i} L${(n(this,lt)[14]-e)/s} ${(n(this,lt)[15]-t)/i} Z`},jm=function(e){const t=n(this,Js);e.push(`L${t[4]} ${t[5]} Z`)},zm=function(e){const[t,s,i,r]=n(this,us),a=n(this,lt).subarray(4,6),o=n(this,lt).subarray(16,18),[l,h,c,u]=w(this,le,eh).call(this);e.push(`L${(a[0]-t)/i} ${(a[1]-s)/r} L${l} ${h} L${c} ${u} L${(o[0]-t)/i} ${(o[1]-s)/r}`)},Gm=function(e){const t=n(this,lt),[s,i,r,a]=n(this,us),[o,l,h,c]=w(this,le,eh).call(this),u=new Float32Array(36);return u.set([NaN,NaN,NaN,NaN,(t[2]-s)/r,(t[3]-i)/a,NaN,NaN,NaN,NaN,(t[4]-s)/r,(t[5]-i)/a,NaN,NaN,NaN,NaN,o,l,NaN,NaN,NaN,NaN,h,c,NaN,NaN,NaN,NaN,(t[16]-s)/r,(t[17]-i)/a,NaN,NaN,NaN,NaN,(t[14]-s)/r,(t[15]-i)/a],0),this.newFreeDrawOutline(u,e,n(this,us),n(this,gl),n(this,fl),n(this,pl))},Vm=function(e,t){const s=n(this,Js);return e.set([NaN,NaN,NaN,NaN,s[4],s[5]],t),t+=6},Wm=function(e,t){const s=n(this,lt).subarray(4,6),i=n(this,lt).subarray(16,18),[r,a,o,l]=n(this,us),[h,c,u,f]=w(this,le,eh).call(this);return e.set([NaN,NaN,NaN,NaN,(s[0]-r)/o,(s[1]-a)/l,NaN,NaN,NaN,NaN,h,c,NaN,NaN,NaN,NaN,u,f,NaN,NaN,NaN,NaN,(i[0]-r)/o,(i[1]-a)/l],t),t+=24},y(Fi,Hc,8),y(Fi,Tu,2),y(Fi,Cu,n(Fi,Hc)+n(Fi,Tu));let lu=Fi;var vl,Sa,hn,$c,fs,jc,Zt,Ru,Ym;class Xm extends W{constructor(t,s,i,r,a,o){super();y(this,Ru);y(this,vl);y(this,Sa,new Float32Array(4));y(this,hn);y(this,$c);y(this,fs);y(this,jc);y(this,Zt);g(this,Zt,t),g(this,fs,s),g(this,vl,i),g(this,jc,r),g(this,hn,a),g(this,$c,o),this.firstPoint=[NaN,NaN],this.lastPoint=[NaN,NaN],w(this,Ru,Ym).call(this,o);const[l,h,c,u]=n(this,Sa);for(let f=0,p=t.length;f<p;f+=2)t[f]=(t[f]-l)/c,t[f+1]=(t[f+1]-h)/u;for(let f=0,p=s.length;f<p;f+=2)s[f]=(s[f]-l)/c,s[f+1]=(s[f+1]-h)/u}toSVGPath(){const t=[`M${n(this,Zt)[4]} ${n(this,Zt)[5]}`];for(let s=6,i=n(this,Zt).length;s<i;s+=6){if(isNaN(n(this,Zt)[s])){t.push(`L${n(this,Zt)[s+4]} ${n(this,Zt)[s+5]}`);continue}t.push(`C${n(this,Zt)[s]} ${n(this,Zt)[s+1]} ${n(this,Zt)[s+2]} ${n(this,Zt)[s+3]} ${n(this,Zt)[s+4]} ${n(this,Zt)[s+5]}`)}return t.push("Z"),t.join(" ")}serialize([t,s,i,r],a){const o=i-t,l=r-s;let h,c;switch(a){case 0:h=W._rescale(n(this,Zt),t,r,o,-l),c=W._rescale(n(this,fs),t,r,o,-l);break;case 90:h=W._rescaleAndSwap(n(this,Zt),t,s,o,l),c=W._rescaleAndSwap(n(this,fs),t,s,o,l);break;case 180:h=W._rescale(n(this,Zt),i,s,-o,l),c=W._rescale(n(this,fs),i,s,-o,l);break;case 270:h=W._rescaleAndSwap(n(this,Zt),i,r,-o,-l),c=W._rescaleAndSwap(n(this,fs),i,r,-o,-l);break}return{outline:Array.from(h),points:[Array.from(c)]}}get box(){return n(this,Sa)}newOutliner(t,s,i,r,a,o=0){return new lu(t,s,i,r,a,o)}getNewOutline(t,s){const[i,r,a,o]=n(this,Sa),[l,h,c,u]=n(this,vl),f=a*c,p=o*u,v=i*c+l,m=r*u+h,A=this.newOutliner({x:n(this,fs)[0]*f+v,y:n(this,fs)[1]*p+m},n(this,vl),n(this,jc),t,n(this,$c),s??n(this,hn));for(let b=2;b<n(this,fs).length;b+=2)A.add({x:n(this,fs)[b]*f+v,y:n(this,fs)[b+1]*p+m});return A.getOutlines()}}vl=new WeakMap,Sa=new WeakMap,hn=new WeakMap,$c=new WeakMap,fs=new WeakMap,jc=new WeakMap,Zt=new WeakMap,Ru=new WeakSet,Ym=function(t){const s=n(this,Zt);let i=s[4],r=s[5];const a=[i,r,i,r];let o=i,l=r,h=i,c=r;const u=t?Math.max:Math.min,f=new Float32Array(4);for(let v=6,m=s.length;v<m;v+=6){const A=s[v+4],b=s[v+5];isNaN(s[v])?(j.pointBoundingBox(A,b,a),l>b?(o=A,l=b):l===b&&(o=u(o,A)),c<b?(h=A,c=b):c===b&&(h=u(h,A))):(f[0]=f[1]=1/0,f[2]=f[3]=-1/0,j.bezierBoundingBox(i,r,...s.slice(v,v+6),f),j.rectBoundingBox(f[0],f[1],f[2],f[3],a),l>f[1]?(o=f[0],l=f[1]):l===f[1]&&(o=u(o,f[0])),c<f[3]?(h=f[2],c=f[3]):c===f[3]&&(h=u(h,f[2]))),i=A,r=b}const p=n(this,Sa);p[0]=a[0]-n(this,hn),p[1]=a[1]-n(this,hn),p[2]=a[2]-a[0]+2*n(this,hn),p[3]=a[3]-a[1]+2*n(this,hn),this.firstPoint=[o,l],this.lastPoint=[h,c]};var zc,Gc,Vc,rr,Qs,ze,Km,Hd,Jm,Qm,qf;class Zf{constructor(e,t=0,s=0,i=!0){y(this,ze);y(this,zc);y(this,Gc);y(this,Vc);y(this,rr,[]);y(this,Qs,[]);const r=[1/0,1/0,-1/0,-1/0],a=10**-4;for(const{x:m,y:A,width:b,height:S}of e){const E=Math.floor((m-t)/a)*a,T=Math.ceil((m+b+t)/a)*a,x=Math.floor((A-t)/a)*a,C=Math.ceil((A+S+t)/a)*a,R=[E,x,C,!0],I=[T,x,C,!1];n(this,rr).push(R,I),j.rectBoundingBox(E,x,T,C,r)}const o=r[2]-r[0]+2*s,l=r[3]-r[1]+2*s,h=r[0]-s,c=r[1]-s;let u=i?-1/0:1/0,f=1/0;const p=n(this,rr).at(i?-1:-2),v=[p[0],p[2]];for(const m of n(this,rr)){const[A,b,S,E]=m;!E&&i?b<f?(f=b,u=A):b===f&&(u=Math.max(u,A)):E&&!i&&(b<f?(f=b,u=A):b===f&&(u=Math.min(u,A))),m[0]=(A-h)/o,m[1]=(b-c)/l,m[2]=(S-c)/l}g(this,zc,new Float32Array([h,c,o,l])),g(this,Gc,[u,f]),g(this,Vc,v)}getOutlines(){n(this,rr).sort((t,s)=>t[0]-s[0]||t[1]-s[1]||t[2]-s[2]);const e=[];for(const t of n(this,rr))t[3]?(e.push(...w(this,ze,qf).call(this,t)),w(this,ze,Jm).call(this,t)):(w(this,ze,Qm).call(this,t),e.push(...w(this,ze,qf).call(this,t)));return w(this,ze,Km).call(this,e)}}zc=new WeakMap,Gc=new WeakMap,Vc=new WeakMap,rr=new WeakMap,Qs=new WeakMap,ze=new WeakSet,Km=function(e){const t=[],s=new Set;for(const a of e){const[o,l,h]=a;t.push([o,l,a],[o,h,a])}t.sort((a,o)=>a[1]-o[1]||a[0]-o[0]);for(let a=0,o=t.length;a<o;a+=2){const l=t[a][2],h=t[a+1][2];l.push(h),h.push(l),s.add(l),s.add(h)}const i=[];let r;for(;s.size>0;){const a=s.values().next().value;let[o,l,h,c,u]=a;s.delete(a);let f=o,p=l;for(r=[o,h],i.push(r);;){let v;if(s.has(c))v=c;else if(s.has(u))v=u;else break;s.delete(v),[o,l,h,c,u]=v,f!==o&&(r.push(f,p,o,p===l?l:h),f=o),p=p===l?h:l}r.push(f,p)}return new Eb(i,n(this,zc),n(this,Gc),n(this,Vc))},Hd=function(e){const t=n(this,Qs);let s=0,i=t.length-1;for(;s<=i;){const r=s+i>>1,a=t[r][0];if(a===e)return r;a<e?s=r+1:i=r-1}return i+1},Jm=function([,e,t]){const s=w(this,ze,Hd).call(this,e);n(this,Qs).splice(s,0,[e,t])},Qm=function([,e,t]){const s=w(this,ze,Hd).call(this,e);for(let i=s;i<n(this,Qs).length;i++){const[r,a]=n(this,Qs)[i];if(r!==e)break;if(r===e&&a===t){n(this,Qs).splice(i,1);return}}for(let i=s-1;i>=0;i--){const[r,a]=n(this,Qs)[i];if(r!==e)break;if(r===e&&a===t){n(this,Qs).splice(i,1);return}}},qf=function(e){const[t,s,i]=e,r=[[t,s,i]],a=w(this,ze,Hd).call(this,i);for(let o=0;o<a;o++){const[l,h]=n(this,Qs)[o];for(let c=0,u=r.length;c<u;c++){const[,f,p]=r[c];if(!(h<=f||p<=l)){if(f>=l){if(p>h)r[c][1]=h;else{if(u===1)return[];r.splice(c,1),c--,u--}continue}r[c][2]=l,p>h&&r.push([t,h,p])}}}return r};var Wc,yl;class Eb extends W{constructor(t,s,i,r){super();y(this,Wc);y(this,yl);g(this,yl,t),g(this,Wc,s),this.firstPoint=i,this.lastPoint=r}toSVGPath(){const t=[];for(const s of n(this,yl)){let[i,r]=s;t.push(`M${i} ${r}`);for(let a=2;a<s.length;a+=2){const o=s[a],l=s[a+1];o===i?(t.push(`V${l}`),r=l):l===r&&(t.push(`H${o}`),i=o)}t.push("Z")}return t.join(" ")}serialize([t,s,i,r],a){const o=[],l=i-t,h=r-s;for(const c of n(this,yl)){const u=new Array(c.length);for(let f=0;f<c.length;f+=2)u[f]=t+c[f]*l,u[f+1]=r-c[f+1]*h;o.push(u)}return o}get box(){return n(this,Wc)}get classNamesForOutlining(){return["highlightOutline"]}}Wc=new WeakMap,yl=new WeakMap;class tp extends lu{newFreeDrawOutline(e,t,s,i,r,a){return new Sb(e,t,s,i,r,a)}}class Sb extends Xm{newOutliner(e,t,s,i,r,a=0){return new tp(e,t,s,i,r,a)}}var bl,Xc,cn,xa,Yc,Je,Kc,Jc,Ta,ps,gs,Ee,Al,wl,Le,El,Ns,Qc,rt,ep,$d,Zm,qm,tv,sp,Ar,_s,Za,ev,jd,zd,sv,iv,nv,rv,av;const vt=class vt extends Nt{constructor(t){super({...t,name:"highlightEditor"});y(this,rt);y(this,bl,null);y(this,Xc,0);y(this,cn);y(this,xa,null);y(this,Yc,null);y(this,Je,null);y(this,Kc,null);y(this,Jc,0);y(this,Ta,null);y(this,ps,null);y(this,gs,null);y(this,Ee,!1);y(this,Al,null);y(this,wl,null);y(this,Le,null);y(this,El,"");y(this,Ns);y(this,Qc,"");this.color=t.color||vt._defaultColor,g(this,Ns,t.thickness||vt._defaultThickness),this.opacity=t.opacity||vt._defaultOpacity,g(this,cn,t.boxes||null),g(this,Qc,t.methodOfCreation||""),g(this,El,t.text||""),this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",t.highlightId>-1?(g(this,Ee,!0),w(this,rt,$d).call(this,t),w(this,rt,Ar).call(this)):n(this,cn)&&(g(this,bl,t.anchorNode),g(this,Xc,t.anchorOffset),g(this,Kc,t.focusNode),g(this,Jc,t.focusOffset),w(this,rt,ep).call(this),w(this,rt,Ar).call(this),this.rotate(this.rotation)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-highlight-added-alert")}static get _keyboardManager(){const t=vt.prototype;return Q(this,"_keyboardManager",new rd([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}get telemetryInitialData(){return{action:"added",type:n(this,Ee)?"free_highlight":"highlight",color:this._uiManager.getNonHCMColorName(this.color),thickness:n(this,Ns),methodOfCreation:n(this,Qc)}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.getNonHCMColorName(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}static initialize(t,s){var i;Nt.initialize(t,s),vt._defaultColor||(vt._defaultColor=((i=s.highlightColors)==null?void 0:i.values().next().value)||"#fff066")}static updateDefaultParams(t,s){switch(t){case dt.HIGHLIGHT_COLOR:vt._defaultColor=s;break;case dt.HIGHLIGHT_THICKNESS:vt._defaultThickness=s;break}}translateInPage(t,s){}get toolbarPosition(){return n(this,wl)}get commentButtonPosition(){return n(this,Al)}updateParams(t,s){switch(t){case dt.HIGHLIGHT_COLOR:w(this,rt,Zm).call(this,s);break;case dt.HIGHLIGHT_THICKNESS:w(this,rt,qm).call(this,s);break}}static get defaultPropertiesToUpdate(){return[[dt.HIGHLIGHT_COLOR,vt._defaultColor],[dt.HIGHLIGHT_THICKNESS,vt._defaultThickness]]}get propertiesToUpdate(){return[[dt.HIGHLIGHT_COLOR,this.color||vt._defaultColor],[dt.HIGHLIGHT_THICKNESS,n(this,Ns)||vt._defaultThickness],[dt.HIGHLIGHT_FREE,n(this,Ee)]]}onUpdatedColor(){var t,s;(t=this.parent)==null||t.drawLayer.updateProperties(n(this,gs),{root:{fill:this.color,"fill-opacity":this.opacity}}),(s=n(this,Yc))==null||s.updateColor(this.color),super.onUpdatedColor()}get toolbarButtons(){return this._uiManager.highlightColors?[["colorPicker",g(this,Yc,new ru({editor:this}))]]:super.toolbarButtons}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(w(this,rt,zd).call(this))}getBaseTranslation(){return[0,0]}getRect(t,s){return super.getRect(t,s,w(this,rt,zd).call(this))}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),t&&this.div.focus()}remove(){w(this,rt,sp).call(this),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(w(this,rt,Ar).call(this),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var i;let s=!1;this.parent&&!t?w(this,rt,sp).call(this):t&&(w(this,rt,Ar).call(this,t),s=!this.parent&&((i=this.div)==null?void 0:i.classList.contains("selectedEditor"))),super.setParent(t),this.show(this._isVisible),s&&this.select()}rotate(t){var r,a,o;const{drawLayer:s}=this.parent;let i;n(this,Ee)?(t=(t-this.rotation+360)%360,i=w(r=vt,_s,Za).call(r,n(this,ps).box,t)):i=w(a=vt,_s,Za).call(a,[this.x,this.y,this.width,this.height],t),s.updateProperties(n(this,gs),{bbox:i,root:{"data-main-rotation":t}}),s.updateProperties(n(this,Le),{bbox:w(o=vt,_s,Za).call(o,n(this,Je).box,t),root:{"data-main-rotation":t}})}render(){if(this.div)return this.div;const t=super.render();n(this,El)&&(t.setAttribute("aria-label",n(this,El)),t.setAttribute("role","mark")),n(this,Ee)?t.classList.add("free"):this.div.addEventListener("keydown",w(this,rt,ev).bind(this),{signal:this._uiManager._signal});const s=g(this,Ta,document.createElement("div"));return t.append(s),s.setAttribute("aria-hidden","true"),s.className="internal",s.style.clipPath=n(this,xa),this.setDims(),Cg(this,n(this,Ta),["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(n(this,Le),{rootClass:{hovered:!0}})}pointerleave(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(n(this,Le),{rootClass:{hovered:!1}})}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:w(this,rt,jd).call(this,!0);break;case 1:case 3:w(this,rt,jd).call(this,!1);break}}select(){var t;super.select(),n(this,Le)&&((t=this.parent)==null||t.drawLayer.updateProperties(n(this,Le),{rootClass:{hovered:!1,selected:!0}}))}unselect(){var t;super.unselect(),n(this,Le)&&((t=this.parent)==null||t.drawLayer.updateProperties(n(this,Le),{rootClass:{selected:!1}}),n(this,Ee)||w(this,rt,jd).call(this,!1))}get _mustFixPosition(){return!n(this,Ee)}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.updateProperties(n(this,gs),{rootClass:{hidden:!t}}),this.parent.drawLayer.updateProperties(n(this,Le),{rootClass:{hidden:!t}}))}static startHighlighting(t,s,{target:i,x:r,y:a}){const{x:o,y:l,width:h,height:c}=i.getBoundingClientRect(),u=new AbortController,f=t.combinedSignal(u),p=v=>{u.abort(),w(this,_s,rv).call(this,t,v)};window.addEventListener("blur",p,{signal:f}),window.addEventListener("pointerup",p,{signal:f}),window.addEventListener("pointerdown",Jt,{capture:!0,passive:!1,signal:f}),window.addEventListener("contextmenu",Hs,{signal:f}),i.addEventListener("pointermove",w(this,_s,nv).bind(this,t),{signal:f}),this._freeHighlight=new tp({x:r,y:a},[o,l,h,c],t.scale,this._defaultThickness/2,s,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static async deserialize(t,s,i){var m,A,b,S;let r=null;if(t instanceof Fm){const{data:{quadPoints:E,rect:T,rotation:x,id:C,color:R,opacity:I,popupRef:P,richText:M,contentsObj:D,creationDate:_,modificationDate:k},parent:{page:{pageNumber:N}}}=t;r=t={annotationType:et.HIGHLIGHT,color:Array.from(R),opacity:I,quadPoints:E,boxes:null,pageIndex:N-1,rect:T.slice(0),rotation:x,annotationElementId:C,id:C,deleted:!1,popupRef:P,richText:M,comment:(D==null?void 0:D.str)||null,creationDate:_,modificationDate:k}}else if(t instanceof Pp){const{data:{inkLists:E,rect:T,rotation:x,id:C,color:R,borderStyle:{rawWidth:I},popupRef:P,richText:M,contentsObj:D,creationDate:_,modificationDate:k},parent:{page:{pageNumber:N}}}=t;r=t={annotationType:et.HIGHLIGHT,color:Array.from(R),thickness:I,inkLists:E,boxes:null,pageIndex:N-1,rect:T.slice(0),rotation:x,annotationElementId:C,id:C,deleted:!1,popupRef:P,richText:M,comment:(D==null?void 0:D.str)||null,creationDate:_,modificationDate:k}}const{color:a,quadPoints:o,inkLists:l,opacity:h}=t,c=await super.deserialize(t,s,i);c.color=j.makeHexColor(...a),c.opacity=h||1,l&&g(c,Ns,t.thickness),c._initialData=r,t.comment&&c.setCommentData(t);const[u,f]=c.pageDimensions,[p,v]=c.pageTranslation;if(o){const E=g(c,cn,[]);for(let T=0;T<o.length;T+=8)E.push({x:(o[T]-p)/u,y:1-(o[T+1]-v)/f,width:(o[T+2]-o[T])/u,height:(o[T+1]-o[T+5])/f});w(m=c,rt,ep).call(m),w(A=c,rt,Ar).call(A),c.rotate(c.rotation)}else if(l){g(c,Ee,!0);const E=l[0],T={x:E[0]-p,y:f-(E[1]-v)},x=new tp(T,[0,0,u,f],1,n(c,Ns)/2,!0,.001);for(let I=0,P=E.length;I<P;I+=2)T.x=E[I]-p,T.y=f-(E[I+1]-v),x.add(T);const{id:C,clipPathId:R}=s.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:c.color,"fill-opacity":c._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:x.toSVGPath()}},!0,!0);w(b=c,rt,$d).call(b,{highlightOutlines:x.getOutlines(),highlightId:C,clipPathId:R}),w(S=c,rt,Ar).call(S),c.rotate(c.parentRotation)}return c}serialize(t=!1){if(this.isEmpty()||t)return null;if(this.deleted)return this.serializeDeleted();const s=Nt._colorManager.convert(this._uiManager.getNonHCMColor(this.color)),i=super.serialize(t);return Object.assign(i,{color:s,opacity:this.opacity,thickness:n(this,Ns),quadPoints:w(this,rt,sv).call(this),outlines:w(this,rt,iv).call(this,i.rect)}),this.addComment(i),this.annotationElementId&&!w(this,rt,av).call(this,i)?null:(i.id=this.annotationElementId,i)}renderAnnotationElement(t){return this.deleted?(t.hide(),null):(t.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}static canCreateNewEmptyEditor(){return!1}};bl=new WeakMap,Xc=new WeakMap,cn=new WeakMap,xa=new WeakMap,Yc=new WeakMap,Je=new WeakMap,Kc=new WeakMap,Jc=new WeakMap,Ta=new WeakMap,ps=new WeakMap,gs=new WeakMap,Ee=new WeakMap,Al=new WeakMap,wl=new WeakMap,Le=new WeakMap,El=new WeakMap,Ns=new WeakMap,Qc=new WeakMap,rt=new WeakSet,ep=function(){const t=new Zf(n(this,cn),.001);g(this,ps,t.getOutlines()),[this.x,this.y,this.width,this.height]=n(this,ps).box;const s=new Zf(n(this,cn),.0025,.001,this._uiManager.direction==="ltr");g(this,Je,s.getOutlines());const{firstPoint:i}=n(this,ps);g(this,Al,[(i[0]-this.x)/this.width,(i[1]-this.y)/this.height]);const{lastPoint:r}=n(this,Je);g(this,wl,[(r[0]-this.x)/this.width,(r[1]-this.y)/this.height])},$d=function({highlightOutlines:t,highlightId:s,clipPathId:i}){var f,p;if(g(this,ps,t),g(this,Je,t.getNewOutline(n(this,Ns)/2+1.5,.0025)),s>=0)g(this,gs,s),g(this,xa,i),this.parent.drawLayer.finalizeDraw(s,{bbox:t.box,path:{d:t.toSVGPath()}}),g(this,Le,this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:n(this,Je).box,path:{d:n(this,Je).toSVGPath()}},!0));else if(this.parent){const v=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(n(this,gs),{bbox:w(f=vt,_s,Za).call(f,n(this,ps).box,(v-this.rotation+360)%360),path:{d:t.toSVGPath()}}),this.parent.drawLayer.updateProperties(n(this,Le),{bbox:w(p=vt,_s,Za).call(p,n(this,Je).box,v),path:{d:n(this,Je).toSVGPath()}})}const[a,o,l,h]=t.box;switch(this.rotation){case 0:this.x=a,this.y=o,this.width=l,this.height=h;break;case 90:{const[v,m]=this.parentDimensions;this.x=o,this.y=1-a,this.width=l*m/v,this.height=h*v/m;break}case 180:this.x=1-a,this.y=1-o,this.width=l,this.height=h;break;case 270:{const[v,m]=this.parentDimensions;this.x=1-o,this.y=a,this.width=l*m/v,this.height=h*v/m;break}}const{firstPoint:c}=t;g(this,Al,[(c[0]-a)/l,(c[1]-o)/h]);const{lastPoint:u}=n(this,Je);g(this,wl,[(u[0]-a)/l,(u[1]-o)/h])},Zm=function(t){const s=(a,o)=>{this.color=a,this.opacity=o,this.onUpdatedColor()},i=this.color,r=this.opacity;this.addCommands({cmd:s.bind(this,t,vt._defaultOpacity),undo:s.bind(this,i,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:dt.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.getNonHCMColorName(t)},!0)},qm=function(t){const s=n(this,Ns),i=r=>{g(this,Ns,r),w(this,rt,tv).call(this,r)};this.addCommands({cmd:i.bind(this,t),undo:i.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:dt.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)},tv=function(t){n(this,Ee)&&(w(this,rt,$d).call(this,{highlightOutlines:n(this,ps).getNewOutline(t/2)}),this.fixAndSetPosition(),this.setDims())},sp=function(){n(this,gs)===null||!this.parent||(this.parent.drawLayer.remove(n(this,gs)),g(this,gs,null),this.parent.drawLayer.remove(n(this,Le)),g(this,Le,null))},Ar=function(t=this.parent){n(this,gs)===null&&({id:ie(this,gs)._,clipPathId:ie(this,xa)._}=t.drawLayer.draw({bbox:n(this,ps).box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":this.opacity},rootClass:{highlight:!0,free:n(this,Ee)},path:{d:n(this,ps).toSVGPath()}},!1,!0),g(this,Le,t.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:n(this,Ee)},bbox:n(this,Je).box,path:{d:n(this,Je).toSVGPath()}},n(this,Ee))),n(this,Ta)&&(n(this,Ta).style.clipPath=n(this,xa)))},_s=new WeakSet,Za=function([t,s,i,r],a){switch(a){case 90:return[1-s-r,t,r,i];case 180:return[1-t-i,1-s-r,i,r];case 270:return[s,1-t-i,r,i]}return[t,s,i,r]},ev=function(t){vt._keyboardManager.exec(this,t)},jd=function(t){if(!n(this,bl))return;const s=window.getSelection();t?s.setPosition(n(this,bl),n(this,Xc)):s.setPosition(n(this,Kc),n(this,Jc))},zd=function(){return n(this,Ee)?this.rotation:0},sv=function(){if(n(this,Ee))return null;const[t,s]=this.pageDimensions,[i,r]=this.pageTranslation,a=n(this,cn),o=new Float32Array(a.length*8);let l=0;for(const{x:h,y:c,width:u,height:f}of a){const p=h*t+i,v=(1-c)*s+r;o[l]=o[l+4]=p,o[l+1]=o[l+3]=v,o[l+2]=o[l+6]=p+u*t,o[l+5]=o[l+7]=v-f*s,l+=8}return o},iv=function(t){return n(this,ps).serialize(t,w(this,rt,zd).call(this))},nv=function(t,s){this._freeHighlight.add(s)&&t.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})},rv=function(t,s){this._freeHighlight.isEmpty()?t.drawLayer.remove(this._freeHighlightId):t.createAndAddNewEditor(s,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""},av=function(t){const{color:s}=this._initialData;return this.hasEditedComment||t.color.some((i,r)=>i!==s[r])},y(vt,_s),F(vt,"_defaultColor",null),F(vt,"_defaultOpacity",1),F(vt,"_defaultThickness",12),F(vt,"_type","highlight"),F(vt,"_editorType",et.HIGHLIGHT),F(vt,"_freeHighlightId",-1),F(vt,"_freeHighlight",null),F(vt,"_freeHighlightClipId","");let hu=vt;var Ca;class ov{constructor(){y(this,Ca,Object.create(null))}updateProperty(e,t){this[e]=t,this.updateSVGProperty(e,t)}updateProperties(e){if(e)for(const[t,s]of Object.entries(e))t.startsWith("_")||this.updateProperty(t,s)}updateSVGProperty(e,t){n(this,Ca)[e]=t}toSVGProperties(){const e=n(this,Ca);return g(this,Ca,Object.create(null)),{root:e}}reset(){g(this,Ca,Object.create(null))}updateAll(e=this){this.updateProperties(e)}clone(){Ot("Not implemented")}}Ca=new WeakMap;var ms,Sl,fe,Ra,Pa,ft,ip,np,rp,sh,lv,Gd,ih,qa;const ct=class ct extends Nt{constructor(t){super(t);y(this,ft);y(this,ms,null);y(this,Sl);F(this,"_colorPicker",null);F(this,"_drawId",null);g(this,Sl,t.mustBeCommitted||!1),this._addOutlines(t)}onUpdatedColor(){var t;(t=this._colorPicker)==null||t.update(this.color),super.onUpdatedColor()}_addOutlines(t){t.drawOutlines&&(w(this,ft,ip).call(this,t),w(this,ft,sh).call(this))}static _mergeSVGProperties(t,s){const i=new Set(Object.keys(t));for(const[r,a]of Object.entries(s))i.has(r)?Object.assign(t[r],a):t[r]=a;return t}static getDefaultDrawingOptions(t){Ot("Not implemented")}static get typesMap(){Ot("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,s){const i=this.typesMap.get(t);i&&this._defaultDrawingOptions.updateProperty(i,s),this._currentParent&&(n(ct,fe).updateProperty(i,s),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(t,s){const i=this.constructor.typesMap.get(t);i&&this._updateProperty(t,i,s)}static get defaultPropertiesToUpdate(){const t=[],s=this._defaultDrawingOptions;for(const[i,r]of this.typesMap)t.push([i,s[r]]);return t}get propertiesToUpdate(){const t=[],{_drawingOptions:s}=this;for(const[i,r]of this.constructor.typesMap)t.push([i,s[r]]);return t}_updateProperty(t,s,i){const r=this._drawingOptions,a=r[s],o=l=>{var c;r.updateProperty(s,l);const h=n(this,ms).updateProperty(s,l);h&&w(this,ft,ih).call(this,h),(c=this.parent)==null||c.drawLayer.updateProperties(this._drawId,r.toSVGProperties()),t===this.colorType&&this.onUpdatedColor()};this.addCommands({cmd:o.bind(this,i),undo:o.bind(this,a),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,ct._mergeSVGProperties(n(this,ms).getPathResizingSVGProperties(w(this,ft,Gd).call(this)),{bbox:w(this,ft,qa).call(this)}))}_onResized(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,ct._mergeSVGProperties(n(this,ms).getPathResizedSVGProperties(w(this,ft,Gd).call(this)),{bbox:w(this,ft,qa).call(this)}))}_onTranslating(t,s){var i;(i=this.parent)==null||i.drawLayer.updateProperties(this._drawId,{bbox:w(this,ft,qa).call(this)})}_onTranslated(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,ct._mergeSVGProperties(n(this,ms).getPathTranslatedSVGProperties(w(this,ft,Gd).call(this),this.parentDimensions),{bbox:w(this,ft,qa).call(this)}))}_onStartDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,n(this,Sl)&&(g(this,Sl,!1),this.commit(),this.parent.setSelected(this),t&&this.isOnScreen&&this.div.focus())}remove(){w(this,ft,rp).call(this),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(w(this,ft,sh).call(this),w(this,ft,ih).call(this,n(this,ms).box),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var i;let s=!1;this.parent&&!t?(this._uiManager.removeShouldRescale(this),w(this,ft,rp).call(this)):t&&(this._uiManager.addShouldRescale(this),w(this,ft,sh).call(this,t),s=!this.parent&&((i=this.div)==null?void 0:i.classList.contains("selectedEditor"))),super.setParent(t),s&&this.select()}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,ct._mergeSVGProperties({bbox:w(this,ft,qa).call(this)},n(this,ms).updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&w(this,ft,ih).call(this,n(this,ms).updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let t,s;this._isCopy&&(t=this.x,s=this.y);const i=super.render();i.classList.add("draw");const r=document.createElement("div");return i.append(r),r.setAttribute("aria-hidden","true"),r.className="internal",this.setDims(),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(t,s),i}static createDrawerInstance(t,s,i,r,a){Ot("Not implemented")}static startDrawing(t,s,i,r){var A;const{target:a,offsetX:o,offsetY:l,pointerId:h,pointerType:c}=r;if(Pe.isInitializedAndDifferentPointerType(c))return;const{viewport:{rotation:u}}=t,{width:f,height:p}=a.getBoundingClientRect(),v=g(ct,Ra,new AbortController),m=t.combinedSignal(v);if(Pe.setPointer(c,h),window.addEventListener("pointerup",b=>{Pe.isSamePointerIdOrRemove(b.pointerId)&&this._endDraw(b)},{signal:m}),window.addEventListener("pointercancel",b=>{Pe.isSamePointerIdOrRemove(b.pointerId)&&this._currentParent.endDrawingSession()},{signal:m}),window.addEventListener("pointerdown",b=>{Pe.isSamePointerType(b.pointerType)&&(Pe.initializeAndAddPointerId(b.pointerId),n(ct,fe).isCancellable()&&(n(ct,fe).removeLastElement(),n(ct,fe).isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:m}),window.addEventListener("contextmenu",Hs,{signal:m}),a.addEventListener("pointermove",this._drawMove.bind(this),{signal:m}),a.addEventListener("touchmove",b=>{Pe.isSameTimeStamp(b.timeStamp)&&Jt(b)},{signal:m}),t.toggleDrawing(),(A=s._editorUndoBar)==null||A.hide(),n(ct,fe)){t.drawLayer.updateProperties(this._currentDrawId,n(ct,fe).startNew(o,l,f,p,u));return}s.updateUIForDefaultProperties(this),g(ct,fe,this.createDrawerInstance(o,l,f,p,u)),g(ct,Pa,this.getDefaultDrawingOptions()),this._currentParent=t,{id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(n(ct,Pa).toSVGProperties(),n(ct,fe).defaultSVGProperties),!0,!1)}static _drawMove(t){if(Pe.isSameTimeStamp(t.timeStamp),!n(ct,fe))return;const{offsetX:s,offsetY:i,pointerId:r}=t;if(Pe.isSamePointerId(r)){if(Pe.isUsingMultiplePointers()){this._endDraw(t);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,n(ct,fe).add(s,i)),Pe.setTimeStamp(t.timeStamp),Jt(t)}}static _cleanup(t){t&&(this._currentDrawId=-1,this._currentParent=null,g(ct,fe,null),g(ct,Pa,null),Pe.clearTimeStamp()),n(ct,Ra)&&(n(ct,Ra).abort(),g(ct,Ra,null),Pe.clearPointerIds())}static _endDraw(t){const s=this._currentParent;if(s){if(s.toggleDrawing(!0),this._cleanup(!1),(t==null?void 0:t.target)===s.div&&s.drawLayer.updateProperties(this._currentDrawId,n(ct,fe).end(t.offsetX,t.offsetY)),this.supportMultipleDrawings){const i=n(ct,fe),r=this._currentDrawId,a=i.getLastElement();s.addCommands({cmd:()=>{s.drawLayer.updateProperties(r,i.setLastElement(a))},undo:()=>{s.drawLayer.updateProperties(r,i.removeLastElement())},mustExec:!1,type:dt.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(t){const s=this._currentParent;if(!s)return null;if(s.toggleDrawing(!0),s.cleanUndoStack(dt.DRAW_STEP),!n(ct,fe).isEmpty()){const{pageDimensions:[i,r],scale:a}=s,o=s.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:n(ct,fe).getOutlines(i*a,r*a,a,this._INNER_MARGIN),drawingOptions:n(ct,Pa),mustBeCommitted:!t});return this._cleanup(!0),o}return s.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(t){}static deserializeDraw(t,s,i,r,a,o){Ot("Not implemented")}static async deserialize(t,s,i){var u,f;const{rawDims:{pageWidth:r,pageHeight:a,pageX:o,pageY:l}}=s.viewport,h=this.deserializeDraw(o,l,r,a,this._INNER_MARGIN,t),c=await super.deserialize(t,s,i);return c.createDrawingOptions(t),w(u=c,ft,ip).call(u,{drawOutlines:h}),w(f=c,ft,sh).call(f),c.onScaleChanging(),c.rotate(),c}serializeDraw(t){const[s,i]=this.pageTranslation,[r,a]=this.pageDimensions;return n(this,ms).serialize([s,i,r,a],t)}renderAnnotationElement(t){return t.updateEdited({rect:this.getPDFRect()}),null}static canCreateNewEmptyEditor(){return!1}};ms=new WeakMap,Sl=new WeakMap,fe=new WeakMap,Ra=new WeakMap,Pa=new WeakMap,ft=new WeakSet,ip=function({drawOutlines:t,drawId:s,drawingOptions:i}){g(this,ms,t),this._drawingOptions||(this._drawingOptions=i),this.annotationElementId||this._uiManager.a11yAlert(`pdfjs-editor-${this.editorType}-added-alert`),s>=0?(this._drawId=s,this.parent.drawLayer.finalizeDraw(s,t.defaultProperties)):this._drawId=w(this,ft,np).call(this,t,this.parent),w(this,ft,ih).call(this,t.box)},np=function(t,s){const{id:i}=s.drawLayer.draw(ct._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1);return i},rp=function(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())},sh=function(t=this.parent){if(!(this._drawId!==null&&this.parent===t)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,t.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=w(this,ft,np).call(this,n(this,ms),t)}},lv=function([t,s,i,r]){const{parentDimensions:[a,o],rotation:l}=this;switch(l){case 90:return[s,1-t,i*(o/a),r*(a/o)];case 180:return[1-t,1-s,i,r];case 270:return[1-s,t,i*(o/a),r*(a/o)];default:return[t,s,i,r]}},Gd=function(){const{x:t,y:s,width:i,height:r,parentDimensions:[a,o],rotation:l}=this;switch(l){case 90:return[1-s,t,i*(a/o),r*(o/a)];case 180:return[1-t,1-s,i,r];case 270:return[s,1-t,i*(a/o),r*(o/a)];default:return[t,s,i,r]}},ih=function(t){[this.x,this.y,this.width,this.height]=w(this,ft,lv).call(this,t),this.div&&(this.fixAndSetPosition(),this.setDims()),this._onResized()},qa=function(){const{x:t,y:s,width:i,height:r,rotation:a,parentRotation:o,parentDimensions:[l,h]}=this;switch((a*4+o)/90){case 1:return[1-s-r,t,r,i];case 2:return[1-t-i,1-s-r,i,r];case 3:return[s,1-t-i,r,i];case 4:return[t,s-i*(l/h),r*(h/l),i*(l/h)];case 5:return[1-s,t,i*(l/h),r*(h/l)];case 6:return[1-t-r*(h/l),1-s,r*(h/l),i*(l/h)];case 7:return[s-i*(l/h),1-t-r*(h/l),i*(l/h),r*(h/l)];case 8:return[t-i,s-r,i,r];case 9:return[1-s,t-i,r,i];case 10:return[1-t,1-s,i,r];case 11:return[s-r,1-t,r,i];case 12:return[t-r*(h/l),s,r*(h/l),i*(l/h)];case 13:return[1-s-i*(l/h),t-r*(h/l),i*(l/h),r*(h/l)];case 14:return[1-t,1-s-i*(l/h),r*(h/l),i*(l/h)];case 15:return[s,1-t,i*(l/h),r*(h/l)];default:return[t,s,i,r]}},F(ct,"_currentDrawId",-1),F(ct,"_currentParent",null),y(ct,fe,null),y(ct,Ra,null),y(ct,Pa,null),F(ct,"_INNER_MARGIN",3);let cu=ct;var Si,pe,ge,Ia,xl,Be,Se,Bs,Da,Ma,Oa,Tl,Vd;class xb{constructor(e,t,s,i,r,a){y(this,Tl);y(this,Si,new Float64Array(6));y(this,pe);y(this,ge);y(this,Ia);y(this,xl);y(this,Be);y(this,Se,"");y(this,Bs,0);y(this,Da,new od);y(this,Ma);y(this,Oa);g(this,Ma,s),g(this,Oa,i),g(this,Ia,r),g(this,xl,a),[e,t]=w(this,Tl,Vd).call(this,e,t);const o=g(this,pe,[NaN,NaN,NaN,NaN,e,t]);g(this,Be,[e,t]),g(this,ge,[{line:o,points:n(this,Be)}]),n(this,Si).set(o,0)}updateProperty(e,t){e==="stroke-width"&&g(this,xl,t)}isEmpty(){return!n(this,ge)||n(this,ge).length===0}isCancellable(){return n(this,Be).length<=10}add(e,t){[e,t]=w(this,Tl,Vd).call(this,e,t);const[s,i,r,a]=n(this,Si).subarray(2,6),o=e-r,l=t-a;return Math.hypot(n(this,Ma)*o,n(this,Oa)*l)<=2?null:(n(this,Be).push(e,t),isNaN(s)?(n(this,Si).set([r,a,e,t],2),n(this,pe).push(NaN,NaN,NaN,NaN,e,t),{path:{d:this.toSVGPath()}}):(isNaN(n(this,Si)[0])&&n(this,pe).splice(6,6),n(this,Si).set([s,i,r,a,e,t],0),n(this,pe).push(...W.createBezierPoints(s,i,r,a,e,t)),{path:{d:this.toSVGPath()}}))}end(e,t){const s=this.add(e,t);return s||(n(this,Be).length===2?{path:{d:this.toSVGPath()}}:null)}startNew(e,t,s,i,r){g(this,Ma,s),g(this,Oa,i),g(this,Ia,r),[e,t]=w(this,Tl,Vd).call(this,e,t);const a=g(this,pe,[NaN,NaN,NaN,NaN,e,t]);g(this,Be,[e,t]);const o=n(this,ge).at(-1);return o&&(o.line=new Float32Array(o.line),o.points=new Float32Array(o.points)),n(this,ge).push({line:a,points:n(this,Be)}),n(this,Si).set(a,0),g(this,Bs,0),this.toSVGPath(),null}getLastElement(){return n(this,ge).at(-1)}setLastElement(e){return n(this,ge)?(n(this,ge).push(e),g(this,pe,e.line),g(this,Be,e.points),g(this,Bs,0),{path:{d:this.toSVGPath()}}):n(this,Da).setLastElement(e)}removeLastElement(){if(!n(this,ge))return n(this,Da).removeLastElement();n(this,ge).pop(),g(this,Se,"");for(let e=0,t=n(this,ge).length;e<t;e++){const{line:s,points:i}=n(this,ge)[e];g(this,pe,s),g(this,Be,i),g(this,Bs,0),this.toSVGPath()}return{path:{d:n(this,Se)}}}toSVGPath(){const e=W.svgRound(n(this,pe)[4]),t=W.svgRound(n(this,pe)[5]);if(n(this,Be).length===2)return g(this,Se,`${n(this,Se)} M ${e} ${t} Z`),n(this,Se);if(n(this,Be).length<=6){const i=n(this,Se).lastIndexOf("M");g(this,Se,`${n(this,Se).slice(0,i)} M ${e} ${t}`),g(this,Bs,6)}if(n(this,Be).length===4){const i=W.svgRound(n(this,pe)[10]),r=W.svgRound(n(this,pe)[11]);return g(this,Se,`${n(this,Se)} L ${i} ${r}`),g(this,Bs,12),n(this,Se)}const s=[];n(this,Bs)===0&&(s.push(`M ${e} ${t}`),g(this,Bs,6));for(let i=n(this,Bs),r=n(this,pe).length;i<r;i+=6){const[a,o,l,h,c,u]=n(this,pe).slice(i,i+6).map(W.svgRound);s.push(`C${a} ${o} ${l} ${h} ${c} ${u}`)}return g(this,Se,n(this,Se)+s.join(" ")),g(this,Bs,n(this,pe).length),n(this,Se)}getOutlines(e,t,s,i){const r=n(this,ge).at(-1);return r.line=new Float32Array(r.line),r.points=new Float32Array(r.points),n(this,Da).build(n(this,ge),e,t,s,n(this,Ia),n(this,xl),i),g(this,Si,null),g(this,pe,null),g(this,ge,null),g(this,Se,null),n(this,Da)}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}Si=new WeakMap,pe=new WeakMap,ge=new WeakMap,Ia=new WeakMap,xl=new WeakMap,Be=new WeakMap,Se=new WeakMap,Bs=new WeakMap,Da=new WeakMap,Ma=new WeakMap,Oa=new WeakMap,Tl=new WeakSet,Vd=function(e,t){return W._normalizePoint(e,t,n(this,Ma),n(this,Oa),n(this,Ia))};var _e,Zc,qc,vs,xi,Ti,Cl,Rl,La,Te,Oi,hv,cv,dv;class od extends W{constructor(){super(...arguments);y(this,Te);y(this,_e);y(this,Zc,0);y(this,qc);y(this,vs);y(this,xi);y(this,Ti);y(this,Cl);y(this,Rl);y(this,La)}build(t,s,i,r,a,o,l){g(this,xi,s),g(this,Ti,i),g(this,Cl,r),g(this,Rl,a),g(this,La,o),g(this,qc,l??0),g(this,vs,t),w(this,Te,cv).call(this)}get thickness(){return n(this,La)}setLastElement(t){return n(this,vs).push(t),{path:{d:this.toSVGPath()}}}removeLastElement(){return n(this,vs).pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const t=[];for(const{line:s}of n(this,vs)){if(t.push(`M${W.svgRound(s[4])} ${W.svgRound(s[5])}`),s.length===6){t.push("Z");continue}if(s.length===12&&isNaN(s[6])){t.push(`L${W.svgRound(s[10])} ${W.svgRound(s[11])}`);continue}for(let i=6,r=s.length;i<r;i+=6){const[a,o,l,h,c,u]=s.subarray(i,i+6).map(W.svgRound);t.push(`C${a} ${o} ${l} ${h} ${c} ${u}`)}}return t.join("")}serialize([t,s,i,r],a){const o=[],l=[],[h,c,u,f]=w(this,Te,hv).call(this);let p,v,m,A,b,S,E,T,x;switch(n(this,Rl)){case 0:x=W._rescale,p=t,v=s+r,m=i,A=-r,b=t+h*i,S=s+(1-c-f)*r,E=t+(h+u)*i,T=s+(1-c)*r;break;case 90:x=W._rescaleAndSwap,p=t,v=s,m=i,A=r,b=t+c*i,S=s+h*r,E=t+(c+f)*i,T=s+(h+u)*r;break;case 180:x=W._rescale,p=t+i,v=s,m=-i,A=r,b=t+(1-h-u)*i,S=s+c*r,E=t+(1-h)*i,T=s+(c+f)*r;break;case 270:x=W._rescaleAndSwap,p=t+i,v=s+r,m=-i,A=-r,b=t+(1-c-f)*i,S=s+(1-h-u)*r,E=t+(1-c)*i,T=s+(1-h)*r;break}for(const{line:C,points:R}of n(this,vs))o.push(x(C,p,v,m,A,a?new Array(C.length):null)),l.push(x(R,p,v,m,A,a?new Array(R.length):null));return{lines:o,points:l,rect:[b,S,E,T]}}static deserialize(t,s,i,r,a,{paths:{lines:o,points:l},rotation:h,thickness:c}){const u=[];let f,p,v,m,A;switch(h){case 0:A=W._rescale,f=-t/i,p=s/r+1,v=1/i,m=-1/r;break;case 90:A=W._rescaleAndSwap,f=-s/r,p=-t/i,v=1/r,m=1/i;break;case 180:A=W._rescale,f=t/i+1,p=-s/r,v=-1/i,m=1/r;break;case 270:A=W._rescaleAndSwap,f=s/r+1,p=t/i+1,v=-1/r,m=-1/i;break}if(!o){o=[];for(const S of l){const E=S.length;if(E===2){o.push(new Float32Array([NaN,NaN,NaN,NaN,S[0],S[1]]));continue}if(E===4){o.push(new Float32Array([NaN,NaN,NaN,NaN,S[0],S[1],NaN,NaN,NaN,NaN,S[2],S[3]]));continue}const T=new Float32Array(3*(E-2));o.push(T);let[x,C,R,I]=S.subarray(0,4);T.set([NaN,NaN,NaN,NaN,x,C],0);for(let P=4;P<E;P+=2){const M=S[P],D=S[P+1];T.set(W.createBezierPoints(x,C,R,I,M,D),(P-2)*3),[x,C,R,I]=[R,I,M,D]}}}for(let S=0,E=o.length;S<E;S++)u.push({line:A(o[S].map(T=>T??NaN),f,p,v,m),points:A(l[S].map(T=>T??NaN),f,p,v,m)});const b=new this.prototype.constructor;return b.build(u,i,r,1,h,c,a),b}get box(){return n(this,_e)}updateProperty(t,s){return t==="stroke-width"?w(this,Te,dv).call(this,s):null}updateParentDimensions([t,s],i){const[r,a]=w(this,Te,Oi).call(this);g(this,xi,t),g(this,Ti,s),g(this,Cl,i);const[o,l]=w(this,Te,Oi).call(this),h=o-r,c=l-a,u=n(this,_e);return u[0]-=h,u[1]-=c,u[2]+=2*h,u[3]+=2*c,u}updateRotation(t){return g(this,Zc,t),{path:{transform:this.rotationTransform}}}get viewBox(){return n(this,_e).map(W.svgRound).join(" ")}get defaultProperties(){const[t,s]=n(this,_e);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${W.svgRound(t)} ${W.svgRound(s)}`}}}get rotationTransform(){const[,,t,s]=n(this,_e);let i=0,r=0,a=0,o=0,l=0,h=0;switch(n(this,Zc)){case 90:r=s/t,a=-t/s,l=t;break;case 180:i=-1,o=-1,l=t,h=s;break;case 270:r=-s/t,a=t/s,h=s;break;default:return""}return`matrix(${i} ${r} ${a} ${o} ${W.svgRound(l)} ${W.svgRound(h)})`}getPathResizingSVGProperties([t,s,i,r]){const[a,o]=w(this,Te,Oi).call(this),[l,h,c,u]=n(this,_e);if(Math.abs(c-a)<=W.PRECISION||Math.abs(u-o)<=W.PRECISION){const A=t+i/2-(l+c/2),b=s+r/2-(h+u/2);return{path:{"transform-origin":`${W.svgRound(t)} ${W.svgRound(s)}`,transform:`${this.rotationTransform} translate(${A} ${b})`}}}const f=(i-2*a)/(c-2*a),p=(r-2*o)/(u-2*o),v=c/i,m=u/r;return{path:{"transform-origin":`${W.svgRound(l)} ${W.svgRound(h)}`,transform:`${this.rotationTransform} scale(${v} ${m}) translate(${W.svgRound(a)} ${W.svgRound(o)}) scale(${f} ${p}) translate(${W.svgRound(-a)} ${W.svgRound(-o)})`}}}getPathResizedSVGProperties([t,s,i,r]){const[a,o]=w(this,Te,Oi).call(this),l=n(this,_e),[h,c,u,f]=l;if(l[0]=t,l[1]=s,l[2]=i,l[3]=r,Math.abs(u-a)<=W.PRECISION||Math.abs(f-o)<=W.PRECISION){const b=t+i/2-(h+u/2),S=s+r/2-(c+f/2);for(const{line:E,points:T}of n(this,vs))W._translate(E,b,S,E),W._translate(T,b,S,T);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${W.svgRound(t)} ${W.svgRound(s)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const p=(i-2*a)/(u-2*a),v=(r-2*o)/(f-2*o),m=-p*(h+a)+t+a,A=-v*(c+o)+s+o;if(p!==1||v!==1||m!==0||A!==0)for(const{line:b,points:S}of n(this,vs))W._rescale(b,m,A,p,v,b),W._rescale(S,m,A,p,v,S);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${W.svgRound(t)} ${W.svgRound(s)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([t,s],i){const[r,a]=i,o=n(this,_e),l=t-o[0],h=s-o[1];if(n(this,xi)===r&&n(this,Ti)===a)for(const{line:c,points:u}of n(this,vs))W._translate(c,l,h,c),W._translate(u,l,h,u);else{const c=n(this,xi)/r,u=n(this,Ti)/a;g(this,xi,r),g(this,Ti,a);for(const{line:f,points:p}of n(this,vs))W._rescale(f,l,h,c,u,f),W._rescale(p,l,h,c,u,p);o[2]*=c,o[3]*=u}return o[0]=t,o[1]=s,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${W.svgRound(t)} ${W.svgRound(s)}`}}}get defaultSVGProperties(){const t=n(this,_e);return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${W.svgRound(t[0])} ${W.svgRound(t[1])}`,transform:this.rotationTransform||null},bbox:t}}}_e=new WeakMap,Zc=new WeakMap,qc=new WeakMap,vs=new WeakMap,xi=new WeakMap,Ti=new WeakMap,Cl=new WeakMap,Rl=new WeakMap,La=new WeakMap,Te=new WeakSet,Oi=function(t=n(this,La)){const s=n(this,qc)+t/2*n(this,Cl);return n(this,Rl)%180===0?[s/n(this,xi),s/n(this,Ti)]:[s/n(this,Ti),s/n(this,xi)]},hv=function(){const[t,s,i,r]=n(this,_e),[a,o]=w(this,Te,Oi).call(this,0);return[t+a,s+o,i-2*a,r-2*o]},cv=function(){const t=g(this,_e,new Float32Array([1/0,1/0,-1/0,-1/0]));for(const{line:r}of n(this,vs)){if(r.length<=12){for(let l=4,h=r.length;l<h;l+=6)j.pointBoundingBox(r[l],r[l+1],t);continue}let a=r[4],o=r[5];for(let l=6,h=r.length;l<h;l+=6){const[c,u,f,p,v,m]=r.subarray(l,l+6);j.bezierBoundingBox(a,o,c,u,f,p,v,m,t),a=v,o=m}}const[s,i]=w(this,Te,Oi).call(this);t[0]=$e(t[0]-s,0,1),t[1]=$e(t[1]-i,0,1),t[2]=$e(t[2]+s,0,1),t[3]=$e(t[3]+i,0,1),t[2]-=t[0],t[3]-=t[1]},dv=function(t){const[s,i]=w(this,Te,Oi).call(this);g(this,La,t);const[r,a]=w(this,Te,Oi).call(this),[o,l]=[r-s,a-i],h=n(this,_e);return h[0]-=o,h[1]-=l,h[2]+=2*o,h[3]+=2*l,h};class ku extends ov{constructor(e){super(),this._viewParameters=e,super.updateProperties({fill:"none",stroke:Nt._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(e,t){e==="stroke-width"&&(t??(t=this["stroke-width"]),t*=this._viewParameters.realScale),super.updateSVGProperty(e,t)}clone(){const e=new ku(this._viewParameters);return e.updateAll(this),e}}var Pu,uv;const ro=class ro extends cu{constructor(t){super({...t,name:"inkEditor"});y(this,Pu);this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(t,s){Nt.initialize(t,s),this._defaultDrawingOptions=new ku(s.viewParameters)}static getDefaultDrawingOptions(t){const s=this._defaultDrawingOptions.clone();return s.updateProperties(t),s}static get supportMultipleDrawings(){return!0}static get typesMap(){return Q(this,"typesMap",new Map([[dt.INK_THICKNESS,"stroke-width"],[dt.INK_COLOR,"stroke"],[dt.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(t,s,i,r,a){return new xb(t,s,i,r,a,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(t,s,i,r,a,o){return od.deserialize(t,s,i,r,a,o)}static async deserialize(t,s,i){let r=null;if(t instanceof Pp){const{data:{inkLists:o,rect:l,rotation:h,id:c,color:u,opacity:f,borderStyle:{rawWidth:p},popupRef:v,richText:m,contentsObj:A,creationDate:b,modificationDate:S},parent:{page:{pageNumber:E}}}=t;r=t={annotationType:et.INK,color:Array.from(u),thickness:p,opacity:f,paths:{points:o},boxes:null,pageIndex:E-1,rect:l.slice(0),rotation:h,annotationElementId:c,id:c,deleted:!1,popupRef:v,richText:m,comment:(A==null?void 0:A.str)||null,creationDate:b,modificationDate:S}}const a=await super.deserialize(t,s,i);return a._initialData=r,t.comment&&a.setCommentData(t),a}get toolbarButtons(){return this._colorPicker||(this._colorPicker=new au(this)),[["colorPicker",this._colorPicker]]}get colorType(){return dt.INK_COLOR}get color(){return this._drawingOptions.stroke}get opacity(){return this._drawingOptions["stroke-opacity"]}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:t,_drawingOptions:s,parent:i}=this;s.updateSVGProperty("stroke-width"),i.drawLayer.updateProperties(t,s.toSVGProperties())}static onScaleChangingWhenDrawing(){const t=this._currentParent;t&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),t.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:t,thickness:s,opacity:i}){this._drawingOptions=ro.getDefaultDrawingOptions({stroke:j.makeHexColor(...t),"stroke-width":s,"stroke-opacity":i})}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:s,points:i}=this.serializeDraw(t),{_drawingOptions:{stroke:r,"stroke-opacity":a,"stroke-width":o}}=this,l=Object.assign(super.serialize(t),{color:Nt._colorManager.convert(r),opacity:a,thickness:o,paths:{lines:s,points:i}});return this.addComment(l),t?(l.isCopy=!0,l):this.annotationElementId&&!w(this,Pu,uv).call(this,l)?null:(l.id=this.annotationElementId,l)}renderAnnotationElement(t){if(this.deleted)return t.hide(),null;const{points:s,rect:i}=this.serializeDraw(!1);return t.updateEdited({rect:i,thickness:this._drawingOptions["stroke-width"],points:s,popup:this.comment}),null}};Pu=new WeakSet,uv=function(t){const{color:s,thickness:i,opacity:r,pageIndex:a}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized||t.color.some((o,l)=>o!==s[l])||t.thickness!==i||t.opacity!==r||t.pageIndex!==a},F(ro,"_type","ink"),F(ro,"_editorType",et.INK),F(ro,"_defaultDrawingOptions",null);let ap=ro;class op extends od{toSVGPath(){let e=super.toSVGPath();return e.endsWith("Z")||(e+="Z"),e}}const vd=8,_l=3;var Fa,yt,lp,Zs,fv,pv,hp,Wd,gv,mv,vv,cp,dp,yv;class vn{static extractContoursFromText(e,{fontFamily:t,fontStyle:s,fontWeight:i},r,a,o,l){let h=new OffscreenCanvas(1,1),c=h.getContext("2d",{alpha:!1});const u=200,f=c.font=`${s} ${i} ${u}px ${t}`,{actualBoundingBoxLeft:p,actualBoundingBoxRight:v,actualBoundingBoxAscent:m,actualBoundingBoxDescent:A,fontBoundingBoxAscent:b,fontBoundingBoxDescent:S,width:E}=c.measureText(e),T=1.5,x=Math.ceil(Math.max(Math.abs(p)+Math.abs(v)||0,E)*T),C=Math.ceil(Math.max(Math.abs(m)+Math.abs(A)||u,Math.abs(b)+Math.abs(S)||u)*T);h=new OffscreenCanvas(x,C),c=h.getContext("2d",{alpha:!0,willReadFrequently:!0}),c.font=f,c.filter="grayscale(1)",c.fillStyle="white",c.fillRect(0,0,x,C),c.fillStyle="black",c.fillText(e,x*(T-1)/2,C*(3-T)/2);const R=w(this,yt,cp).call(this,c.getImageData(0,0,x,C).data),I=w(this,yt,vv).call(this,R),P=w(this,yt,dp).call(this,I),M=w(this,yt,hp).call(this,R,x,C,P);return this.processDrawnLines({lines:{curves:M,width:x,height:C},pageWidth:r,pageHeight:a,rotation:o,innerMargin:l,mustSmooth:!0,areContours:!0})}static process(e,t,s,i,r){const[a,o,l]=w(this,yt,yv).call(this,e),[h,c]=w(this,yt,mv).call(this,a,o,l,Math.hypot(o,l)*n(this,Fa).sigmaSFactor,n(this,Fa).sigmaR,n(this,Fa).kernelSize),u=w(this,yt,dp).call(this,c),f=w(this,yt,hp).call(this,h,o,l,u);return this.processDrawnLines({lines:{curves:f,width:o,height:l},pageWidth:t,pageHeight:s,rotation:i,innerMargin:r,mustSmooth:!0,areContours:!0})}static processDrawnLines({lines:e,pageWidth:t,pageHeight:s,rotation:i,innerMargin:r,mustSmooth:a,areContours:o}){i%180!==0&&([t,s]=[s,t]);const{curves:l,width:h,height:c}=e,u=e.thickness??0,f=[],p=Math.min(t/h,s/c),v=p/t,m=p/s,A=[];for(const{points:S}of l){const E=a?w(this,yt,gv).call(this,S):S;if(!E)continue;A.push(E);const T=E.length,x=new Float32Array(T),C=new Float32Array(3*(T===2?2:T-2));if(f.push({line:C,points:x}),T===2){x[0]=E[0]*v,x[1]=E[1]*m,C.set([NaN,NaN,NaN,NaN,x[0],x[1]],0);continue}let[R,I,P,M]=E;R*=v,I*=m,P*=v,M*=m,x.set([R,I,P,M],0),C.set([NaN,NaN,NaN,NaN,R,I],0);for(let D=4;D<T;D+=2){const _=x[D]=E[D]*v,k=x[D+1]=E[D+1]*m;C.set(W.createBezierPoints(R,I,P,M,_,k),(D-2)*3),[R,I,P,M]=[P,M,_,k]}}if(f.length===0)return null;const b=o?new op:new od;return b.build(f,t,s,1,i,o?0:u,r),{outline:b,newCurves:A,areContours:o,thickness:u,width:h,height:c}}static async compressSignature({outlines:e,areContours:t,thickness:s,width:i,height:r}){let a=1/0,o=-1/0,l=0;for(const E of e){l+=E.length;for(let T=2,x=E.length;T<x;T++){const C=E[T]-E[T-2];a=Math.min(a,C),o=Math.max(o,C)}}let h;a>=-128&&o<=127?h=Int8Array:a>=-32768&&o<=32767?h=Int16Array:h=Int32Array;const c=e.length,u=vd+_l*c,f=new Uint32Array(u);let p=0;f[p++]=u*Uint32Array.BYTES_PER_ELEMENT+(l-2*c)*h.BYTES_PER_ELEMENT,f[p++]=0,f[p++]=i,f[p++]=r,f[p++]=t?0:1,f[p++]=Math.max(0,Math.floor(s??0)),f[p++]=c,f[p++]=h.BYTES_PER_ELEMENT;for(const E of e)f[p++]=E.length-2,f[p++]=E[0],f[p++]=E[1];const v=new CompressionStream("deflate-raw"),m=v.writable.getWriter();await m.ready,m.write(f);const A=h.prototype.constructor;for(const E of e){const T=new A(E.length-2);for(let x=2,C=E.length;x<C;x++)T[x-2]=E[x]-E[x-2];m.write(T)}m.close();const b=await new Response(v.readable).arrayBuffer(),S=new Uint8Array(b);return vg(S)}static async decompressSignature(e){try{const t=_v(e),{readable:s,writable:i}=new DecompressionStream("deflate-raw"),r=i.getWriter();await r.ready,r.write(t).then(async()=>{await r.ready,await r.close()}).catch(()=>{});let a=null,o=0;for await(const E of s)a||(a=new Uint8Array(new Uint32Array(E.buffer,0,4)[0])),a.set(E,o),o+=E.length;const l=new Uint32Array(a.buffer,0,a.length>>2),h=l[1];if(h!==0)throw new Error(`Invalid version: ${h}`);const c=l[2],u=l[3],f=l[4]===0,p=l[5],v=l[6],m=l[7],A=[],b=(vd+_l*v)*Uint32Array.BYTES_PER_ELEMENT;let S;switch(m){case Int8Array.BYTES_PER_ELEMENT:S=new Int8Array(a.buffer,b);break;case Int16Array.BYTES_PER_ELEMENT:S=new Int16Array(a.buffer,b);break;case Int32Array.BYTES_PER_ELEMENT:S=new Int32Array(a.buffer,b);break}o=0;for(let E=0;E<v;E++){const T=l[_l*E+vd],x=new Float32Array(T+2);A.push(x);for(let C=0;C<_l-1;C++)x[C]=l[_l*E+vd+C+1];for(let C=0;C<T;C++)x[C+2]=x[C]+S[o++]}return{areContours:f,thickness:p,outlines:A,width:c,height:u}}catch(t){return J(`decompressSignature: ${t}`),null}}}Fa=new WeakMap,yt=new WeakSet,lp=function(e,t,s,i){return s-=e,i-=t,s===0?i>0?0:4:s===1?i+6:2-i},Zs=new WeakMap,fv=function(e,t,s,i,r,a,o){const l=w(this,yt,lp).call(this,s,i,r,a);for(let h=0;h<8;h++){const c=(-h+l-o+16)%8,u=n(this,Zs)[2*c],f=n(this,Zs)[2*c+1];if(e[(s+u)*t+(i+f)]!==0)return c}return-1},pv=function(e,t,s,i,r,a,o){const l=w(this,yt,lp).call(this,s,i,r,a);for(let h=0;h<8;h++){const c=(h+l+o+16)%8,u=n(this,Zs)[2*c],f=n(this,Zs)[2*c+1];if(e[(s+u)*t+(i+f)]!==0)return c}return-1},hp=function(e,t,s,i){const r=e.length,a=new Int32Array(r);for(let c=0;c<r;c++)a[c]=e[c]<=i?1:0;for(let c=1;c<s-1;c++)a[c*t]=a[c*t+t-1]=0;for(let c=0;c<t;c++)a[c]=a[t*s-1-c]=0;let o=1,l;const h=[];for(let c=1;c<s-1;c++){l=1;for(let u=1;u<t-1;u++){const f=c*t+u,p=a[f];if(p===0)continue;let v=c,m=u;if(p===1&&a[f-1]===0)o+=1,m-=1;else if(p>=1&&a[f+1]===0)o+=1,m+=1,p>1&&(l=p);else{p!==1&&(l=Math.abs(p));continue}const A=[u,c],b=m===u+1,S={isHole:b,points:A,id:o,parent:0};h.push(S);let E;for(const D of h)if(D.id===l){E=D;break}E?E.isHole?S.parent=b?E.parent:l:S.parent=b?l:E.parent:S.parent=b?l:0;const T=w(this,yt,fv).call(this,a,t,c,u,v,m,0);if(T===-1){a[f]=-o,a[f]!==1&&(l=Math.abs(a[f]));continue}let x=n(this,Zs)[2*T],C=n(this,Zs)[2*T+1];const R=c+x,I=u+C;v=R,m=I;let P=c,M=u;for(;;){const D=w(this,yt,pv).call(this,a,t,P,M,v,m,1);x=n(this,Zs)[2*D],C=n(this,Zs)[2*D+1];const _=P+x,k=M+C;A.push(k,_);const N=P*t+M;if(a[N+1]===0?a[N]=-o:a[N]===1&&(a[N]=o),_===c&&k===u&&P===R&&M===I){a[f]!==1&&(l=Math.abs(a[f]));break}else v=P,m=M,P=_,M=k}}}return h},Wd=function(e,t,s,i){if(s-t<=4){for(let R=t;R<s-2;R+=2)i.push(e[R],e[R+1]);return}const r=e[t],a=e[t+1],o=e[s-4]-r,l=e[s-3]-a,h=Math.hypot(o,l),c=o/h,u=l/h,f=c*a-u*r,p=l/o,v=1/h,m=Math.atan(p),A=Math.cos(m),b=Math.sin(m),S=v*(Math.abs(A)+Math.abs(b)),E=v*(1-S+S**2),T=Math.max(Math.atan(Math.abs(b+A)*E),Math.atan(Math.abs(b-A)*E));let x=0,C=t;for(let R=t+2;R<s-2;R+=2){const I=Math.abs(f-c*e[R+1]+u*e[R]);I>x&&(C=R,x=I)}x>(h*T)**2?(w(this,yt,Wd).call(this,e,t,C+2,i),w(this,yt,Wd).call(this,e,C,s,i)):i.push(r,a)},gv=function(e){const t=[],s=e.length;return w(this,yt,Wd).call(this,e,0,s,t),t.push(e[s-2],e[s-1]),t.length<=4?null:t},mv=function(e,t,s,i,r,a){const o=new Float32Array(a**2),l=-2*i**2,h=a>>1;for(let m=0;m<a;m++){const A=(m-h)**2;for(let b=0;b<a;b++)o[m*a+b]=Math.exp((A+(b-h)**2)/l)}const c=new Float32Array(256),u=-2*r**2;for(let m=0;m<256;m++)c[m]=Math.exp(m**2/u);const f=e.length,p=new Uint8Array(f),v=new Uint32Array(256);for(let m=0;m<s;m++)for(let A=0;A<t;A++){const b=m*t+A,S=e[b];let E=0,T=0;for(let C=0;C<a;C++){const R=m+C-h;if(!(R<0||R>=s))for(let I=0;I<a;I++){const P=A+I-h;if(P<0||P>=t)continue;const M=e[R*t+P],D=o[C*a+I]*c[Math.abs(M-S)];E+=M*D,T+=D}}const x=p[b]=Math.round(E/T);v[x]++}return[p,v]},vv=function(e){const t=new Uint32Array(256);for(const s of e)t[s]++;return t},cp=function(e){const t=e.length,s=new Uint8ClampedArray(t>>2);let i=-1/0,r=1/0;for(let o=0,l=s.length;o<l;o++){const h=s[o]=e[o<<2];i=Math.max(i,h),r=Math.min(r,h)}const a=255/(i-r);for(let o=0,l=s.length;o<l;o++)s[o]=(s[o]-r)*a;return s},dp=function(e){let t,s=-1/0,i=-1/0;const r=e.findIndex(l=>l!==0);let a=r,o=r;for(t=r;t<256;t++){const l=e[t];l>s&&(t-a>i&&(i=t-a,o=t-1),s=l,a=t)}for(t=o-1;t>=0&&!(e[t]>e[t+1]);t--);return t},yv=function(e){const t=e,{width:s,height:i}=e,{maxDim:r}=n(this,Fa);let a=s,o=i;if(s>r||i>r){let f=s,p=i,v=Math.log2(Math.max(s,i)/r);const m=Math.floor(v);v=v===m?m-1:m;for(let b=0;b<v;b++){a=Math.ceil(f/2),o=Math.ceil(p/2);const S=new OffscreenCanvas(a,o);S.getContext("2d").drawImage(e,0,0,f,p,0,0,a,o),f=a,p=o,e!==t&&e.close(),e=S.transferToImageBitmap()}const A=Math.min(r/a,r/o);a=Math.round(a*A),o=Math.round(o*A)}const h=new OffscreenCanvas(a,o).getContext("2d",{willReadFrequently:!0});h.fillStyle="white",h.fillRect(0,0,a,o),h.filter="grayscale(1)",h.drawImage(e,0,0,e.width,e.height,0,0,a,o);const c=h.getImageData(0,0,a,o).data;return[w(this,yt,cp).call(this,c),a,o]},y(vn,yt),y(vn,Fa,{maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16}),y(vn,Zs,new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]));class Ip extends ov{constructor(){super(),super.updateProperties({fill:Nt._defaultLineColor,"stroke-width":0})}clone(){const e=new Ip;return e.updateAll(this),e}}class Dp extends ku{constructor(e){super(e),super.updateProperties({stroke:Nt._defaultLineColor,"stroke-width":1})}clone(){const e=new Dp(this._viewParameters);return e.updateAll(this),e}}var ar,Ci,or,ka;const qe=class qe extends cu{constructor(t){super({...t,mustBeCommitted:!0,name:"signatureEditor"});y(this,ar,!1);y(this,Ci,null);y(this,or,null);y(this,ka,null);this._willKeepAspectRatio=!0,g(this,or,t.signatureData||null),g(this,Ci,null),this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(t,s){Nt.initialize(t,s),this._defaultDrawingOptions=new Ip,this._defaultDrawnSignatureOptions=new Dp(s.viewParameters)}static getDefaultDrawingOptions(t){const s=this._defaultDrawingOptions.clone();return s.updateProperties(t),s}static get supportMultipleDrawings(){return!1}static get typesMap(){return Q(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!n(this,Ci)}}static computeTelemetryFinalData(t){const s=t.get("hasDescription");return{hasAltText:s.get(!0)??0,hasNoAltText:s.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){this._drawId!==null&&super.onScaleChanging()}render(){if(this.div)return this.div;let t,s;const{_isCopy:i}=this;if(i&&(this._isCopy=!1,t=this.x,s=this.y),super.render(),this._drawId===null)if(n(this,or)){const{lines:r,mustSmooth:a,areContours:o,description:l,uuid:h,heightInPage:c}=n(this,or),{rawDims:{pageWidth:u,pageHeight:f},rotation:p}=this.parent.viewport,v=vn.processDrawnLines({lines:r,pageWidth:u,pageHeight:f,rotation:p,innerMargin:qe._INNER_MARGIN,mustSmooth:a,areContours:o});this.addSignature(v,c,l,h)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this);else this.div.setAttribute("data-l10n-args",JSON.stringify({description:n(this,Ci)||""}));return i&&(this._isCopy=!0,this._moveAfterPaste(t,s)),this.div}setUuid(t){g(this,ka,t),this.addEditToolbar()}getUuid(){return n(this,ka)}get description(){return n(this,Ci)}set description(t){g(this,Ci,t),this.div&&(this.div.setAttribute("data-l10n-args",JSON.stringify({description:t})),super.addEditToolbar().then(s=>{s==null||s.updateEditSignatureButton(t)}))}getSignaturePreview(){const{newCurves:t,areContours:s,thickness:i,width:r,height:a}=n(this,or),o=Math.max(r,a),l=vn.processDrawnLines({lines:{curves:t.map(h=>({points:h})),thickness:i,width:r,height:a},pageWidth:o,pageHeight:o,rotation:0,innerMargin:0,mustSmooth:!1,areContours:s});return{areContours:s,outline:l.outline}}get toolbarButtons(){return this._uiManager.signatureManager?[["editSignature",this._uiManager.signatureManager]]:super.toolbarButtons}addSignature(t,s,i,r){const{x:a,y:o}=this,{outline:l}=g(this,or,t);g(this,ar,l instanceof op),this.description=i;let h;n(this,ar)?h=qe.getDefaultDrawingOptions():(h=qe._defaultDrawnSignatureOptions.clone(),h.updateProperties({"stroke-width":l.thickness})),this._addOutlines({drawOutlines:l,drawingOptions:h});const[,c]=this.pageDimensions;let u=s/c;u=u>=1?.5:u,this.width*=u/this.height,this.width>=1&&(u*=.9/this.width,this.width=.9),this.height=u,this.setDims(),this.x=a,this.y=o,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(r),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!r,hasDescription:!!i}}),this.div.hidden=!1}getFromImage(t){const{rawDims:{pageWidth:s,pageHeight:i},rotation:r}=this.parent.viewport;return vn.process(t,s,i,r,qe._INNER_MARGIN)}getFromText(t,s){const{rawDims:{pageWidth:i,pageHeight:r},rotation:a}=this.parent.viewport;return vn.extractContoursFromText(t,s,i,r,a,qe._INNER_MARGIN)}getDrawnSignature(t){const{rawDims:{pageWidth:s,pageHeight:i},rotation:r}=this.parent.viewport;return vn.processDrawnLines({lines:t,pageWidth:s,pageHeight:i,rotation:r,innerMargin:qe._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions({areContours:t,thickness:s}){t?this._drawingOptions=qe.getDefaultDrawingOptions():(this._drawingOptions=qe._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":s}))}serialize(t=!1){if(this.isEmpty())return null;const{lines:s,points:i}=this.serializeDraw(t),{_drawingOptions:{"stroke-width":r}}=this,a=Object.assign(super.serialize(t),{isSignature:!0,areContours:n(this,ar),color:[0,0,0],thickness:n(this,ar)?0:r});return this.addComment(a),t?(a.paths={lines:s,points:i},a.uuid=n(this,ka),a.isCopy=!0):a.lines=s,n(this,Ci)&&(a.accessibilityData={type:"Figure",alt:n(this,Ci)}),a}static deserializeDraw(t,s,i,r,a,o){return o.areContours?op.deserialize(t,s,i,r,a,o):od.deserialize(t,s,i,r,a,o)}static async deserialize(t,s,i){var a;const r=await super.deserialize(t,s,i);return g(r,ar,t.areContours),r.description=((a=t.accessibilityData)==null?void 0:a.alt)||"",g(r,ka,t.uuid),r}};ar=new WeakMap,Ci=new WeakMap,or=new WeakMap,ka=new WeakMap,F(qe,"_type","signature"),F(qe,"_editorType",et.SIGNATURE),F(qe,"_defaultDrawingOptions",null);let up=qe;var $t,me,lr,dn,hr,Pl,un,Na,Ri,ys,Il,pt,nh,rh,Xd,Yd,Kd,pp,Jd,bv;class fp extends Nt{constructor(t){super({...t,name:"stampEditor"});y(this,pt);y(this,$t,null);y(this,me,null);y(this,lr,null);y(this,dn,null);y(this,hr,null);y(this,Pl,"");y(this,un,null);y(this,Na,!1);y(this,Ri,null);y(this,ys,!1);y(this,Il,!1);g(this,dn,t.bitmapUrl),g(this,hr,t.bitmapFile),this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(t,s){Nt.initialize(t,s)}static isHandlingMimeForPasting(t){return Qu.includes(t)}static paste(t,s){s.pasteEditor({mode:et.STAMP},{bitmapFile:t.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){var t;return{type:"stamp",hasAltText:!!((t=this.altTextData)!=null&&t.altText)}}static computeTelemetryFinalData(t){const s=t.get("hasAltText");return{hasAltText:s.get(!0)??0,hasNoAltText:s.get(!1)??0}}async mlGuessAltText(t=null,s=!0){if(this.hasAltTextData())return null;const{mlManager:i}=this._uiManager;if(!i)throw new Error("No ML.");if(!await i.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:r,width:a,height:o}=t||this.copyCanvas(null,null,!0).imageData,l=await i.guess({name:"altText",request:{data:r,width:a,height:o,channels:r.length/(a*o)}});if(!l)throw new Error("No response from the AI service.");if(l.error)throw new Error("Error from the AI service.");if(l.cancel)return null;if(!l.output)throw new Error("No valid response from the AI service.");const h=l.output;return await this.setGuessedAltText(h),s&&!this.hasAltTextData()&&(this.altTextData={alt:h,decorative:!1}),h}remove(){var t;n(this,me)&&(g(this,$t,null),this._uiManager.imageManager.deleteId(n(this,me)),(t=n(this,un))==null||t.remove(),g(this,un,null),n(this,Ri)&&(clearTimeout(n(this,Ri)),g(this,Ri,null))),super.remove()}rebuild(){if(!this.parent){n(this,me)&&w(this,pt,Xd).call(this);return}super.rebuild(),this.div!==null&&(n(this,me)&&n(this,un)===null&&w(this,pt,Xd).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(t){this._isDraggable=!0,t&&this.div.focus()}isEmpty(){return!(n(this,lr)||n(this,$t)||n(this,dn)||n(this,hr)||n(this,me)||n(this,Na))}get toolbarButtons(){return[["altText",this.createAltText()]]}get isResizable(){return!0}render(){if(this.div)return this.div;let t,s;return this._isCopy&&(t=this.x,s=this.y),super.render(),this.div.hidden=!0,this.createAltText(),n(this,Na)||(n(this,$t)?w(this,pt,Yd).call(this):w(this,pt,Xd).call(this)),this._isCopy&&this._moveAfterPaste(t,s),this._uiManager.addShouldRescale(this),this.div}setCanvas(t,s){const{id:i,bitmap:r}=this._uiManager.imageManager.getFromCanvas(t,s);s.remove(),i&&this._uiManager.imageManager.isValidId(i)&&(g(this,me,i),r&&g(this,$t,r),g(this,Na,!1),w(this,pt,Yd).call(this))}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;n(this,Ri)!==null&&clearTimeout(n(this,Ri)),g(this,Ri,setTimeout(()=>{g(this,Ri,null),w(this,pt,pp).call(this)},200))}copyCanvas(t,s,i=!1){t||(t=224);const{width:r,height:a}=n(this,$t),o=new Pi;let l=n(this,$t),h=r,c=a,u=null;if(s){if(r>s||a>s){const R=Math.min(s/r,s/a);h=Math.floor(r*R),c=Math.floor(a*R)}u=document.createElement("canvas");const p=u.width=Math.ceil(h*o.sx),v=u.height=Math.ceil(c*o.sy);n(this,ys)||(l=w(this,pt,Kd).call(this,p,v));const m=u.getContext("2d");m.filter=this._uiManager.hcmFilter;let A="white",b="#cfcfd8";this._uiManager.hcmFilter!=="none"?b="black":Gv.isDarkMode&&(A="#8f8f9d",b="#42414d");const S=15,E=S*o.sx,T=S*o.sy,x=new OffscreenCanvas(E*2,T*2),C=x.getContext("2d");C.fillStyle=A,C.fillRect(0,0,E*2,T*2),C.fillStyle=b,C.fillRect(0,0,E,T),C.fillRect(E,T,E,T),m.fillStyle=m.createPattern(x,"repeat"),m.fillRect(0,0,p,v),m.drawImage(l,0,0,l.width,l.height,0,0,p,v)}let f=null;if(i){let p,v;if(o.symmetric&&l.width<t&&l.height<t)p=l.width,v=l.height;else if(l=n(this,$t),r>t||a>t){const b=Math.min(t/r,t/a);p=Math.floor(r*b),v=Math.floor(a*b),n(this,ys)||(l=w(this,pt,Kd).call(this,p,v))}const A=new OffscreenCanvas(p,v).getContext("2d",{willReadFrequently:!0});A.drawImage(l,0,0,l.width,l.height,0,0,p,v),f={width:p,height:v,data:A.getImageData(0,0,p,v).data}}return{canvas:u,width:h,height:c,imageData:f}}static async deserialize(t,s,i){var A;let r=null,a=!1;if(t instanceof km){const{data:{rect:b,rotation:S,id:E,structParent:T,popupRef:x,richText:C,contentsObj:R,creationDate:I,modificationDate:P},container:M,parent:{page:{pageNumber:D}},canvas:_}=t;let k,N;_?(delete t.canvas,{id:k,bitmap:N}=i.imageManager.getFromCanvas(M.id,_),_.remove()):(a=!0,t._hasNoCanvas=!0);const G=((A=await s._structTree.getAriaAttributes(`${to}${E}`))==null?void 0:A.get("aria-label"))||"";r=t={annotationType:et.STAMP,bitmapId:k,bitmap:N,pageIndex:D-1,rect:b.slice(0),rotation:S,annotationElementId:E,id:E,deleted:!1,accessibilityData:{decorative:!1,altText:G},isSvg:!1,structParent:T,popupRef:x,richText:C,comment:(R==null?void 0:R.str)||null,creationDate:I,modificationDate:P}}const o=await super.deserialize(t,s,i),{rect:l,bitmap:h,bitmapUrl:c,bitmapId:u,isSvg:f,accessibilityData:p}=t;a?(i.addMissingCanvas(t.id,o),g(o,Na,!0)):u&&i.imageManager.isValidId(u)?(g(o,me,u),h&&g(o,$t,h)):g(o,dn,c),g(o,ys,f);const[v,m]=o.pageDimensions;return o.width=(l[2]-l[0])/v,o.height=(l[3]-l[1])/m,p&&(o.altTextData=p),o._initialData=r,t.comment&&o.setCommentData(t),g(o,Il,!!r),o}serialize(t=!1,s=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const i=Object.assign(super.serialize(t),{bitmapId:n(this,me),isSvg:n(this,ys)});if(this.addComment(i),t)return i.bitmapUrl=w(this,pt,Jd).call(this,!0),i.accessibilityData=this.serializeAltText(!0),i.isCopy=!0,i;const{decorative:r,altText:a}=this.serializeAltText(!1);if(!r&&a&&(i.accessibilityData={type:"Figure",alt:a}),this.annotationElementId){const l=w(this,pt,bv).call(this,i);return l.isSame?null:(l.isSameAltText?delete i.accessibilityData:i.accessibilityData.structParent=this._initialData.structParent??-1,i.id=this.annotationElementId,delete i.bitmapId,i)}if(s===null)return i;s.stamps||(s.stamps=new Map);const o=n(this,ys)?(i.rect[2]-i.rect[0])*(i.rect[3]-i.rect[1]):null;if(!s.stamps.has(n(this,me)))s.stamps.set(n(this,me),{area:o,serialized:i}),i.bitmap=w(this,pt,Jd).call(this,!1);else if(n(this,ys)){const l=s.stamps.get(n(this,me));o>l.area&&(l.area=o,l.serialized.bitmap.close(),l.serialized.bitmap=w(this,pt,Jd).call(this,!1))}return i}renderAnnotationElement(t){return this.deleted?(t.hide(),null):(t.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}}$t=new WeakMap,me=new WeakMap,lr=new WeakMap,dn=new WeakMap,hr=new WeakMap,Pl=new WeakMap,un=new WeakMap,Na=new WeakMap,Ri=new WeakMap,ys=new WeakMap,Il=new WeakMap,pt=new WeakSet,nh=function(t,s=!1){if(!t){this.remove();return}g(this,$t,t.bitmap),s||(g(this,me,t.id),g(this,ys,t.isSvg)),t.file&&g(this,Pl,t.file.name),w(this,pt,Yd).call(this)},rh=function(){if(g(this,lr,null),this._uiManager.enableWaiting(!1),!!n(this,un)){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&n(this,$t)){this.addEditToolbar().then(()=>{this._editToolbar.hide(),this._uiManager.editAltText(this,!0)});return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&n(this,$t)){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}},Xd=function(){if(n(this,me)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(n(this,me)).then(i=>w(this,pt,nh).call(this,i,!0)).finally(()=>w(this,pt,rh).call(this));return}if(n(this,dn)){const i=n(this,dn);g(this,dn,null),this._uiManager.enableWaiting(!0),g(this,lr,this._uiManager.imageManager.getFromUrl(i).then(r=>w(this,pt,nh).call(this,r)).finally(()=>w(this,pt,rh).call(this)));return}if(n(this,hr)){const i=n(this,hr);g(this,hr,null),this._uiManager.enableWaiting(!0),g(this,lr,this._uiManager.imageManager.getFromFile(i).then(r=>w(this,pt,nh).call(this,r)).finally(()=>w(this,pt,rh).call(this)));return}const t=document.createElement("input");t.type="file",t.accept=Qu.join(",");const s=this._uiManager._signal;g(this,lr,new Promise(i=>{t.addEventListener("change",async()=>{if(!t.files||t.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const r=await this._uiManager.imageManager.getFromFile(t.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),w(this,pt,nh).call(this,r)}i()},{signal:s}),t.addEventListener("cancel",()=>{this.remove(),i()},{signal:s})}).finally(()=>w(this,pt,rh).call(this))),t.click()},Yd=function(){var h;const{div:t}=this;let{width:s,height:i}=n(this,$t);const[r,a]=this.pageDimensions,o=.75;if(this.width)s=this.width*r,i=this.height*a;else if(s>o*r||i>o*a){const c=Math.min(o*r/s,o*a/i);s*=c,i*=c}this._uiManager.enableWaiting(!1);const l=g(this,un,document.createElement("canvas"));l.setAttribute("role","img"),this.addContainer(l),this.width=s/r,this.height=i/a,this.setDims(),(h=this._initialOptions)!=null&&h.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(t.hidden=!1),w(this,pt,pp).call(this),n(this,Il)||(this.parent.addUndoableEditor(this),g(this,Il,!0)),this._reportTelemetry({action:"inserted_image"}),n(this,Pl)&&this.div.setAttribute("aria-description",n(this,Pl)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-stamp-added-alert")},Kd=function(t,s){const{width:i,height:r}=n(this,$t);let a=i,o=r,l=n(this,$t);for(;a>2*t||o>2*s;){const h=a,c=o;a>2*t&&(a=a>=16384?Math.floor(a/2)-1:Math.ceil(a/2)),o>2*s&&(o=o>=16384?Math.floor(o/2)-1:Math.ceil(o/2));const u=new OffscreenCanvas(a,o);u.getContext("2d").drawImage(l,0,0,h,c,0,0,a,o),l=u.transferToImageBitmap()}return l},pp=function(){const[t,s]=this.parentDimensions,{width:i,height:r}=this,a=new Pi,o=Math.ceil(i*t*a.sx),l=Math.ceil(r*s*a.sy),h=n(this,un);if(!h||h.width===o&&h.height===l)return;h.width=o,h.height=l;const c=n(this,ys)?n(this,$t):w(this,pt,Kd).call(this,o,l),u=h.getContext("2d");u.filter=this._uiManager.hcmFilter,u.drawImage(c,0,0,c.width,c.height,0,0,o,l)},Jd=function(t){if(t){if(n(this,ys)){const r=this._uiManager.imageManager.getSvgUrl(n(this,me));if(r)return r}const s=document.createElement("canvas");return{width:s.width,height:s.height}=n(this,$t),s.getContext("2d").drawImage(n(this,$t),0,0),s.toDataURL()}if(n(this,ys)){const[s,i]=this.pageDimensions,r=Math.round(this.width*s*mr.PDF_TO_CSS_UNITS),a=Math.round(this.height*i*mr.PDF_TO_CSS_UNITS),o=new OffscreenCanvas(r,a);return o.getContext("2d").drawImage(n(this,$t),0,0,n(this,$t).width,n(this,$t).height,0,0,r,a),o.transferToImageBitmap()}return structuredClone(n(this,$t))},bv=function(t){var o;const{pageIndex:s,accessibilityData:{altText:i}}=this._initialData,r=t.pageIndex===s,a=(((o=t.accessibilityData)==null?void 0:o.alt)||"")===i;return{isSame:!this.hasEditedComment&&!this._hasBeenMoved&&!this._hasBeenResized&&r&&a,isSameAltText:a}},F(fp,"_type","stamp"),F(fp,"_editorType",et.STAMP);var Ba,Dl,cr,dr,fn,Qe,ur,Ml,Ol,qs,pn,ve,gn,fr,Ll,X,pr,Mt,mp,Av,ri,vp,yp,Qd;const js=class js{constructor({uiManager:e,pageIndex:t,div:s,structTreeLayer:i,accessibilityManager:r,annotationLayer:a,drawLayer:o,textLayer:l,viewport:h,l10n:c}){y(this,Mt);y(this,Ba);y(this,Dl,!1);y(this,cr,null);y(this,dr,null);y(this,fn,null);y(this,Qe,new Map);y(this,ur,!1);y(this,Ml,!1);y(this,Ol,!1);y(this,qs,null);y(this,pn,null);y(this,ve,null);y(this,gn,null);y(this,fr,null);y(this,Ll,-1);y(this,X);const u=[...n(js,pr).values()];if(!js._initialized){js._initialized=!0;for(const f of u)f.initialize(c,e)}e.registerEditorTypes(u),g(this,X,e),this.pageIndex=t,this.div=s,g(this,Ba,r),g(this,cr,a),this.viewport=h,g(this,ve,l),this.drawLayer=o,this._structTree=i,n(this,X).addLayer(this)}get isEmpty(){return n(this,Qe).size===0}get isInvisible(){return this.isEmpty&&n(this,X).getMode()===et.NONE}updateToolbar(e){n(this,X).updateToolbar(e)}updateMode(e=n(this,X).getMode()){switch(w(this,Mt,Qd).call(this),e){case et.NONE:this.div.classList.toggle("nonEditing",!0),this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case et.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case et.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:t}=this.div;if(t.toggle("nonEditing",!1),e===et.POPUP)t.toggle("commentEditing",!0);else{t.toggle("commentEditing",!1);for(const s of n(js,pr).values())t.toggle(`${s._type}Editing`,e===s._editorType)}this.div.hidden=!1}hasTextLayer(e){var t;return e===((t=n(this,ve))==null?void 0:t.div)}setEditingState(e){n(this,X).setEditingState(e)}addCommands(e){n(this,X).addCommands(e)}cleanUndoStack(e){n(this,X).cleanUndoStack(e)}toggleDrawing(e=!1){this.div.classList.toggle("drawing",!e)}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}toggleAnnotationLayerPointerEvents(e=!1){var t;(t=n(this,cr))==null||t.togglePointerEvents(e)}async enable(){var s;g(this,Ol,!0),this.div.tabIndex=0,this.togglePointerEvents(!0),this.div.classList.toggle("nonEditing",!1),(s=n(this,fr))==null||s.abort(),g(this,fr,null);const e=new Set;for(const i of n(this,Mt,mp))i.enableEditing(),i.show(!0),i.annotationElementId&&(n(this,X).removeChangedExistingAnnotation(i),e.add(i.annotationElementId));const t=n(this,cr);if(t)for(const i of t.getEditableAnnotations()){if(i.hide(),n(this,X).isDeletedAnnotationElement(i.data.id)||e.has(i.data.id))continue;const r=await this.deserialize(i);r&&(this.addOrRebuild(r),r.enableEditing())}g(this,Ol,!1),n(this,X)._eventBus.dispatch("editorsrendered",{source:this,pageNumber:this.pageIndex+1})}disable(){var i;if(g(this,Ml,!0),this.div.tabIndex=-1,this.togglePointerEvents(!1),this.div.classList.toggle("nonEditing",!0),n(this,ve)&&!n(this,fr)){g(this,fr,new AbortController);const r=n(this,X).combinedSignal(n(this,fr));n(this,ve).div.addEventListener("pointerdown",a=>{const{clientX:l,clientY:h,timeStamp:c}=a,u=n(this,Ll);if(c-u>500){g(this,Ll,c);return}g(this,Ll,-1);const{classList:f}=this.div;f.toggle("getElements",!0);const p=document.elementsFromPoint(l,h);if(f.toggle("getElements",!1),!this.div.contains(p[0]))return;let v;const m=new RegExp(`^${ah}[0-9]+$`);for(const b of p)if(m.test(b.id)){v=b.id;break}if(!v)return;const A=n(this,Qe).get(v);(A==null?void 0:A.annotationElementId)===null&&(a.stopPropagation(),a.preventDefault(),A.dblclick(a))},{signal:r,capture:!0})}const e=n(this,cr),t=[];if(e){const r=new Map,a=new Map;for(const l of n(this,Mt,mp)){if(l.disableEditing(),!l.annotationElementId){t.push(l);continue}if(l.serialize()!==null){r.set(l.annotationElementId,l);continue}else a.set(l.annotationElementId,l);(i=this.getEditableAnnotation(l.annotationElementId))==null||i.show(),l.remove()}const o=e.getEditableAnnotations();for(const l of o){const{id:h}=l.data;if(n(this,X).isDeletedAnnotationElement(h)){l.updateEdited({deleted:!0});continue}let c=a.get(h);if(c){c.resetAnnotationElement(l),c.show(!1),l.show();continue}c=r.get(h),c&&(n(this,X).addChangedExistingAnnotation(c),c.renderAnnotationElement(l)&&c.show(!1)),l.show()}}w(this,Mt,Qd).call(this),this.isEmpty&&(this.div.hidden=!0);const{classList:s}=this.div;for(const r of n(js,pr).values())s.remove(`${r._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),e==null||e.updateFakeAnnotations(t),g(this,Ml,!1)}getEditableAnnotation(e){var t;return((t=n(this,cr))==null?void 0:t.getEditableAnnotation(e))||null}setActiveEditor(e){n(this,X).getActive()!==e&&n(this,X).setActiveEditor(e)}enableTextSelection(){var e;if(this.div.tabIndex=-1,(e=n(this,ve))!=null&&e.div&&!n(this,gn)){g(this,gn,new AbortController);const t=n(this,X).combinedSignal(n(this,gn));n(this,ve).div.addEventListener("pointerdown",w(this,Mt,Av).bind(this),{signal:t}),n(this,ve).div.classList.add("highlighting")}}disableTextSelection(){var e;this.div.tabIndex=0,(e=n(this,ve))!=null&&e.div&&n(this,gn)&&(n(this,gn).abort(),g(this,gn,null),n(this,ve).div.classList.remove("highlighting"))}enableClick(){if(n(this,dr))return;g(this,dr,new AbortController);const e=n(this,X).combinedSignal(n(this,dr));this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:e});const t=this.pointerup.bind(this);this.div.addEventListener("pointerup",t,{signal:e}),this.div.addEventListener("pointercancel",t,{signal:e})}disableClick(){var e;(e=n(this,dr))==null||e.abort(),g(this,dr,null)}attach(e){n(this,Qe).set(e.id,e);const{annotationElementId:t}=e;t&&n(this,X).isDeletedAnnotationElement(t)&&n(this,X).removeDeletedAnnotationElement(e)}detach(e){var t;n(this,Qe).delete(e.id),(t=n(this,Ba))==null||t.removePointerInTextLayer(e.contentDiv),!n(this,Ml)&&e.annotationElementId&&n(this,X).addDeletedAnnotationElement(e)}remove(e){this.detach(e),n(this,X).removeEditor(e),e.div.remove(),e.isAttachedToDOM=!1}changeParent(e){var t;e.parent!==this&&(e.parent&&e.annotationElementId&&(n(this,X).addDeletedAnnotationElement(e),Nt.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),(t=e.parent)==null||t.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}add(e){if(!(e.parent===this&&e.isAttachedToDOM)){if(this.changeParent(e),n(this,X).addEditor(e),this.attach(e),!e.isAttachedToDOM){const t=e.render();this.div.append(t),e.isAttachedToDOM=!0}e.fixAndSetPosition(),e.onceAdded(!n(this,Ol)),n(this,X).addToAnnotationStorage(e),e._reportTelemetry(e.telemetryInitialData)}}moveEditorInDOM(e){var s;if(!e.isAttachedToDOM)return;const{activeElement:t}=document;e.div.contains(t)&&!n(this,fn)&&(e._focusEventsAllowed=!1,g(this,fn,setTimeout(()=>{g(this,fn,null),e.div.contains(document.activeElement)?e._focusEventsAllowed=!0:(e.div.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:n(this,X)._signal}),t.focus())},0))),e._structTreeParentId=(s=n(this,Ba))==null?void 0:s.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?(e.parent||(e.parent=this),e.rebuild(),e.show()):this.add(e)}addUndoableEditor(e){const t=()=>e._uiManager.rebuild(e),s=()=>{e.remove()};this.addCommands({cmd:t,undo:s,mustExec:!1})}getEditorByUID(e){for(const t of n(this,Qe).values())if(t.uid===e)return t;return null}getNextId(){return n(this,X).getId()}combinedSignal(e){return n(this,X).combinedSignal(e)}canCreateNewEmptyEditor(){var e;return(e=n(this,Mt,ri))==null?void 0:e.canCreateNewEmptyEditor()}async pasteEditor(e,t){this.updateToolbar(e),await n(this,X).updateMode(e.mode);const{offsetX:s,offsetY:i}=w(this,Mt,yp).call(this),r=this.getNextId(),a=w(this,Mt,vp).call(this,{parent:this,id:r,x:s,y:i,uiManager:n(this,X),isCentered:!0,...t});a&&this.add(a)}async deserialize(e){var t;return await((t=n(js,pr).get(e.annotationType??e.annotationEditorType))==null?void 0:t.deserialize(e,this,n(this,X)))||null}createAndAddNewEditor(e,t,s={}){const i=this.getNextId(),r=w(this,Mt,vp).call(this,{parent:this,id:i,x:e.offsetX,y:e.offsetY,uiManager:n(this,X),isCentered:t,...s});return r&&this.add(r),r}get boundingClientRect(){return this.div.getBoundingClientRect()}addNewEditor(e={}){this.createAndAddNewEditor(w(this,Mt,yp).call(this),!0,e)}setSelected(e){n(this,X).setSelected(e)}toggleSelected(e){n(this,X).toggleSelected(e)}unselect(e){n(this,X).unselect(e)}pointerup(e){var i;const{isMac:t}=he.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div||!n(this,ur)||(g(this,ur,!1),(i=n(this,Mt,ri))!=null&&i.isDrawer&&n(this,Mt,ri).supportMultipleDrawings))return;if(!n(this,Dl)){g(this,Dl,!0);return}const s=n(this,X).getMode();if(s===et.STAMP||s===et.SIGNATURE){n(this,X).unselectAll();return}this.createAndAddNewEditor(e,!1)}pointerdown(e){var i;if(n(this,X).getMode()===et.HIGHLIGHT&&this.enableTextSelection(),n(this,ur)){g(this,ur,!1);return}const{isMac:t}=he.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div)return;if(g(this,ur,!0),(i=n(this,Mt,ri))!=null&&i.isDrawer){this.startDrawingSession(e);return}const s=n(this,X).getActive();g(this,Dl,!s||s.isEmpty())}startDrawingSession(e){if(this.div.focus({preventScroll:!0}),n(this,qs)){n(this,Mt,ri).startDrawing(this,n(this,X),!1,e);return}n(this,X).setCurrentDrawingSession(this),g(this,qs,new AbortController);const t=n(this,X).combinedSignal(n(this,qs));this.div.addEventListener("blur",({relatedTarget:s})=>{s&&!this.div.contains(s)&&(g(this,pn,null),this.commitOrRemove())},{signal:t}),n(this,Mt,ri).startDrawing(this,n(this,X),!1,e)}pause(e){if(e){const{activeElement:t}=document;this.div.contains(t)&&g(this,pn,t);return}n(this,pn)&&setTimeout(()=>{var t;(t=n(this,pn))==null||t.focus(),g(this,pn,null)},0)}endDrawingSession(e=!1){return n(this,qs)?(n(this,X).setCurrentDrawingSession(null),n(this,qs).abort(),g(this,qs,null),g(this,pn,null),n(this,Mt,ri).endDrawing(e)):null}findNewParent(e,t,s){const i=n(this,X).findParent(t,s);return i===null||i===this?!1:(i.changeParent(e),!0)}commitOrRemove(){return n(this,qs)?(this.endDrawingSession(),!0):!1}onScaleChanging(){n(this,qs)&&n(this,Mt,ri).onScaleChangingWhenDrawing(this)}destroy(){var e,t;this.commitOrRemove(),((e=n(this,X).getActive())==null?void 0:e.parent)===this&&(n(this,X).commitOrRemove(),n(this,X).setActiveEditor(null)),n(this,fn)&&(clearTimeout(n(this,fn)),g(this,fn,null));for(const s of n(this,Qe).values())(t=n(this,Ba))==null||t.removePointerInTextLayer(s.contentDiv),s.setParent(null),s.isAttachedToDOM=!1,s.div.remove();this.div=null,n(this,Qe).clear(),n(this,X).removeLayer(this)}render({viewport:e}){this.viewport=e,Ua(this.div,e);for(const t of n(this,X).getEditors(this.pageIndex))this.add(t),t.rebuild();this.updateMode()}update({viewport:e}){n(this,X).commitOrRemove(),w(this,Mt,Qd).call(this);const t=this.viewport.rotation,s=e.rotation;if(this.viewport=e,Ua(this.div,{rotation:s}),t!==s)for(const i of n(this,Qe).values())i.rotate(s)}get pageDimensions(){const{pageWidth:e,pageHeight:t}=this.viewport.rawDims;return[e,t]}get scale(){return n(this,X).viewParameters.realScale}};Ba=new WeakMap,Dl=new WeakMap,cr=new WeakMap,dr=new WeakMap,fn=new WeakMap,Qe=new WeakMap,ur=new WeakMap,Ml=new WeakMap,Ol=new WeakMap,qs=new WeakMap,pn=new WeakMap,ve=new WeakMap,gn=new WeakMap,fr=new WeakMap,Ll=new WeakMap,X=new WeakMap,pr=new WeakMap,Mt=new WeakSet,mp=function(){return n(this,Qe).size!==0?n(this,Qe).values():n(this,X).getEditors(this.pageIndex)},Av=function(e){n(this,X).unselectAll();const{target:t}=e;if(t===n(this,ve).div||(t.getAttribute("role")==="img"||t.classList.contains("endOfContent"))&&n(this,ve).div.contains(t)){const{isMac:s}=he.platform;if(e.button!==0||e.ctrlKey&&s)return;n(this,X).showAllEditors("highlight",!0,!0),n(this,ve).div.classList.add("free"),this.toggleDrawing(),hu.startHighlighting(this,n(this,X).direction==="ltr",{target:n(this,ve).div,x:e.x,y:e.y}),n(this,ve).div.addEventListener("pointerup",()=>{n(this,ve).div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:n(this,X)._signal}),e.preventDefault()}},ri=function(){return n(js,pr).get(n(this,X).getMode())},vp=function(e){const t=n(this,Mt,ri);return t?new t.prototype.constructor(e):null},yp=function(){const{x:e,y:t,width:s,height:i}=this.boundingClientRect,r=Math.max(0,e),a=Math.max(0,t),o=Math.min(window.innerWidth,e+s),l=Math.min(window.innerHeight,t+i),h=(r+o)/2-e,c=(a+l)/2-t,[u,f]=this.viewport.rotation%180===0?[h,c]:[c,h];return{offsetX:u,offsetY:f}},Qd=function(){for(const e of n(this,Qe).values())e.isEmpty()&&e.remove()},F(js,"_initialized",!1),y(js,pr,new Map([Jf,ap,fp,hu,up].map(e=>[e._editorType,e])));let gp=js;var ti,Ue,_a,td,Iu,wv,Ii,Ap,Ev,wp;const re=class re{constructor({pageIndex:e}){y(this,Ii);y(this,ti,null);y(this,Ue,new Map);y(this,_a,new Map);this.pageIndex=e}setParent(e){if(!n(this,ti)){g(this,ti,e);return}if(n(this,ti)!==e){if(n(this,Ue).size>0)for(const t of n(this,Ue).values())t.remove(),e.append(t);g(this,ti,e)}}static get _svgFactory(){return Q(this,"_svgFactory",new ou)}draw(e,t=!1,s=!1){const i=ie(re,td)._++,r=w(this,Ii,Ap).call(this),a=re._svgFactory.createElement("defs");r.append(a);const o=re._svgFactory.createElement("path");a.append(o);const l=`path_p${this.pageIndex}_${i}`;o.setAttribute("id",l),o.setAttribute("vector-effect","non-scaling-stroke"),t&&n(this,_a).set(i,o);const h=s?w(this,Ii,Ev).call(this,a,l):null,c=re._svgFactory.createElement("use");return r.append(c),c.setAttribute("href",`#${l}`),this.updateProperties(r,e),n(this,Ue).set(i,r),{id:i,clipPathId:`url(#${h})`}}drawOutline(e,t){const s=ie(re,td)._++,i=w(this,Ii,Ap).call(this),r=re._svgFactory.createElement("defs");i.append(r);const a=re._svgFactory.createElement("path");r.append(a);const o=`path_p${this.pageIndex}_${s}`;a.setAttribute("id",o),a.setAttribute("vector-effect","non-scaling-stroke");let l;if(t){const u=re._svgFactory.createElement("mask");r.append(u),l=`mask_p${this.pageIndex}_${s}`,u.setAttribute("id",l),u.setAttribute("maskUnits","objectBoundingBox");const f=re._svgFactory.createElement("rect");u.append(f),f.setAttribute("width","1"),f.setAttribute("height","1"),f.setAttribute("fill","white");const p=re._svgFactory.createElement("use");u.append(p),p.setAttribute("href",`#${o}`),p.setAttribute("stroke","none"),p.setAttribute("fill","black"),p.setAttribute("fill-rule","nonzero"),p.classList.add("mask")}const h=re._svgFactory.createElement("use");i.append(h),h.setAttribute("href",`#${o}`),l&&h.setAttribute("mask",`url(#${l})`);const c=h.cloneNode();return i.append(c),h.classList.add("mainOutline"),c.classList.add("secondaryOutline"),this.updateProperties(i,e),n(this,Ue).set(s,i),s}finalizeDraw(e,t){n(this,_a).delete(e),this.updateProperties(e,t)}updateProperties(e,t){var l;if(!t)return;const{root:s,bbox:i,rootClass:r,path:a}=t,o=typeof e=="number"?n(this,Ue).get(e):e;if(o){if(s&&w(this,Ii,wp).call(this,o,s),i&&w(l=re,Iu,wv).call(l,o,i),r){const{classList:h}=o;for(const[c,u]of Object.entries(r))h.toggle(c,u)}if(a){const c=o.firstElementChild.firstElementChild;w(this,Ii,wp).call(this,c,a)}}}updateParent(e,t){if(t===this)return;const s=n(this,Ue).get(e);s&&(n(t,ti).append(s),n(this,Ue).delete(e),n(t,Ue).set(e,s))}remove(e){n(this,_a).delete(e),n(this,ti)!==null&&(n(this,Ue).get(e).remove(),n(this,Ue).delete(e))}destroy(){g(this,ti,null);for(const e of n(this,Ue).values())e.remove();n(this,Ue).clear(),n(this,_a).clear()}};ti=new WeakMap,Ue=new WeakMap,_a=new WeakMap,td=new WeakMap,Iu=new WeakSet,wv=function(e,[t,s,i,r]){const{style:a}=e;a.top=`${100*s}%`,a.left=`${100*t}%`,a.width=`${100*i}%`,a.height=`${100*r}%`},Ii=new WeakSet,Ap=function(){const e=re._svgFactory.create(1,1,!0);return n(this,ti).append(e),e.setAttribute("aria-hidden",!0),e},Ev=function(e,t){const s=re._svgFactory.createElement("clipPath");e.append(s);const i=`clip_${t}`;s.setAttribute("id",i),s.setAttribute("clipPathUnits","objectBoundingBox");const r=re._svgFactory.createElement("use");return s.append(r),r.setAttribute("href",`#${t}`),r.classList.add("clip"),i},wp=function(e,t){for(const[s,i]of Object.entries(t))i===null?e.removeAttribute(s):e.setAttribute(s,i)},y(re,Iu),y(re,td,0);let bp=re;globalThis._pdfjsTestingUtils={HighlightOutliner:Zf};globalThis.pdfjsLib={AbortException:gr,AnnotationEditorLayer:gp,AnnotationEditorParamsType:dt,AnnotationEditorType:et,AnnotationEditorUIManager:Ha,AnnotationLayer:Yf,AnnotationMode:xn,AnnotationType:te,applyOpacity:Wv,build:eb,ColorPicker:ru,createValidAbsoluteUrl:fg,CSSConstants:Vv,DOMSVGFactory:ou,DrawLayer:bp,FeatureTest:he,fetchData:sd,findContrastColor:Xv,getDocument:Ky,getFilenameFromUrl:Uv,getPdfFilenameFromUrl:Hv,getRGB:nd,getUuid:mg,getXfaPageViewport:jv,GlobalWorkerOptions:mn,ImageKind:yd,InvalidPDFException:Ku,isDataScheme:Lu,isPdfFile:Sp,isValidExplicitDest:ny,MathClamp:$e,noContextMenu:Hs,normalizeUnicode:Nv,OPS:oh,OutputScale:Pi,PasswordResponses:Rv,PDFDataRangeTransport:wm,PDFDateString:qd,PDFWorker:ch,PermissionFlag:Cv,PixelsPerInch:mr,RenderingCancelledException:Ep,renderRichText:bg,ResponseException:Zd,setLayerDimensions:Ua,shadow:Q,SignatureExtractor:vn,stopEvent:Jt,SupportedImageMimeTypes:Qu,TextLayer:hh,TouchManager:eu,updateUrlHash:pg,Util:j,VerbosityLevel:Du,version:tb,XfaLayer:yg};export{gr as AbortException,gp as AnnotationEditorLayer,dt as AnnotationEditorParamsType,et as AnnotationEditorType,Ha as AnnotationEditorUIManager,Yf as AnnotationLayer,xn as AnnotationMode,te as AnnotationType,Vv as CSSConstants,ru as ColorPicker,ou as DOMSVGFactory,bp as DrawLayer,he as FeatureTest,mn as GlobalWorkerOptions,yd as ImageKind,Ku as InvalidPDFException,$e as MathClamp,oh as OPS,Pi as OutputScale,wm as PDFDataRangeTransport,qd as PDFDateString,ch as PDFWorker,Rv as PasswordResponses,Cv as PermissionFlag,mr as PixelsPerInch,Ep as RenderingCancelledException,Zd as ResponseException,vn as SignatureExtractor,Qu as SupportedImageMimeTypes,hh as TextLayer,eu as TouchManager,j as Util,Du as VerbosityLevel,yg as XfaLayer,Wv as applyOpacity,eb as build,fg as createValidAbsoluteUrl,sd as fetchData,Xv as findContrastColor,Ky as getDocument,Uv as getFilenameFromUrl,Hv as getPdfFilenameFromUrl,nd as getRGB,mg as getUuid,jv as getXfaPageViewport,Lu as isDataScheme,Sp as isPdfFile,ny as isValidExplicitDest,Hs as noContextMenu,Nv as normalizeUnicode,bg as renderRichText,Ua as setLayerDimensions,Q as shadow,Jt as stopEvent,pg as updateUrlHash,tb as version};
